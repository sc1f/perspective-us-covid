{"version":3,"sources":["../../../src/js/data/ohlcData.js"],"names":["labelFunction","splitIntoMultiSeries","ohlcData","settings","data","excludeEmpty","map","seriesToOHLC","labelfn","getNextOpen","i","length","mainValues","name","mappedSeries","col","openValue","undefined","closeValue","crossValue","v","highValue","Math","max","lowValue","min","key","row"],"mappings":"AAAA;;;;;;;;AAQA,SAAQA,aAAR,QAA4B,mBAA5B;AACA,SAAQC,oBAAR,QAAmC,wBAAnC;AAEA,OAAO,SAASC,QAAT,CAAkBC,QAAlB,EAA4BC,IAA5B,EAAkC;AACrC,SAAOH,oBAAoB,CAACE,QAAD,EAAWC,IAAX,EAAiB;AAACC,IAAAA,YAAY,EAAE;AAAf,GAAjB,CAApB,CAA2DC,GAA3D,CAA+DF,IAAI,IAAIG,YAAY,CAACJ,QAAD,EAAWC,IAAX,CAAnF,CAAP;AACH;;AAED,SAASG,YAAT,CAAsBJ,QAAtB,EAAgCC,IAAhC,EAAsC;AAClC,QAAMI,OAAO,GAAGR,aAAa,CAACG,QAAD,CAA7B;;AAEA,QAAMM,WAAW,GAAGC,CAAC,IAAIN,IAAI,CAACM,CAAC,GAAGN,IAAI,CAACO,MAAL,GAAc,CAAlB,GAAsBD,CAAC,GAAG,CAA1B,GAA8BA,CAA/B,CAAJ,CAAsCP,QAAQ,CAACS,UAAT,CAAoB,CAApB,EAAuBC,IAA7D,CAAzB;;AACA,QAAMC,YAAY,GAAGV,IAAI,CAACE,GAAL,CAAS,CAACS,GAAD,EAAML,CAAN,KAAY;AACtC,UAAMM,SAAS,GAAGb,QAAQ,CAACS,UAAT,CAAoBD,MAApB,IAA8B,CAA9B,GAAkCI,GAAG,CAACZ,QAAQ,CAACS,UAAT,CAAoB,CAApB,EAAuBC,IAAxB,CAArC,GAAqEI,SAAvF;AACA,UAAMC,UAAU,GAAGf,QAAQ,CAACS,UAAT,CAAoBD,MAApB,IAA8B,CAA9B,GAAkCI,GAAG,CAACZ,QAAQ,CAACS,UAAT,CAAoB,CAApB,EAAuBC,IAAxB,CAArC,GAAqEJ,WAAW,CAACC,CAAD,CAAnG;AACA,WAAO;AACHS,MAAAA,UAAU,EAAEX,OAAO,CAACO,GAAD,EAAML,CAAN,CADhB;AAEHE,MAAAA,UAAU,EAAET,QAAQ,CAACS,UAAT,CAAoBN,GAApB,CAAwBc,CAAC,IAAIL,GAAG,CAACK,CAAC,CAACP,IAAH,CAAhC,CAFT;AAGHG,MAAAA,SAAS,EAAEA,SAHR;AAIHE,MAAAA,UAAU,EAAEA,UAJT;AAKHG,MAAAA,SAAS,EAAElB,QAAQ,CAACS,UAAT,CAAoBD,MAApB,IAA8B,CAA9B,GAAkCI,GAAG,CAACZ,QAAQ,CAACS,UAAT,CAAoB,CAApB,EAAuBC,IAAxB,CAArC,GAAqES,IAAI,CAACC,GAAL,CAASP,SAAT,EAAoBE,UAApB,CAL7E;AAMHM,MAAAA,QAAQ,EAAErB,QAAQ,CAACS,UAAT,CAAoBD,MAApB,IAA8B,CAA9B,GAAkCI,GAAG,CAACZ,QAAQ,CAACS,UAAT,CAAoB,CAApB,EAAuBC,IAAxB,CAArC,GAAqES,IAAI,CAACG,GAAL,CAAST,SAAT,EAAoBE,UAApB,CAN5E;AAOHQ,MAAAA,GAAG,EAAEtB,IAAI,CAACsB,GAPP;AAQHC,MAAAA,GAAG,EAAEZ;AARF,KAAP;AAUH,GAboB,CAArB;AAeAD,EAAAA,YAAY,CAACY,GAAb,GAAmBtB,IAAI,CAACsB,GAAxB;AACA,SAAOZ,YAAP;AACH","sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {labelFunction} from \"../axis/axisLabel\";\nimport {splitIntoMultiSeries} from \"./splitIntoMultiSeries\";\n\nexport function ohlcData(settings, data) {\n    return splitIntoMultiSeries(settings, data, {excludeEmpty: true}).map(data => seriesToOHLC(settings, data));\n}\n\nfunction seriesToOHLC(settings, data) {\n    const labelfn = labelFunction(settings);\n\n    const getNextOpen = i => data[i < data.length - 1 ? i + 1 : i][settings.mainValues[0].name];\n    const mappedSeries = data.map((col, i) => {\n        const openValue = settings.mainValues.length >= 1 ? col[settings.mainValues[0].name] : undefined;\n        const closeValue = settings.mainValues.length >= 2 ? col[settings.mainValues[1].name] : getNextOpen(i);\n        return {\n            crossValue: labelfn(col, i),\n            mainValues: settings.mainValues.map(v => col[v.name]),\n            openValue: openValue,\n            closeValue: closeValue,\n            highValue: settings.mainValues.length >= 3 ? col[settings.mainValues[2].name] : Math.max(openValue, closeValue),\n            lowValue: settings.mainValues.length >= 4 ? col[settings.mainValues[3].name] : Math.min(openValue, closeValue),\n            key: data.key,\n            row: col\n        };\n    });\n\n    mappedSeries.key = data.key;\n    return mappedSeries;\n}\n"],"file":"ohlcData.js"}