{"version":3,"sources":["../../../src/js/plugin/template.js"],"names":["d3","style","template","areArraysEqualSimple","initialiseStyles","bindTemplate","styleWithD3FC","getD3FCStyles","D3FCChartElement","constructor","_chart","_settings","connectedCallback","console","log","_container","shadowRoot","querySelector","render","chart","settings","_configureSettings","data","length","plugin","type","remove","draw","window","navigator","userAgent","indexOf","setTimeout","containerDiv","select","chartClass","size","getBoundingClientRect","attr","resize","innerHTML","delete","getContainer","getSettings","excludeSettings","forEach","s","setSettings","oldSettings","newSettings","oldValues","crossValues","mainValues","splitValues","realValues","newValues","colorStyles","headerStyles","document","querySelectorAll","d3fcStyles","innerText","push","join"],"mappings":"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","sourcesContent":["/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\n\r\nimport style from \"../../less/chart.less\";\r\nimport template from \"../../html/d3fc-chart.html\";\r\nimport {areArraysEqualSimple} from \"../utils/utils\";\r\nimport {initialiseStyles} from \"../series/colorStyles\";\r\n\r\nimport {bindTemplate} from \"@finos/perspective-viewer/dist/esm/utils\";\r\n\r\nconst styleWithD3FC = `${style}${getD3FCStyles()}`;\r\n\r\n@bindTemplate(template, styleWithD3FC) // eslint-disable-next-line no-unused-vars\r\nclass D3FCChartElement extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        this._chart = null;\r\n        this._settings = null;\r\n    }\r\n\r\n    connectedCallback() {\r\n        console.log(\"connected callback\");\r\n        this._container = this.shadowRoot.querySelector(\".chart\");\r\n    }\r\n\r\n    render(chart, settings) {\r\n        this._chart = chart;\r\n        this._settings = this._configureSettings(this._settings, settings);\r\n        initialiseStyles(this._container, this._settings);\r\n\r\n        if ((this._settings.data && this._settings.data.length > 0) || chart.plugin.type !== this._chart.plugin.type) {\r\n            this.remove();\r\n        }\r\n        this.draw();\r\n\r\n        if (window.navigator.userAgent.indexOf(\"Edge\") > -1) {\r\n            // Workaround for MS Edge issue that doesn't draw content in the\r\n            // plot-area until the chart D3 object is redrawn\r\n            setTimeout(() => this.draw());\r\n        }\r\n    }\r\n\r\n    draw() {\r\n        if (this._settings.data) {\r\n            const containerDiv = d3.select(this._container);\r\n            const chartClass = `chart ${this._chart.plugin.type}`;\r\n            this._settings.size = this._container.getBoundingClientRect();\r\n\r\n            if (this._settings.data.length > 0) {\r\n                this._chart(containerDiv.attr(\"class\", chartClass), this._settings);\r\n            } else {\r\n                containerDiv.attr(\"class\", `${chartClass} disabled`);\r\n            }\r\n        }\r\n    }\r\n\r\n    resize() {\r\n        this.draw();\r\n    }\r\n\r\n    remove() {\r\n        this._container.innerHTML = \"\";\r\n    }\r\n\r\n    delete() {\r\n        this.remove();\r\n    }\r\n\r\n    getContainer() {\r\n        return this._container;\r\n    }\r\n\r\n    getSettings() {\r\n        const excludeSettings = [\"crossValues\", \"mainValues\", \"splitValues\", \"filter\", \"data\", \"size\", \"colorStyles\"];\r\n        const settings = {...this._settings};\r\n        excludeSettings.forEach(s => {\r\n            delete settings[s];\r\n        });\r\n        return settings;\r\n    }\r\n\r\n    setSettings(settings) {\r\n        this._settings = {...this._settings, ...settings};\r\n        this.draw();\r\n    }\r\n\r\n    _configureSettings(oldSettings, newSettings) {\r\n        if (oldSettings) {\r\n            if (!oldSettings.data) {\r\n                // Combine with the restored settings\r\n                return {...oldSettings, ...newSettings};\r\n            }\r\n\r\n            const oldValues = [oldSettings.crossValues, oldSettings.mainValues, oldSettings.splitValues, oldSettings.realValues];\r\n            const newValues = [newSettings.crossValues, newSettings.mainValues, newSettings.splitValues, newSettings.realValues];\r\n            if (areArraysEqualSimple(oldValues, newValues)) return {...oldSettings, data: newSettings.data, colorStyles: null};\r\n        }\r\n        this.remove();\r\n        return newSettings;\r\n    }\r\n}\r\n\r\nfunction getD3FCStyles() {\r\n    const headerStyles = document.querySelector(\"head\").querySelectorAll(\"style\");\r\n    const d3fcStyles = [];\r\n    headerStyles.forEach(s => {\r\n        if (s.innerText.indexOf(\"d3fc-\") !== -1) {\r\n            d3fcStyles.push(s.innerText);\r\n        }\r\n    });\r\n    return d3fcStyles.join(\"\");\r\n}\r\n"],"file":"template.js"}