{"version":3,"sources":["../../../src/js/series/colorStyles.js"],"names":["d3","gparser","initialiseStyles","container","settings","colorStyles","data","n","push","styles","scheme","gradient","interpolator","grid","computed","computedStyle","forEach","d","i","opacity","getOpacityFromColor","series","gridLineColor","gradients","g","parseGradient","color","stepAsColor","value","window","ShadyCSS","getComputedStyleValue","containerStyles","getComputedStyle","getPropertyValue","parsed","parse","colorStops","map","length","sort","a","b"],"mappings":"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","sourcesContent":["/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nimport * as d3 from \"d3\";\r\nimport * as gparser from \"gradient-parser\";\r\n\r\nexport const initialiseStyles = (container, settings) => {\r\n    if (!settings.colorStyles) {\r\n        const data = [\"series\"];\r\n        for (let n = 1; n <= 10; n++) {\r\n            data.push(`series-${n}`);\r\n        }\r\n\r\n        const styles = {\r\n            scheme: [],\r\n            gradient: {},\r\n            interpolator: {},\r\n            grid: {}\r\n        };\r\n\r\n        const computed = computedStyle(container);\r\n        data.forEach((d, i) => {\r\n            styles[d] = computed(`--d3fc-${d}`);\r\n\r\n            if (i > 0) {\r\n                styles.scheme.push(styles[d]);\r\n            }\r\n        });\r\n\r\n        styles.opacity = getOpacityFromColor(styles.series);\r\n        styles.grid.gridLineColor = computed`--d3fc-gridline--color`;\r\n\r\n        const gradients = [\"full\", \"positive\", \"negative\"];\r\n        gradients.forEach(g => {\r\n            const gradient = computed(`--d3fc-${g}--gradient`);\r\n            styles.gradient[g] = parseGradient(gradient, styles.opacity);\r\n        });\r\n\r\n        settings.colorStyles = styles;\r\n    }\r\n};\r\n\r\nconst getOpacityFromColor = color => {\r\n    return d3.color(color).opacity;\r\n};\r\n\r\nconst stepAsColor = (value, opacity) => {\r\n    const color = d3.color(`#${value}`);\r\n    color.opacity = opacity;\r\n    return color + \"\";\r\n};\r\n\r\nconst computedStyle = container => {\r\n    if (window.ShadyCSS) {\r\n        return d => window.ShadyCSS.getComputedStyleValue(container, d);\r\n    } else {\r\n        const containerStyles = getComputedStyle(container);\r\n        return d => containerStyles.getPropertyValue(d);\r\n    }\r\n};\r\n\r\nconst parseGradient = (gradient, opacity) => {\r\n    const parsed = gparser.parse(gradient)[0].colorStops;\r\n    return parsed.map((g, i) => [g.length ? g.length.value / 100 : i / (parsed.length - 1), stepAsColor(g.value, opacity)]).sort((a, b) => a[0] - b[0]);\r\n};\r\n"],"file":"colorStyles.js"}