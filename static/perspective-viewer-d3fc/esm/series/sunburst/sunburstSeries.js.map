{"version":3,"sources":["../../../../src/js/series/sunburst/sunburstSeries.js"],"names":["drawArc","arcVisible","labelVisible","labelTransform","cropLabel","clickHandler","sunburstSeries","settings","split","data","color","radius","_sunburstSeries","sunburstElement","segment","selectAll","descendants","slice","segmentEnter","enter","append","attr","segmentMerge","merge","path","select","d","current","style","label","text","name","each","call","parentTitle","parent","datum","onClick","sunburstLevel","currentLevel","find","on","filter","children","args","length"],"mappings":"AAAA;;;;;;;;AASA,SAAQA,OAAR,EAAiBC,UAAjB,QAAkC,eAAlC;AACA,SAAQC,YAAR,EAAsBC,cAAtB,EAAsCC,SAAtC,QAAsD,iBAAtD;AACA,SAAQC,YAAR,QAA2B,iBAA3B;AAEA,OAAO,SAASC,cAAT,GAA0B;AAC7B,MAAIC,QAAQ,GAAG,IAAf;AACA,MAAIC,KAAK,GAAG,IAAZ;AACA,MAAIC,IAAI,GAAG,IAAX;AACA,MAAIC,KAAK,GAAG,IAAZ;AACA,MAAIC,MAAM,GAAG,IAAb;;AAEA,QAAMC,eAAe,GAAGC,eAAe,IAAI;AACvC,UAAMC,OAAO,GAAGD,eAAe,CAACE,SAAhB,CAA0B,WAA1B,EAAuCN,IAAvC,CAA4CA,IAAI,CAACO,WAAL,GAAmBC,KAAnB,CAAyB,CAAzB,CAA5C,CAAhB;AACA,UAAMC,YAAY,GAAGJ,OAAO,CACvBK,KADgB,GAEhBC,MAFgB,CAET,GAFS,EAGhBC,IAHgB,CAGX,OAHW,EAGF,SAHE,CAArB;AAKAH,IAAAA,YAAY,CAACE,MAAb,CAAoB,MAApB;AACAF,IAAAA,YAAY,CACPE,MADL,CACY,MADZ,EAEKC,IAFL,CAEU,OAFV,EAEmB,SAFnB,EAGKA,IAHL,CAGU,IAHV,EAGgB,QAHhB;AAIA,UAAMC,YAAY,GAAGJ,YAAY,CAACK,KAAb,CAAmBT,OAAnB,CAArB;AAEA,UAAMU,IAAI,GAAGF,YAAY,CACpBG,MADQ,CACD,MADC,EAERJ,IAFQ,CAEH,cAFG,EAEaK,CAAC,IAAKzB,UAAU,CAACyB,CAAC,CAACC,OAAH,CAAV,GAAwB,CAAxB,GAA4B,CAF/C,EAGRN,IAHQ,CAGH,aAHG,EAGYK,CAAC,IAAKzB,UAAU,CAACyB,CAAC,CAACC,OAAH,CAAV,GAAwB,SAAxB,GAAoC,MAHtD,EAIRN,IAJQ,CAIH,gBAJG,EAIeK,CAAC,IAAKzB,UAAU,CAACyB,CAAC,CAACC,OAAH,CAAV,GAAwB,SAAxB,GAAoC,MAJzD,EAKRN,IALQ,CAKH,GALG,EAKEK,CAAC,IAAI1B,OAAO,CAACW,MAAD,CAAP,CAAgBe,CAAC,CAACC,OAAlB,CALP,CAAb;AAMAjB,IAAAA,KAAK,IAAIc,IAAI,CAACI,KAAL,CAAW,MAAX,EAAmBF,CAAC,IAAIhB,KAAK,CAACgB,CAAC,CAACjB,IAAF,CAAOC,KAAR,CAA7B,CAAT;AAEA,UAAMmB,KAAK,GAAGP,YAAY,CACrBG,MADS,CACF,MADE,EAETJ,IAFS,CAEJ,cAFI,EAEYK,CAAC,IAAI,CAACxB,YAAY,CAACwB,CAAC,CAACC,OAAH,CAF9B,EAGTN,IAHS,CAGJ,WAHI,EAGSK,CAAC,IAAIvB,cAAc,CAACuB,CAAC,CAACC,OAAH,EAAYhB,MAAZ,CAH5B,EAITmB,IAJS,CAIJJ,CAAC,IAAIA,CAAC,CAACjB,IAAF,CAAOsB,IAJR,EAKTC,IALS,CAKJ,UAASN,CAAT,EAAY;AACdtB,MAAAA,SAAS,CAAC6B,IAAV,CAAe,IAAf,EAAqBP,CAArB,EAAwBf,MAAxB;AACH,KAPS,CAAd;AASA,UAAMuB,WAAW,GAAGrB,eAAe,CAACY,MAAhB,CAAuB,aAAvB,CAApB;AACA,UAAMU,MAAM,GAAGtB,eAAe,CACzBY,MADU,CACH,QADG,EAEVJ,IAFU,CAEL,GAFK,EAEAV,MAFA,EAGVyB,KAHU,CAGJ3B,IAHI,CAAf;AAKA,UAAM4B,OAAO,GAAGhC,YAAY,CAACI,IAAD,EAAOI,eAAP,EAAwBsB,MAAxB,EAAgCD,WAAhC,EAA6CV,IAA7C,EAAmDK,KAAnD,EAA0DlB,MAA1D,EAAkEH,KAAlE,EAAyED,QAAzE,CAA5B;;AACA,QAAIA,QAAQ,CAAC+B,aAAb,EAA4B;AACxB,YAAMC,YAAY,GAAG9B,IAAI,CAACO,WAAL,GAAmBwB,IAAnB,CAAwBd,CAAC,IAAIA,CAAC,CAACjB,IAAF,CAAOsB,IAAP,KAAgBxB,QAAQ,CAAC+B,aAAT,CAAuB9B,KAAvB,CAA7C,CAArB;AACA+B,MAAAA,YAAY,IAAIF,OAAO,CAACE,YAAD,EAAe,IAAf,CAAvB;AACH,KAHD,MAGO;AACHhC,MAAAA,QAAQ,CAAC+B,aAAT,GAAyB,EAAzB;AACH;;AACDH,IAAAA,MAAM,CAACM,EAAP,CAAU,OAAV,EAAmBf,CAAC,IAAIW,OAAO,CAACX,CAAD,EAAI,KAAJ,CAA/B;AACAF,IAAAA,IAAI,CAACkB,MAAL,CAAYhB,CAAC,IAAIA,CAAC,CAACiB,QAAnB,EACKf,KADL,CACW,QADX,EACqB,SADrB,EAEKa,EAFL,CAEQ,OAFR,EAEiBf,CAAC,IAAIW,OAAO,CAACX,CAAD,EAAI,KAAJ,CAF7B;AAGH,GAhDD;;AAkDAd,EAAAA,eAAe,CAACL,QAAhB,GAA2B,CAAC,GAAGqC,IAAJ,KAAa;AACpC,QAAI,CAACA,IAAI,CAACC,MAAV,EAAkB;AACd,aAAOtC,QAAP;AACH;;AACDA,IAAAA,QAAQ,GAAGqC,IAAI,CAAC,CAAD,CAAf;AACA,WAAOhC,eAAP;AACH,GAND;;AAQAA,EAAAA,eAAe,CAACJ,KAAhB,GAAwB,CAAC,GAAGoC,IAAJ,KAAa;AACjC,QAAI,CAACA,IAAI,CAACC,MAAV,EAAkB;AACd,aAAOrC,KAAP;AACH;;AACDA,IAAAA,KAAK,GAAGoC,IAAI,CAAC,CAAD,CAAZ;AACA,WAAOhC,eAAP;AACH,GAND;;AAQAA,EAAAA,eAAe,CAACH,IAAhB,GAAuB,CAAC,GAAGmC,IAAJ,KAAa;AAChC,QAAI,CAACA,IAAI,CAACC,MAAV,EAAkB;AACd,aAAOpC,IAAP;AACH;;AACDA,IAAAA,IAAI,GAAGmC,IAAI,CAAC,CAAD,CAAX;AACA,WAAOhC,eAAP;AACH,GAND;;AAQAA,EAAAA,eAAe,CAACF,KAAhB,GAAwB,CAAC,GAAGkC,IAAJ,KAAa;AACjC,QAAI,CAACA,IAAI,CAACC,MAAV,EAAkB;AACd,aAAOnC,KAAP;AACH;;AACDA,IAAAA,KAAK,GAAGkC,IAAI,CAAC,CAAD,CAAZ;AACA,WAAOhC,eAAP;AACH,GAND;;AAQAA,EAAAA,eAAe,CAACD,MAAhB,GAAyB,CAAC,GAAGiC,IAAJ,KAAa;AAClC,QAAI,CAACA,IAAI,CAACC,MAAV,EAAkB;AACd,aAAOlC,MAAP;AACH;;AACDA,IAAAA,MAAM,GAAGiC,IAAI,CAAC,CAAD,CAAb;AACA,WAAOhC,eAAP;AACH,GAND;;AAQA,SAAOA,eAAP;AACH","sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {drawArc, arcVisible} from \"./sunburstArc\";\nimport {labelVisible, labelTransform, cropLabel} from \"./sunburstLabel\";\nimport {clickHandler} from \"./sunburstClick\";\n\nexport function sunburstSeries() {\n    let settings = null;\n    let split = null;\n    let data = null;\n    let color = null;\n    let radius = null;\n\n    const _sunburstSeries = sunburstElement => {\n        const segment = sunburstElement.selectAll(\"g.segment\").data(data.descendants().slice(1));\n        const segmentEnter = segment\n            .enter()\n            .append(\"g\")\n            .attr(\"class\", \"segment\");\n\n        segmentEnter.append(\"path\");\n        segmentEnter\n            .append(\"text\")\n            .attr(\"class\", \"segment\")\n            .attr(\"dy\", \"0.35em\");\n        const segmentMerge = segmentEnter.merge(segment);\n\n        const path = segmentMerge\n            .select(\"path\")\n            .attr(\"fill-opacity\", d => (arcVisible(d.current) ? 1 : 0))\n            .attr(\"user-select\", d => (arcVisible(d.current) ? \"initial\" : \"none\"))\n            .attr(\"pointer-events\", d => (arcVisible(d.current) ? \"initial\" : \"none\"))\n            .attr(\"d\", d => drawArc(radius)(d.current));\n        color && path.style(\"fill\", d => color(d.data.color));\n\n        const label = segmentMerge\n            .select(\"text\")\n            .attr(\"fill-opacity\", d => +labelVisible(d.current))\n            .attr(\"transform\", d => labelTransform(d.current, radius))\n            .text(d => d.data.name)\n            .each(function(d) {\n                cropLabel.call(this, d, radius);\n            });\n\n        const parentTitle = sunburstElement.select(\"text.parent\");\n        const parent = sunburstElement\n            .select(\"circle\")\n            .attr(\"r\", radius)\n            .datum(data);\n\n        const onClick = clickHandler(data, sunburstElement, parent, parentTitle, path, label, radius, split, settings);\n        if (settings.sunburstLevel) {\n            const currentLevel = data.descendants().find(d => d.data.name === settings.sunburstLevel[split]);\n            currentLevel && onClick(currentLevel, true);\n        } else {\n            settings.sunburstLevel = {};\n        }\n        parent.on(\"click\", d => onClick(d, false));\n        path.filter(d => d.children)\n            .style(\"cursor\", \"pointer\")\n            .on(\"click\", d => onClick(d, false));\n    };\n\n    _sunburstSeries.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.split = (...args) => {\n        if (!args.length) {\n            return split;\n        }\n        split = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.data = (...args) => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.radius = (...args) => {\n        if (!args.length) {\n            return radius;\n        }\n        radius = args[0];\n        return _sunburstSeries;\n    };\n\n    return _sunburstSeries;\n}\n"],"file":"sunburstSeries.js"}