{"version":3,"sources":["../../../src/js/tooltip/tooltip.js"],"names":["select","getChartContainer","getOrCreateElement","isElementOverflowing","tooltipTemplate","generateHtml","selectionEvent","tooltip","alwaysShow","tooltipDiv","settings","centered","_tooltip","selection","node","isConnected","hideTooltip","container","getTooltipDiv","showTip","data","i","nodes","showTooltip","style","hideTip","each","on","args","length","append","attr","html","containerNode","containerRect","getBoundingClientRect","rect","left","width","top","scrollTop","height","transition","duration","centerTip","shiftIfOverflowingChartArea","tooltipDivRect","leftAdjust","newLeft","topAdjust","newTop","right","bottom"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {select} from \"d3\";\nimport {getChartContainer} from \"../plugin/root\";\nimport {getOrCreateElement, isElementOverflowing} from \"../utils/utils\";\nimport tooltipTemplate from \"../../html/tooltip.html\";\nimport {generateHtml} from \"./generateHTML\";\nimport {selectionEvent} from \"./selectionEvent\";\n\nexport const tooltip = () => {\n    let alwaysShow = false;\n    let tooltipDiv = null;\n    let settings = null;\n    let centered = false;\n\n    const _tooltip = selection => {\n        const node = selection.node();\n\n        if (!node || !node.isConnected) {\n            hideTooltip(tooltipDiv);\n            return;\n        }\n\n        const container = select(getChartContainer(node));\n        tooltipDiv = getTooltipDiv(container);\n\n        const showTip = (data, i, nodes) => {\n            generateHtml(tooltipDiv, data, settings);\n            showTooltip(container.node(), nodes[i], tooltipDiv, centered);\n            select(nodes[i]).style(\"opacity\", \"0.7\");\n        };\n        const hideTip = (data, i, nodes) => {\n            hideTooltip(tooltipDiv);\n            if (nodes) select(nodes[i]).style(\"opacity\", \"1\");\n        };\n\n        if (alwaysShow) {\n            selection.each(showTip);\n        } else {\n            selection.on(\"mouseover\", showTip).on(\"mouseout\", hideTip);\n            selectionEvent().settings(settings)(selection);\n        }\n    };\n\n    _tooltip.alwaysShow = (...args) => {\n        if (!args.length) {\n            return alwaysShow;\n        }\n        alwaysShow = args[0];\n        return _tooltip;\n    };\n\n    _tooltip.centered = (...args) => {\n        if (!args.length) {\n            return centered;\n        }\n        centered = args[0];\n        return _tooltip;\n    };\n\n    _tooltip.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _tooltip;\n    };\n\n    return _tooltip;\n};\n\nfunction getTooltipDiv(container) {\n    return getOrCreateElement(container, \"div.tooltip\", () =>\n        container\n            .append(\"div\")\n            .attr(\"class\", \"tooltip\")\n            .style(\"z-index\", 3)\n            .style(\"opacity\", 0)\n            .html(tooltipTemplate)\n    );\n}\n\nfunction showTooltip(containerNode, node, tooltipDiv, centered) {\n    const containerRect = containerNode.getBoundingClientRect();\n    const rect = node.getBoundingClientRect();\n\n    let left = rect.left + rect.width / 2 - containerRect.left;\n    let top = rect.top - containerRect.top + containerNode.scrollTop;\n\n    if (centered) top = rect.top + rect.height / 2 - containerRect.top + containerNode.scrollTop;\n\n    tooltipDiv\n        .style(\"left\", `${left}px`)\n        .style(\"top\", `${top}px`)\n        .transition()\n        .duration(200)\n        .style(\"opacity\", 0.9);\n\n    if (centered) [left, top] = centerTip(tooltipDiv, containerRect);\n\n    shiftIfOverflowingChartArea(tooltipDiv, containerRect, left, top, centered);\n}\n\nfunction centerTip(tooltipDiv, containerRect) {\n    const tooltipDivRect = tooltipDiv.node().getBoundingClientRect();\n\n    const leftAdjust = tooltipDivRect.width / 2;\n    const newLeft = tooltipDivRect.left - leftAdjust - containerRect.left;\n    tooltipDiv.style(\"left\", `${newLeft}px`);\n\n    const topAdjust = tooltipDivRect.height / 2;\n    const newTop = tooltipDivRect.top - topAdjust - containerRect.top;\n    tooltipDiv.style(\"top\", `${newTop}px`);\n    return [newLeft, newTop];\n}\n\nfunction shiftIfOverflowingChartArea(tooltipDiv, containerRect, left, top, centered = false) {\n    const tooltipDivRect = tooltipDiv.node().getBoundingClientRect();\n\n    if (isElementOverflowing(containerRect, tooltipDivRect)) {\n        const leftAdjust = tooltipDivRect.right - containerRect.right;\n        tooltipDiv.style(\"left\", `${left - leftAdjust}px`);\n    }\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"bottom\")) {\n        const topAdjust = tooltipDivRect.bottom - containerRect.bottom;\n        tooltipDiv.style(\"top\", `${top - topAdjust}px`);\n    }\n\n    if (!centered) return;\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"left\")) {\n        const leftAdjust = tooltipDivRect.left - containerRect.left;\n        tooltipDiv.style(\"left\", `${left - leftAdjust}px`);\n    }\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"top\")) {\n        const topAdjust = tooltipDivRect.top - containerRect.top;\n        tooltipDiv.style(\"top\", `${top - topAdjust}px`);\n    }\n}\n\nfunction hideTooltip(tooltipDiv) {\n    if (tooltipDiv) {\n        tooltipDiv\n            .transition()\n            .duration(500)\n            .style(\"opacity\", 0);\n    }\n}\n"],"file":"tooltip.js"}