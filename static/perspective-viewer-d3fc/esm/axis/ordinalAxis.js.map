{"version":3,"sources":["../../../src/js/axis/ordinalAxis.js"],"names":["d3","fc","minBandwidth","flattenArray","multiAxisBottom","multiAxisLeft","multiAxisTop","multiAxisRight","getChartContainer","scale","scaleBand","padding","domain","valueNames","orient","_domain","data","flattenedData","transformDomain","Set","map","d","reverse","valueName","args","length","labelFunction","join","component","settings","settingName","getComponent","multiLevel","levelGroups","axisGroups","groupTickLayout","getGroupTickLayout","tickSizeInner","l","size","tickSizeOuter","reduce","s","v","createAxis","base","axis","groups","tickPadding","decorate","index","rotation","applyLabelRotation","hideOverlappingLabels","axisSet","getAxisSet","bottom","left","right","top","axisOrdinalBottom","axisOrdinalLeft","axisOrdinalTop","axisOrdinalRight","forEach","tick","split","i","push","group","text","width","maxLength","Math","max","g","rotated","getTransformCoords","transform","splitOn","indexOf","coords","substring","c","parseInt","rectanglesOverlap","r1","r2","x","y","height","rotatedLabelsOverlap","isOverlap","rectangleContained","boundsRect","getXAxisBoundsRect","previousRectangles","each","nodes","select","transformCoords","attr","tickRect","node","getBBox","rect","overlap","some","r","hidden","container","chart","querySelector","chartRect","getBoundingClientRect","axisRect","getLabelTransform","anchor","style"],"mappings":"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","sourcesContent":["/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\nimport * as fc from \"d3fc\";\r\nimport minBandwidth from \"./minBandwidth\";\r\nimport {flattenArray} from \"./flatten\";\r\nimport {multiAxisBottom, multiAxisLeft, multiAxisTop, multiAxisRight} from \"../d3fc/axis/multi-axis\";\r\nimport {getChartContainer} from \"../plugin/root\";\r\n\r\nexport const scale = () => minBandwidth(d3.scaleBand()).padding(0.5);\r\n\r\nexport const domain = () => {\r\n    let valueNames = [\"crossValue\"];\r\n    let orient = \"horizontal\";\r\n\r\n    const _domain = data => {\r\n        const flattenedData = flattenArray(data);\r\n        return transformDomain([...new Set(flattenedData.map(d => d[valueNames[0]]))]);\r\n    };\r\n\r\n    const transformDomain = d => (orient == \"vertical\" ? d.reverse() : d);\r\n\r\n    _domain.valueName = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames[0];\r\n        }\r\n        valueNames = [args[0]];\r\n        return _domain;\r\n    };\r\n    _domain.valueNames = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames;\r\n        }\r\n        valueNames = args[0];\r\n        return _domain;\r\n    };\r\n\r\n    _domain.orient = (...args) => {\r\n        if (!args.length) {\r\n            return orient;\r\n        }\r\n        orient = args[0];\r\n        return _domain;\r\n    };\r\n\r\n    return _domain;\r\n};\r\n\r\nexport const labelFunction = valueName => d => d[valueName].join(\"|\");\r\n\r\nexport const component = settings => {\r\n    let orient = \"horizontal\";\r\n    let settingName = \"crossValues\";\r\n    let domain = null;\r\n\r\n    const getComponent = () => {\r\n        const multiLevel = settings[settingName].length > 1;\r\n\r\n        // Calculate the label groups and corresponding group sizes\r\n        const levelGroups = axisGroups(domain);\r\n        const groupTickLayout = levelGroups.map(getGroupTickLayout);\r\n\r\n        const tickSizeInner = multiLevel ? groupTickLayout.map(l => l.size) : groupTickLayout[0].size;\r\n        const tickSizeOuter = groupTickLayout.reduce((s, v) => s + v.size, 0);\r\n\r\n        const createAxis = base => scale => {\r\n            const axis = base(scale);\r\n\r\n            if (multiLevel) {\r\n                axis.groups(levelGroups)\r\n                    .tickSizeInner(tickSizeInner)\r\n                    .tickSizeOuter(tickSizeOuter);\r\n            }\r\n            if (orient !== \"horizontal\") axis.tickPadding(10);\r\n            return axis;\r\n        };\r\n\r\n        const decorate = (s, data, index) => {\r\n            const rotation = groupTickLayout[index].rotation;\r\n            if (orient === \"horizontal\") applyLabelRotation(s, rotation);\r\n            hideOverlappingLabels(s, rotation);\r\n        };\r\n\r\n        const axisSet = getAxisSet(multiLevel);\r\n        return {\r\n            bottom: createAxis(axisSet.bottom),\r\n            left: createAxis(axisSet.left),\r\n            right: createAxis(axisSet.right),\r\n            top: createAxis(axisSet.top),\r\n            size: `${tickSizeOuter + 10}px`,\r\n            decorate\r\n        };\r\n    };\r\n\r\n    // const pickAxis = multiLevel => {\r\n    //     if (multiLevel) {\r\n    //         return orient === \"horizontal\" ?\r\n    //                multiAxisBottom : multiAxisLeft;\r\n    //     }\r\n    //     return orient === \"horizontal\" ?\r\n    //                 fc.axisOrdinalBottom : fc.axisOrdinalLeft;\r\n    // };\r\n\r\n    const getAxisSet = multiLevel => {\r\n        if (multiLevel) {\r\n            return {\r\n                bottom: multiAxisBottom,\r\n                left: multiAxisLeft,\r\n                top: multiAxisTop,\r\n                right: multiAxisRight\r\n            };\r\n        } else {\r\n            return {\r\n                bottom: fc.axisOrdinalBottom,\r\n                left: fc.axisOrdinalLeft,\r\n                top: fc.axisOrdinalTop,\r\n                right: fc.axisOrdinalRight\r\n            };\r\n        }\r\n    };\r\n\r\n    const axisGroups = domain => {\r\n        const groups = [];\r\n        domain.forEach(tick => {\r\n            const split = tick && tick.split ? tick.split(\"|\") : [tick];\r\n            split.forEach((s, i) => {\r\n                while (groups.length <= i) groups.push([]);\r\n\r\n                const group = groups[i];\r\n                if (group.length > 0 && group[group.length - 1].text === s) {\r\n                    group[group.length - 1].domain.push(tick);\r\n                } else {\r\n                    group.push({text: s, domain: [tick]});\r\n                }\r\n            });\r\n        });\r\n        return groups.reverse();\r\n    };\r\n\r\n    const getGroupTickLayout = group => {\r\n        const width = settings.size.width;\r\n        const maxLength = Math.max(...group.map(g => (g.text ? g.text.length : 0)));\r\n\r\n        if (orient === \"horizontal\") {\r\n            // x-axis may rotate labels and expand the available height\r\n            if (group && group.length * 16 > width - 100) {\r\n                return {\r\n                    size: maxLength * 5 + 10,\r\n                    rotation: 90\r\n                };\r\n            } else if (group && group.length * (maxLength * 6 + 10) > width - 100) {\r\n                return {\r\n                    size: maxLength * 3 + 20,\r\n                    rotation: 45\r\n                };\r\n            }\r\n            return {\r\n                size: 25,\r\n                rotation: 0\r\n            };\r\n        } else {\r\n            // y-axis size always based on label size\r\n            return {\r\n                size: maxLength * 5 + 10,\r\n                rotation: 0\r\n            };\r\n        }\r\n    };\r\n\r\n    const hideOverlappingLabels = (s, rotated) => {\r\n        const getTransformCoords = transform => {\r\n            const splitOn = transform.indexOf(\",\") !== -1 ? \",\" : \" \";\r\n            const coords = transform\r\n                .substring(transform.indexOf(\"(\") + 1, transform.indexOf(\")\"))\r\n                .split(splitOn)\r\n                .map(c => parseInt(c));\r\n            while (coords.length < 2) coords.push(0);\r\n            return coords;\r\n        };\r\n\r\n        const rectanglesOverlap = (r1, r2) => r1.x <= r2.x + r2.width && r2.x <= r1.x + r1.width && r1.y <= r2.y + r2.height && r2.y <= r1.y + r1.height;\r\n        const rotatedLabelsOverlap = (r1, r2) => r1.x + r1.width + 14 > r2.x + r2.width;\r\n        const isOverlap = rotated ? rotatedLabelsOverlap : rectanglesOverlap;\r\n\r\n        const rectangleContained = (r1, r2) => r1.x >= r2.x && r1.x + r1.width <= r2.x + r2.width && r1.y >= r2.y && r1.y + r1.height <= r2.y + r2.height;\r\n        // The bounds rect is the available screen space a label can fit into\r\n        const boundsRect = orient == \"horizontal\" ? getXAxisBoundsRect(s) : null;\r\n\r\n        const previousRectangles = [];\r\n        s.each((d, i, nodes) => {\r\n            const tick = d3.select(nodes[i]);\r\n\r\n            // How the \"tick\" element is transformed (x/y)\r\n            const transformCoords = getTransformCoords(tick.attr(\"transform\"));\r\n\r\n            // Work out the actual rectanble the label occupies\r\n            const tickRect = tick.node().getBBox();\r\n            const rect = {x: tickRect.x + transformCoords[0], y: tickRect.y + transformCoords[1], width: tickRect.width, height: tickRect.height};\r\n\r\n            const overlap = previousRectangles.some(r => isOverlap(r, rect));\r\n\r\n            // Test that it also fits into the screen space\r\n            const hidden = overlap || (boundsRect && !rectangleContained(rect, boundsRect));\r\n\r\n            tick.attr(\"visibility\", hidden ? \"hidden\" : \"\");\r\n            if (!hidden) {\r\n                previousRectangles.push(rect);\r\n            }\r\n        });\r\n    };\r\n\r\n    const getXAxisBoundsRect = s => {\r\n        const container = getChartContainer(s.node());\r\n        if (container === null) {\r\n            return;\r\n        }\r\n        const chart = container.querySelector(\".cartesian-chart\");\r\n        const axis = chart.querySelector(\".x-axis\");\r\n\r\n        const chartRect = chart.getBoundingClientRect();\r\n        const axisRect = axis.getBoundingClientRect();\r\n        return {\r\n            x: chartRect.left - axisRect.left,\r\n            width: chartRect.width,\r\n            y: chartRect.top - axisRect.top,\r\n            height: chartRect.height\r\n        };\r\n    };\r\n\r\n    const getLabelTransform = rotation => {\r\n        if (!rotation) {\r\n            return \"translate(0, 8)\";\r\n        }\r\n        if (rotation < 60) {\r\n            return `rotate(-${rotation} 5 5)`;\r\n        }\r\n        return `rotate(-${rotation} 3 7)`;\r\n    };\r\n\r\n    const applyLabelRotation = (s, rotation) => {\r\n        const transform = getLabelTransform(rotation);\r\n        const anchor = rotation ? \"end\" : \"\";\r\n        s.each((d, i, nodes) => {\r\n            const tick = d3.select(nodes[i]);\r\n            const text = tick.select(\"text\");\r\n\r\n            text.attr(\"transform\", transform).style(\"text-anchor\", anchor);\r\n        });\r\n    };\r\n\r\n    getComponent.orient = (...args) => {\r\n        if (!args.length) {\r\n            return orient;\r\n        }\r\n        orient = args[0];\r\n        return getComponent;\r\n    };\r\n\r\n    getComponent.settingName = (...args) => {\r\n        if (!args.length) {\r\n            return settingName;\r\n        }\r\n        settingName = args[0];\r\n        return getComponent;\r\n    };\r\n\r\n    getComponent.domain = (...args) => {\r\n        if (!args.length) {\r\n            return domain;\r\n        }\r\n        domain = args[0];\r\n        return getComponent;\r\n    };\r\n\r\n    return getComponent;\r\n};\r\n"],"file":"ordinalAxis.js"}