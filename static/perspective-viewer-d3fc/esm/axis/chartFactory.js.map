{"version":3,"sources":["../../../src/js/axis/chartFactory.js"],"names":["d3","fc","chartSvgFactory","xAxis","yAxis","chartFactory","chartSvgCartesian","chartCanvasFactory","chartCanvasCartesian","cartesian","canvas","axisSplitter","altAxis","chart","xScale","scale","yScale","component","xDomain","domain","xLabel","label","xAxisHeight","size","xDecorate","decorate","xTickFormat","tickFormatFunction","yDomain","yLabel","yAxisWidth","yDecorate","yOrient","yTickFormat","xPaddingInner","xPaddingOuter","yPaddingInner","yPaddingOuter","args","length","oldDecorate","container","data","plotArea","select","node","setAttribute","clientWidth","clientHeight","haveSplit","altData","y2AxisDataJoin","dataJoin","key","d","ySeriesDataJoin","enter","append","attr","style","y2Scale","yAxisComponent","right","tickFormat","on","i","nodes","width","height","event","detail","range","call","drawMultiCanvasSeries","selection","canvasPlotArea","context","getContext","yScales","forEach","drawMultiSvgSeries","svgPlotArea","each","datum"],"mappings":"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","sourcesContent":["/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\nimport * as fc from \"d3fc\";\r\n\r\nexport const chartSvgFactory = (xAxis, yAxis) => chartFactory(xAxis, yAxis, fc.chartSvgCartesian, false);\r\nexport const chartCanvasFactory = (xAxis, yAxis) => chartFactory(xAxis, yAxis, fc.chartCanvasCartesian, true);\r\n\r\nconst chartFactory = (xAxis, yAxis, cartesian, canvas) => {\r\n    let axisSplitter = null;\r\n    let altAxis = null;\r\n\r\n    const chart = cartesian({\r\n        xScale: xAxis.scale,\r\n        yScale: yAxis.scale,\r\n        xAxis: xAxis.component,\r\n        yAxis: yAxis.component\r\n    })\r\n        .xDomain(xAxis.domain)\r\n        .xLabel(xAxis.label)\r\n        .xAxisHeight(xAxis.size)\r\n        .xDecorate(xAxis.decorate)\r\n        .xTickFormat(xAxis.tickFormatFunction)\r\n        .yDomain(yAxis.domain)\r\n        .yLabel(yAxis.label)\r\n        .yAxisWidth(yAxis.size)\r\n        .yDecorate(yAxis.decorate)\r\n        .yOrient(\"left\")\r\n        .yTickFormat(yAxis.tickFormatFunction);\r\n\r\n    if (xAxis.decorate) chart.xDecorate(xAxis.decorate);\r\n    if (yAxis.decorate) chart.yDecorate(yAxis.decorate);\r\n\r\n    // Padding defaults can be overridden\r\n    chart.xPaddingInner && chart.xPaddingInner(1);\r\n    chart.xPaddingOuter && chart.xPaddingOuter(0.5);\r\n    chart.yPaddingInner && chart.yPaddingInner(1);\r\n    chart.yPaddingOuter && chart.yPaddingOuter(0.5);\r\n\r\n    chart.axisSplitter = (...args) => {\r\n        if (!args.length) {\r\n            return axisSplitter;\r\n        }\r\n        axisSplitter = args[0];\r\n        return chart;\r\n    };\r\n\r\n    chart.altAxis = (...args) => {\r\n        if (!args.length) {\r\n            return altAxis;\r\n        }\r\n        altAxis = args[0];\r\n        return chart;\r\n    };\r\n\r\n    const oldDecorate = chart.decorate();\r\n    chart.decorate((container, data) => {\r\n        const plotArea = container.select(\"d3fc-svg.plot-area\");\r\n\r\n        plotArea\r\n            .select(\"svg\")\r\n            .node()\r\n            .setAttribute(\"viewBox\", `0 0 ${plotArea.node().clientWidth} ${plotArea.node().clientHeight}`);\r\n\r\n        oldDecorate(container, data);\r\n        if (!axisSplitter) return;\r\n\r\n        if (axisSplitter.haveSplit()) {\r\n            // Render a second axis on the right of the chart\r\n            const altData = axisSplitter.altData();\r\n\r\n            const y2AxisDataJoin = fc.dataJoin(\"d3fc-svg\", \"y2-axis\").key(d => d);\r\n            const ySeriesDataJoin = fc.dataJoin(\"g\", \"y-series\").key(d => d);\r\n\r\n            // Column 5 of the grid\r\n            container\r\n                .enter()\r\n                .append(\"div\")\r\n                .attr(\"class\", \"y2-label-container\")\r\n                .style(\"grid-column\", 5)\r\n                .style(\"-ms-grid-column\", 5)\r\n                .style(\"grid-row\", 3)\r\n                .style(\"-ms-grid-row\", 3)\r\n                .style(\"width\", altAxis.size || \"1em\")\r\n                .style(\"display\", \"flex\")\r\n                .style(\"align-items\", \"center\")\r\n                .style(\"justify-content\", \"center\")\r\n                .append(\"div\")\r\n                .attr(\"class\", \"y-label\")\r\n                .style(\"transform\", \"rotate(-90deg)\");\r\n\r\n            const y2Scale = altAxis.scale.domain(altAxis.domain);\r\n            const yAxisComponent = altAxis.component.right(y2Scale);\r\n            yAxisComponent.tickFormat(altAxis.tickFormatFunction);\r\n            if (altAxis.decorate) yAxisComponent.decorate(altAxis.decorate);\r\n\r\n            // Render the axis\r\n            y2AxisDataJoin(container, [\"right\"])\r\n                .attr(\"class\", d => `y-axis ${d}-axis`)\r\n                .on(\"measure\", (d, i, nodes) => {\r\n                    const {width, height} = d3.event.detail;\r\n                    if (d === \"left\") {\r\n                        d3.select(nodes[i])\r\n                            .select(\"svg\")\r\n                            .attr(\"viewBox\", `${-width} 0 ${width} ${height}`);\r\n                    }\r\n                    y2Scale.range([height, 0]);\r\n                })\r\n                .on(\"draw\", (d, i, nodes) => {\r\n                    d3.select(nodes[i])\r\n                        .select(\"svg\")\r\n                        .call(yAxisComponent);\r\n                });\r\n\r\n            // Render all the series using either the primary or alternate\r\n            // y-scales\r\n            if (canvas) {\r\n                const drawMultiCanvasSeries = selection => {\r\n                    const canvasPlotArea = chart.plotArea();\r\n                    canvasPlotArea.context(selection.node().getContext(\"2d\")).xScale(xAxis.scale);\r\n\r\n                    const yScales = [yAxis.scale, y2Scale];\r\n                    [data, altData].forEach((d, i) => {\r\n                        canvasPlotArea.yScale(yScales[i]);\r\n                        canvasPlotArea(d);\r\n                    });\r\n                };\r\n\r\n                container.select(\"d3fc-canvas.plot-area\").on(\"draw\", (d, i, nodes) => {\r\n                    drawMultiCanvasSeries(d3.select(nodes[i]).select(\"canvas\"));\r\n                });\r\n            } else {\r\n                const drawMultiSvgSeries = selection => {\r\n                    const svgPlotArea = chart.plotArea();\r\n                    svgPlotArea.xScale(xAxis.scale);\r\n\r\n                    const yScales = [yAxis.scale, y2Scale];\r\n                    ySeriesDataJoin(selection, [data, altData]).each((d, i, nodes) => {\r\n                        svgPlotArea.yScale(yScales[i]);\r\n                        d3.select(nodes[i])\r\n                            .datum(d)\r\n                            .call(svgPlotArea);\r\n                    });\r\n                };\r\n\r\n                container.select(\"d3fc-svg.plot-area\").on(\"draw\", (d, i, nodes) => {\r\n                    drawMultiSvgSeries(d3.select(nodes[i]).select(\"svg\"));\r\n                });\r\n            }\r\n        }\r\n\r\n        // Render any UI elements the splitter component requires\r\n        axisSplitter(container);\r\n    });\r\n\r\n    return chart;\r\n};\r\n"],"file":"chartFactory.js"}