{"version":3,"sources":["../../../src/js/charts/ohlcCandle.js"],"names":["fc","axisFactory","chartCanvasFactory","ohlcData","filterDataByGroup","withGridLines","hardLimitZeroPadding","zoomableChart","nearbyTip","ohlcCandleSeries","colorScale","setOpacity","colorLegend","ohlcCandle","seriesCanvas","container","settings","srcData","bollinger","indicatorBollingerBands","value","d","openValue","data","map","seriesData","bollingerData","i","Object","assign","keys","k","key","concat","hideKeys","sort","upColor","domain","mapFunction","legend","scale","length","series","multi","seriesCanvasMulti","mapping","index","paddingStrategy","pad","padUnit","xAxis","settingName","valueName","yAxis","valueNames","orient","chart","plotArea","canvas","yNice","zoomChart","xScale","onChange","zoom","zoomedData","filter","crossValue","xDomain","yDomain","domainFunction","toolTip","yScale","yValueName","color","datum","call"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {chartCanvasFactory} from \"../axis/chartFactory\";\nimport {ohlcData} from \"../data/ohlcData\";\nimport {filterDataByGroup} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\nimport {ohlcCandleSeries} from \"../series/ohlcCandleSeries\";\nimport {colorScale, setOpacity} from \"../series/seriesColors\";\nimport {colorLegend} from \"../legend/legend\";\n\nfunction ohlcCandle(seriesCanvas) {\n    return function(container, settings) {\n        const srcData = ohlcData(settings, filterDataByGroup(settings));\n\n        const bollinger = fc.indicatorBollingerBands().value(d => d.openValue);\n        const data = srcData.map(seriesData => {\n            const bollingerData = bollinger(seriesData);\n            return seriesData.map((d, i) => Object.assign({bollinger: bollingerData[i]}, d));\n        });\n\n        const keys = srcData\n            .map(k => k.key)\n            .concat(settings.hideKeys ? settings.hideKeys : [])\n            .sort();\n\n        const upColor = colorScale()\n            .domain(keys)\n            .settings(settings)\n            .mapFunction(setOpacity(1))();\n\n        const legend = colorLegend()\n            .settings(settings)\n            .scale(keys.length > 1 ? upColor : null);\n\n        const series = ohlcCandleSeries(settings, seriesCanvas, upColor);\n\n        const multi = fc\n            .seriesCanvasMulti()\n            .mapping((data, index) => data[index])\n            .series(data.map(() => series));\n\n        const paddingStrategy = hardLimitZeroPadding()\n            .pad([0.1, 0.1])\n            .padUnit(\"percent\");\n\n        const xAxis = axisFactory(settings)\n            .settingName(\"crossValues\")\n            .valueName(\"crossValue\")(data);\n        const yAxis = axisFactory(settings)\n            .settingName(\"mainValues\")\n            .valueNames([\"lowValue\", \"highValue\"])\n            .orient(\"vertical\")\n            .paddingStrategy(paddingStrategy)(data);\n\n        const chart = chartCanvasFactory(xAxis, yAxis).plotArea(\n            withGridLines(multi, settings)\n                .orient(\"vertical\")\n                .canvas(true)\n        );\n\n        chart.yNice && chart.yNice();\n\n        const zoomChart = zoomableChart()\n            .chart(chart)\n            .settings(settings)\n            .xScale(xAxis.scale)\n            .onChange(zoom => {\n                const zoomedData = data.map(series => series.filter(d => d.crossValue >= zoom.xDomain[0] && d.crossValue <= zoom.xDomain[1]));\n                chart.yDomain(yAxis.domainFunction(zoomedData));\n            })\n            .canvas(true);\n\n        const toolTip = nearbyTip()\n            .settings(settings)\n            .xScale(xAxis.scale)\n            .yScale(yAxis.scale)\n            .yValueName(\"closeValue\")\n            .color(upColor)\n            .data(data)\n            .canvas(true);\n\n        // render\n        container.datum(data).call(zoomChart);\n        container.call(toolTip);\n        container.call(legend);\n    };\n}\n\nexport default ohlcCandle;\n"],"file":"ohlcCandle.js"}