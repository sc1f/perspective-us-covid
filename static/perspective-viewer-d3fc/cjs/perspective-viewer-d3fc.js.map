{"version":3,"sources":["webpack:///packages/perspective-viewer-d3fc/webpack/universalModuleDefinition","webpack:///packages/perspective-viewer-d3fc/webpack/bootstrap","webpack:///packages/perspective-viewer-d3fc/external \"d3\"","webpack:///packages/perspective-viewer-d3fc/external \"d3fc\"","webpack:///packages/perspective-viewer-d3fc/external \"core-js/modules/web.dom-collections.iterator\"","webpack:///packages/perspective-viewer-d3fc/external \"d3-array\"","webpack:///packages/perspective-viewer-d3fc/external \"d3-svg-legend\"","webpack:///packages/perspective-viewer-d3fc/external \"@finos/perspective/dist/esm/config\"","webpack:///packages/perspective-viewer-d3fc/external \"@finos/perspective-viewer/dist/esm/utils.js\"","webpack:///packages/perspective-viewer-d3fc/dist/html/tooltip.html","webpack:///packages/perspective-viewer-d3fc/dist/html/legend-controls.html","webpack:///packages/perspective-viewer-d3fc/dist/html/zoom-controls.html","webpack:///packages/perspective-viewer-d3fc/dist/html/parent-controls.html","webpack:///packages/perspective-viewer-d3fc/dist/less/chart.less","webpack:///packages/perspective-viewer-d3fc/dist/html/d3fc-chart.html","webpack:///packages/perspective-viewer-d3fc/external \"gradient-parser\"","webpack:///packages/perspective-viewer-d3fc/external \"@finos/perspective-viewer/dist/esm/utils\"","webpack:///packages/perspective-viewer-d3fc/external \"core-js/modules/es.string.replace\"","webpack:///../../src/js/plugin/polyfills/matches.js","webpack:///../../src/js/plugin/polyfills/closest.js","webpack:///node_modules/css-loader/lib/css-base.js","webpack:///../src/js/axis/axisType.js","webpack:///../src/js/axis/flatten.js","webpack:///../src/js/axis/minBandwidth.js","webpack:///../src/js/axis/noAxis.js","webpack:///../src/js/axis/withoutTicks.js","webpack:///../../src/js/d3fc/padding/default.js","webpack:///../../src/js/d3fc/extent/extentLinear.js","webpack:///../src/js/axis/valueFormatter.js","webpack:///../src/js/axis/linearAxis.js","webpack:///../src/js/axis/timeAxis.js","webpack:///../../src/js/d3fc/axis/multi-axis.js","webpack:///../../src/js/d3fc/axis/store.js","webpack:///../src/js/plugin/root.js","webpack:///../src/js/axis/ordinalAxis.js","webpack:///../src/js/axis/axisFactory.js","webpack:///../src/js/axis/chartFactory.js","webpack:///../src/js/utils/utils.js","webpack:///../src/js/tooltip/selectionData.js","webpack:///../src/js/tooltip/generateHTML.js","webpack:///../src/js/tooltip/selectionEvent.js","webpack:///../src/js/tooltip/tooltip.js","webpack:///../src/js/series/barSeries.js","webpack:///../src/js/series/seriesKey.js","webpack:///../src/js/series/seriesColors.js","webpack:///../src/js/axis/axisLabel.js","webpack:///../src/js/data/splitIntoMultiSeries.js","webpack:///../src/js/data/groupData.js","webpack:///../../src/js/legend/styling/enforceContainerBoundaries.js","webpack:///../../src/js/legend/styling/draggableComponent.js","webpack:///../../src/js/legend/styling/resizableComponent.js","webpack:///../src/js/legend/scrollableLegend.js","webpack:///../../src/js/legend/styling/cropCellContents.js","webpack:///../src/js/legend/legend.js","webpack:///../src/js/legend/filter.js","webpack:///../src/js/gridlines/gridlines.js","webpack:///../../src/js/d3fc/padding/hardLimitZero.js","webpack:///../src/js/zoom/zoomableChart.js","webpack:///../src/js/charts/bar.js","webpack:///../src/js/axis/domainMatchOrigins.js","webpack:///../src/js/axis/axisSplitter.js","webpack:///../src/js/axis/splitterLabels.js","webpack:///../src/js/charts/column.js","webpack:///../src/js/data/transposeData.js","webpack:///../src/js/data/findBest.js","webpack:///../src/js/tooltip/nearbyTip.js","webpack:///../src/js/charts/line.js","webpack:///../src/js/data/splitData.js","webpack:///../src/js/series/lineSeries.js","webpack:///../src/js/charts/area.js","webpack:///../src/js/data/splitAndBaseData.js","webpack:///../src/js/series/areaSeries.js","webpack:///../src/js/series/seriesSymbols.js","webpack:///../src/js/charts/y-scatter.js","webpack:///../src/js/series/categoryPointSeries.js","webpack:///../src/js/data/pointData.js","webpack:///../src/js/series/seriesRange.js","webpack:///../src/js/legend/colorRangeLegend.js","webpack:///../src/js/charts/xy-scatter.js","webpack:///../src/js/series/pointSeriesCanvas.js","webpack:///../src/js/charts/heatmap.js","webpack:///../src/js/data/heatmapData.js","webpack:///../src/js/series/heatmapSeries.js","webpack:///../src/js/data/ohlcData.js","webpack:///../src/js/series/ohlcCandleSeries.js","webpack:///../src/js/charts/ohlcCandle.js","webpack:///../src/js/charts/ohlc.js","webpack:///../src/js/charts/candlestick.js","webpack:///../src/js/data/treeData.js","webpack:///../../src/js/series/sunburst/sunburstArc.js","webpack:///../../src/js/series/sunburst/sunburstLabel.js","webpack:///../../src/js/series/sunburst/sunburstClick.js","webpack:///../../src/js/series/sunburst/sunburstSeries.js","webpack:///../src/js/layout/gridLayoutMultiChart.js","webpack:///../src/js/charts/sunburst.js","webpack:///../../src/js/series/sunburst/sunburstColor.js","webpack:///../../src/js/series/treemap/treemapColor.js","webpack:///../../src/js/series/treemap/treemapLabel.js","webpack:///../../src/js/series/treemap/treemapLayout.js","webpack:///../../src/js/series/treemap/treemapLevelCalculation.js","webpack:///../../src/js/series/treemap/treemapTransitions.js","webpack:///../../src/js/series/treemap/treemapSeries.js","webpack:///../../src/js/series/treemap/treemapControls.js","webpack:///../src/js/charts/treemap.js","webpack:///../src/js/charts/charts.js","webpack:///../src/js/series/colorStyles.js","webpack:///../src/js/plugin/template.js","webpack:///../src/js/plugin/plugin.js","webpack:///src/js/index.js"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__1__","__WEBPACK_EXTERNAL_MODULE__2__","__WEBPACK_EXTERNAL_MODULE__3__","__WEBPACK_EXTERNAL_MODULE__4__","__WEBPACK_EXTERNAL_MODULE__5__","__WEBPACK_EXTERNAL_MODULE__6__","__WEBPACK_EXTERNAL_MODULE__13__","__WEBPACK_EXTERNAL_MODULE__14__","__WEBPACK_EXTERNAL_MODULE__15__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","push","Element","matches","msMatchesSelector","webkitMatchesSelector","closest","el","this","parentElement","parentNode","nodeType","useSourceMap","list","toString","map","item","content","cssMapping","btoa","sourceMapping","sourceMap","unescape","encodeURIComponent","JSON","stringify","sourceURLs","sources","source","sourceRoot","concat","join","cssWithMappingToString","mediaQuery","alreadyImportedModules","length","id","AXIS_TYPES","none","ordinal","time","linear","axisType","settings","settingName","settingValue","excludeType","getType","checkTypes","types","filter","some","includes","type","args","flattenExtent","array","withUndefined","fn","a","b","undefined","reduce","v","Math","min","max","flattenArray","Array","isArray","adaptee","minBandwidth","arg","rebindAll","bandwidth","scale","withoutTicks","ticks","d3","domain","valueNames","orient","_domain","data","flattenedData","transformDomain","Set","reverse","valueName","labelFunction","defaultPadding","pad","padUnit","padding","extent","delta","Error","arguments","toConsumableArray","arr","arr2","from","abs","Number","isInteger","base","accessors","symmetricalAbout","include","paddingStrategy","instance","values","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","iterator","_step","next","done","accessor","apply","err","return","extent$$1","d3Array","halfRange","customExtent","parseFloat","getDataExtent","fc","dataWidth","gaps","sort","acc","src","getMinimumGap","tickFormatFunction","valueformatter","Date","getTime","multiAxis","baseAxis","tickSizeOuter","tickSizeInner","axisStore","names","store","target","keys","decorate","groups","groupDataJoin","dataJoin","domainPathDataJoin","translate","x","y","isVertical","selection","transition","each","index","group","element","container","select","sign","range","domainPathData","pathTranspose","attr","line","g","getAxisSize","getAxisOffset","sum","nodes","groupElement","groupScale","scaleFromGroup","tickOffset","step","useAxis","exit","customScale","tickFormat","text","copy","exclude","tickSize","multiAxisTop","axisOrdinalTop","multiAxisBottom","axisOrdinalBottom","multiAxisLeft","axisOrdinalLeft","multiAxisRight","axisOrdinalRight","getChartElement","getRootNode","host","getChartContainer","component","getComponent","multiLevel","levelGroups","axisGroups","groupTickLayout","getGroupTickLayout","size","createAxis","axis","tickPadding","axisSet","getAxisSet","bottom","left","right","top","rotation","applyLabelRotation","hideOverlappingLabels","forEach","tick","split","width","maxLength","rotated","isOverlap","r1","r2","height","boundsRect","getXAxisBoundsRect","previousRectangles","transformCoords","transform","splitOn","indexOf","coords","substring","parseInt","getTransformCoords","tickRect","node","getBBox","rect","hidden","rectangleContained","chart","querySelector","chartRect","getBoundingClientRect","axisRect","getLabelTransform","anchor","style","axisTypes","axisFactory","optionalParams","optional","_factory","useType","domainFunction","createComponent","defaultComponent","label","chartSvgFactory","xAxis","yAxis","chartFactory","chartCanvasFactory","cartesian","canvas","axisSplitter","altAxis","xScale","yScale","xDomain","xLabel","xAxisHeight","xDecorate","xTickFormat","yDomain","yLabel","yAxisWidth","yDecorate","yOrient","yTickFormat","xPaddingInner","xPaddingOuter","yPaddingInner","yPaddingOuter","oldDecorate","plotArea","setAttribute","clientWidth","clientHeight","haveSplit","altData","y2AxisDataJoin","ySeriesDataJoin","enter","append","y2Scale","yAxisComponent","on","detail","drawMultiCanvasSeries","canvasPlotArea","context","getContext","yScales","drawMultiSvgSeries","svgPlotArea","datum","getOrCreateElement","selector","createCallback","isElementOverflowing","containerRect","innerElementRect","direction","isElementOverlapping","immovableRect","elementRect","fuzz","dimension","immovableInnerPoint","immovableOuterPoint","elementInnerPoint","elementOuterPoint","toValue","getGroupValues","crossValues","crossValue","cross","getSplitValues","splitValues","mainValue","getDataValues","mainValues","baseValue","main","colorValue","generateHtml","tooltipDiv","selectAll","formatNumber","addDataValues","toLocaleString","minimumFractionDigits","get_type_config","precision","maximumFractionDigits","mapToFilter","raiseEvent","column_names","groupFilters","splitFilters","filters","dispatchEvent","CustomEvent","bubbles","composed","config","row","tooltip","alwaysShow","centered","_tooltip","isConnected","hideTooltip","html","tooltipTemplate","getTooltipDiv","showTip","containerNode","scrollTop","duration","tooltipDivRect","leftAdjust","newLeft","topAdjust","newTop","centerTip","shiftIfOverflowingChartArea","showTooltip","hideTip","_event","selectionEvent","barSeries","color","series","groupFromKey","slice","seriesColors","col","k","colorScale","defaultColors","mapFunction","withOpacity","colorStyles","opacity","colors","styles","defaults","scheme","withoutOpacity","setOpacity","decoded","labelFunctions","noLabel","ordinalLabel","timeLabel","linearLabel","splitIntoMultiSeries","stack","excludeEmpty","useData","multiSeries","baseValues","labels","baseKey","splitName","__ROW_PATH__","__KEY__","splitByValuesIntoMultiSeries","groupAndStackData","groupPointDataByMainValue","seriesFn","labelfn","seriesDataFn","margin","enforceContainerBoundaries","innerNode","offsetX","offsetY","chartNodeRect","getContainer","innerNodeRect","draggedInnerNodeRect","adjustedOffsets","edge","bound","adjustment","resizeForDraggingEvent","draggableComponent","pinned","draggable","cursor","legend","drag","offsets","dx","dy","offsetLeft","offsetTop","position","nodeRect","isNodeInTopRight","pinNodeToTopRight","unpinNodeFromTopRight","horizontalHandleClass","verticalHandleClass","cornerHandleClass","handlesContainerId","fillOpacity","resizeEvent","extendPerpendicularHandles","handles","offset","orientationClass","_","handleNode","handlesContainerExists","pinHandleToHandleBoxEdge","handle","extendHandlesBox","fromLegend","d3Legend","pageSize","resizable","pageCount","pageIndex","scrollableLegend","handleWidthPx","zIndex","minDimensionsPx","maxDimensionsPx","callbacks","executeCallbacks","event","callback","execute","dragHelper","horizontal","dragLeft","vertical","dragTop","dragRight","dragBottom","topleft","topright","bottomright","bottomleft","handlesGroup","xCoordHelper","yCoordHelper","leftHandle","topHandle","rightHandle","bottomHandle","concatCornerEdges","corner","cornerCursorHelper","topLeftHandle","topRightHandle","bottomRightHandle","bottomLeftHandle","enforceDistToParallelBarConstraints","offsetWidth","updateSettings","resizeAndRelocateHandles","pointerFallenBehindAbsoluteCoordinates","offsetHeight","dimensions","pinCorners","enforceMaxDimensions","relativeHandle","becauseCrossedMinSize","becauseExitedCoordinateSpace","dragHandleContainer","operatorFunction","anticipatedDimension","input","minWidth","minHeight","handleWidth","maxWidth","maxHeight","resizableComponent","render","calculatePageSize","renderControls","renderLegend","legendDiv","legendCells","legendDivRect","svg","cell","cutoffCharIndex","cellRect","cutoffCoord","createSVGPoint","getCharNumAtPosition","getCutoffCharacterIndex","cropCellContents","controls","getLegendControls","setPage","cellFilter","remove","legendElement","getLegendElement","cellContainerSize","legendContainerRect","proposedPageSize","floor","calculatePageCount","ceil","legendControlsTemplate","scrollColorLegend","shape","shapeRadius","scrollSymbolLegend","shapePadding","labelOffset","colorLegend","legendComponent","symbolLegend","symbolScale","fromScale","scrollLegendComponent","scaleModifier","scrollLegend","hideKeys","draw","options","parts","legendSelection","isHidden","cells","classed","filterData","clone","filterDataByGroup","mainGridCanvas","globalAlpha","lineWidth","crossGridSvg","crossGridCanvas","seriesMulti","annotationGridline","mainGrid","grid","gridLineColor","mainGridSvg","crossGrid","_withGridLines","multi","xStyle","yStyle","gridlines","hardLimitZeroPadding","_defaultPadding","paddedLowerExtent","paddedUpperExtent","xCopy","yCopy","onChange","zoomableChart","chartPlotArea","dateAxis","zoom","applyTransform","noZoom","zoomControls","getZoomControls","oneYear","sixMonths","oneMonth","dateClick","endCalculation","start","end","xRange","yMiddle","setYear","getFullYear","setMonth","getMonth","sel","initialTransform","zoomableScale","changeArgs","rescaleX","yZoomDomain","rescaleY","template","nice","barChart","bars","mapping","withGridLines","align","xNice","zoomChart","plugin","max_cells","max_columns","domain1","domain2","isMatchable","ratio1","originRatio","ratio2","adjustLowerBound","isNaN","ratio","sourceData","splitFn","dataSplitFunction","splitMainValues","altValue","splitter","labelsInfo","mainLabels","altLabels","labeller","alt","_render","labelDataJoin","disabled","coloured","redrawChart","chartElement","splitterLabels","isIncludedFn","dataBlankFunction","assign","groupedBlankFunction","columnChart","yAxisFactory","blankFunction","yAxis1","plotSeries","yNice","yAxis2","domainMatchOrigins","transposeData","columns","findBestFromData","valueFn","compareFn","findBestFromArray","best","thisValue","findBestFromItem","bestItem","xValueName","yValueName","altDataWithScale","nearbyTip","tooltipData","pointer","getClosestDataPoint","useYScale","renderTip","tipData","tips","merge","sqrt","pos","distFn","pow","dist1","best1","dist2","best2","lineChart","splitData","lineSeries","toolTip","transposed_data","areaChart","splitAndBaseData","areaSeries","symbols","fromDomain","yScatter","groupedSeries","groupData","symbolType","seriesKey","categoryPointSeries","pointData","mappedSeries","realValues","seriesToPoints","seriesColorRange","getExtent","gradient","full","positive","negative","maxVal","interpolator","multiInterpolator","gradientPairs","interpolators","findIndex","value1","value2","colorRangeLegend","paddedDomain","expandedDomain","svgBar","middle","round","tickValues","axisLabel","legendSvg","legendBar","barWidth","xyScatter","symbolTypeFromGroups","useGroupColors","seriesColorsFromGroups","seriesLinearRange","seriesCanvasPoint","strokeStyle","fillStyle","pointSeriesCanvas","axisDefault","initial","count","selectMode","heatmapChart","mainType","heatmapData","pop","getMainValues","xValue","yValue","colorInterpolate","widthFraction","heatmapSeries","xAlign","yAlign","ohlcData","openValue","closeValue","getNextOpen","highValue","lowValue","seriesToOHLC","isUp","ohlcCandle","seriesCanvas","srcData","bollinger","seriesData","bollingerData","upColor","downColor","avgColor","bollingerAverageSeries","average","bollingerAreaSeries","upper","lower","ohlcCandleSeries","zoomedData","ohlc","seriesCanvasOhlc","candlestick","seriesCanvasCandlestick","treeData","sets","real_aggs","find","splits","splitValue","getSplitNames","currentLevel","e","children","getDataValue","entries","set","tree","chartData","PI","current","ancestors","extents","getExtents","aggregate","drawArc","radius","arc","startAngle","x0","endAngle","x1","padAngle","padRadius","innerRadius","y0","outerRadius","y1","arcVisible","labelVisible","labelTransform","cropLabel","targetWidth","actualWidth","labelText","textSelection","replace","clickHandler","parent","parentTitle","path","skipTransition","sunburstLevel","depth","tween","interpolate","getAttribute","attrTween","sunburstSeries","_sunburstSeries","sunburstElement","segment","descendants","segmentEnter","segmentMerge","onClick","gridLayoutMultiChart","elementsPrefix","chartContainer","chartEnter","chartDiv","chartTitle","containerSize","_gridLayoutMultiChart","innerContainer","innerRect","containerHeight","containerWidth","cols","rows","sunburst","console","warn","treeColor","sunburstGrid","sunburstContainer","sunburstEnter","sunburstDiv","sunburstTitle","svgNode","getColors","child","labelMapExists","textAttributes","toggleLabels","treemapLevel","textLevelHelper","visibleNodes","selectVisibleNodes","centerLabels","preventTextCollisions","restoreLabels","class","topNodes","textVisability","high","low","lowerNode","topNode","lockTextOpacity","textOpacity","unlockTextOpacity","mid","zero","adjustLabelsThatOverflow","shrinkOrHideText","centerText","nodeSelect","childNodes","textRect","rectRect","needsToShrinkOrHide","fontSize","every","treemapLayout","paddingInner","tile","includesAllCrossValues","val","calculateSubTreeMap","nodesMerge","rootNode","treemapDiv","oldDimensions","newDimensions","dimensionMultiplier","calcWidth","calcHeight","visible","mapLevel","levelRoot","approximateAttributesForAllNodes","subTreeRoot","treeRootWidth","treeRootHeight","dummiedDescendants","treemapBlueprinter","hierarchy","recalculateVisibleSubTreeCoordinates","calculateTextOpacities","saveLabelMap","textVis","textLockedAt","changeLevel","rects","treemapSvg","parentCtrls","treemapRoute","executeTransition","recordLabelMap","ease","preventUserInteraction","styleTween","catch","enableUserInteraction","then","visibleLabelNodes","async","interpolation","lockedOpacity","targetOpacity","ex","error","fadeTextTransition","hide","deactivate","nodeLevel","nodeLevelHelper","maxDepth","isLeafNode","treemapSeries","_treemapSeries","deactivated","button","parentControls","treemap","nodesEnter","calculateRootLevelMap","cv","returnToLevel","treemaps","treemapGrid","treemapEnter","chartClasses","heatmap","getOpacityFromColor","stepAsColor","computedStyle","ShadyCSS","getComputedStyleValue","containerStyles","getComputedStyle","getPropertyValue","parseGradient","parsed","gparser","colorStops","styleWithD3FC","headerStyles","document","querySelectorAll","d3fcStyles","innerText","getD3FCStyles","bindTemplate","constructor","super","_chart","_settings","connectedCallback","log","_container","shadowRoot","_configureSettings","computed","initialiseStyles","navigator","userAgent","setTimeout","containerDiv","chartClass","resize","innerHTML","delete","getSettings","setSettings","oldSettings","newSettings","oldValues","newValues","arr1","PRIVATE","DEFAULT_PLUGIN_SETTINGS","drawChart","view","task","end_col","end_row","jsonp","parse","to_json","leaves_only","tschema","schema","json","Promise","all","_table","get_config","cancelled","row_pivots","column_pivots","mapped","createOrUpdateChart","getOrCreatePluginElement","perspective_d3fc_element","createElement","div","body","contains","appendChild","resizeChart","deleteChart","save","restore","plugins","charts","has","registerPlugin","register"],"mappings":"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","file":"perspective-viewer-d3fc.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"d3\"), require(\"d3fc\"), require(\"core-js/modules/web.dom-collections.iterator\"), require(\"d3-array\"), require(\"d3-svg-legend\"), require(\"@finos/perspective/dist/esm/config\"), require(\"@finos/perspective-viewer/dist/esm/utils.js\"), require(\"gradient-parser\"), require(\"@finos/perspective-viewer/dist/esm/utils\"), require(\"core-js/modules/es.string.replace\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"d3\", \"d3fc\", \"core-js/modules/web.dom-collections.iterator\", \"d3-array\", \"d3-svg-legend\", \"@finos/perspective/dist/esm/config\", \"@finos/perspective-viewer/dist/esm/utils.js\", \"gradient-parser\", \"@finos/perspective-viewer/dist/esm/utils\", \"core-js/modules/es.string.replace\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"perspective-view-d3fc\"] = factory(require(\"d3\"), require(\"d3fc\"), require(\"core-js/modules/web.dom-collections.iterator\"), require(\"d3-array\"), require(\"d3-svg-legend\"), require(\"@finos/perspective/dist/esm/config\"), require(\"@finos/perspective-viewer/dist/esm/utils.js\"), require(\"gradient-parser\"), require(\"@finos/perspective-viewer/dist/esm/utils\"), require(\"core-js/modules/es.string.replace\"));\n\telse\n\t\troot[\"perspective-view-d3fc\"] = factory(root[\"d3\"], root[\"d3fc\"], root[\"core-js/modules/web.dom-collections.iterator\"], root[\"d3-array\"], root[\"d3-svg-legend\"], root[\"@finos/perspective/dist/esm/config\"], root[\"@finos/perspective-viewer/dist/esm/utils.js\"], root[\"gradient-parser\"], root[\"@finos/perspective-viewer/dist/esm/utils\"], root[\"core-js/modules/es.string.replace\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__, __WEBPACK_EXTERNAL_MODULE__1__, __WEBPACK_EXTERNAL_MODULE__2__, __WEBPACK_EXTERNAL_MODULE__3__, __WEBPACK_EXTERNAL_MODULE__4__, __WEBPACK_EXTERNAL_MODULE__5__, __WEBPACK_EXTERNAL_MODULE__6__, __WEBPACK_EXTERNAL_MODULE__13__, __WEBPACK_EXTERNAL_MODULE__14__, __WEBPACK_EXTERNAL_MODULE__15__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","module.exports = __WEBPACK_EXTERNAL_MODULE__3__;","module.exports = __WEBPACK_EXTERNAL_MODULE__4__;","module.exports = __WEBPACK_EXTERNAL_MODULE__5__;","module.exports = __WEBPACK_EXTERNAL_MODULE__6__;","module.exports = \"<ul id=\\\"tooltip-values\\\"></ul>\";","module.exports = \"<span id=\\\"up-arrow\\\">&#9650;</span>\\n<span id=\\\"page-text\\\"></span>\\n<span id=\\\"down-arrow\\\">&#9660;</span>\";","module.exports = \"<button id=\\\"zoom-reset\\\">Reset zoom</button>\\n<button id=\\\"one-year\\\">1 Year</button>\\n<button id=\\\"six-months\\\">6 Months</button>\\n<button id=\\\"one-month\\\">1 Month</button>\";","module.exports = \"<button id=\\\"goto-parent\\\">Goto parent</button>\";","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \":host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:15px;overflow:hidden}:host .chart.d3_heatmap d3fc-group.cartesian-chart,:host .chart.d3_treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0,max-content) auto 1fr auto minmax(0,max-content);grid-template-rows:minmax(0,max-content) auto 1fr auto minmax(0,max-content)}:host .chart .chart-label{display:none}:host .chart.d3_heatmap{padding-right:120px}:host .chart.d3_sunburst{padding:0}:host .chart.d3_sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.d3_sunburst .inner-container div{overflow:hidden}:host .chart.d3_sunburst .inner-container svg{width:100%;height:100%;transform:translate(0,-27px)}:host .chart.d3_sunburst .inner-container path{fill:var(--d3fc-series,rgba(31,119,180,.5))}:host .chart.d3_sunburst .inner-container text.parent,:host .chart.d3_sunburst .inner-container text.segment{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,#333)}:host .chart.d3_sunburst .inner-container div.title-container{margin-top:5px}:host .chart.d3_treemap{padding-right:120px}:host .chart.d3_treemap .treemap-container{position:relative}:host .chart.d3_treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.d3_treemap .inner-container div{overflow:hidden}:host .chart.d3_treemap .inner-container svg{width:100%;height:100%}:host .chart.d3_treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines,var(--d3fc-axis--lines,#fff));fill:var(--d3fc-series,rgba(31,119,180,.5))}:host .chart.d3_treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight,#000);stroke-opacity:1}:host .chart.d3_treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0}:host .chart.d3_treemap .inner-container .branchnode{opacity:0}:host .chart.d3_treemap .inner-container .branchnode:hover{fill-opacity:.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight,#000)}:host .chart.d3_treemap .inner-container .leafnode{fill-opacity:.8}:host .chart.d3_treemap .inner-container .leafnode:hover{fill-opacity:.5}:host .chart.d3_treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0}:host .chart.d3_treemap .inner-container .top{font-size:19px;font-weight:700;z-index:5;pointer-events:none}:host .chart.d3_treemap .inner-container .mid{font-size:10px;font-weight:700;opacity:.7;z-index:4}:host .chart.d3_treemap .inner-container .lower{font-size:0;font-weight:700;opacity:0;z-index:4}:host .chart.d3_treemap .inner-container text{fill:var(--d3fc-treedata--labels,#333)}:host .chart.d3_treemap .inner-container text.title{dominant-baseline:hanging}:host .chart.d3_treemap .inner-container .parent-controls{position:absolute;top:15px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s}:host .chart.d3_treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px #000;transition:box-shadow .2s}:host .chart .x-label{height:1.2em!important}:host .chart d3fc-canvas.plot-area{display:none}:host .chart.d3_candlestick d3fc-canvas.plot-area,:host .chart.d3_ohlc d3fc-canvas.plot-area,:host .chart.d3_xy_scatter d3fc-canvas.plot-area{display:block}:host .chart .x-axis text,:host .chart .y-axis text{fill:var(--d3fc-axis--ticks,#505050);font-size:11px}:host .chart .x-axis path,:host .chart .y-axis path{stroke:var(--d3fc-axis--lines,#b4d2e1)}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer}:host .chart .splitter-label::after{margin-left:5px;color:var(--d3fc-axis--lines,#b4d2e1)}:host .chart .splitter-label:hover::after{color:var(--d3fc-axis--ticks,#505050)}:host .chart .splitter-label.disabled{cursor:default}:host .chart .splitter-label.disabled::after{color:rgba(80,80,80,.3)}:host .chart .y-label-container .splitter-label::after{content:\\\"\\\\1F847\\\"}:host .chart .y2-label-container .splitter-label::after{content:\\\"\\\\1F845\\\"}:host .chart.d3_x_bar .x-axis path,:host .chart.d3_xy_scatter .x-axis path,:host .chart.d3_xy_scatter .y-axis path,:host .chart.d3_y_area .y-axis path,:host .chart.d3_y_bar .y-axis path,:host .chart.d3_y_line .y-axis path,:host .chart.d3_y_scatter .y-axis path{visibility:hidden}:host .chart .y-label{white-space:nowrap}:host .chart .nearbyTip{fill:var(--d3fc-series,rgba(31,119,180,.5))}:host .chart .series{fill:var(--d3fc-series,rgba(31,119,180,.5))}:host .chart .series-1{fill:var(--d3fc-series-1,#0366d6)}:host .chart .series-2{fill:var(--d3fc-series-2,#ff7f0e)}:host .chart .series-3{fill:var(--d3fc-series-3,#2ca02c)}:host .chart .series-4{fill:var(--d3fc-series-4,#d62728)}:host .chart .series-5{fill:var(--d3fc-series-5,#9467bd)}:host .chart .series-6{fill:var(--d3fc-series-6,#8c564b)}:host .chart .series-7{fill:var(--d3fc-series-7,#e377c2)}:host .chart .series-8{fill:var(--d3fc-series-8,#7f7f7f)}:host .chart .series-9{fill:var(--d3fc-series-9,#bcbd22)}:host .chart .series-10{fill:var(--d3fc-series-10,#17becf)}:host .disabled{filter:grayscale(100%)}:host #dragHandles{position:absolute;top:0;right:0;left:auto;pointer-events:none}:host #dragHandles rect{pointer-events:all}:host .label rect{fill:none}:host .legend-container{position:absolute;top:15px;right:15px;left:auto;width:150px;height:280px}:host .legend-container.legend-color{width:90px;height:150px}:host .legend-container[borderbox-on-hover=true]{transition:box-shadow 1s}:host .legend-container[borderbox-on-hover=true]:hover{box-shadow:0 2px 5px rgba(0,0,0,.2);transition:box-shadow .2s}:host .legend-container .legend{font-size:8pt;width:100%}:host .legend-container .legend .cell{cursor:pointer}:host .legend-container .legend .cell path{fill:var(--d3fc-series,rgba(31,119,180,.5));stroke:var(--d3fc-series,#1f77b4)}:host .legend-container .legend .cell.hidden path{fill:rgba(204,204,204,.5);stroke:#ccc}:host .legend-container .legend .cell.hidden circle{fill:#ccc!important}:host .legend-container text{fill:var(--d3fc-legend--text,#333)}:host .legend-container .label:hover{fill:#22a0ce}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text,#333)}:host .legend-container .legend-controls{margin-left:12px}:host .legend-container .legend-controls #down-arrow,:host .legend-container .legend-controls #up-arrow{cursor:pointer;color:#1f77b4}:host .legend-container .legend-controls #down-arrow.disabled,:host .legend-container .legend-controls #up-arrow.disabled{cursor:default;color:#333}:host .d3_heatmap .legend-container.legend-color{height:200px}:host .d3_treemap .legend-container.legend-color{height:200px}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center}:host .zoom-controls button{-webkit-appearance:none;background:#f7f7f7;border:1px solid #ccc;padding:10px;opacity:.5;cursor:pointer}:host .zoom-controls button:hover{background:#e6e6e6}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right}:host .parent-controls button{-webkit-appearance:none;background:#f7f7f7;border:1px solid #ccc;padding:10px;opacity:.5;cursor:pointer}:host .parent-controls button:hover{background:#e6e6e6}:host div.tooltip{position:absolute;text-align:left;font-size:10pt;white-space:nowrap;padding:.5em;background:var(--d3fc-tooltip--background,#fff);color:var(--d3fc-tooltip--color,#000);border:1px solid #777;border-radius:2px;pointer-events:none}:host div.tooltip ul{margin:0;padding:0;list-style-type:none}\", \"\"]);\n\n// exports\n","module.exports = \"<template id=\\\"perspective-d3fc-chart\\\">\\r\\n    <div id=\\\"container\\\" class=\\\"chart\\\">\\r\\n    </div>\\r\\n</template>\";","module.exports = __WEBPACK_EXTERNAL_MODULE__13__;","module.exports = __WEBPACK_EXTERNAL_MODULE__14__;","module.exports = __WEBPACK_EXTERNAL_MODULE__15__;","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nif (!Element.prototype.matches) {\r\n    Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\r\n}\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nif (!Element.prototype.matches) {\r\n    Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\r\n}\r\n\r\nif (!Element.prototype.closest) {\r\n    Element.prototype.closest = function(s) {\r\n        var el = this;\r\n\r\n        do {\r\n            if (el.matches(s)) return el;\r\n            el = el.parentElement || el.parentNode;\r\n        } while (el !== null && el.nodeType === 1);\r\n        return null;\r\n    };\r\n}\r\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nexport const AXIS_TYPES = {\r\n    none: \"none\",\r\n    ordinal: \"ordinal\",\r\n    time: \"time\",\r\n    linear: \"linear\"\r\n};\r\n\r\nexport const axisType = settings => {\r\n    let settingName = \"crossValues\";\r\n    let settingValue = null;\r\n    let excludeType = null;\r\n\r\n    const getType = () => {\r\n        const checkTypes = types => {\r\n            const list = settingValue ? settings[settingName].filter(s => settingValue == s.name) : settings[settingName];\r\n\r\n            if (settingName == \"crossValues\" && list.length > 1) {\r\n                // can't do multiple values on non-ordinal cross-axis\r\n                return false;\r\n            }\r\n\r\n            return list.some(s => types.includes(s.type));\r\n        };\r\n\r\n        if (settings[settingName].length === 0) {\r\n            return AXIS_TYPES.none;\r\n        } else if (excludeType != AXIS_TYPES.time && checkTypes([\"datetime\", \"date\"])) {\r\n            return AXIS_TYPES.time;\r\n        } else if (excludeType != AXIS_TYPES.linear && checkTypes([\"integer\", \"float\"])) {\r\n            return AXIS_TYPES.linear;\r\n        }\r\n\r\n        if (excludeType == AXIS_TYPES.ordinal) {\r\n            return AXIS_TYPES.linear;\r\n        }\r\n        return AXIS_TYPES.ordinal;\r\n    };\r\n\r\n    getType.settingName = (...args) => {\r\n        if (!args.length) {\r\n            return settingName;\r\n        }\r\n        settingName = args[0];\r\n        return getType;\r\n    };\r\n\r\n    getType.settingValue = (...args) => {\r\n        if (!args.length) {\r\n            return settingValue;\r\n        }\r\n        settingValue = args[0];\r\n        return getType;\r\n    };\r\n\r\n    getType.excludeType = (...args) => {\r\n        if (!args.length) {\r\n            return excludeType;\r\n        }\r\n        excludeType = args[0];\r\n        return getType;\r\n    };\r\n\r\n    return getType;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nexport const flattenExtent = array => {\r\n    const withUndefined = fn => (a, b) => {\r\n        if (a === undefined) return b;\r\n        if (b === undefined) return a;\r\n        return fn(a, b);\r\n    };\r\n    return array.reduce((r, v) => [withUndefined(Math.min)(r[0], v[0]), withUndefined(Math.max)(r[1], v[1])], [undefined, undefined]);\r\n};\r\n\r\nexport const flattenArray = array => {\r\n    if (Array.isArray(array)) {\r\n        return [].concat(...array.map(flattenArray));\r\n    } else {\r\n        return [array];\r\n    }\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport {rebindAll} from \"d3fc\";\r\n\r\nconst MIN_BANDWIDTH = 1;\r\n\r\nexport default adaptee => {\r\n    const minBandwidth = arg => {\r\n        return adaptee(arg);\r\n    };\r\n\r\n    rebindAll(minBandwidth, adaptee);\r\n\r\n    minBandwidth.bandwidth = (...args) => {\r\n        if (!args.length) {\r\n            return Math.max(adaptee.bandwidth(), MIN_BANDWIDTH);\r\n        }\r\n        adaptee.bandwidth(...args);\r\n        return minBandwidth;\r\n    };\r\n\r\n    return minBandwidth;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\nimport {flattenArray} from \"./flatten\";\r\nimport minBandwidth from \"./minBandwidth\";\r\nimport withoutTicks from \"./withoutTicks\";\r\n\r\nexport const scale = () => withoutTicks(minBandwidth(d3.scaleBand()));\r\n\r\nexport const domain = () => {\r\n    let valueNames = [\"crossValue\"];\r\n    let orient = \"horizontal\";\r\n\r\n    const _domain = data => {\r\n        const flattenedData = flattenArray(data);\r\n        return transformDomain([...new Set(flattenedData.map(d => d[valueNames[0]]))]);\r\n    };\r\n\r\n    const transformDomain = d => (orient == \"vertical\" ? d.reverse() : d);\r\n\r\n    _domain.valueName = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames[0];\r\n        }\r\n        valueNames = [args[0]];\r\n        return _domain;\r\n    };\r\n    _domain.valueNames = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames;\r\n        }\r\n        valueNames = args[0];\r\n        return _domain;\r\n    };\r\n\r\n    _domain.orient = (...args) => {\r\n        if (!args.length) {\r\n            return orient;\r\n        }\r\n        orient = args[0];\r\n        return _domain;\r\n    };\r\n\r\n    return _domain;\r\n};\r\n\r\nexport const labelFunction = valueName => d => d[valueName].join(\"|\");\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport {rebindAll} from \"d3fc\";\r\n\r\nexport default adaptee => {\r\n    const withoutTicks = arg => {\r\n        return adaptee(arg);\r\n    };\r\n\r\n    rebindAll(withoutTicks, adaptee);\r\n\r\n    withoutTicks.ticks = function() {\r\n        return [];\r\n    };\r\n\r\n    return withoutTicks;\r\n};\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport const defaultPadding = () => {\n    let pad = [0, 0];\n    let padUnit = \"percent\";\n\n    const padding = extent => {\n        switch (padUnit) {\n            case \"domain\": {\n                extent[0] -= pad[0];\n                extent[1] += pad[1];\n                break;\n            }\n            case \"percent\": {\n                let delta = extent[1] - extent[0];\n                extent[0] -= pad[0] * delta;\n                extent[1] += pad[1] * delta;\n                break;\n            }\n            default:\n                throw new Error(\"Unknown padUnit: \" + padUnit);\n        }\n        return extent;\n    };\n\n    padding.pad = function() {\n        if (!arguments.length) {\n            return pad;\n        }\n        pad = arguments.length <= 0 ? undefined : arguments[0];\n        return padding;\n    };\n\n    padding.padUnit = function() {\n        if (!arguments.length) {\n            return padUnit;\n        }\n        padUnit = arguments.length <= 0 ? undefined : arguments[0];\n        return padding;\n    };\n\n    return padding;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3Array from \"d3-array\";\nimport {defaultPadding} from \"../padding/default\";\n\nexport const extentLinear = function() {\n    let accessors = [\n        function(d) {\n            return d;\n        }\n    ];\n    let symmetricalAbout = null;\n    let include = [];\n    let paddingStrategy = defaultPadding();\n\n    const instance = function instance(data) {\n        let values = new Array(data.length);\n        let _iteratorNormalCompletion = true;\n        let _didIteratorError = false;\n        let _iteratorError = undefined;\n\n        let _iterator = accessors[Symbol.iterator]();\n        try {\n            for (let _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                let accessor = _step.value;\n\n                for (let i = 0; i < data.length; i++) {\n                    let value = accessor(data[i], i);\n                    if (Array.isArray(value)) {\n                        values.push.apply(values, toConsumableArray(value));\n                    } else {\n                        values.push(value);\n                    }\n                }\n            }\n        } catch (err) {\n            _didIteratorError = true;\n            _iteratorError = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion && _iterator.return) {\n                    _iterator.return();\n                }\n            } finally {\n                if (_didIteratorError) {\n                    throw _iteratorError;\n                }\n            }\n        }\n\n        let extent$$1 = [d3Array.min(values), d3Array.max(values)];\n\n        extent$$1[0] = extent$$1[0] == null ? d3Array.min(include) : d3Array.min([extent$$1[0]].concat(toConsumableArray(include)));\n        extent$$1[1] = extent$$1[1] == null ? d3Array.max(include) : d3Array.max([extent$$1[1]].concat(toConsumableArray(include)));\n\n        if (symmetricalAbout != null) {\n            let halfRange = Math.max(Math.abs(extent$$1[1] - symmetricalAbout), Math.abs(extent$$1[0] - symmetricalAbout));\n            extent$$1[0] = symmetricalAbout - halfRange;\n            extent$$1[1] = symmetricalAbout + halfRange;\n        }\n\n        return paddingStrategy(extent$$1);\n    };\n\n    instance.accessors = function() {\n        if (!arguments.length) {\n            return accessors;\n        }\n        accessors = arguments.length <= 0 ? undefined : arguments[0];\n        return instance;\n    };\n\n    //This function points directly at the paddingStrategy child object's\n    //properties for backwards-compatibility. DEPRECATED.\n    instance.pad = function() {\n        if (!arguments.length) {\n            return paddingStrategy.pad;\n        }\n        paddingStrategy.pad(arguments.length <= 0 ? undefined : arguments[0]);\n        return instance;\n    };\n\n    //This function points directly at the paddingStrategy child object's\n    //properties for backwards-compatibility. DEPRECATED.\n    instance.padUnit = function() {\n        if (!arguments.length) {\n            return paddingStrategy.padUnit;\n        }\n        paddingStrategy.padUnit(arguments.length <= 0 ? undefined : arguments[0]);\n        return instance;\n    };\n\n    instance.include = function() {\n        if (!arguments.length) {\n            return include;\n        }\n        include = arguments.length <= 0 ? undefined : arguments[0];\n        return instance;\n    };\n\n    instance.symmetricalAbout = function() {\n        if (!arguments.length) {\n            return symmetricalAbout;\n        }\n        symmetricalAbout = arguments.length <= 0 ? undefined : arguments[0];\n        return instance;\n    };\n\n    instance.paddingStrategy = function() {\n        if (!arguments.length) {\n            return paddingStrategy;\n        }\n        paddingStrategy = arguments.length <= 0 ? undefined : arguments[0];\n        return instance;\n    };\n\n    return instance;\n};\n\nlet toConsumableArray = function(arr) {\n    if (Array.isArray(arr)) {\n        let arr2 = Array(arr.length);\n        for (let i = 0; i < arr.length; i++) {\n            arr2[i] = arr[i];\n        }\n        return arr2;\n    } else {\n        return Array.from(arr);\n    }\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\n\nconst SI_MIN = 10000000;\n\nexport default d => (Math.abs(d) >= SI_MIN ? d3.format(\".3s\")(d) : Number.isInteger(d) ? d3.format(\",.0f\")(d) : d3.format(\",.2f\")(d));\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\nimport * as fc from \"d3fc\";\r\nimport {flattenArray} from \"./flatten\";\r\nimport {extentLinear as customExtent} from \"../d3fc/extent/extentLinear\";\r\nimport valueformatter from \"./valueFormatter\";\r\n\r\nexport const scale = () => d3.scaleLinear();\r\n\r\nexport const domain = () => {\r\n    const base = customExtent()\r\n        .pad([0, 0.1])\r\n        .padUnit(\"percent\");\r\n\r\n    let valueNames = [\"crossValue\"];\r\n\r\n    const _domain = data => {\r\n        base.accessors(valueNames.map(v => d => parseFloat(d[v])));\r\n\r\n        return getDataExtent(flattenArray(data));\r\n    };\r\n\r\n    fc.rebindAll(_domain, base);\r\n\r\n    const getMinimumGap = data => {\r\n        const gaps = valueNames.map(valueName =>\r\n            data\r\n                .map(d => d[valueName])\r\n                .sort((a, b) => a - b)\r\n                .filter((d, i, a) => i === 0 || d !== a[i - 1])\r\n                .reduce((acc, d, i, src) => (i === 0 || acc <= d - src[i - 1] ? acc : Math.abs(d - src[i - 1])))\r\n        );\r\n\r\n        return Math.min(...gaps);\r\n    };\r\n\r\n    const getDataExtent = data => {\r\n        if (base.padUnit() == \"domain\") {\r\n            const dataWidth = getMinimumGap(data);\r\n            return base.pad([dataWidth / 2, dataWidth / 2])(data);\r\n        } else {\r\n            return base(data);\r\n        }\r\n    };\r\n\r\n    _domain.valueName = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames[0];\r\n        }\r\n        valueNames = [args[0]];\r\n        return _domain;\r\n    };\r\n    _domain.valueNames = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames;\r\n        }\r\n        valueNames = args[0];\r\n        return _domain;\r\n    };\r\n\r\n    return _domain;\r\n};\r\n\r\nexport const labelFunction = valueName => d => d[valueName][0];\r\n\r\nexport const tickFormatFunction = valueformatter;\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\nimport * as fc from \"d3fc\";\r\nimport {flattenArray} from \"./flatten\";\r\n\r\nexport const scale = () => d3.scaleTime();\r\n\r\nexport const domain = () => {\r\n    const base = fc.extentTime();\r\n\r\n    let valueNames = [\"crossValue\"];\r\n\r\n    const _domain = data => {\r\n        base.accessors(valueNames.map(v => d => new Date(d[v])));\r\n\r\n        return getDataExtent(flattenArray(data));\r\n    };\r\n\r\n    fc.rebindAll(_domain, base, fc.exclude(\"include\", \"paddingStrategy\"));\r\n\r\n    const getMinimumGap = data => {\r\n        const gaps = valueNames.map(valueName =>\r\n            data\r\n                .map(d => new Date(d[valueName]).getTime())\r\n                .sort((a, b) => a - b)\r\n                .filter((d, i, a) => i === 0 || d !== a[i - 1])\r\n                .reduce((acc, d, i, src) => (i === 0 || acc <= d - src[i - 1] ? acc : Math.abs(d - src[i - 1])))\r\n        );\r\n\r\n        return Math.min(...gaps);\r\n    };\r\n\r\n    const getDataExtent = data => {\r\n        const dataWidth = getMinimumGap(data);\r\n        return base.padUnit(\"domain\").pad([dataWidth / 2, dataWidth / 2])(data);\r\n    };\r\n\r\n    _domain.valueName = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames[0];\r\n        }\r\n        valueNames = [args[0]];\r\n        return _domain;\r\n    };\r\n    _domain.valueNames = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames;\r\n        }\r\n        valueNames = args[0];\r\n        return _domain;\r\n    };\r\n\r\n    return _domain;\r\n};\r\n\r\nexport const labelFunction = valueName => d => new Date(d[valueName][0]);\r\n","import {select, line} from \"d3\";\r\nimport {axisOrdinalTop, axisOrdinalBottom, axisOrdinalLeft, axisOrdinalRight, dataJoin, rebindAll, exclude} from \"d3fc\";\r\nimport store from \"./store\";\r\n\r\nconst multiAxis = (orient, baseAxis, scale) => {\r\n    let tickSizeOuter = 6;\r\n    let tickSizeInner = 6;\r\n    let axisStore = store(\"tickFormat\", \"ticks\", \"tickArguments\", \"tickValues\", \"tickPadding\");\r\n    let decorate = () => {};\r\n\r\n    let groups = null;\r\n\r\n    const groupDataJoin = dataJoin(\"g\", \"group\");\r\n    const domainPathDataJoin = dataJoin(\"path\", \"domain\");\r\n\r\n    const translate = (x, y) => (isVertical() ? `translate(${y}, ${x})` : `translate(${x}, ${y})`);\r\n\r\n    const pathTranspose = arr => (isVertical() ? arr.map(d => [d[1], d[0]]) : arr);\r\n\r\n    const isVertical = () => orient === \"left\" || orient === \"right\";\r\n\r\n    const multiAxis = selection => {\r\n        if (!groups) {\r\n            axisStore(baseAxis(scale).decorate(decorate))(selection);\r\n            return;\r\n        }\r\n\r\n        if (selection.selection) {\r\n            groupDataJoin.transition(selection);\r\n            domainPathDataJoin.transition(selection);\r\n        }\r\n\r\n        selection.each((data, index, group) => {\r\n            const element = group[index];\r\n\r\n            const container = select(element);\r\n\r\n            const sign = orient === \"bottom\" || orient === \"right\" ? 1 : -1;\r\n\r\n            // add the domain line\r\n            const range = scale.range();\r\n            const domainPathData = pathTranspose([\r\n                [range[0], sign * tickSizeOuter],\r\n                [range[0], 0],\r\n                [range[1], 0],\r\n                [range[1], sign * tickSizeOuter]\r\n            ]);\r\n\r\n            const domainLine = domainPathDataJoin(container, [data]);\r\n            domainLine\r\n                .attr(\"d\", line()(domainPathData))\r\n                .attr(\"stroke\", \"#000\")\r\n                .attr(\"fill\", \"none\");\r\n\r\n            const g = groupDataJoin(container, groups);\r\n\r\n            const getAxisSize = i => (Array.isArray(tickSizeInner) ? tickSizeInner[i] : tickSizeInner);\r\n            const getAxisOffset = i => {\r\n                let sum = 0;\r\n                for (let n = 0; n < i; n++) {\r\n                    sum += getAxisSize(n);\r\n                }\r\n                return sum;\r\n            };\r\n\r\n            g.attr(\"transform\", (d, i) => translate(0, sign * getAxisOffset(i))).each((group, i, nodes) => {\r\n                const groupElement = select(nodes[i]);\r\n                const groupScale = scaleFromGroup(scale, group);\r\n                const useAxis = axisStore(baseAxis(groupScale))\r\n                    .decorate((s, data) => decorate(s, data, i))\r\n                    .tickSizeInner(getAxisSize(i))\r\n                    .tickOffset(d => groupScale.step(d) / 2);\r\n                useAxis(groupElement);\r\n\r\n                groupElement.select(\"path.domain\").attr(\"visibility\", \"hidden\");\r\n            });\r\n\r\n            // exit\r\n            g.exit().attr(\"transform\", (d, i) => translate(0, sign * getAxisOffset(i)));\r\n        });\r\n    };\r\n\r\n    const scaleFromGroup = (scale, group) => {\r\n        function customScale(value) {\r\n            const values = value.domain;\r\n            return values.reduce((sum, d) => sum + scale(d), 0) / values.length;\r\n        }\r\n\r\n        customScale.ticks = () => {\r\n            return group;\r\n        };\r\n        customScale.tickFormat = () => d => {\r\n            return d.text;\r\n        };\r\n        customScale.copy = () => scaleFromGroup(scale, group);\r\n\r\n        customScale.step = value => value.domain.length * scale.step();\r\n\r\n        rebindAll(customScale, scale, exclude(\"ticks\", \"step\", \"copy\"));\r\n        return customScale;\r\n    };\r\n\r\n    multiAxis.tickSize = (...args) => {\r\n        if (!args.length) {\r\n            return tickSizeInner;\r\n        }\r\n        tickSizeInner = tickSizeOuter = Number(args[0]);\r\n        return multiAxis;\r\n    };\r\n\r\n    multiAxis.tickSizeInner = (...args) => {\r\n        if (!args.length) {\r\n            return tickSizeInner;\r\n        }\r\n        tickSizeInner = Array.isArray(args[0]) ? args[0] : Number(args[0]);\r\n        return multiAxis;\r\n    };\r\n\r\n    multiAxis.tickSizeOuter = (...args) => {\r\n        if (!args.length) {\r\n            return tickSizeOuter;\r\n        }\r\n        tickSizeOuter = Number(args[0]);\r\n        return multiAxis;\r\n    };\r\n\r\n    multiAxis.decorate = (...args) => {\r\n        if (!args.length) {\r\n            return decorate;\r\n        }\r\n        decorate = args[0];\r\n        return multiAxis;\r\n    };\r\n\r\n    multiAxis.groups = (...args) => {\r\n        if (!args.length) {\r\n            return groups;\r\n        }\r\n        groups = args[0];\r\n        return multiAxis;\r\n    };\r\n\r\n    rebindAll(multiAxis, axisStore);\r\n\r\n    return multiAxis;\r\n};\r\n\r\nexport const multiAxisTop = scale => multiAxis(\"top\", axisOrdinalTop, scale);\r\n\r\nexport const multiAxisBottom = scale => multiAxis(\"bottom\", axisOrdinalBottom, scale);\r\n\r\nexport const multiAxisLeft = scale => multiAxis(\"left\", axisOrdinalLeft, scale);\r\n\r\nexport const multiAxisRight = scale => multiAxis(\"right\", axisOrdinalRight, scale);\r\n","export default (...names) => {\r\n    const data = {};\r\n\r\n    const store = target => {\r\n        for (const key of Object.keys(data)) {\r\n            target[key](data[key]);\r\n        }\r\n        return target;\r\n    };\r\n\r\n    for (const name of names) {\r\n        store[name] = (...args) => {\r\n            if (!args.length) {\r\n                return data[name];\r\n            }\r\n            data[name] = args[0];\r\n            return store;\r\n        };\r\n    }\r\n\r\n    return store;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nexport function getChartElement(element) {\r\n    return element.getRootNode().host;\r\n}\r\n\r\nexport function getChartContainer(element) {\r\n    return element.closest(\"#container.chart\");\r\n}\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\nimport * as fc from \"d3fc\";\r\nimport minBandwidth from \"./minBandwidth\";\r\nimport {flattenArray} from \"./flatten\";\r\nimport {multiAxisBottom, multiAxisLeft, multiAxisTop, multiAxisRight} from \"../d3fc/axis/multi-axis\";\r\nimport {getChartContainer} from \"../plugin/root\";\r\n\r\nexport const scale = () => minBandwidth(d3.scaleBand()).padding(0.5);\r\n\r\nexport const domain = () => {\r\n    let valueNames = [\"crossValue\"];\r\n    let orient = \"horizontal\";\r\n\r\n    const _domain = data => {\r\n        const flattenedData = flattenArray(data);\r\n        return transformDomain([...new Set(flattenedData.map(d => d[valueNames[0]]))]);\r\n    };\r\n\r\n    const transformDomain = d => (orient == \"vertical\" ? d.reverse() : d);\r\n\r\n    _domain.valueName = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames[0];\r\n        }\r\n        valueNames = [args[0]];\r\n        return _domain;\r\n    };\r\n    _domain.valueNames = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames;\r\n        }\r\n        valueNames = args[0];\r\n        return _domain;\r\n    };\r\n\r\n    _domain.orient = (...args) => {\r\n        if (!args.length) {\r\n            return orient;\r\n        }\r\n        orient = args[0];\r\n        return _domain;\r\n    };\r\n\r\n    return _domain;\r\n};\r\n\r\nexport const labelFunction = valueName => d => d[valueName].join(\"|\");\r\n\r\nexport const component = settings => {\r\n    let orient = \"horizontal\";\r\n    let settingName = \"crossValues\";\r\n    let domain = null;\r\n\r\n    const getComponent = () => {\r\n        const multiLevel = settings[settingName].length > 1;\r\n\r\n        // Calculate the label groups and corresponding group sizes\r\n        const levelGroups = axisGroups(domain);\r\n        const groupTickLayout = levelGroups.map(getGroupTickLayout);\r\n\r\n        const tickSizeInner = multiLevel ? groupTickLayout.map(l => l.size) : groupTickLayout[0].size;\r\n        const tickSizeOuter = groupTickLayout.reduce((s, v) => s + v.size, 0);\r\n\r\n        const createAxis = base => scale => {\r\n            const axis = base(scale);\r\n\r\n            if (multiLevel) {\r\n                axis.groups(levelGroups)\r\n                    .tickSizeInner(tickSizeInner)\r\n                    .tickSizeOuter(tickSizeOuter);\r\n            }\r\n            if (orient !== \"horizontal\") axis.tickPadding(10);\r\n            return axis;\r\n        };\r\n\r\n        const decorate = (s, data, index) => {\r\n            const rotation = groupTickLayout[index].rotation;\r\n            if (orient === \"horizontal\") applyLabelRotation(s, rotation);\r\n            hideOverlappingLabels(s, rotation);\r\n        };\r\n\r\n        const axisSet = getAxisSet(multiLevel);\r\n        return {\r\n            bottom: createAxis(axisSet.bottom),\r\n            left: createAxis(axisSet.left),\r\n            right: createAxis(axisSet.right),\r\n            top: createAxis(axisSet.top),\r\n            size: `${tickSizeOuter + 10}px`,\r\n            decorate\r\n        };\r\n    };\r\n\r\n    // const pickAxis = multiLevel => {\r\n    //     if (multiLevel) {\r\n    //         return orient === \"horizontal\" ?\r\n    //                multiAxisBottom : multiAxisLeft;\r\n    //     }\r\n    //     return orient === \"horizontal\" ?\r\n    //                 fc.axisOrdinalBottom : fc.axisOrdinalLeft;\r\n    // };\r\n\r\n    const getAxisSet = multiLevel => {\r\n        if (multiLevel) {\r\n            return {\r\n                bottom: multiAxisBottom,\r\n                left: multiAxisLeft,\r\n                top: multiAxisTop,\r\n                right: multiAxisRight\r\n            };\r\n        } else {\r\n            return {\r\n                bottom: fc.axisOrdinalBottom,\r\n                left: fc.axisOrdinalLeft,\r\n                top: fc.axisOrdinalTop,\r\n                right: fc.axisOrdinalRight\r\n            };\r\n        }\r\n    };\r\n\r\n    const axisGroups = domain => {\r\n        const groups = [];\r\n        domain.forEach(tick => {\r\n            const split = tick && tick.split ? tick.split(\"|\") : [tick];\r\n            split.forEach((s, i) => {\r\n                while (groups.length <= i) groups.push([]);\r\n\r\n                const group = groups[i];\r\n                if (group.length > 0 && group[group.length - 1].text === s) {\r\n                    group[group.length - 1].domain.push(tick);\r\n                } else {\r\n                    group.push({text: s, domain: [tick]});\r\n                }\r\n            });\r\n        });\r\n        return groups.reverse();\r\n    };\r\n\r\n    const getGroupTickLayout = group => {\r\n        const width = settings.size.width;\r\n        const maxLength = Math.max(...group.map(g => (g.text ? g.text.length : 0)));\r\n\r\n        if (orient === \"horizontal\") {\r\n            // x-axis may rotate labels and expand the available height\r\n            if (group && group.length * 16 > width - 100) {\r\n                return {\r\n                    size: maxLength * 5 + 10,\r\n                    rotation: 90\r\n                };\r\n            } else if (group && group.length * (maxLength * 6 + 10) > width - 100) {\r\n                return {\r\n                    size: maxLength * 3 + 20,\r\n                    rotation: 45\r\n                };\r\n            }\r\n            return {\r\n                size: 25,\r\n                rotation: 0\r\n            };\r\n        } else {\r\n            // y-axis size always based on label size\r\n            return {\r\n                size: maxLength * 5 + 10,\r\n                rotation: 0\r\n            };\r\n        }\r\n    };\r\n\r\n    const hideOverlappingLabels = (s, rotated) => {\r\n        const getTransformCoords = transform => {\r\n            const splitOn = transform.indexOf(\",\") !== -1 ? \",\" : \" \";\r\n            const coords = transform\r\n                .substring(transform.indexOf(\"(\") + 1, transform.indexOf(\")\"))\r\n                .split(splitOn)\r\n                .map(c => parseInt(c));\r\n            while (coords.length < 2) coords.push(0);\r\n            return coords;\r\n        };\r\n\r\n        const rectanglesOverlap = (r1, r2) => r1.x <= r2.x + r2.width && r2.x <= r1.x + r1.width && r1.y <= r2.y + r2.height && r2.y <= r1.y + r1.height;\r\n        const rotatedLabelsOverlap = (r1, r2) => r1.x + r1.width + 14 > r2.x + r2.width;\r\n        const isOverlap = rotated ? rotatedLabelsOverlap : rectanglesOverlap;\r\n\r\n        const rectangleContained = (r1, r2) => r1.x >= r2.x && r1.x + r1.width <= r2.x + r2.width && r1.y >= r2.y && r1.y + r1.height <= r2.y + r2.height;\r\n        // The bounds rect is the available screen space a label can fit into\r\n        const boundsRect = orient == \"horizontal\" ? getXAxisBoundsRect(s) : null;\r\n\r\n        const previousRectangles = [];\r\n        s.each((d, i, nodes) => {\r\n            const tick = d3.select(nodes[i]);\r\n\r\n            // How the \"tick\" element is transformed (x/y)\r\n            const transformCoords = getTransformCoords(tick.attr(\"transform\"));\r\n\r\n            // Work out the actual rectanble the label occupies\r\n            const tickRect = tick.node().getBBox();\r\n            const rect = {x: tickRect.x + transformCoords[0], y: tickRect.y + transformCoords[1], width: tickRect.width, height: tickRect.height};\r\n\r\n            const overlap = previousRectangles.some(r => isOverlap(r, rect));\r\n\r\n            // Test that it also fits into the screen space\r\n            const hidden = overlap || (boundsRect && !rectangleContained(rect, boundsRect));\r\n\r\n            tick.attr(\"visibility\", hidden ? \"hidden\" : \"\");\r\n            if (!hidden) {\r\n                previousRectangles.push(rect);\r\n            }\r\n        });\r\n    };\r\n\r\n    const getXAxisBoundsRect = s => {\r\n        const container = getChartContainer(s.node());\r\n        if (container === null) {\r\n            return;\r\n        }\r\n        const chart = container.querySelector(\".cartesian-chart\");\r\n        const axis = chart.querySelector(\".x-axis\");\r\n\r\n        const chartRect = chart.getBoundingClientRect();\r\n        const axisRect = axis.getBoundingClientRect();\r\n        return {\r\n            x: chartRect.left - axisRect.left,\r\n            width: chartRect.width,\r\n            y: chartRect.top - axisRect.top,\r\n            height: chartRect.height\r\n        };\r\n    };\r\n\r\n    const getLabelTransform = rotation => {\r\n        if (!rotation) {\r\n            return \"translate(0, 8)\";\r\n        }\r\n        if (rotation < 60) {\r\n            return `rotate(-${rotation} 5 5)`;\r\n        }\r\n        return `rotate(-${rotation} 3 7)`;\r\n    };\r\n\r\n    const applyLabelRotation = (s, rotation) => {\r\n        const transform = getLabelTransform(rotation);\r\n        const anchor = rotation ? \"end\" : \"\";\r\n        s.each((d, i, nodes) => {\r\n            const tick = d3.select(nodes[i]);\r\n            const text = tick.select(\"text\");\r\n\r\n            text.attr(\"transform\", transform).style(\"text-anchor\", anchor);\r\n        });\r\n    };\r\n\r\n    getComponent.orient = (...args) => {\r\n        if (!args.length) {\r\n            return orient;\r\n        }\r\n        orient = args[0];\r\n        return getComponent;\r\n    };\r\n\r\n    getComponent.settingName = (...args) => {\r\n        if (!args.length) {\r\n            return settingName;\r\n        }\r\n        settingName = args[0];\r\n        return getComponent;\r\n    };\r\n\r\n    getComponent.domain = (...args) => {\r\n        if (!args.length) {\r\n            return domain;\r\n        }\r\n        domain = args[0];\r\n        return getComponent;\r\n    };\r\n\r\n    return getComponent;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\nimport {axisType} from \"./axisType\";\r\nimport * as none from \"./noAxis\";\r\nimport * as linear from \"./linearAxis\";\r\nimport * as time from \"./timeAxis\";\r\nimport * as ordinal from \"./ordinalAxis\";\r\n\r\nconst axisTypes = {\r\n    none,\r\n    ordinal,\r\n    time,\r\n    linear\r\n};\r\n\r\nexport const axisFactory = settings => {\r\n    let excludeType = null;\r\n    let orient = \"horizontal\";\r\n    let settingName = \"crossValues\";\r\n    let settingValue = null;\r\n    let valueNames = [\"crossValue\"];\r\n\r\n    const optionalParams = [\"include\", \"paddingStrategy\", \"pad\"];\r\n    const optional = {};\r\n\r\n    const _factory = data => {\r\n        const useType = axisType(settings)\r\n            .excludeType(excludeType)\r\n            .settingName(settingName)\r\n            .settingValue(settingValue)();\r\n\r\n        const axis = axisTypes[useType];\r\n        const domainFunction = axis.domain().valueNames(valueNames);\r\n\r\n        optionalParams.forEach(p => {\r\n            if (optional[p] && domainFunction[p]) domainFunction[p](optional[p]);\r\n        });\r\n        if (domainFunction.orient) domainFunction.orient(orient);\r\n\r\n        const domain = domainFunction(data);\r\n        const component = axis.component ? createComponent(axis, domain, data) : defaultComponent();\r\n\r\n        return {\r\n            scale: axis.scale(),\r\n            domain,\r\n            domainFunction,\r\n            labelFunction: axis.labelFunction,\r\n            component: {\r\n                bottom: component.bottom,\r\n                left: component.left,\r\n                top: component.top,\r\n                right: component.right\r\n            },\r\n            size: component.size,\r\n            decorate: component.decorate,\r\n            label: settings[settingName].map(v => v.name).join(\", \"),\r\n            tickFormatFunction: axis.tickFormatFunction\r\n        };\r\n    };\r\n\r\n    const createComponent = (axis, domain, data) =>\r\n        axis\r\n            .component(settings)\r\n            .orient(orient)\r\n            .settingName(settingName)\r\n            .domain(domain)(data);\r\n\r\n    const defaultComponent = () => ({\r\n        bottom: fc.axisBottom,\r\n        left: fc.axisLeft,\r\n        top: fc.axisTop,\r\n        right: fc.axisRight,\r\n        decorate: () => {}\r\n    });\r\n\r\n    _factory.excludeType = (...args) => {\r\n        if (!args.length) {\r\n            return excludeType;\r\n        }\r\n        excludeType = args[0];\r\n        return _factory;\r\n    };\r\n\r\n    _factory.orient = (...args) => {\r\n        if (!args.length) {\r\n            return orient;\r\n        }\r\n        orient = args[0];\r\n        return _factory;\r\n    };\r\n\r\n    _factory.settingName = (...args) => {\r\n        if (!args.length) {\r\n            return settingName;\r\n        }\r\n        settingName = args[0];\r\n        return _factory;\r\n    };\r\n    _factory.settingValue = (...args) => {\r\n        if (!args.length) {\r\n            return settingValue;\r\n        }\r\n        settingValue = args[0];\r\n        return _factory;\r\n    };\r\n\r\n    _factory.valueName = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames[0];\r\n        }\r\n        valueNames = [args[0]];\r\n        return _factory;\r\n    };\r\n    _factory.valueNames = (...args) => {\r\n        if (!args.length) {\r\n            return valueNames;\r\n        }\r\n        valueNames = args[0];\r\n        return _factory;\r\n    };\r\n\r\n    optionalParams.forEach(p => {\r\n        _factory[p] = (...args) => {\r\n            if (!args.length) {\r\n                return optional[p];\r\n            }\r\n            optional[p] = args[0];\r\n            return _factory;\r\n        };\r\n    });\r\n\r\n    return _factory;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\nimport * as fc from \"d3fc\";\r\n\r\nexport const chartSvgFactory = (xAxis, yAxis) => chartFactory(xAxis, yAxis, fc.chartSvgCartesian, false);\r\nexport const chartCanvasFactory = (xAxis, yAxis) => chartFactory(xAxis, yAxis, fc.chartCanvasCartesian, true);\r\n\r\nconst chartFactory = (xAxis, yAxis, cartesian, canvas) => {\r\n    let axisSplitter = null;\r\n    let altAxis = null;\r\n\r\n    const chart = cartesian({\r\n        xScale: xAxis.scale,\r\n        yScale: yAxis.scale,\r\n        xAxis: xAxis.component,\r\n        yAxis: yAxis.component\r\n    })\r\n        .xDomain(xAxis.domain)\r\n        .xLabel(xAxis.label)\r\n        .xAxisHeight(xAxis.size)\r\n        .xDecorate(xAxis.decorate)\r\n        .xTickFormat(xAxis.tickFormatFunction)\r\n        .yDomain(yAxis.domain)\r\n        .yLabel(yAxis.label)\r\n        .yAxisWidth(yAxis.size)\r\n        .yDecorate(yAxis.decorate)\r\n        .yOrient(\"left\")\r\n        .yTickFormat(yAxis.tickFormatFunction);\r\n\r\n    if (xAxis.decorate) chart.xDecorate(xAxis.decorate);\r\n    if (yAxis.decorate) chart.yDecorate(yAxis.decorate);\r\n\r\n    // Padding defaults can be overridden\r\n    chart.xPaddingInner && chart.xPaddingInner(1);\r\n    chart.xPaddingOuter && chart.xPaddingOuter(0.5);\r\n    chart.yPaddingInner && chart.yPaddingInner(1);\r\n    chart.yPaddingOuter && chart.yPaddingOuter(0.5);\r\n\r\n    chart.axisSplitter = (...args) => {\r\n        if (!args.length) {\r\n            return axisSplitter;\r\n        }\r\n        axisSplitter = args[0];\r\n        return chart;\r\n    };\r\n\r\n    chart.altAxis = (...args) => {\r\n        if (!args.length) {\r\n            return altAxis;\r\n        }\r\n        altAxis = args[0];\r\n        return chart;\r\n    };\r\n\r\n    const oldDecorate = chart.decorate();\r\n    chart.decorate((container, data) => {\r\n        const plotArea = container.select(\"d3fc-svg.plot-area\");\r\n\r\n        plotArea\r\n            .select(\"svg\")\r\n            .node()\r\n            .setAttribute(\"viewBox\", `0 0 ${plotArea.node().clientWidth} ${plotArea.node().clientHeight}`);\r\n\r\n        oldDecorate(container, data);\r\n        if (!axisSplitter) return;\r\n\r\n        if (axisSplitter.haveSplit()) {\r\n            // Render a second axis on the right of the chart\r\n            const altData = axisSplitter.altData();\r\n\r\n            const y2AxisDataJoin = fc.dataJoin(\"d3fc-svg\", \"y2-axis\").key(d => d);\r\n            const ySeriesDataJoin = fc.dataJoin(\"g\", \"y-series\").key(d => d);\r\n\r\n            // Column 5 of the grid\r\n            container\r\n                .enter()\r\n                .append(\"div\")\r\n                .attr(\"class\", \"y2-label-container\")\r\n                .style(\"grid-column\", 5)\r\n                .style(\"-ms-grid-column\", 5)\r\n                .style(\"grid-row\", 3)\r\n                .style(\"-ms-grid-row\", 3)\r\n                .style(\"width\", altAxis.size || \"1em\")\r\n                .style(\"display\", \"flex\")\r\n                .style(\"align-items\", \"center\")\r\n                .style(\"justify-content\", \"center\")\r\n                .append(\"div\")\r\n                .attr(\"class\", \"y-label\")\r\n                .style(\"transform\", \"rotate(-90deg)\");\r\n\r\n            const y2Scale = altAxis.scale.domain(altAxis.domain);\r\n            const yAxisComponent = altAxis.component.right(y2Scale);\r\n            yAxisComponent.tickFormat(altAxis.tickFormatFunction);\r\n            if (altAxis.decorate) yAxisComponent.decorate(altAxis.decorate);\r\n\r\n            // Render the axis\r\n            y2AxisDataJoin(container, [\"right\"])\r\n                .attr(\"class\", d => `y-axis ${d}-axis`)\r\n                .on(\"measure\", (d, i, nodes) => {\r\n                    const {width, height} = d3.event.detail;\r\n                    if (d === \"left\") {\r\n                        d3.select(nodes[i])\r\n                            .select(\"svg\")\r\n                            .attr(\"viewBox\", `${-width} 0 ${width} ${height}`);\r\n                    }\r\n                    y2Scale.range([height, 0]);\r\n                })\r\n                .on(\"draw\", (d, i, nodes) => {\r\n                    d3.select(nodes[i])\r\n                        .select(\"svg\")\r\n                        .call(yAxisComponent);\r\n                });\r\n\r\n            // Render all the series using either the primary or alternate\r\n            // y-scales\r\n            if (canvas) {\r\n                const drawMultiCanvasSeries = selection => {\r\n                    const canvasPlotArea = chart.plotArea();\r\n                    canvasPlotArea.context(selection.node().getContext(\"2d\")).xScale(xAxis.scale);\r\n\r\n                    const yScales = [yAxis.scale, y2Scale];\r\n                    [data, altData].forEach((d, i) => {\r\n                        canvasPlotArea.yScale(yScales[i]);\r\n                        canvasPlotArea(d);\r\n                    });\r\n                };\r\n\r\n                container.select(\"d3fc-canvas.plot-area\").on(\"draw\", (d, i, nodes) => {\r\n                    drawMultiCanvasSeries(d3.select(nodes[i]).select(\"canvas\"));\r\n                });\r\n            } else {\r\n                const drawMultiSvgSeries = selection => {\r\n                    const svgPlotArea = chart.plotArea();\r\n                    svgPlotArea.xScale(xAxis.scale);\r\n\r\n                    const yScales = [yAxis.scale, y2Scale];\r\n                    ySeriesDataJoin(selection, [data, altData]).each((d, i, nodes) => {\r\n                        svgPlotArea.yScale(yScales[i]);\r\n                        d3.select(nodes[i])\r\n                            .datum(d)\r\n                            .call(svgPlotArea);\r\n                    });\r\n                };\r\n\r\n                container.select(\"d3fc-svg.plot-area\").on(\"draw\", (d, i, nodes) => {\r\n                    drawMultiSvgSeries(d3.select(nodes[i]).select(\"svg\"));\r\n                });\r\n            }\r\n        }\r\n\r\n        // Render any UI elements the splitter component requires\r\n        axisSplitter(container);\r\n    });\r\n\r\n    return chart;\r\n};\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport function areArraysEqualSimple(arr1, arr2) {\n    return JSON.stringify(arr1) === JSON.stringify(arr2);\n}\n\nexport function getOrCreateElement(container, selector, createCallback) {\n    let element = container.select(selector);\n    return element.size() > 0 ? element : createCallback();\n}\n\nexport function isElementOverflowing(containerRect, innerElementRect, direction = \"right\") {\n    if (direction === \"right\" || direction === \"bottom\") {\n        return containerRect[direction] < innerElementRect[direction] ? true : false;\n    }\n\n    if (direction === \"left\" || direction === \"top\") {\n        return containerRect[direction] > innerElementRect[direction] ? true : false;\n    }\n\n    throw `Direction being checked for overflow is invalid: ${direction}`;\n}\n\nexport function isElementOverlapping(axis, immovableRect, elementRect, fuzz = 0) {\n    const dimension = axis === \"x\" ? \"width\" : \"height\";\n\n    const immovableInnerPoint = immovableRect[axis];\n    const immovableOuterPoint = immovableRect[axis] + immovableRect[dimension];\n\n    const elementInnerPoint = elementRect[axis];\n    const elementOuterPoint = elementRect[axis] + elementRect[dimension];\n\n    const innerPointInside = elementInnerPoint + fuzz > immovableInnerPoint && elementInnerPoint - fuzz < immovableOuterPoint;\n    const outerPointInside = elementOuterPoint + fuzz > immovableInnerPoint && elementOuterPoint - fuzz < immovableOuterPoint;\n    const pointsEitherSide = elementInnerPoint + fuzz < immovableInnerPoint && elementOuterPoint - fuzz > immovableOuterPoint;\n\n    return innerPointInside || outerPointInside || pointsEitherSide;\n}\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nfunction toValue(type, value) {\r\n    switch (type) {\r\n        case \"date\":\r\n        case \"datetime\":\r\n            return value instanceof Date ? value : new Date(parseInt(value));\r\n        case \"integer\":\r\n            return parseInt(value, 10);\r\n        case \"float\":\r\n            return parseFloat(value);\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function getGroupValues(data, settings) {\r\n    if (settings.crossValues.length === 0) return [];\r\n    const groupValues = (data.crossValue.split ? data.crossValue.split(\"|\") : [data.crossValue]) || [data.key];\r\n    return groupValues.map((cross, i) => ({name: settings.crossValues[i].name, value: toValue(settings.crossValues[i].type, cross)}));\r\n}\r\n\r\nexport function getSplitValues(data, settings) {\r\n    if (settings.splitValues.length === 0) return [];\r\n    const splitValues = data.key ? data.key.split(\"|\") : data.mainValue.split ? data.mainValue.split(\"|\") : [data.mainValue];\r\n    return settings.splitValues.map((split, i) => ({name: split.name, value: toValue(split.type, splitValues[i])}));\r\n}\r\n\r\nexport function getDataValues(data, settings) {\r\n    if (settings.mainValues.length > 1) {\r\n        if (data.mainValue) {\r\n            return [\r\n                {\r\n                    name: data.key,\r\n                    value: data.mainValue - (data.baseValue || 0)\r\n                }\r\n            ];\r\n        }\r\n        return settings.mainValues.map((main, i) => ({name: main.name, value: toValue(main.type, data.mainValues[i])}));\r\n    }\r\n    return [\r\n        {\r\n            name: settings.mainValues[0].name,\r\n            value: toValue(settings.mainValues[0].type, data.colorValue || data.mainValue - data.baseValue || data.mainValue || data.mainValues)\r\n        }\r\n    ];\r\n}\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {select} from \"d3\";\nimport {getGroupValues, getSplitValues, getDataValues} from \"./selectionData\";\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\n\nexport function generateHtml(tooltipDiv, data, settings) {\n    const tooltipValues = getGroupValues(data, settings)\n        .concat(getSplitValues(data, settings))\n        .concat(getDataValues(data, settings));\n    addDataValues(tooltipDiv, tooltipValues);\n}\n\nfunction addDataValues(tooltipDiv, values) {\n    tooltipDiv\n        .select(\"#tooltip-values\")\n        .selectAll(\"li\")\n        .data(values)\n        .join(\"li\")\n        .each(function(d) {\n            select(this)\n                .text(`${d.name}: `)\n                .append(\"b\")\n                .text(formatNumber(d.value));\n        });\n}\n\nconst formatNumber = value =>\n    value.toLocaleString(undefined, {\n        style: \"decimal\",\n        minimumFractionDigits: get_type_config(\"float\").precision,\n        maximumFractionDigits: get_type_config(\"float\").precision\n    });\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport {getGroupValues, getSplitValues, getDataValues} from \"./selectionData\";\r\n\r\nconst mapToFilter = d => [d.name, \"==\", d.value];\r\n\r\nexport const raiseEvent = (node, data, settings) => {\r\n    const column_names = getDataValues(data, settings).map(d => d.name);\r\n    const groupFilters = getGroupValues(data, settings).map(mapToFilter);\r\n    const splitFilters = getSplitValues(data, settings).map(mapToFilter);\r\n\r\n    const filters = settings.filter.concat(groupFilters).concat(splitFilters);\r\n\r\n    node.dispatchEvent(\r\n        new CustomEvent(\"perspective-click\", {\r\n            bubbles: true,\r\n            composed: true,\r\n            detail: {\r\n                column_names,\r\n                config: {filters},\r\n                row: data.row\r\n            }\r\n        })\r\n    );\r\n};\r\n\r\nexport const selectionEvent = () => {\r\n    let settings = null;\r\n\r\n    const _event = selection => {\r\n        const node = selection.node();\r\n        selection.on(\"click\", data => raiseEvent(node, data, settings));\r\n    };\r\n\r\n    _event.settings = (...args) => {\r\n        if (!args.length) {\r\n            return settings;\r\n        }\r\n        settings = args[0];\r\n        return _event;\r\n    };\r\n\r\n    return _event;\r\n};\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {select} from \"d3\";\nimport {getChartContainer} from \"../plugin/root\";\nimport {getOrCreateElement, isElementOverflowing} from \"../utils/utils\";\nimport tooltipTemplate from \"../../html/tooltip.html\";\nimport {generateHtml} from \"./generateHTML\";\nimport {selectionEvent} from \"./selectionEvent\";\n\nexport const tooltip = () => {\n    let alwaysShow = false;\n    let tooltipDiv = null;\n    let settings = null;\n    let centered = false;\n\n    const _tooltip = selection => {\n        const node = selection.node();\n\n        if (!node || !node.isConnected) {\n            hideTooltip(tooltipDiv);\n            return;\n        }\n\n        const container = select(getChartContainer(node));\n        tooltipDiv = getTooltipDiv(container);\n\n        const showTip = (data, i, nodes) => {\n            generateHtml(tooltipDiv, data, settings);\n            showTooltip(container.node(), nodes[i], tooltipDiv, centered);\n            select(nodes[i]).style(\"opacity\", \"0.7\");\n        };\n        const hideTip = (data, i, nodes) => {\n            hideTooltip(tooltipDiv);\n            if (nodes) select(nodes[i]).style(\"opacity\", \"1\");\n        };\n\n        if (alwaysShow) {\n            selection.each(showTip);\n        } else {\n            selection.on(\"mouseover\", showTip).on(\"mouseout\", hideTip);\n            selectionEvent().settings(settings)(selection);\n        }\n    };\n\n    _tooltip.alwaysShow = (...args) => {\n        if (!args.length) {\n            return alwaysShow;\n        }\n        alwaysShow = args[0];\n        return _tooltip;\n    };\n\n    _tooltip.centered = (...args) => {\n        if (!args.length) {\n            return centered;\n        }\n        centered = args[0];\n        return _tooltip;\n    };\n\n    _tooltip.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _tooltip;\n    };\n\n    return _tooltip;\n};\n\nfunction getTooltipDiv(container) {\n    return getOrCreateElement(container, \"div.tooltip\", () =>\n        container\n            .append(\"div\")\n            .attr(\"class\", \"tooltip\")\n            .style(\"z-index\", 3)\n            .style(\"opacity\", 0)\n            .html(tooltipTemplate)\n    );\n}\n\nfunction showTooltip(containerNode, node, tooltipDiv, centered) {\n    const containerRect = containerNode.getBoundingClientRect();\n    const rect = node.getBoundingClientRect();\n\n    let left = rect.left + rect.width / 2 - containerRect.left;\n    let top = rect.top - containerRect.top + containerNode.scrollTop;\n\n    if (centered) top = rect.top + rect.height / 2 - containerRect.top + containerNode.scrollTop;\n\n    tooltipDiv\n        .style(\"left\", `${left}px`)\n        .style(\"top\", `${top}px`)\n        .transition()\n        .duration(200)\n        .style(\"opacity\", 0.9);\n\n    if (centered) [left, top] = centerTip(tooltipDiv, containerRect);\n\n    shiftIfOverflowingChartArea(tooltipDiv, containerRect, left, top, centered);\n}\n\nfunction centerTip(tooltipDiv, containerRect) {\n    const tooltipDivRect = tooltipDiv.node().getBoundingClientRect();\n\n    const leftAdjust = tooltipDivRect.width / 2;\n    const newLeft = tooltipDivRect.left - leftAdjust - containerRect.left;\n    tooltipDiv.style(\"left\", `${newLeft}px`);\n\n    const topAdjust = tooltipDivRect.height / 2;\n    const newTop = tooltipDivRect.top - topAdjust - containerRect.top;\n    tooltipDiv.style(\"top\", `${newTop}px`);\n    return [newLeft, newTop];\n}\n\nfunction shiftIfOverflowingChartArea(tooltipDiv, containerRect, left, top, centered = false) {\n    const tooltipDivRect = tooltipDiv.node().getBoundingClientRect();\n\n    if (isElementOverflowing(containerRect, tooltipDivRect)) {\n        const leftAdjust = tooltipDivRect.right - containerRect.right;\n        tooltipDiv.style(\"left\", `${left - leftAdjust}px`);\n    }\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"bottom\")) {\n        const topAdjust = tooltipDivRect.bottom - containerRect.bottom;\n        tooltipDiv.style(\"top\", `${top - topAdjust}px`);\n    }\n\n    if (!centered) return;\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"left\")) {\n        const leftAdjust = tooltipDivRect.left - containerRect.left;\n        tooltipDiv.style(\"left\", `${left - leftAdjust}px`);\n    }\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"top\")) {\n        const topAdjust = tooltipDivRect.top - containerRect.top;\n        tooltipDiv.style(\"top\", `${top - topAdjust}px`);\n    }\n}\n\nfunction hideTooltip(tooltipDiv) {\n    if (tooltipDiv) {\n        tooltipDiv\n            .transition()\n            .duration(500)\n            .style(\"opacity\", 0);\n    }\n}\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\nimport {tooltip} from \"../tooltip/tooltip\";\r\n\r\nexport function barSeries(settings, color) {\r\n    let series = settings.mainValues.length > 1 ? fc.seriesSvgGrouped(fc.seriesSvgBar()) : fc.seriesSvgBar();\r\n\r\n    series = series.decorate(selection => {\r\n        tooltip().settings(settings)(selection);\r\n        selection.style(\"fill\", d => color(d.key));\r\n    });\r\n\r\n    return fc\r\n        .autoBandwidth(minBandwidth(series))\r\n        .crossValue(d => d.crossValue)\r\n        .mainValue(d => d.mainValue)\r\n        .baseValue(d => d.baseValue);\r\n}\r\n\r\nconst minBandwidth = adaptee => {\r\n    const min = arg => {\r\n        return adaptee(arg);\r\n    };\r\n\r\n    fc.rebindAll(min, adaptee);\r\n\r\n    min.bandwidth = (...args) => {\r\n        if (!args.length) {\r\n            return adaptee.bandwidth();\r\n        }\r\n        adaptee.bandwidth(Math.max(args[0], 1));\r\n        return min;\r\n    };\r\n\r\n    return min;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nexport function groupFromKey(key) {\r\n    return key\r\n        .split(\"|\")\r\n        .slice(0, -1)\r\n        .join(\"|\");\r\n}\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport {groupFromKey} from \"./seriesKey\";\n\nexport function seriesColors(settings) {\n    const col = settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = Object.keys(col).filter(k => k !== \"__ROW_PATH__\");\n    return colorScale()\n        .settings(settings)\n        .domain(domain)();\n}\n\nexport function seriesColorsFromGroups(settings) {\n    const col = settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = [];\n    Object.keys(col).forEach(key => {\n        if (key !== \"__ROW_PATH__\") {\n            const group = groupFromKey(key);\n            if (!domain.includes(group)) {\n                domain.push(group);\n            }\n        }\n    });\n    return colorScale()\n        .settings(settings)\n        .domain(domain)();\n}\n\nexport function colorScale() {\n    let domain = null;\n    let defaultColors = null;\n    let settings = {};\n    let mapFunction = d => withOpacity(d, settings.colorStyles && settings.colorStyles.opacity);\n\n    const colors = () => {\n        const styles = settings.colorStyles;\n        const defaults = defaultColors || [styles.series];\n        if (defaults || domain.length > 1) {\n            const range = domain.length > 1 ? styles.scheme : defaults;\n            return d3.scaleOrdinal(range.map(mapFunction)).domain(domain);\n        }\n        return null;\n    };\n\n    colors.domain = (...args) => {\n        if (!args.length) {\n            return domain;\n        }\n        domain = args[0];\n        return colors;\n    };\n\n    colors.defaultColors = (...args) => {\n        if (!args.length) {\n            return defaultColors;\n        }\n        defaultColors = args[0];\n        return colors;\n    };\n\n    colors.mapFunction = (...args) => {\n        if (!args.length) {\n            return mapFunction;\n        }\n        mapFunction = args[0];\n        return colors;\n    };\n\n    colors.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return colors;\n    };\n\n    return colors;\n}\n\nexport function withoutOpacity(color) {\n    return setOpacity(1)(color);\n}\n\nexport function withOpacity(color, opacity = 0.5) {\n    return setOpacity(opacity)(color);\n}\n\nexport function setOpacity(opacity) {\n    return color => {\n        const decoded = d3.color(color);\n        decoded.opacity = opacity;\n        return decoded + \"\";\n    };\n}\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport {rebindAll} from \"d3fc\";\r\nimport {axisType} from \"./axisType\";\r\nimport {labelFunction as noLabel} from \"./noAxis\";\r\nimport {labelFunction as timeLabel} from \"./timeAxis\";\r\nimport {labelFunction as linearLabel} from \"./linearAxis\";\r\nimport {labelFunction as ordinalLabel} from \"./ordinalAxis\";\r\n\r\nconst labelFunctions = {\r\n    none: noLabel,\r\n    ordinal: ordinalLabel,\r\n    time: timeLabel,\r\n    linear: linearLabel\r\n};\r\n\r\nexport const labelFunction = settings => {\r\n    const base = axisType(settings);\r\n    let valueName = \"__ROW_PATH__\";\r\n\r\n    const label = (d, i) => {\r\n        return labelFunctions[base()](valueName)(d, i);\r\n    };\r\n\r\n    rebindAll(label, base);\r\n\r\n    label.valueName = (...args) => {\r\n        if (!args.length) {\r\n            return valueName;\r\n        }\r\n        valueName = args[0];\r\n        return label;\r\n    };\r\n\r\n    return label;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nexport function splitIntoMultiSeries(settings, data, {stack = false, excludeEmpty = false} = {}) {\r\n    const useData = data || settings.data;\r\n\r\n    if (settings.splitValues.length > 0) {\r\n        return splitByValuesIntoMultiSeries(settings, useData, {stack, excludeEmpty});\r\n    }\r\n    return [useData];\r\n}\r\n\r\nfunction splitByValuesIntoMultiSeries(settings, data, {stack = false, excludeEmpty = false}) {\r\n    // Create a series for each \"split\" value, each one containing all the\r\n    // \"aggregate\" values, and \"base\" values to offset it from the previous\r\n    // series\r\n    const multiSeries = {};\r\n\r\n    data.forEach(col => {\r\n        // Split this column by \"split\", including multiple aggregates for each\r\n        const baseValues = {};\r\n        const split = {};\r\n\r\n        // Keys are of the form \"split1|split2|aggregate\"\r\n        Object.keys(col)\r\n            .filter(key => key !== \"__ROW_PATH__\")\r\n            .filter(key => !excludeEmpty || (col[key] != null && col[key] != undefined))\r\n            .forEach(key => {\r\n                const labels = key.split(\"|\");\r\n                // label=\"aggregate\"\r\n                const label = labels[labels.length - 1];\r\n                const value = col[key] || 0;\r\n                const baseKey = `${label}${value >= 0 ? \"+ve\" : \"-ve\"}`;\r\n                // splitName=\"split1|split2\"\r\n                const splitName = labels.slice(0, labels.length - 1).join(\"|\");\r\n\r\n                // Combine aggregate values for the same split in a single\r\n                // object\r\n                const splitValues = (split[splitName] = split[splitName] || {__ROW_PATH__: col.__ROW_PATH__});\r\n                const baseValue = baseValues[baseKey] || 0;\r\n\r\n                splitValues.__KEY__ = splitName;\r\n\r\n                // Assign the values for this split/aggregate\r\n                if (stack) {\r\n                    splitValues[label] = baseValue + value;\r\n                    splitValues[`__BASE_VALUE__${label}`] = baseValue;\r\n                    baseValues[baseKey] = splitValues[label];\r\n                } else {\r\n                    splitValues[label] = value;\r\n                }\r\n                splitValues.row = col;\r\n            });\r\n\r\n        // Push each object onto the correct series\r\n        Object.keys(split).forEach(splitName => {\r\n            const series = (multiSeries[splitName] = multiSeries[splitName] || []);\r\n            series.push(split[splitName]);\r\n        });\r\n    });\r\n\r\n    return Object.keys(multiSeries).map(k => {\r\n        const series = multiSeries[k];\r\n        series.key = k;\r\n        return series;\r\n    });\r\n}\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {labelFunction} from \"../axis/axisLabel\";\nimport {splitIntoMultiSeries} from \"./splitIntoMultiSeries\";\n\nexport function groupData(settings, data) {\n    const stack = {stack: false};\n    const groupedSeries = splitIntoMultiSeries(settings, data, stack).map(data => groupPointDataByMainValue(settings, data, stack));\n\n    if (settings.mainValues.length > 1) {\n        const flattenedSeries = groupedSeries.reduce((a, b) => a.concat(b));\n        return flattenedSeries;\n    }\n\n    return groupedSeries;\n}\n\nexport function groupAndStackData(settings, data) {\n    const stack = {stack: true};\n    return splitIntoMultiSeries(settings, data, stack).map(data => groupPointDataByMainValue(settings, data, stack));\n}\n\nfunction seriesDataFn(settings, data, {stack = false}) {\n    const labelfn = labelFunction(settings);\n\n    return mainValue => {\n        const baseValue = col => (stack ? col[`__BASE_VALUE__${mainValue.name}`] || 0 : 0);\n        const series = data.map((col, i) => ({\n            crossValue: labelfn(col, i),\n            mainValue: !!col[mainValue.name] ? col[mainValue.name] : null,\n            baseValue: baseValue(col),\n            key: col.__KEY__ ? `${col.__KEY__}|${mainValue.name}` : mainValue.name,\n            row: col.row || col\n        }));\n        series.key = series[0].key;\n        return series;\n    };\n}\n\nfunction groupPointDataByMainValue(settings, data, {stack = false}) {\n    // Split data into a group for each aggregate (mainValue)\n    const seriesFn = seriesDataFn(settings, data, {stack});\n\n    if (settings.mainValues.length > 1) {\n        return settings.mainValues.map(seriesFn);\n    } else {\n        return seriesFn(settings.mainValues[0]);\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {isElementOverflowing} from \"../../utils/utils\";\nimport {getChartElement} from \"../../plugin/root\";\n\nexport const margin = 10;\n\nexport function enforceContainerBoundaries(innerNode, offsetX, offsetY) {\n    const chartNodeRect = d3\n        .select(getChartElement(innerNode).getContainer())\n        .node()\n        .getBoundingClientRect();\n\n    const innerNodeRect = innerNode.getBoundingClientRect();\n\n    const draggedInnerNodeRect = {\n        top: innerNodeRect.top + offsetY - margin,\n        right: innerNodeRect.right + offsetX + margin,\n        bottom: innerNodeRect.bottom + offsetY + margin,\n        left: innerNodeRect.left + offsetX - margin\n    };\n\n    const adjustedOffsets = {x: offsetX, y: offsetY};\n    const boundaries = [\n        {edge: \"right\", dimension: \"x\"},\n        {edge: \"left\", dimension: \"x\"},\n        {edge: \"top\", dimension: \"y\"},\n        {edge: \"bottom\", dimension: \"y\"}\n    ];\n\n    boundaries.forEach(bound => {\n        if (isElementOverflowing(chartNodeRect, draggedInnerNodeRect, bound.edge)) {\n            const adjustment = draggedInnerNodeRect[bound.edge] - chartNodeRect[bound.edge];\n            adjustedOffsets[bound.dimension] = adjustedOffsets[bound.dimension] - adjustment;\n        }\n    });\n\n    return adjustedOffsets;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {getChartContainer} from \"../../plugin/root\";\nimport {enforceContainerBoundaries, margin} from \"./enforceContainerBoundaries\";\n\nconst resizeForDraggingEvent = \"resize.for-dragging\";\n\nexport function draggableComponent() {\n    let pinned = true;\n    let settings = null;\n\n    const draggable = element => {\n        const node = element.node();\n        node.style.cursor = \"move\";\n        if (settings.legend) {\n            node.style.left = settings.legend.left;\n            node.style.top = settings.legend.top;\n        }\n\n        const drag = d3.drag().on(\"drag\", function() {\n            const offsets = enforceContainerBoundaries(this, d3.event.dx, d3.event.dy);\n            this.style.left = `${this.offsetLeft + offsets.x}px`;\n            this.style.top = `${this.offsetTop + offsets.y}px`;\n            const position = {\n                left: this.style.left,\n                top: this.style.top\n            };\n            settings.legend = {...settings.legend, ...position};\n\n            if (isNodeInTopRight(node)) {\n                pinned = pinNodeToTopRight(node);\n                return;\n            }\n\n            pinned = unpinNodeFromTopRight(node, pinned);\n        });\n\n        element.call(drag);\n    };\n\n    draggable.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return draggable;\n    };\n\n    return draggable;\n}\n\nfunction unpinNodeFromTopRight(node, pinned) {\n    if (pinned !== false) {\n        // Default behaviour for the legend is to remain pinned to the top right\n        // hand corner with a specific margin. Once the legend has moved we\n        // cannot continue to use that css based approach.\n        d3.select(window).on(resizeForDraggingEvent, function() {\n            const offsets = enforceContainerBoundaries(node, 0, 0);\n            node.style.left = `${node.offsetLeft + offsets.x}px`;\n            node.style.top = `${node.offsetTop + offsets.y}px`;\n        });\n    }\n    return false;\n}\n\nfunction pinNodeToTopRight(node) {\n    d3.select(window).on(resizeForDraggingEvent, null);\n    node.style.left = \"auto\";\n    return true;\n}\n\nfunction isNodeInTopRight(node) {\n    const nodeRect = node.getBoundingClientRect();\n    const containerRect = d3\n        .select(getChartContainer(node))\n        .node()\n        .getBoundingClientRect();\n\n    const fuzz = 5;\n\n    return nodeRect.right + margin + fuzz >= containerRect.right && nodeRect.top - margin - fuzz <= containerRect.top;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {enforceContainerBoundaries} from \"./enforceContainerBoundaries\";\n\nconst horizontalHandleClass = \"horizontal-drag-handle\";\nconst verticalHandleClass = \"vertical-drag-handle\";\nconst cornerHandleClass = \"corner-drag-handle\";\n\nconst handlesContainerId = \"dragHandles\";\n\nconst fillOpacity = 0.0;\nconst resizeEvent = \"resize\";\n\nexport function resizableComponent() {\n    let handleWidthPx = 9;\n    let zIndex = 3;\n    let settings = null;\n    const minDimensionsPx = {height: 100, width: 100};\n    const maxDimensionsPx = {height: null, width: null};\n\n    const callbacks = [];\n    const executeCallbacks = (event, direction) => callbacks.filter(callback => callback.event === event).forEach(callback => callback.execute(direction));\n\n    const resizable = container => {\n        if (handlesContainerExists(container)) {\n            return;\n        }\n\n        const dragHelper = {\n            left: () => executeCallbacks(resizeEvent, {horizontal: dragLeft(d3.event), vertical: false}),\n            top: () => executeCallbacks(resizeEvent, {horizontal: false, vertical: dragTop(d3.event)}),\n            right: () => executeCallbacks(resizeEvent, {horizontal: dragRight(d3.event), vertical: false}),\n            bottom: () => executeCallbacks(resizeEvent, {horizontal: false, vertical: dragBottom(d3.event)}),\n            topleft: () => executeCallbacks(resizeEvent, {horizontal: dragLeft(d3.event), vertical: dragTop(d3.event)}),\n            topright: () => executeCallbacks(resizeEvent, {horizontal: dragRight(d3.event), vertical: dragTop(d3.event)}),\n            bottomright: () => executeCallbacks(resizeEvent, {horizontal: dragRight(d3.event), vertical: dragBottom(d3.event)}),\n            bottomleft: () => executeCallbacks(resizeEvent, {horizontal: dragLeft(d3.event), vertical: dragBottom(d3.event)})\n        };\n\n        const containerNode = container.node();\n        if (settings.legend) {\n            containerNode.style.height = settings.legend.height;\n            containerNode.style.width = settings.legend.width;\n        }\n\n        const containerRect = containerNode.getBoundingClientRect();\n        const handles = container\n            .append(\"svg\")\n            .attr(\"id\", handlesContainerId)\n            .attr(\"width\", containerRect.width)\n            .attr(\"height\", containerRect.height);\n        const handlesGroup = handles.append(\"g\");\n\n        const isVertical = d => d === \"left\" || d === \"right\";\n        const xCoordHelper = {left: 0, top: handleWidthPx, right: containerRect.width - handleWidthPx, bottom: handleWidthPx};\n        const yCoordHelper = {left: handleWidthPx, top: 0, right: handleWidthPx, bottom: containerRect.height - handleWidthPx};\n        const edgeHandles = [\"left\", \"top\", \"right\", \"bottom\"];\n        const [leftHandle, topHandle, rightHandle, bottomHandle] = edgeHandles.map(edge =>\n            handlesGroup\n                .append(\"rect\")\n                .attr(\"id\", `drag${edge}`)\n                .attr(\"class\", isVertical(edge) ? verticalHandleClass : horizontalHandleClass)\n                .attr(\"y\", yCoordHelper[edge])\n                .attr(\"x\", xCoordHelper[edge])\n                .attr(\"height\", isVertical(edge) ? containerRect.height - handleWidthPx * 2 : handleWidthPx)\n                .attr(\"width\", isVertical(edge) ? handleWidthPx : containerRect.width - handleWidthPx * 2)\n                .attr(\"fill\", isVertical(edge) ? \"lightgreen\" : \"lightblue\")\n                .attr(\"fill-opacity\", fillOpacity)\n                .style(\"z-index\", zIndex)\n                .attr(\"cursor\", isVertical(edge) ? \"ew-resize\" : \"ns-resize\")\n                .call(d3.drag().on(\"drag\", dragHelper[edge]))\n        );\n\n        const concatCornerEdges = corner => `${corner[0]}${corner[1]}`;\n        const cornerCursorHelper = {topleft: \"nwse\", topright: \"nesw\", bottomright: \"nwse\", bottomleft: \"nesw\"};\n        const cornerHandles = [\n            [\"top\", \"left\"],\n            [\"top\", \"right\"],\n            [\"bottom\", \"right\"],\n            [\"bottom\", \"left\"]\n        ];\n        const [topLeftHandle, topRightHandle, bottomRightHandle, bottomLeftHandle] = cornerHandles.map(corner =>\n            handlesGroup\n                .append(\"rect\")\n                .attr(\"id\", `drag${concatCornerEdges(corner)}`)\n                .attr(\"class\", `${cornerHandleClass} ${corner[0]} ${corner[1]}`)\n                .attr(\"height\", handleWidthPx)\n                .attr(\"width\", handleWidthPx)\n                .attr(\"fill\", \"red\")\n                .attr(\"fill-opacity\", fillOpacity)\n                .style(\"z-index\", zIndex)\n                .attr(\"cursor\", `${cornerCursorHelper[concatCornerEdges(corner)]}-resize`)\n                .call(d3.drag().on(\"drag\", dragHelper[concatCornerEdges(corner)]))\n        );\n\n        enforceMaxDimensions(\"height\", \"y\", bottomHandle);\n        enforceMaxDimensions(\"width\", \"x\", rightHandle);\n        pinCorners(handles);\n\n        function dragLeft(event) {\n            const offset = enforceDistToParallelBarConstraints(enforceContainerBoundaries(leftHandle.node(), event.x, 0).x, handles, \"width\", (x, y) => x - y);\n            containerNode.style.left = `${containerNode.offsetLeft + offset}px`;\n            containerNode.style.width = `${containerNode.offsetWidth - offset}px`;\n            updateSettings();\n            return resizeAndRelocateHandles(rightHandle, offset, \"width\", \"x\");\n        }\n\n        function dragRight(event) {\n            const offset = -enforceDistToParallelBarConstraints(enforceContainerBoundaries(rightHandle.node(), event.dx, 0).x, handles, \"width\", (x, y) => x + y);\n            if (pointerFallenBehindAbsoluteCoordinates(offset, \"x\", rightHandle, event)) return false;\n            containerNode.style.width = `${containerNode.offsetWidth - offset}px`;\n            updateSettings();\n            return resizeAndRelocateHandles(rightHandle, offset, \"width\", \"x\");\n        }\n\n        function dragTop(event) {\n            const offset = enforceDistToParallelBarConstraints(enforceContainerBoundaries(topHandle.node(), 0, event.y).y, handles, \"height\", (x, y) => x - y);\n            containerNode.style.top = `${containerNode.offsetTop + offset}px`;\n            containerNode.style.height = `${containerNode.offsetHeight - offset}px`;\n            updateSettings();\n            return resizeAndRelocateHandles(bottomHandle, offset, \"height\", \"y\");\n        }\n\n        function dragBottom(event) {\n            const offset = -enforceDistToParallelBarConstraints(enforceContainerBoundaries(bottomHandle.node(), 0, event.dy).y, handles, \"height\", (x, y) => x + y);\n            if (pointerFallenBehindAbsoluteCoordinates(offset, \"y\", bottomHandle, event)) return false;\n            containerNode.style.height = `${containerNode.offsetHeight - offset}px`;\n            updateSettings();\n            return resizeAndRelocateHandles(bottomHandle, offset, \"height\", \"y\");\n        }\n\n        function updateSettings() {\n            const dimensions = {\n                top: containerNode.style.top,\n                left: containerNode.style.left,\n                height: containerNode.style.height,\n                width: containerNode.style.width\n            };\n            settings.legend = {...settings.legend, ...dimensions};\n        }\n\n        function resizeAndRelocateHandles(handle, offset, dimension, axis) {\n            extendHandlesBox(handles, dimension, offset);\n            pinHandleToHandleBoxEdge(handle, axis, offset);\n            extendPerpendicularHandles(handles, offset, dimension, dimension === \"height\" ? verticalHandleClass : horizontalHandleClass);\n            pinCorners(handles);\n            return offset != 0;\n        }\n\n        function pinCorners(handles) {\n            topLeftHandle.attr(\"y\", 0, \"x\", 0);\n            topRightHandle.attr(\"y\", 0).attr(\"x\", handles.attr(\"width\") - handleWidthPx);\n            bottomRightHandle.attr(\"y\", handles.attr(\"height\") - handleWidthPx).attr(\"x\", handles.attr(\"width\") - handleWidthPx);\n            bottomLeftHandle.attr(\"y\", handles.attr(\"height\") - handleWidthPx).attr(\"x\", 0);\n        }\n\n        function enforceMaxDimensions(dimension, axis, relativeHandle) {\n            if (!!maxDimensionsPx[dimension] && maxDimensionsPx[dimension] < containerRect[dimension]) {\n                containerNode.style[dimension] = `${maxDimensionsPx[dimension]}px`;\n                resizeAndRelocateHandles(relativeHandle, containerRect[dimension] - maxDimensionsPx[dimension], dimension, axis);\n            }\n        }\n    };\n\n    resizable.on = (event, callback) => {\n        callbacks.push({event: event, execute: callback});\n        return resizable;\n    };\n\n    resizable.zIndex = input => {\n        zIndex = input;\n        return resizable;\n    };\n\n    resizable.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return resizable;\n    };\n\n    resizable.minWidth = input => {\n        minDimensionsPx.width = input;\n        if (!!maxDimensionsPx.width) maxDimensionsPx.width = Math.max(minDimensionsPx.width, maxDimensionsPx.width);\n        return resizable;\n    };\n\n    resizable.minHeight = input => {\n        minDimensionsPx.height = input;\n        if (!!maxDimensionsPx.height) maxDimensionsPx.height = Math.max(minDimensionsPx.height, maxDimensionsPx.height);\n        return resizable;\n    };\n\n    resizable.handleWidth = input => {\n        handleWidthPx = input;\n        return resizable;\n    };\n\n    resizable.maxWidth = input => {\n        maxDimensionsPx.width = input;\n        minDimensionsPx.width = Math.min(minDimensionsPx.width, maxDimensionsPx.width);\n        return resizable;\n    };\n\n    resizable.maxHeight = input => {\n        maxDimensionsPx.height = input;\n        minDimensionsPx.height = Math.min(minDimensionsPx.height, maxDimensionsPx.height);\n        return resizable;\n    };\n\n    function pointerFallenBehindAbsoluteCoordinates(offset, axis, handle, event) {\n        const becauseCrossedMinSize = (offset, axis, handle, event) => offset < 0 && event[axis] < Number(handle.attr(axis));\n        const becauseExitedCoordinateSpace = (offset, axis, handle, event) => offset > 0 && event[axis] > Number(handle.attr(axis));\n        return becauseCrossedMinSize(offset, axis, handle, event) || becauseExitedCoordinateSpace(offset, axis, handle, event);\n    }\n\n    function enforceDistToParallelBarConstraints(offset, dragHandleContainer, dimension, operatorFunction) {\n        const anticipatedDimension = operatorFunction(Number(dragHandleContainer.attr(dimension)), offset);\n        if (anticipatedDimension < minDimensionsPx[dimension]) {\n            const difference = minDimensionsPx[dimension] - anticipatedDimension;\n            return operatorFunction(offset, difference);\n        }\n        if (!!maxDimensionsPx[dimension] && anticipatedDimension > maxDimensionsPx[dimension]) {\n            const difference = maxDimensionsPx[dimension] - anticipatedDimension;\n            return operatorFunction(offset, difference);\n        }\n        return offset;\n    }\n\n    return resizable;\n}\n\n// \"dimension\" referring to width or height\nconst extendPerpendicularHandles = (handles, offset, dimension, orientationClass) => {\n    const perpendicularHandles = handles.selectAll(`.${orientationClass}`);\n    perpendicularHandles.each((_, i, nodes) => {\n        const handleNode = nodes[i];\n        const handleElement = d3.select(handleNode);\n        handleElement.attr(dimension, handleNode.getBoundingClientRect()[dimension] - offset);\n    });\n};\n\nconst handlesContainerExists = container => container.select(`#${handlesContainerId}`).size() > 0;\n\nconst pinHandleToHandleBoxEdge = (handle, axis, offset) => handle.attr(axis, Number(handle.attr(axis)) - offset);\n\nconst extendHandlesBox = (handles, dimension, offset) => handles.attr(dimension, handles.node().getBoundingClientRect()[dimension] - offset);\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3Legend from \"d3-svg-legend\";\r\nimport {rebindAll} from \"d3fc\";\r\nimport {getOrCreateElement} from \"../utils/utils\";\r\nimport legendControlsTemplate from \"../../html/legend-controls.html\";\r\nimport {cropCellContents} from \"./styling/cropCellContents\";\r\nimport {draggableComponent} from \"./styling/draggableComponent\";\r\nimport {resizableComponent} from \"./styling/resizableComponent\";\r\n\r\nconst averageCellHeightPx = 16;\r\nconst controlsHeightPx = 20;\r\n\r\nexport default (fromLegend, settings) => {\r\n    const legend = fromLegend || d3Legend.legendColor();\r\n\r\n    let domain = [];\r\n    let pageCount = 1;\r\n    let pageSize;\r\n    let pageIndex = settings.legend && settings.legend.pageIndex ? settings.legend.pageIndex : 0;\r\n    let decorate = () => {};\r\n    let draggable = draggableComponent().settings(settings);\r\n    let resizable;\r\n\r\n    const scrollableLegend = selection => {\r\n        domain = legend.scale().domain();\r\n\r\n        resizable = resizableComponent()\r\n            .settings(settings)\r\n            .maxHeight(domain.length * averageCellHeightPx + controlsHeightPx)\r\n            .on(\"resize\", () => render(selection));\r\n\r\n        resizable(selection);\r\n        draggable(selection);\r\n        render(selection);\r\n    };\r\n\r\n    const render = selection => {\r\n        calculatePageSize(selection);\r\n        renderControls(selection);\r\n        renderLegend(selection);\r\n        cropCellContents(selection);\r\n    };\r\n\r\n    const renderControls = selection => {\r\n        const controls = getLegendControls(selection);\r\n        controls.style(\"display\", pageCount <= 1 ? \"none\" : \"block\");\r\n\r\n        controls.select(\"#page-text\").text(`${pageIndex + 1}/${pageCount}`);\r\n\r\n        controls\r\n            .select(\"#up-arrow\")\r\n            .attr(\"class\", pageIndex === 0 ? \"disabled\" : \"\")\r\n            .on(\"click\", () => {\r\n                if (pageIndex > 0) {\r\n                    setPage(pageIndex - 1);\r\n                    render(selection);\r\n                }\r\n            });\r\n\r\n        controls\r\n            .select(\"#down-arrow\")\r\n            .attr(\"class\", pageIndex >= pageCount - 1 ? \"disabled\" : \"\")\r\n            .on(\"click\", () => {\r\n                if (pageIndex < pageCount - 1) {\r\n                    setPage(pageIndex + 1);\r\n                    render(selection);\r\n                }\r\n            });\r\n    };\r\n\r\n    const renderLegend = selection => {\r\n        if (pageCount > 1) legend.cellFilter(cellFilter());\r\n        selection.select(\"g.legendCells\").remove();\r\n\r\n        const legendElement = getLegendElement(selection);\r\n        legendElement.call(legend);\r\n\r\n        const cellContainerSize = selection\r\n            .select(\"g.legendCells\")\r\n            .node()\r\n            .getBBox();\r\n        legendElement.attr(\"height\", cellContainerSize.height + controlsHeightPx);\r\n\r\n        decorate(selection);\r\n    };\r\n\r\n    const setPage = index => {\r\n        pageIndex = index;\r\n        settings.legend = {...settings.legend, pageIndex};\r\n    };\r\n\r\n    const cellFilter = () => (_, i) => i >= pageSize * pageIndex && i < pageSize * pageIndex + pageSize;\r\n\r\n    const calculatePageSize = selection => {\r\n        const legendContainerRect = selection.node().getBoundingClientRect();\r\n        let proposedPageSize = Math.floor(legendContainerRect.height / averageCellHeightPx) - 1;\r\n\r\n        // if page size is less than all legend items, leave space for the\r\n        // legend controls\r\n        pageSize = proposedPageSize < domain.length ? proposedPageSize - 1 : proposedPageSize;\r\n        pageCount = calculatePageCount(proposedPageSize);\r\n        pageIndex = Math.min(pageIndex, pageCount - 1);\r\n    };\r\n\r\n    const calculatePageCount = pageSize => Math.ceil(domain.length / pageSize);\r\n\r\n    const getLegendControls = container =>\r\n        getOrCreateElement(container, \".legend-controls\", () =>\r\n            container\r\n                .append(\"g\")\r\n                .attr(\"class\", \"legend-controls\")\r\n                .html(legendControlsTemplate)\r\n        );\r\n\r\n    const getLegendElement = container => getOrCreateElement(container, \".legend\", () => container.append(\"svg\").attr(\"class\", \"legend\"));\r\n\r\n    scrollableLegend.decorate = (...args) => {\r\n        if (!args.length) {\r\n            return decorate;\r\n        }\r\n        decorate = args[0];\r\n        return scrollableLegend;\r\n    };\r\n\r\n    rebindAll(scrollableLegend, legend);\r\n\r\n    return scrollableLegend;\r\n};\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {isElementOverflowing} from \"../../utils/utils\";\n\nexport function cropCellContents(legendDiv) {\n    const legendCells = legendDiv.select(\"g.legendCells\");\n    const legendDivRect = legendDiv.node().getBoundingClientRect();\n\n    if (!isElementOverflowing(legendDivRect, legendCells.node().getBoundingClientRect())) {\n        return;\n    }\n\n    const svg = legendDiv.select(\".legend\");\n\n    legendCells.selectAll(\".label\").text((d, i, nodes) => {\n        const cell = nodes[i];\n        if (isElementOverflowing(legendDivRect, cell.getBoundingClientRect())) {\n            const cutoffCharIndex = getCutoffCharacterIndex(cell, svg, legendDivRect);\n            return `${d.substring(0, cutoffCharIndex - 3)}...`;\n        } else {\n            return d;\n        }\n    });\n}\n\nfunction getCutoffCharacterIndex(cell, svg, legendDivRect) {\n    const cellRect = cell.getBoundingClientRect();\n    const cutoffCoord = svg.node().createSVGPoint();\n    // Sometimes the svg point can _just_ miss a character, so we fuzz it.\n    const fuzzyFactor = 3;\n    cutoffCoord.x = legendDivRect.right - cellRect.left - fuzzyFactor;\n    cutoffCoord.y = 0;\n    return cell.getCharNumAtPosition(cutoffCoord);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport * as d3Legend from \"d3-svg-legend\";\nimport scrollableLegend from \"./scrollableLegend\";\nimport {withoutOpacity} from \"../series/seriesColors\";\nimport {getChartElement} from \"../plugin/root\";\nimport {getOrCreateElement} from \"../utils/utils\";\n\nconst scrollColorLegend = settings =>\n    scrollableLegend(\n        d3Legend\n            .legendColor()\n            .shape(\"circle\")\n            .shapeRadius(6),\n        settings\n    );\nconst scrollSymbolLegend = settings =>\n    scrollableLegend(\n        d3Legend\n            .legendSymbol()\n            .shapePadding(1)\n            .labelOffset(3),\n        settings\n    );\n\nexport const colorLegend = () => legendComponent(scrollColorLegend);\nexport const symbolLegend = () => legendComponent(scrollSymbolLegend, symbolScale);\n\nfunction symbolScale(fromScale) {\n    if (!fromScale) return null;\n\n    const domain = fromScale.domain();\n    const range = fromScale.range().map(r => d3.symbol().type(r)());\n\n    return d3\n        .scaleOrdinal()\n        .domain(domain)\n        .range(range);\n}\n\nfunction legendComponent(scrollLegendComponent, scaleModifier) {\n    let settings = {};\n    let scale = null;\n    let color = null;\n\n    function legend(container) {\n        if (scale && scale.range().length > 1) {\n            const scrollLegend = scrollLegendComponent(settings);\n            scrollLegend\n                .scale(scale)\n                .orient(\"vertical\")\n                .on(\"cellclick\", function(d) {\n                    settings.hideKeys = settings.hideKeys || [];\n                    if (settings.hideKeys.includes(d)) {\n                        settings.hideKeys = settings.hideKeys.filter(k => k !== d);\n                    } else {\n                        settings.hideKeys.push(d);\n                    }\n\n                    getChartElement(this).draw();\n                });\n\n            scrollLegend.labels(options => {\n                const parts = options.domain[options.i].split(\"|\");\n                return settings.mainValues.length <= 1 && parts.length > 1 ? parts.slice(0, parts.length - 1).join(\"|\") : options.domain[options.i];\n            });\n\n            const legendSelection = getOrCreateElement(container, \"div.legend-container\", () => container.append(\"div\"));\n\n            scrollLegend.decorate(selection => {\n                const isHidden = data => settings.hideKeys && settings.hideKeys.includes(data);\n\n                const cells = selection\n                    .select(\"g.legendCells\")\n                    .attr(\"transform\", \"translate(20,20)\")\n                    .selectAll(\"g.cell\");\n\n                cells.classed(\"hidden\", isHidden);\n                cells.append(\"title\").html(d => d);\n\n                if (color) {\n                    cells\n                        .select(\"path\")\n                        .style(\"fill\", d => (isHidden(d) ? null : color(d)))\n                        .style(\"stroke\", d => (isHidden(d) ? null : withoutOpacity(color(d))));\n                }\n            });\n\n            // render the legend\n            legendSelection\n                .attr(\"class\", \"legend-container\")\n                .attr(\"borderbox-on-hover\", true)\n                .style(\"z-index\", \"2\")\n                .call(scrollLegend);\n        }\n    }\n\n    legend.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return legend;\n    };\n\n    legend.scale = (...args) => {\n        if (!args.length) {\n            return scale;\n        }\n        scale = scaleModifier ? scaleModifier(args[0]) : args[0];\n        return legend;\n    };\n\n    legend.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return legend;\n    };\n\n    return legend;\n}\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport {groupFromKey} from \"../series/seriesKey\";\r\n\r\nexport function filterData(settings, data) {\r\n    const useData = data || settings.data;\r\n    if (settings.hideKeys && settings.hideKeys.length > 0) {\r\n        return useData.map(col => {\r\n            const clone = {...col};\r\n            settings.hideKeys.forEach(k => {\r\n                delete clone[k];\r\n            });\r\n            return clone;\r\n        });\r\n    }\r\n    return useData;\r\n}\r\n\r\nexport function filterDataByGroup(settings, data) {\r\n    const useData = data || settings.data;\r\n    if (settings.hideKeys && settings.hideKeys.length > 0) {\r\n        return useData.map(col => {\r\n            const clone = {};\r\n            Object.keys(col).map(key => {\r\n                if (!settings.hideKeys.includes(groupFromKey(key))) {\r\n                    clone[key] = col[key];\r\n                }\r\n            });\r\n            return clone;\r\n        });\r\n    }\r\n    return useData;\r\n}\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\n\nconst mainGridSvg = settings => x =>\n    x\n        .style(\"opacity\", \"0.3\")\n        .style(\"stroke-width\", \"1.0\")\n        .style(\"stroke\", settings ? settings.colorStyles.grid.gridLineColor : \"#bbb\");\n\nconst mainGridCanvas = c => {\n    c.globalAlpha = 0.3;\n    c.lineWidth = 1.0;\n};\n\nconst crossGridSvg = x => x.style(\"display\", \"none\");\nconst crossGridCanvas = c => {\n    c.globalAlpha = 0;\n};\n\nexport default (series, settings) => {\n    let orient = \"both\";\n    let canvas = false;\n    let xScale = null;\n    let yScale = null;\n    let context = null;\n\n    let seriesMulti = fc.seriesSvgMulti();\n    let annotationGridline = fc.annotationSvgGridline();\n    let mainGrid = mainGridSvg(settings);\n    let crossGrid = crossGridSvg;\n\n    const _withGridLines = function(...args) {\n        if (canvas) {\n            seriesMulti = fc.seriesCanvasMulti().context(context);\n            annotationGridline = fc.annotationCanvasGridline();\n            mainGrid = mainGridCanvas;\n            crossGrid = crossGridCanvas;\n        }\n\n        const multi = seriesMulti.xScale(xScale).yScale(yScale);\n\n        const xStyle = orient === \"vertical\" ? crossGrid : mainGrid;\n        const yStyle = orient === \"horizontal\" ? crossGrid : mainGrid;\n\n        const gridlines = annotationGridline.xDecorate(xStyle).yDecorate(yStyle);\n\n        return multi.series([gridlines, series])(...args);\n    };\n\n    _withGridLines.orient = (...args) => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.canvas = (...args) => {\n        if (!args.length) {\n            return canvas;\n        }\n        canvas = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.xScale = (...args) => {\n        if (!args.length) {\n            return xScale;\n        }\n        xScale = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.yScale = (...args) => {\n        if (!args.length) {\n            return yScale;\n        }\n        yScale = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.context = (...args) => {\n        if (!args.length) {\n            return context;\n        }\n        context = args[0];\n        return _withGridLines;\n    };\n\n    return _withGridLines;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {defaultPadding} from \"./default\";\nimport * as fc from \"d3fc\";\n\nexport const hardLimitZeroPadding = () => {\n    const _defaultPadding = defaultPadding();\n\n    const padding = extent => {\n        let pad = _defaultPadding.pad();\n        let padUnit = _defaultPadding.padUnit();\n\n        let delta = 1;\n        switch (padUnit) {\n            case \"domain\": {\n                break;\n            }\n            case \"percent\": {\n                delta = extent[1] - extent[0];\n                break;\n            }\n            default:\n                throw new Error(\"Unknown padUnit: \" + padUnit);\n        }\n\n        let paddedLowerExtent = extent[0] - pad[0] * delta;\n        let paddedUpperExtent = extent[1] + pad[1] * delta;\n\n        // If datapoints are exclusively negative or exclusively positive hard\n        // limit extent to 0.\n        extent[0] = extent[0] >= 0 && paddedLowerExtent < 0 ? 0 : paddedLowerExtent;\n        extent[1] = extent[1] <= 0 && paddedUpperExtent > 0 ? 0 : paddedUpperExtent;\n        return extent;\n    };\n\n    fc.rebindAll(padding, _defaultPadding);\n\n    return padding;\n};\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nimport * as d3 from \"d3\";\r\nimport {getOrCreateElement} from \"../utils/utils\";\r\nimport template from \"../../html/zoom-controls.html\";\r\n\r\nexport default () => {\r\n    let chart = null;\r\n    let settings = null;\r\n    let xScale = null;\r\n    let xCopy = null;\r\n    let yScale = null;\r\n    let yCopy = null;\r\n    let bound = false;\r\n    let canvas = false;\r\n    let onChange = () => {};\r\n\r\n    function zoomableChart(selection) {\r\n        const chartPlotArea = `d3fc-${canvas ? \"canvas\" : \"svg\"}.plot-area`;\r\n        if (xScale || yScale) {\r\n            const dateAxis = xCopy && xCopy.domain()[0] instanceof Date;\r\n            const zoom = d3.zoom().on(\"zoom\", () => {\r\n                const {transform} = d3.event;\r\n                settings.zoom = {\r\n                    k: transform.k,\r\n                    x: transform.x,\r\n                    y: transform.y\r\n                };\r\n\r\n                applyTransform(transform);\r\n\r\n                selection.call(chart);\r\n\r\n                const noZoom = transform.k === 1 && transform.x === 0 && transform.y === 0;\r\n\r\n                const zoomControls = getZoomControls(selection).style(\"display\", noZoom ? \"none\" : \"\");\r\n                zoomControls.select(\"#zoom-reset\").on(\"click\", () => selection.select(chartPlotArea).call(zoom.transform, d3.zoomIdentity));\r\n\r\n                const oneYear = zoomControls.select(\"#one-year\").style(\"display\", dateAxis ? \"\" : \"none\");\r\n                const sixMonths = zoomControls.select(\"#six-months\").style(\"display\", dateAxis ? \"\" : \"none\");\r\n                const oneMonth = zoomControls.select(\"#one-month\").style(\"display\", dateAxis ? \"\" : \"none\");\r\n                if (dateAxis) {\r\n                    const dateClick = endCalculation => () => {\r\n                        const start = new Date(xScale.domain()[0]);\r\n                        const end = new Date(start);\r\n                        endCalculation(start, end);\r\n\r\n                        const xRange = xCopy.range();\r\n                        const k = (xRange[1] - xRange[0]) / (xCopy(end) - xCopy(start));\r\n                        const x = -xCopy(start) * k;\r\n                        let y = 0;\r\n                        if (yScale) {\r\n                            const yMiddle = yScale.domain().reduce((a, b) => a + b) / 2;\r\n                            y = -yCopy(yMiddle) * k + yScale(yMiddle);\r\n                        }\r\n                        selection.select(chartPlotArea).call(zoom.transform, d3.zoomIdentity.translate(x, y).scale(k));\r\n                    };\r\n\r\n                    oneYear.on(\r\n                        \"click\",\r\n                        dateClick((start, end) => end.setYear(start.getFullYear() + 1))\r\n                    );\r\n                    sixMonths.on(\r\n                        \"click\",\r\n                        dateClick((start, end) => end.setMonth(start.getMonth() + 6))\r\n                    );\r\n                    oneMonth.on(\r\n                        \"click\",\r\n                        dateClick((start, end) => end.setMonth(start.getMonth() + 1))\r\n                    );\r\n                }\r\n            });\r\n\r\n            const oldDecorate = chart.decorate();\r\n            chart.decorate((sel, data) => {\r\n                oldDecorate(sel, data);\r\n                if (!bound) {\r\n                    bound = true;\r\n                    // add the zoom interaction on the enter selection\r\n                    const plotArea = sel.select(chartPlotArea);\r\n\r\n                    plotArea\r\n                        .on(\"measure.zoom-range\", () => {\r\n                            if (xCopy) xCopy.range([0, d3.event.detail.width]);\r\n                            if (yCopy) yCopy.range([0, d3.event.detail.height]);\r\n\r\n                            if (settings.zoom) {\r\n                                const initialTransform = d3.zoomIdentity.translate(settings.zoom.x, settings.zoom.y).scale(settings.zoom.k);\r\n                                plotArea.call(zoom.transform, initialTransform);\r\n                            }\r\n                        })\r\n                        .call(zoom);\r\n                }\r\n            });\r\n        }\r\n\r\n        selection.call(chart);\r\n    }\r\n\r\n    zoomableChart.chart = (...args) => {\r\n        if (!args.length) {\r\n            return chart;\r\n        }\r\n        chart = args[0];\r\n        return zoomableChart;\r\n    };\r\n\r\n    zoomableChart.settings = (...args) => {\r\n        if (!args.length) {\r\n            return settings;\r\n        }\r\n        settings = args[0];\r\n        return zoomableChart;\r\n    };\r\n\r\n    zoomableChart.xScale = (...args) => {\r\n        if (!args.length) {\r\n            return xScale;\r\n        }\r\n        xScale = zoomableScale(args[0]);\r\n        xCopy = xScale ? xScale.copy() : null;\r\n        return zoomableChart;\r\n    };\r\n\r\n    zoomableChart.yScale = (...args) => {\r\n        if (!args.length) {\r\n            return yScale;\r\n        }\r\n        yScale = zoomableScale(args[0]);\r\n        yCopy = yScale ? yScale.copy() : null;\r\n        if (yCopy) {\r\n            const yDomain = yCopy.domain();\r\n            yCopy.domain([yDomain[1], yDomain[0]]);\r\n        }\r\n        return zoomableChart;\r\n    };\r\n\r\n    zoomableChart.canvas = (...args) => {\r\n        if (!args.length) {\r\n            return canvas;\r\n        }\r\n        canvas = args[0];\r\n        return zoomableChart;\r\n    };\r\n\r\n    zoomableChart.onChange = (...args) => {\r\n        if (!args.length) {\r\n            return onChange;\r\n        }\r\n        onChange = args[0];\r\n        return zoomableChart;\r\n    };\r\n\r\n    const applyTransform = transform => {\r\n        const changeArgs = {...transform};\r\n        if (xScale) {\r\n            xScale.domain(transform.rescaleX(xCopy).domain());\r\n            changeArgs.xDomain = xScale.domain();\r\n        }\r\n\r\n        if (yScale) {\r\n            const yZoomDomain = transform.rescaleY(yCopy).domain();\r\n            yScale.domain([yZoomDomain[1], yZoomDomain[0]]);\r\n            changeArgs.yDomain = yScale.domain();\r\n        }\r\n\r\n        onChange(changeArgs);\r\n    };\r\n\r\n    const getZoomControls = container =>\r\n        getOrCreateElement(container, \".zoom-controls\", () =>\r\n            container\r\n                .append(\"div\")\r\n                .attr(\"class\", \"zoom-controls\")\r\n                .style(\"display\", \"none\")\r\n                .html(template)\r\n        );\r\n\r\n    const zoomableScale = scale => {\r\n        if (scale && scale.nice) {\r\n            return scale;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    return zoomableChart;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\nimport {axisFactory} from \"../axis/axisFactory\";\r\nimport {chartSvgFactory} from \"../axis/chartFactory\";\r\nimport {AXIS_TYPES} from \"../axis/axisType\";\r\nimport {barSeries} from \"../series/barSeries\";\r\nimport {seriesColors} from \"../series/seriesColors\";\r\nimport {groupAndStackData} from \"../data/groupData\";\r\nimport {colorLegend} from \"../legend/legend\";\r\nimport {filterData} from \"../legend/filter\";\r\nimport withGridLines from \"../gridlines/gridlines\";\r\n\r\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\r\nimport zoomableChart from \"../zoom/zoomableChart\";\r\n\r\nfunction barChart(container, settings) {\r\n    const data = groupAndStackData(settings, filterData(settings));\r\n    const color = seriesColors(settings);\r\n\r\n    const legend = colorLegend()\r\n        .settings(settings)\r\n        .scale(color);\r\n\r\n    const bars = barSeries(settings, color).orient(\"horizontal\");\r\n    const series = fc\r\n        .seriesSvgMulti()\r\n        .mapping((data, index) => data[index])\r\n        .series(data.map(() => bars));\r\n\r\n    const xAxis = axisFactory(settings)\r\n        .settingName(\"mainValues\")\r\n        .valueName(\"mainValue\")\r\n        .excludeType(AXIS_TYPES.ordinal)\r\n        .include([0])\r\n        .paddingStrategy(hardLimitZeroPadding())(data);\r\n    const yAxis = axisFactory(settings)\r\n        .excludeType(AXIS_TYPES.linear)\r\n        .settingName(\"crossValues\")\r\n        .valueName(\"crossValue\")\r\n        .orient(\"vertical\")(data);\r\n\r\n    const chart = chartSvgFactory(xAxis, yAxis).plotArea(withGridLines(series, settings).orient(\"horizontal\"));\r\n\r\n    if (chart.yPaddingInner) {\r\n        chart.yPaddingInner(0.5);\r\n        chart.yPaddingOuter(0.25);\r\n        bars.align(\"left\");\r\n    }\r\n    chart.xNice && chart.xNice();\r\n\r\n    const zoomChart = zoomableChart()\r\n        .chart(chart)\r\n        .settings(settings)\r\n        .yScale(yAxis.scale);\r\n\r\n    // render\r\n    container.datum(data).call(zoomChart);\r\n    container.call(legend);\r\n}\r\nbarChart.plugin = {\r\n    type: \"d3_x_bar\",\r\n    name: \"X Bar Chart\",\r\n    max_cells: 1000,\r\n    max_columns: 50\r\n};\r\n\r\nexport default barChart;\r\n","export default (domain1, domain2) => {\r\n    if (!isMatchable(domain1) || !isMatchable(domain2)) return;\r\n\r\n    const ratio1 = originRatio(domain1);\r\n    const ratio2 = originRatio(domain2);\r\n\r\n    if (ratio1 > ratio2) {\r\n        domain2[0] = adjustLowerBound(domain2, ratio1);\r\n    } else {\r\n        domain1[0] = adjustLowerBound(domain1, ratio2);\r\n    }\r\n};\r\n\r\nconst isMatchable = domain => domain.length === 2 && !isNaN(domain[0]) && !isNaN(domain[1]) && domain[0] !== domain[1];\r\nconst originRatio = domain => (0 - domain[0]) / (domain[1] - domain[0]);\r\nconst adjustLowerBound = (domain, ratio) => (ratio * domain[1]) / (ratio - 1);\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport {splitterLabels} from \"./splitterLabels\";\r\n\r\nexport const axisSplitter = (settings, sourceData, splitFn = dataSplitFunction) => {\r\n    let color;\r\n    let data;\r\n    let altData;\r\n\r\n    // splitMainValues is an array of main-value names to put into the alt-axis\r\n    const splitMainValues = settings.splitMainValues || [];\r\n    const altValue = name => {\r\n        const split = name.split(\"|\");\r\n        return splitMainValues.includes(split[split.length - 1]);\r\n    };\r\n\r\n    const haveSplit = settings[\"mainValues\"].some(m => altValue(m.name));\r\n\r\n    // Split the data into main and alt displays\r\n    data = haveSplit ? splitFn(sourceData, key => !altValue(key)) : sourceData;\r\n    altData = haveSplit ? splitFn(sourceData, altValue) : null;\r\n\r\n    // Renderer to show the special controls for moving between axes\r\n    const splitter = selection => {\r\n        if (settings[\"mainValues\"].length === 1) return;\r\n\r\n        const labelsInfo = settings[\"mainValues\"].map((v, i) => ({\r\n            index: i,\r\n            name: v.name\r\n        }));\r\n        const mainLabels = labelsInfo.filter(v => !altValue(v.name));\r\n        const altLabels = labelsInfo.filter(v => altValue(v.name));\r\n\r\n        const labeller = () => splitterLabels(settings).color(color);\r\n\r\n        selection.select(\".y-label-container>.y-label\").call(labeller().labels(mainLabels));\r\n        selection.select(\".y2-label-container>.y-label\").call(\r\n            labeller()\r\n                .labels(altLabels)\r\n                .alt(true)\r\n        );\r\n    };\r\n\r\n    splitter.color = (...args) => {\r\n        if (!args.length) {\r\n            return color;\r\n        }\r\n        color = args[0];\r\n        return splitter;\r\n    };\r\n\r\n    splitter.haveSplit = () => haveSplit;\r\n\r\n    splitter.data = (...args) => {\r\n        if (!args.length) {\r\n            return data;\r\n        }\r\n        data = args[0];\r\n        return splitter;\r\n    };\r\n    splitter.altData = (...args) => {\r\n        if (!args.length) {\r\n            return altData;\r\n        }\r\n        altData = args[0];\r\n        return splitter;\r\n    };\r\n\r\n    return splitter;\r\n};\r\n\r\nexport const dataSplitFunction = (sourceData, isIncludedFn) => {\r\n    return sourceData.map(d => d.filter(v => isIncludedFn(v.key)));\r\n};\r\n\r\nexport const dataBlankFunction = (sourceData, isIncludedFn) => {\r\n    return sourceData.map(series => {\r\n        if (!isIncludedFn(series.key)) {\r\n            // Blank this data\r\n            return series.map(v => Object.assign({}, v, {mainValue: null}));\r\n        }\r\n        return series;\r\n    });\r\n};\r\n\r\nexport const groupedBlankFunction = (sourceData, isIncludedFn) => {\r\n    return sourceData.map(group => dataBlankFunction(group, isIncludedFn));\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\nimport {getChartElement} from \"../plugin/root\";\r\nimport {withoutOpacity} from \"../series/seriesColors.js\";\r\n\r\n// Render a set of labels with the little left/right arrows for moving\r\n// between axes\r\nexport const splitterLabels = settings => {\r\n    let labels = [];\r\n    let alt = false;\r\n    let color;\r\n\r\n    const _render = selection => {\r\n        selection.text(\"\");\r\n\r\n        const labelDataJoin = fc.dataJoin(\"span\", \"splitter-label\").key(d => d);\r\n\r\n        const disabled = !alt && labels.length === 1;\r\n        const coloured = color && settings.splitValues.length === 0;\r\n        labelDataJoin(selection, labels)\r\n            .classed(\"disabled\", disabled)\r\n            .text(d => d.name)\r\n            .style(\"color\", d => (coloured ? withoutOpacity(color(d.name)) : undefined))\r\n            .on(\"click\", d => {\r\n                if (disabled) return;\r\n\r\n                if (alt) {\r\n                    settings.splitMainValues = settings.splitMainValues.filter(v => v != d.name);\r\n                } else {\r\n                    settings.splitMainValues = [d.name].concat(settings.splitMainValues || []);\r\n                }\r\n\r\n                redrawChart(selection);\r\n            });\r\n    };\r\n\r\n    const redrawChart = selection => {\r\n        const chartElement = getChartElement(selection.node());\r\n        chartElement.remove();\r\n        chartElement.draw();\r\n    };\r\n\r\n    _render.labels = (...args) => {\r\n        if (!args.length) {\r\n            return labels;\r\n        }\r\n        labels = args[0];\r\n        return _render;\r\n    };\r\n    _render.alt = (...args) => {\r\n        if (!args.length) {\r\n            return alt;\r\n        }\r\n        alt = args[0];\r\n        return _render;\r\n    };\r\n\r\n    _render.color = (...args) => {\r\n        if (!args.length) {\r\n            return color;\r\n        }\r\n        color = args[0];\r\n        return _render;\r\n    };\r\n    return _render;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\nimport {axisFactory} from \"../axis/axisFactory\";\r\nimport {chartSvgFactory} from \"../axis/chartFactory\";\r\nimport domainMatchOrigins from \"../axis/domainMatchOrigins\";\r\nimport {axisSplitter, dataBlankFunction, groupedBlankFunction} from \"../axis/axisSplitter\";\r\nimport {AXIS_TYPES} from \"../axis/axisType\";\r\nimport {barSeries} from \"../series/barSeries\";\r\nimport {seriesColors} from \"../series/seriesColors\";\r\nimport {groupAndStackData} from \"../data/groupData\";\r\nimport {colorLegend} from \"../legend/legend\";\r\nimport {filterData} from \"../legend/filter\";\r\nimport withGridLines from \"../gridlines/gridlines\";\r\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\r\nimport zoomableChart from \"../zoom/zoomableChart\";\r\n\r\nfunction columnChart(container, settings) {\r\n    const data = groupAndStackData(settings, filterData(settings));\r\n    const color = seriesColors(settings);\r\n\r\n    const legend = colorLegend()\r\n        .settings(settings)\r\n        .scale(color);\r\n\r\n    const bars = barSeries(settings, color).orient(\"vertical\");\r\n    const series = fc\r\n        .seriesSvgMulti()\r\n        .mapping((data, index) => data[index])\r\n        .series(data.map(() => bars));\r\n\r\n    const xAxis = axisFactory(settings)\r\n        .excludeType(AXIS_TYPES.linear)\r\n        .settingName(\"crossValues\")\r\n        .valueName(\"crossValue\")(data);\r\n    const yAxisFactory = axisFactory(settings)\r\n        .settingName(\"mainValues\")\r\n        .valueName(\"mainValue\")\r\n        .excludeType(AXIS_TYPES.ordinal)\r\n        .orient(\"vertical\")\r\n        .include([0])\r\n        .paddingStrategy(hardLimitZeroPadding());\r\n\r\n    // Check whether we've split some values into a second y-axis\r\n    const blankFunction = settings.mainValues.length > 1 ? groupedBlankFunction : dataBlankFunction;\r\n    const splitter = axisSplitter(settings, data, blankFunction).color(color);\r\n\r\n    const yAxis1 = yAxisFactory(splitter.data());\r\n\r\n    // No grid lines if splitting y-axis\r\n    const plotSeries = splitter.haveSplit() ? series : withGridLines(series, settings).orient(\"vertical\");\r\n\r\n    const chart = chartSvgFactory(xAxis, yAxis1)\r\n        .axisSplitter(splitter)\r\n        .plotArea(plotSeries);\r\n\r\n    if (chart.xPaddingInner) {\r\n        chart.xPaddingInner(0.5);\r\n        chart.xPaddingOuter(0.25);\r\n        bars.align(\"left\");\r\n    }\r\n    chart.yNice && chart.yNice();\r\n\r\n    const zoomChart = zoomableChart()\r\n        .chart(chart)\r\n        .settings(settings)\r\n        .xScale(xAxis.scale);\r\n\r\n    if (splitter.haveSplit()) {\r\n        // Create the y-axis data for the alt-axis\r\n        const yAxis2 = yAxisFactory(splitter.altData());\r\n\r\n        domainMatchOrigins(yAxis1.domain, yAxis2.domain);\r\n        chart.yDomain(yAxis1.domain).altAxis(yAxis2);\r\n    }\r\n\r\n    // render\r\n    container.datum(splitter.data()).call(zoomChart);\r\n    container.call(legend);\r\n}\r\ncolumnChart.plugin = {\r\n    type: \"d3_y_bar\",\r\n    name: \"Y Bar Chart\",\r\n    max_cells: 1000,\r\n    max_columns: 50\r\n};\r\n\r\nexport default columnChart;\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport const transposeData = function(x) {\n    const columns = [];\n    for (const row of x) {\n        for (let col = 0; col < row.length; col++) {\n            if (row[col].mainValue !== null) {\n                columns[col] = columns[col] || [];\n                columns[col].push(row[col]);\n            }\n        }\n    }\n    return columns;\n};\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nexport const findBestFromData = (array, valueFn, compareFn = Math.min) => {\r\n    const findBestFromArray = array => {\r\n        return array.reduce((best, v) => {\r\n            const thisValue = findBestFromItem(v, valueFn);\r\n            return thisValue && (!best || compareFn(best.value, thisValue.value) === thisValue.value) ? thisValue : best;\r\n        }, null);\r\n    };\r\n    const findBestFromItem = item => {\r\n        if (Array.isArray(item)) {\r\n            return findBestFromArray(item, valueFn);\r\n        }\r\n        const value = valueFn(item);\r\n        return value !== null\r\n            ? {\r\n                  item,\r\n                  value\r\n              }\r\n            : null;\r\n    };\r\n\r\n    const bestItem = findBestFromArray(array, valueFn);\r\n    return bestItem ? bestItem.item : null;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nimport * as fc from \"d3fc\";\r\nimport {tooltip} from \"./tooltip\";\r\nimport {withOpacity} from \"../series/seriesColors.js\";\r\nimport {findBestFromData} from \"../data/findBest\";\r\nimport {raiseEvent} from \"./selectionEvent\";\r\n\r\nexport default () => {\r\n    const base = tooltip().alwaysShow(true);\r\n\r\n    let xScale = null;\r\n    let yScale = null;\r\n    let color = null;\r\n    let size = null;\r\n    let canvas = false;\r\n    let data = null;\r\n    let xValueName = \"crossValue\";\r\n    let yValueName = \"mainValue\";\r\n    let altDataWithScale = null;\r\n\r\n    function nearbyTip(selection) {\r\n        const chartPlotArea = `d3fc-${canvas ? \"canvas\" : \"svg\"}.plot-area`;\r\n        if (xScale || yScale) {\r\n            let tooltipData = null;\r\n            const pointer = fc.pointer().on(\"point\", event => {\r\n                const closest = event.length ? getClosestDataPoint(event[0]) : null;\r\n                tooltipData = closest ? [closest.data] : [];\r\n                const useYScale = closest ? closest.scale : yScale;\r\n\r\n                renderTip(selection, tooltipData, useYScale);\r\n            });\r\n\r\n            selection\r\n                .select(chartPlotArea)\r\n                .on(\"measure.nearbyTip\", () => renderTip(selection, []))\r\n                .on(\"click\", () => {\r\n                    if (tooltipData.length) {\r\n                        raiseEvent(selection.node(), tooltipData[0], base.settings());\r\n                    }\r\n                })\r\n                .call(pointer);\r\n        }\r\n    }\r\n\r\n    const renderTip = (selection, tipData, useYScale = yScale) => {\r\n        const tips = selection\r\n            .select(\"d3fc-svg.plot-area svg\")\r\n            .selectAll(\"circle.nearbyTip\")\r\n            .data(tipData);\r\n        tips.exit().remove();\r\n\r\n        tips.enter()\r\n            .append(\"circle\")\r\n            .attr(\"class\", \"nearbyTip\")\r\n            .merge(tips)\r\n            .attr(\"r\", d => (size ? Math.sqrt(size(d.size)) : 10))\r\n            .attr(\"transform\", d => `translate(${xScale(d[xValueName])},${useYScale(d[yValueName])})`)\r\n            .style(\"stroke\", \"none\")\r\n            .style(\"fill\", d => color && withOpacity(color(d.key)));\r\n\r\n        base(tips);\r\n    };\r\n\r\n    const getClosestDataPoint = pos => {\r\n        const distFn = scale => {\r\n            return v => {\r\n                if (v[yValueName] === undefined || v[yValueName] === null || v[xValueName] === undefined || v[xValueName] === null) return null;\r\n\r\n                return Math.sqrt(Math.pow(xScale(v[xValueName]) - pos.x, 2) + Math.pow(scale(v[yValueName]) - pos.y, 2));\r\n            };\r\n        };\r\n\r\n        // Check the main data\r\n        const dist1 = distFn(yScale);\r\n        const best1 = findBestFromData(data, dist1, Math.min);\r\n\r\n        if (altDataWithScale) {\r\n            // Check the alt data with its scale, to see if any are closer\r\n            const dist2 = distFn(altDataWithScale.yScale);\r\n            const best2 = findBestFromData(altDataWithScale.data, dist2, Math.min);\r\n            return dist1(best1) <= dist2(best2) ? {data: best1, scale: yScale} : {data: best2, scale: altDataWithScale.yScale};\r\n        }\r\n        return {data: best1, scale: yScale};\r\n    };\r\n\r\n    nearbyTip.xScale = (...args) => {\r\n        if (!args.length) {\r\n            return xScale;\r\n        }\r\n        xScale = args[0];\r\n        return nearbyTip;\r\n    };\r\n\r\n    nearbyTip.yScale = (...args) => {\r\n        if (!args.length) {\r\n            return yScale;\r\n        }\r\n        yScale = args[0];\r\n        return nearbyTip;\r\n    };\r\n\r\n    nearbyTip.color = (...args) => {\r\n        if (!args.length) {\r\n            return color;\r\n        }\r\n        color = args[0];\r\n        return nearbyTip;\r\n    };\r\n\r\n    nearbyTip.size = (...args) => {\r\n        if (!args.length) {\r\n            return size;\r\n        }\r\n        size = args[0] ? args[0].copy().range([40, 4000]) : null;\r\n        return nearbyTip;\r\n    };\r\n\r\n    nearbyTip.canvas = (...args) => {\r\n        if (!args.length) {\r\n            return canvas;\r\n        }\r\n        canvas = args[0];\r\n        return nearbyTip;\r\n    };\r\n\r\n    nearbyTip.data = (...args) => {\r\n        if (!args.length) {\r\n            return data;\r\n        }\r\n        data = args[0];\r\n        return nearbyTip;\r\n    };\r\n\r\n    nearbyTip.xValueName = (...args) => {\r\n        if (!args.length) {\r\n            return xValueName;\r\n        }\r\n        xValueName = args[0];\r\n        return nearbyTip;\r\n    };\r\n\r\n    nearbyTip.yValueName = (...args) => {\r\n        if (!args.length) {\r\n            return yValueName;\r\n        }\r\n        yValueName = args[0];\r\n        return nearbyTip;\r\n    };\r\n\r\n    nearbyTip.altDataWithScale = (...args) => {\r\n        if (!args.length) {\r\n            return altDataWithScale;\r\n        }\r\n        altDataWithScale = args[0];\r\n        return nearbyTip;\r\n    };\r\n\r\n    fc.rebindAll(nearbyTip, base);\r\n    return nearbyTip;\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\nimport {axisFactory} from \"../axis/axisFactory\";\r\nimport {AXIS_TYPES} from \"../axis/axisType\";\r\nimport {chartSvgFactory} from \"../axis/chartFactory\";\r\nimport {axisSplitter} from \"../axis/axisSplitter\";\r\nimport {seriesColors} from \"../series/seriesColors\";\r\nimport {lineSeries} from \"../series/lineSeries\";\r\nimport {splitData} from \"../data/splitData\";\r\nimport {colorLegend} from \"../legend/legend\";\r\nimport {filterData} from \"../legend/filter\";\r\nimport {transposeData} from \"../data/transposeData\";\r\nimport withGridLines from \"../gridlines/gridlines\";\r\n\r\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\r\nimport zoomableChart from \"../zoom/zoomableChart\";\r\nimport nearbyTip from \"../tooltip/nearbyTip\";\r\n\r\nfunction lineChart(container, settings) {\r\n    const data = splitData(settings, filterData(settings));\r\n    const color = seriesColors(settings);\r\n\r\n    const legend = colorLegend()\r\n        .settings(settings)\r\n        .scale(color);\r\n\r\n    const series = fc\r\n        .seriesSvgRepeat()\r\n        .series(lineSeries(settings, color))\r\n        .orient(\"horizontal\");\r\n\r\n    const paddingStrategy = hardLimitZeroPadding()\r\n        .pad([0.1, 0.1])\r\n        .padUnit(\"percent\");\r\n\r\n    const xAxis = axisFactory(settings)\r\n        .excludeType(AXIS_TYPES.linear)\r\n        .settingName(\"crossValues\")\r\n        .valueName(\"crossValue\")(data);\r\n\r\n    const yAxisFactory = axisFactory(settings)\r\n        .settingName(\"mainValues\")\r\n        .valueName(\"mainValue\")\r\n        .orient(\"vertical\")\r\n        .paddingStrategy(paddingStrategy);\r\n\r\n    // Check whether we've split some values into a second y-axis\r\n    const splitter = axisSplitter(settings, transposeData(data)).color(color);\r\n\r\n    const yAxis1 = yAxisFactory(splitter.data());\r\n\r\n    // No grid lines if splitting y-axis\r\n    const plotSeries = splitter.haveSplit() ? series : withGridLines(series, settings).orient(\"vertical\");\r\n    const chart = chartSvgFactory(xAxis, yAxis1)\r\n        .axisSplitter(splitter)\r\n        .plotArea(plotSeries);\r\n\r\n    chart.yNice && chart.yNice();\r\n\r\n    const zoomChart = zoomableChart()\r\n        .chart(chart)\r\n        .settings(settings)\r\n        .xScale(xAxis.scale);\r\n\r\n    const toolTip = nearbyTip()\r\n        .settings(settings)\r\n        .xScale(xAxis.scale)\r\n        .yScale(yAxis1.scale)\r\n        .color(color)\r\n        .data(data);\r\n\r\n    if (splitter.haveSplit()) {\r\n        // Create the y-axis data for the alt-axis\r\n        const yAxis2 = yAxisFactory(splitter.altData());\r\n        chart.altAxis(yAxis2);\r\n        // Give the tooltip the information (i.e. 2 datasets with different\r\n        // scales)\r\n        toolTip.data(splitter.data()).altDataWithScale({yScale: yAxis2.scale, data: splitter.altData()});\r\n    }\r\n\r\n    const transposed_data = splitter.data();\r\n\r\n    // render\r\n    container.datum(transposed_data).call(zoomChart);\r\n    container.call(toolTip);\r\n    container.call(legend);\r\n}\r\n\r\nlineChart.plugin = {\r\n    type: \"d3_y_line\",\r\n    name: \"Y Line Chart\",\r\n    max_cells: 4000,\r\n    max_columns: 50\r\n};\r\n\r\nexport default lineChart;\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport {labelFunction} from \"../axis/axisLabel\";\r\n\r\nexport function splitData(settings, data) {\r\n    const labelfn = labelFunction(settings);\r\n\r\n    return data.map((col, i) => {\r\n        return Object.keys(col)\r\n            .filter(key => key !== \"__ROW_PATH__\")\r\n            .map(key => ({\r\n                key,\r\n                crossValue: labelfn(col, i),\r\n                mainValue: col[key],\r\n                row: col\r\n            }));\r\n    });\r\n}\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\nimport {withoutOpacity} from \"./seriesColors.js\";\r\n\r\nexport function lineSeries(settings, color) {\r\n    let series = fc.seriesSvgLine();\r\n\r\n    series = series.decorate(selection => {\r\n        selection.style(\"stroke\", d => withoutOpacity(color(d[0] && d[0].key)));\r\n    });\r\n\r\n    return series.crossValue(d => d.crossValue).mainValue(d => d.mainValue);\r\n}\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\nimport {axisFactory} from \"../axis/axisFactory\";\r\nimport {chartSvgFactory} from \"../axis/chartFactory\";\r\nimport {axisSplitter} from \"../axis/axisSplitter\";\r\nimport {AXIS_TYPES} from \"../axis/axisType\";\r\nimport {areaSeries} from \"../series/areaSeries\";\r\nimport {seriesColors} from \"../series/seriesColors\";\r\nimport {splitAndBaseData} from \"../data/splitAndBaseData\";\r\nimport {colorLegend} from \"../legend/legend\";\r\nimport {filterData} from \"../legend/filter\";\r\nimport withGridLines from \"../gridlines/gridlines\";\r\n\r\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\r\nimport zoomableChart from \"../zoom/zoomableChart\";\r\nimport nearbyTip from \"../tooltip/nearbyTip\";\r\n\r\nfunction areaChart(container, settings) {\r\n    const data = splitAndBaseData(settings, filterData(settings));\r\n\r\n    const color = seriesColors(settings);\r\n    const legend = colorLegend()\r\n        .settings(settings)\r\n        .scale(color);\r\n\r\n    const series = fc.seriesSvgRepeat().series(areaSeries(settings, color).orient(\"vertical\"));\r\n\r\n    const xAxis = axisFactory(settings)\r\n        .excludeType(AXIS_TYPES.linear)\r\n        .settingName(\"crossValues\")\r\n        .valueName(\"crossValue\")(data);\r\n    const yAxisFactory = axisFactory(settings)\r\n        .settingName(\"mainValues\")\r\n        .valueName(\"mainValue\")\r\n        .excludeType(AXIS_TYPES.ordinal)\r\n        .orient(\"vertical\")\r\n        .include([0])\r\n        .paddingStrategy(hardLimitZeroPadding());\r\n\r\n    // Check whether we've split some values into a second y-axis\r\n    const splitter = axisSplitter(settings, data).color(color);\r\n\r\n    const yAxis1 = yAxisFactory(splitter.data());\r\n\r\n    // No grid lines if splitting y-axis\r\n    const plotSeries = splitter.haveSplit() ? series : withGridLines(series, settings).orient(\"vertical\");\r\n\r\n    const chart = chartSvgFactory(xAxis, yAxis1)\r\n        .axisSplitter(splitter)\r\n        .plotArea(plotSeries);\r\n\r\n    chart.yNice && chart.yNice();\r\n\r\n    const zoomChart = zoomableChart()\r\n        .chart(chart)\r\n        .settings(settings)\r\n        .xScale(xAxis.scale);\r\n\r\n    const toolTip = nearbyTip()\r\n        .settings(settings)\r\n        .xScale(xAxis.scale)\r\n        .yScale(yAxis1.scale)\r\n        .color(color)\r\n        .data(data);\r\n\r\n    if (splitter.haveSplit()) {\r\n        // Create the y-axis data for the alt-axis\r\n        const yAxis2 = yAxisFactory(splitter.altData());\r\n        chart.altAxis(yAxis2);\r\n        // Give the tooltip the information (i.e. 2 datasets with different\r\n        // scales)\r\n        toolTip.data(splitter.data()).altDataWithScale({yScale: yAxis2.scale, data: splitter.altData()});\r\n    }\r\n\r\n    // render\r\n    container.datum(splitter.data()).call(zoomChart);\r\n    container.call(toolTip);\r\n    container.call(legend);\r\n}\r\nareaChart.plugin = {\r\n    type: \"d3_y_area\",\r\n    name: \"Y Area Chart\",\r\n    max_cells: 4000,\r\n    max_columns: 50\r\n};\r\n\r\nexport default areaChart;\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {labelFunction} from \"../axis/axisLabel\";\n\nexport function splitAndBaseData(settings, data) {\n    const labelfn = labelFunction(settings);\n\n    return data.map((col, i) => {\n        const baseValues = {};\n\n        return Object.keys(col)\n            .filter(key => key !== \"__ROW_PATH__\")\n            .map(key => {\n                // Keys are of the form \"split1|split2|aggregate\"\n                const labels = key.split(\"|\");\n                // label=\"aggregate\"\n                const label = labels[labels.length - 1];\n                const baseValue = baseValues[label] || 0;\n                const value = baseValue + col[key];\n                baseValues[label] = value;\n\n                return {\n                    key,\n                    crossValue: labelfn(col, i),\n                    mainValue: value,\n                    baseValue: baseValue,\n                    row: col\n                };\n            });\n    });\n}\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\n\r\nexport function areaSeries(settings, color) {\r\n    let series = fc.seriesSvgArea();\r\n\r\n    series = series.decorate(selection => {\r\n        selection.style(\"fill\", d => color(d[0].key));\r\n    });\r\n\r\n    return series\r\n        .crossValue(d => d.crossValue)\r\n        .mainValue(d => d.mainValue)\r\n        .baseValue(d => d.baseValue);\r\n}\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\n\nconst symbols = [d3.symbolCircle, d3.symbolCross, d3.symbolDiamond, d3.symbolSquare, d3.symbolStar, d3.symbolTriangle, d3.symbolWye];\n\nexport function fromDomain(domain) {\n    return domain.length > 1\n        ? d3\n              .scaleOrdinal()\n              .domain(domain)\n              .range(symbols)\n        : null;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {chartSvgFactory} from \"../axis/chartFactory\";\nimport {axisSplitter} from \"../axis/axisSplitter\";\nimport {seriesColors} from \"../series/seriesColors\";\nimport {categoryPointSeries, symbolType} from \"../series/categoryPointSeries\";\nimport {groupData} from \"../data/groupData\";\nimport {symbolLegend} from \"../legend/legend\";\nimport {filterData} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\n\nfunction yScatter(container, settings) {\n    const data = groupData(settings, filterData(settings));\n    const symbols = symbolType(settings);\n    const color = seriesColors(settings);\n\n    const legend = symbolLegend()\n        .settings(settings)\n        .scale(symbols)\n        .color(color);\n\n    const series = fc\n        .seriesSvgMulti()\n        .mapping((data, index) => data[index])\n        .series(data.map(series => categoryPointSeries(settings, series.key, color, symbols)));\n\n    const paddingStrategy = hardLimitZeroPadding()\n        .pad([0.05, 0.05])\n        .padUnit(\"percent\");\n\n    const xAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .orient(\"vertical\")\n        .paddingStrategy(paddingStrategy);\n\n    // Check whether we've split some values into a second y-axis\n    const splitter = axisSplitter(settings, data).color(color);\n\n    const yAxis1 = yAxisFactory(splitter.data());\n\n    // No grid lines if splitting y-axis\n    const plotSeries = splitter.haveSplit() ? series : withGridLines(series, settings).orient(\"vertical\");\n\n    const chart = chartSvgFactory(xAxis, yAxis1)\n        .axisSplitter(splitter)\n        .plotArea(plotSeries);\n\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis1.scale)\n        .color(color)\n        .data(data);\n\n    if (splitter.haveSplit()) {\n        // Create the y-axis data for the alt-axis\n        const yAxis2 = yAxisFactory(splitter.altData());\n        chart.altAxis(yAxis2);\n        // Give the tooltip the information (i.e. 2 datasets with different\n        // scales)\n        toolTip.data(splitter.data()).altDataWithScale({yScale: yAxis2.scale, data: splitter.altData()});\n    }\n\n    // render\n    container.datum(splitter.data()).call(zoomChart);\n    container.call(toolTip);\n    if (legend) {\n        container.call(legend);\n    }\n}\nyScatter.plugin = {\n    type: \"d3_y_scatter\",\n    name: \"Y Scatter Chart\",\n    max_cells: 4000,\n    max_columns: 50\n};\n\nexport default yScatter;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {withOpacity, withoutOpacity} from \"./seriesColors\";\nimport {fromDomain} from \"./seriesSymbols\";\n\nexport function categoryPointSeries(settings, seriesKey, color, symbols) {\n    let series = fc.seriesSvgPoint().size(100);\n    const opacity = settings.colorStyles && settings.colorStyles.opacity;\n\n    if (symbols) {\n        series.type(symbols(seriesKey));\n    }\n\n    series.decorate(selection => {\n        selection.style(\"stroke\", d => withoutOpacity(color(d.colorValue || seriesKey))).style(\"fill\", d => withOpacity(color(d.colorValue || seriesKey), opacity));\n    });\n\n    return series.crossValue(d => d.crossValue).mainValue(d => d.mainValue);\n}\n\nexport function symbolType(settings) {\n    const col = settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = Object.keys(col).filter(k => k !== \"__ROW_PATH__\");\n    return fromDomain(domain);\n}\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport {labelFunction} from \"../axis/axisLabel\";\r\nimport {splitIntoMultiSeries} from \"./splitIntoMultiSeries\";\r\n\r\nexport function pointData(settings, data) {\r\n    return splitIntoMultiSeries(settings, data, {excludeEmpty: true}).map(data => seriesToPoints(settings, data));\r\n}\r\n\r\nfunction seriesToPoints(settings, data) {\r\n    const labelfn = labelFunction(settings);\r\n\r\n    const mappedSeries = data.map((col, i) => ({\r\n        crossValue: labelfn(col, i),\r\n        mainValues: settings.mainValues.map(v => col[v.name]),\r\n        x: col[settings.mainValues[0].name],\r\n        y: col[settings.mainValues[1].name],\r\n        colorValue: settings.realValues[2] ? col[settings.realValues[2]] : undefined,\r\n        size: settings.realValues[3] ? col[settings.realValues[3]] : undefined,\r\n        key: data.key,\r\n        row: col\r\n    }));\r\n\r\n    mappedSeries.key = data.key;\r\n    return mappedSeries;\r\n}\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\nimport {domain} from \"../axis/linearAxis\";\r\n\r\nexport function seriesLinearRange(settings, data, valueName, customExtent) {\r\n    return d3.scaleLinear().domain(getExtent(data, valueName, customExtent));\r\n}\r\n\r\nexport function seriesColorRange(settings, data, valueName, customExtent) {\r\n    let extent = getExtent(data, valueName, customExtent);\r\n    let gradient = settings.colorStyles.gradient.full;\r\n\r\n    if (extent[0] >= 0) {\r\n        gradient = settings.colorStyles.gradient.positive;\r\n    } else if (extent[1] <= 0) {\r\n        gradient = settings.colorStyles.gradient.negative;\r\n    } else {\r\n        const maxVal = Math.max(-extent[0], extent[1]);\r\n        extent = [-maxVal, maxVal];\r\n    }\r\n\r\n    const interpolator = multiInterpolator(gradient);\r\n    return d3.scaleSequential(interpolator).domain(extent);\r\n}\r\n\r\nconst getExtent = (data, valueName, customExtent) => {\r\n    return (\r\n        customExtent ||\r\n        domain()\r\n            .valueName(valueName)\r\n            .pad([0, 0])(data)\r\n    );\r\n};\r\n\r\nconst multiInterpolator = gradientPairs => {\r\n    // A new interpolator that calls through to a set of\r\n    // interpolators between each value/color pair\r\n    const interpolators = gradientPairs.slice(1).map((p, i) => d3.interpolate(gradientPairs[i][1], p[1]));\r\n    return value => {\r\n        const index = gradientPairs.findIndex((p, i) => i < gradientPairs.length - 1 && value <= gradientPairs[i + 1][0] && value > p[0]);\r\n        if (index === -1) {\r\n            if (value <= gradientPairs[0][0]) {\r\n                return gradientPairs[0][1];\r\n            }\r\n            return gradientPairs[gradientPairs.length - 1][1];\r\n        }\r\n\r\n        const interpolator = interpolators[index];\r\n        const [value1] = gradientPairs[index];\r\n        const [value2] = gradientPairs[index + 1];\r\n\r\n        return interpolator((value - value1) / (value2 - value1));\r\n    };\r\n};\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\nimport {getOrCreateElement} from \"../utils/utils\";\nimport valueformatter from \"../axis/valueFormatter\";\n\nexport function colorRangeLegend() {\n    let scale = null;\n\n    function legend(container) {\n        const legendSelection = getOrCreateElement(container, \"div.legend-container\", () =>\n            container\n                .append(\"div\")\n                .attr(\"class\", \"legend-container legend-color\")\n                .style(\"z-index\", \"2\")\n        );\n        const {width, height} = legendSelection.node().getBoundingClientRect();\n\n        const xScale = d3\n            .scaleBand()\n            .domain([0, 1])\n            .range([0, width]);\n\n        const domain = scale\n            .copy()\n            .nice()\n            .domain();\n        const paddedDomain = fc\n            .extentLinear()\n            .pad([0.1, 0.1])\n            .padUnit(\"percent\")(domain);\n        const [min, max] = paddedDomain;\n        const expandedDomain = d3.range(min, max, (max - min) / height);\n\n        const yScale = d3\n            .scaleLinear()\n            .domain(paddedDomain)\n            .range([height, 0]);\n\n        const svgBar = fc\n            .autoBandwidth(fc.seriesSvgBar())\n            .xScale(xScale)\n            .yScale(yScale)\n            .crossValue(0)\n            .baseValue((_, i) => (i > 0 ? expandedDomain[i - 1] : 0))\n            .mainValue(d => d)\n            .decorate(selection => {\n                selection.selectAll(\"path\").style(\"fill\", d => scale(d));\n            });\n\n        const middle = domain[0] < 0 && domain[1] > 0 ? 0 : Math.round((domain[1] + domain[0]) / 2);\n        const tickValues = [...domain, middle];\n\n        const axisLabel = fc\n            .axisRight(yScale)\n            .tickValues(tickValues)\n            .tickSizeOuter(0)\n            .tickFormat(d => valueformatter(d));\n\n        const legendSvg = getOrCreateElement(legendSelection, \"svg\", () => legendSelection.append(\"svg\"))\n            .style(\"width\", width)\n            .style(\"height\", height);\n        const legendBar = getOrCreateElement(legendSvg, \"g\", () => legendSvg.append(\"g\"))\n            .datum(expandedDomain)\n            .call(svgBar);\n\n        const barWidth = Math.abs(legendBar.node().getBBox().x);\n        getOrCreateElement(legendSvg, \"#legend-axis\", () => legendSvg.append(\"g\").attr(\"id\", \"legend-axis\"))\n            .attr(\"transform\", `translate(${barWidth})`)\n            .datum(expandedDomain)\n            .call(axisLabel)\n            .select(\".domain\")\n            .attr(\"visibility\", \"hidden\");\n    }\n\n    legend.scale = (...args) => {\n        if (!args.length) {\n            return scale;\n        }\n        scale = args[0];\n        return legend;\n    };\n\n    return legend;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {chartCanvasFactory} from \"../axis/chartFactory\";\nimport {pointSeriesCanvas, symbolTypeFromGroups} from \"../series/pointSeriesCanvas\";\nimport {pointData} from \"../data/pointData\";\nimport {seriesColorsFromGroups} from \"../series/seriesColors\";\nimport {seriesLinearRange, seriesColorRange} from \"../series/seriesRange\";\nimport {symbolLegend} from \"../legend/legend\";\nimport {colorRangeLegend} from \"../legend/colorRangeLegend\";\nimport {filterDataByGroup} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\n\nfunction xyScatter(container, settings) {\n    const data = pointData(settings, filterDataByGroup(settings));\n    const symbols = symbolTypeFromGroups(settings);\n    const useGroupColors = settings.realValues.length <= 2 || settings.realValues[2] === null;\n    let color = null;\n    let legend = null;\n\n    if (useGroupColors) {\n        color = seriesColorsFromGroups(settings);\n\n        legend = symbolLegend()\n            .settings(settings)\n            .scale(symbols)\n            .color(useGroupColors ? color : null);\n    } else {\n        color = seriesColorRange(settings, data, \"colorValue\");\n        legend = colorRangeLegend().scale(color);\n    }\n\n    const size = settings.realValues[3] ? seriesLinearRange(settings, data, \"size\").range([10, 10000]) : null;\n\n    const series = fc\n        .seriesCanvasMulti()\n        .mapping((data, index) => data[index])\n        .series(data.map(series => pointSeriesCanvas(settings, series.key, size, color, symbols)));\n\n    const axisDefault = () =>\n        axisFactory(settings)\n            .settingName(\"mainValues\")\n            .paddingStrategy(hardLimitZeroPadding())\n            .pad([0.1, 0.1]);\n\n    const xAxis = axisDefault()\n        .settingValue(settings.mainValues[0].name)\n        .valueName(\"x\")(data);\n    const yAxis = axisDefault()\n        .orient(\"vertical\")\n        .settingValue(settings.mainValues[1].name)\n        .valueName(\"y\")(data);\n\n    const chart = chartCanvasFactory(xAxis, yAxis)\n        .xLabel(settings.mainValues[0].name)\n        .yLabel(settings.mainValues[1].name)\n        .plotArea(withGridLines(series, settings).canvas(true));\n\n    chart.xNice && chart.xNice();\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis.scale)\n        .canvas(true);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .canvas(true)\n        .xScale(xAxis.scale)\n        .xValueName(\"x\")\n        .yValueName(\"y\")\n        .yScale(yAxis.scale)\n        .color(useGroupColors && color)\n        .size(size)\n        .data(data);\n\n    // render\n    container.datum(data).call(zoomChart);\n    container.call(toolTip);\n    if (legend) container.call(legend);\n}\nxyScatter.plugin = {\n    type: \"d3_xy_scatter\",\n    name: \"X/Y Scatter Chart\",\n    max_cells: 50000,\n    max_columns: 50,\n    initial: {\n        type: \"number\",\n        count: 2,\n        names: [\"X Axis\", \"Y Axis\", \"Color\", \"Size\", \"Tooltip\"]\n    },\n    selectMode: \"toggle\"\n};\n\nexport default xyScatter;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {seriesCanvasPoint} from \"d3fc\";\nimport {withOpacity, withoutOpacity} from \"./seriesColors\";\nimport {groupFromKey} from \"./seriesKey\";\nimport {fromDomain} from \"./seriesSymbols\";\n\nexport function pointSeriesCanvas(settings, seriesKey, size, color, symbols) {\n    let series = seriesCanvasPoint()\n        .crossValue(d => d.x)\n        .mainValue(d => d.y);\n\n    if (size) {\n        series.size(d => size(d.size));\n    }\n    if (symbols) {\n        series.type(symbols(seriesKey));\n    }\n\n    series.decorate((context, d) => {\n        const colorValue = color(d.colorValue !== undefined ? d.colorValue : seriesKey);\n        const opacity = settings.colorStyles && settings.colorStyles.opacity;\n\n        context.strokeStyle = withoutOpacity(colorValue);\n        context.fillStyle = withOpacity(colorValue, opacity);\n    });\n\n    return series;\n}\n\nexport function symbolTypeFromGroups(settings) {\n    const col = settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = [];\n    Object.keys(col).forEach(key => {\n        if (key !== \"__ROW_PATH__\") {\n            const group = groupFromKey(key);\n            if (!domain.includes(group)) {\n                domain.push(group);\n            }\n        }\n    });\n    return fromDomain(domain);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {chartSvgFactory} from \"../axis/chartFactory\";\nimport {heatmapSeries} from \"../series/heatmapSeries\";\nimport {seriesColorRange} from \"../series/seriesRange\";\nimport {heatmapData} from \"../data/heatmapData\";\nimport {filterData} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport {colorRangeLegend} from \"../legend/colorRangeLegend\";\nimport zoomableChart from \"../zoom/zoomableChart\";\n\nfunction heatmapChart(container, settings) {\n    const data = heatmapData(settings, filterData(settings));\n\n    const color = seriesColorRange(settings, data, \"colorValue\");\n    const series = heatmapSeries(settings, color);\n\n    const legend = colorRangeLegend().scale(color);\n\n    const xAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n    const yAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"splitValues\")\n        .valueName(\"mainValue\")\n        .orient(\"vertical\")(data);\n\n    const chart = chartSvgFactory(xAxis, yAxis).plotArea(withGridLines(series, settings));\n\n    if (chart.xPaddingInner) {\n        chart.xPaddingInner(0);\n        chart.xPaddingOuter(0);\n        series.xAlign(\"right\");\n    }\n    if (chart.yPaddingInner) {\n        chart.yPaddingInner(0);\n        chart.yPaddingOuter(0);\n        series.yAlign(\"top\");\n    }\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis.scale);\n\n    // render\n    container.datum(data).call(zoomChart);\n    container.call(legend);\n}\nheatmapChart.plugin = {\n    type: \"d3_heatmap\",\n    name: \"Heatmap\",\n    max_cells: 1000,\n    max_columns: 50\n};\n\nexport default heatmapChart;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {axisType} from \"../axis/axisType\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {labelFunction} from \"../axis/axisLabel\";\n\nexport function heatmapData(settings, data) {\n    const labelfn = labelFunction(settings);\n    const mainType = axisType(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"splitValues\")();\n\n    const heatmapData = [];\n\n    data.forEach((col, i) => {\n        const crossValue = labelfn(col, i);\n        Object.keys(col)\n            .filter(key => key !== \"__ROW_PATH__\")\n            .forEach(key => {\n                const mainValue = getMainValues(key);\n                heatmapData.push({\n                    crossValue: crossValue,\n                    mainValue: mainType === AXIS_TYPES.time ? new Date(mainValue) : mainValue,\n                    colorValue: col[key],\n                    row: col\n                });\n            });\n    });\n\n    return heatmapData;\n}\n\nfunction getMainValues(key) {\n    // Key format is based on \"Split By\" values plus the value label at the end\n    // val1|val2|....|label\n    const labels = key.split(\"|\");\n    labels.pop();\n    return labels.join(\"|\");\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {tooltip} from \"../tooltip/tooltip\";\n\nexport function heatmapSeries(settings, color) {\n    let series = fc.seriesSvgHeatmap();\n\n    series.decorate(selection => {\n        tooltip().settings(settings)(selection);\n        selection.select(\"path\").attr(\"fill\", d => color(d.colorValue));\n    });\n\n    return fc\n        .autoBandwidth(series)\n        .xValue(d => d.crossValue)\n        .yValue(d => d.mainValue)\n        .colorValue(d => d.colorValue)\n        .colorInterpolate(color.interpolator())\n        .widthFraction(1.0);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {labelFunction} from \"../axis/axisLabel\";\nimport {splitIntoMultiSeries} from \"./splitIntoMultiSeries\";\n\nexport function ohlcData(settings, data) {\n    return splitIntoMultiSeries(settings, data, {excludeEmpty: true}).map(data => seriesToOHLC(settings, data));\n}\n\nfunction seriesToOHLC(settings, data) {\n    const labelfn = labelFunction(settings);\n\n    const getNextOpen = i => data[i < data.length - 1 ? i + 1 : i][settings.mainValues[0].name];\n    const mappedSeries = data.map((col, i) => {\n        const openValue = settings.mainValues.length >= 1 ? col[settings.mainValues[0].name] : undefined;\n        const closeValue = settings.mainValues.length >= 2 ? col[settings.mainValues[1].name] : getNextOpen(i);\n        return {\n            crossValue: labelfn(col, i),\n            mainValues: settings.mainValues.map(v => col[v.name]),\n            openValue: openValue,\n            closeValue: closeValue,\n            highValue: settings.mainValues.length >= 3 ? col[settings.mainValues[2].name] : Math.max(openValue, closeValue),\n            lowValue: settings.mainValues.length >= 4 ? col[settings.mainValues[3].name] : Math.min(openValue, closeValue),\n            key: data.key,\n            row: col\n        };\n    });\n\n    mappedSeries.key = data.key;\n    return mappedSeries;\n}\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as fc from \"d3fc\";\r\nimport {colorScale, setOpacity} from \"../series/seriesColors\";\r\n\r\nconst isUp = d => d.closeValue >= d.openValue;\r\n\r\nexport function ohlcCandleSeries(settings, seriesCanvas, upColor) {\r\n    const domain = upColor.domain();\r\n    const downColor = colorScale()\r\n        .domain(domain)\r\n        .settings(settings)\r\n        .defaultColors([settings.colorStyles[\"series-2\"]])\r\n        .mapFunction(setOpacity(0.5))();\r\n    const avgColor = colorScale()\r\n        .settings(settings)\r\n        .domain(domain)();\r\n\r\n    const series = seriesCanvas()\r\n        .crossValue(d => d.crossValue)\r\n        .openValue(d => d.openValue)\r\n        .highValue(d => d.highValue)\r\n        .lowValue(d => d.lowValue)\r\n        .closeValue(d => d.closeValue)\r\n        .decorate((context, d) => {\r\n            const color = isUp(d) ? upColor(d.key) : downColor(d.key);\r\n            context.fillStyle = color;\r\n            context.strokeStyle = color;\r\n        });\r\n\r\n    const bollingerAverageSeries = fc\r\n        .seriesCanvasLine()\r\n        .mainValue(d => d.bollinger.average)\r\n        .crossValue(d => d.crossValue)\r\n        .decorate((context, d) => {\r\n            context.strokeStyle = avgColor(d[0].key);\r\n        });\r\n\r\n    const bollingerAreaSeries = fc\r\n        .seriesCanvasArea()\r\n        .mainValue(d => d.bollinger.upper)\r\n        .baseValue(d => d.bollinger.lower)\r\n        .crossValue(d => d.crossValue)\r\n        .decorate((context, d) => {\r\n            context.fillStyle = setOpacity(0.25)(avgColor(d[0].key));\r\n        });\r\n\r\n    return fc.seriesCanvasMulti().series([bollingerAreaSeries, series, bollingerAverageSeries]);\r\n}\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {chartCanvasFactory} from \"../axis/chartFactory\";\nimport {ohlcData} from \"../data/ohlcData\";\nimport {filterDataByGroup} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\nimport {ohlcCandleSeries} from \"../series/ohlcCandleSeries\";\nimport {colorScale, setOpacity} from \"../series/seriesColors\";\nimport {colorLegend} from \"../legend/legend\";\n\nfunction ohlcCandle(seriesCanvas) {\n    return function(container, settings) {\n        const srcData = ohlcData(settings, filterDataByGroup(settings));\n\n        const bollinger = fc.indicatorBollingerBands().value(d => d.openValue);\n        const data = srcData.map(seriesData => {\n            const bollingerData = bollinger(seriesData);\n            return seriesData.map((d, i) => Object.assign({bollinger: bollingerData[i]}, d));\n        });\n\n        const keys = srcData\n            .map(k => k.key)\n            .concat(settings.hideKeys ? settings.hideKeys : [])\n            .sort();\n\n        const upColor = colorScale()\n            .domain(keys)\n            .settings(settings)\n            .mapFunction(setOpacity(1))();\n\n        const legend = colorLegend()\n            .settings(settings)\n            .scale(keys.length > 1 ? upColor : null);\n\n        const series = ohlcCandleSeries(settings, seriesCanvas, upColor);\n\n        const multi = fc\n            .seriesCanvasMulti()\n            .mapping((data, index) => data[index])\n            .series(data.map(() => series));\n\n        const paddingStrategy = hardLimitZeroPadding()\n            .pad([0.1, 0.1])\n            .padUnit(\"percent\");\n\n        const xAxis = axisFactory(settings)\n            .settingName(\"crossValues\")\n            .valueName(\"crossValue\")(data);\n        const yAxis = axisFactory(settings)\n            .settingName(\"mainValues\")\n            .valueNames([\"lowValue\", \"highValue\"])\n            .orient(\"vertical\")\n            .paddingStrategy(paddingStrategy)(data);\n\n        const chart = chartCanvasFactory(xAxis, yAxis).plotArea(\n            withGridLines(multi, settings)\n                .orient(\"vertical\")\n                .canvas(true)\n        );\n\n        chart.yNice && chart.yNice();\n\n        const zoomChart = zoomableChart()\n            .chart(chart)\n            .settings(settings)\n            .xScale(xAxis.scale)\n            .onChange(zoom => {\n                const zoomedData = data.map(series => series.filter(d => d.crossValue >= zoom.xDomain[0] && d.crossValue <= zoom.xDomain[1]));\n                chart.yDomain(yAxis.domainFunction(zoomedData));\n            })\n            .canvas(true);\n\n        const toolTip = nearbyTip()\n            .settings(settings)\n            .xScale(xAxis.scale)\n            .yScale(yAxis.scale)\n            .yValueName(\"closeValue\")\n            .color(upColor)\n            .data(data)\n            .canvas(true);\n\n        // render\n        container.datum(data).call(zoomChart);\n        container.call(toolTip);\n        container.call(legend);\n    };\n}\n\nexport default ohlcCandle;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {seriesCanvasOhlc} from \"d3fc\";\nimport ohlcCandle from \"./ohlcCandle\";\n\nconst ohlc = ohlcCandle(seriesCanvasOhlc);\nohlc.plugin = {\n    type: \"d3_ohlc\",\n    name: \"OHLC Chart\",\n    max_cells: 3500,\n    max_columns: 50,\n    initial: {\n        type: \"number\",\n        count: 4,\n        names: [\"Open\", \"Close\", \"High\", \"Low\"]\n    },\n    selectMode: \"toggle\"\n};\n\nexport default ohlc;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {seriesCanvasCandlestick} from \"d3fc\";\nimport ohlcCandle from \"./ohlcCandle\";\n\nconst candlestick = ohlcCandle(seriesCanvasCandlestick);\ncandlestick.plugin = {\n    type: \"d3_candlestick\",\n    name: \"Candlestick Chart\",\n    max_cells: 4000,\n    max_columns: 50,\n    initial: {\n        type: \"number\",\n        count: 4,\n        names: [\"Open\", \"Close\", \"High\", \"Low\"]\n    },\n    selectMode: \"toggle\"\n};\n\nexport default candlestick;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\n\nexport function treeData(settings) {\n    const sets = {};\n    const real_aggs = settings.realValues.map(x => (x === null ? null : settings.mainValues.find(y => y.name === x)));\n    settings.data.forEach(d => {\n        const groups = d.__ROW_PATH__;\n        const splits = getSplitNames(d);\n        splits.forEach(split => {\n            let currentLevel;\n            if (!sets[split]) {\n                sets[split] = [];\n            }\n            currentLevel = sets[split];\n            groups.forEach((group, i) => {\n                let element = currentLevel.find(e => e.name === group);\n                if (!element) {\n                    element = {name: group, children: []};\n                    currentLevel.push(element);\n                }\n                if (settings.realValues.length > 1 && settings.realValues[1] !== null) {\n                    const colorValue = getDataValue(d, settings.mainValues[1], split);\n                    element.color = element.color ? element.color + colorValue : colorValue;\n                }\n                if (settings.realValues.length > 2 && settings.realValues[2] !== null) {\n                    element.tooltip = [];\n                    for (let i = 2; i < settings.realValues.length; ++i) {\n                        element.tooltip.push(getDataValue(d, real_aggs[i], split));\n                    }\n                }\n                if (i === groups.length - 1) {\n                    element.name = groups.slice(-1)[0];\n                    if (groups.length === settings.crossValues.length) {\n                        const size = getDataValue(d, settings.mainValues[0], split);\n                        element.size = size > 0 ? size : 0;\n                    }\n                }\n                currentLevel = element.children;\n            });\n        });\n    });\n\n    const data = Object.entries(sets).map(set => {\n        const tree = {name: \"root\", children: set[1]};\n        const root = d3.hierarchy(tree).sum(d => d.size);\n        const chartData = d3.partition().size([2 * Math.PI, root.height + 1])(root);\n        chartData.each(d => {\n            d.current = d;\n            d.mainValues =\n                settings.realValues.length === 1 || (settings.realValues[1] === null && settings.realValues[2] === null)\n                    ? d.value\n                    : [d.value, d.data.color].concat(d.data.tooltip || []).filter(x => x !== null);\n            d.crossValue = d\n                .ancestors()\n                .slice(0, -1)\n                .reverse()\n                .map(cross => cross.data.name)\n                .join(\"|\");\n            d.key = set[0];\n        });\n\n        return {split: set[0], data: chartData, extents: getExtents(settings, set)};\n    });\n\n    return data;\n}\n\nexport const getDataValue = (d, aggregate, split) => (split.length ? d[`${split}|${aggregate.name}`] : d[aggregate.name]);\n\nfunction getExtents(settings, [split, data]) {\n    if (settings.realValues.length > 1 && settings.realValues[1] !== null) {\n        const min = Math.min(...settings.data.map(d => getDataValue(d, settings.mainValues[1], split)));\n        const max = Math.max(...data.map(d => d.color));\n        return [min, max];\n    }\n}\n\nfunction getSplitNames(d) {\n    const splits = [];\n    Object.keys(d).forEach(key => {\n        if (key !== \"__ROW_PATH__\") {\n            const splitValue = key\n                .split(\"|\")\n                .slice(0, -1)\n                .join(\"|\");\n            if (!splits.includes(splitValue)) {\n                splits.push(splitValue);\n            }\n        }\n    });\n    return splits;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {arc} from \"d3\";\n\nexport const drawArc = radius =>\n    arc()\n        .startAngle(d => d.x0)\n        .endAngle(d => d.x1)\n        .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))\n        .padRadius(radius)\n        .innerRadius(d => d.y0 * radius)\n        .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1));\n\nexport const arcVisible = d => d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {select} from \"d3\";\n\nexport const labelVisible = d => d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.06;\n\nexport function labelTransform(d, radius) {\n    const x = (((d.x0 + d.x1) / 2) * 180) / Math.PI;\n    const y = ((d.y0 + d.y1) / 2) * radius;\n    return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;\n}\n\nexport function cropLabel(d, targetWidth) {\n    let actualWidth = this.getBBox().width;\n    if (actualWidth > targetWidth) {\n        let labelText = d.data.name;\n        const textSelection = select(this);\n        while (actualWidth > targetWidth) {\n            labelText = labelText.substring(0, labelText.length - 1);\n            textSelection.text(() => labelText);\n            actualWidth = this.getBBox().width;\n        }\n        textSelection.text(() => `${labelText.substring(0, labelText.length - 3).replace(/\\s+$/, \"\")}...`);\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {interpolate} from \"d3\";\nimport {drawArc, arcVisible} from \"./sunburstArc\";\nimport {labelVisible, labelTransform} from \"./sunburstLabel\";\n\nexport const clickHandler = (data, g, parent, parentTitle, path, label, radius, split, settings) => (p, skipTransition) => {\n    settings.sunburstLevel[split] = p.data.name;\n    if (p.parent) {\n        parent.datum(p.parent);\n        parent.style(\"cursor\", \"pointer\");\n        parentTitle.html(`&#8682; ${p.data.name}`);\n    } else {\n        parent.datum(data);\n        parent.style(\"cursor\", \"default\");\n        parentTitle.html(\"\");\n    }\n    data.each(\n        d =>\n            (d.target = {\n                x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,\n                x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,\n                y0: Math.max(0, d.y0 - p.depth),\n                y1: Math.max(0, d.y1 - p.depth)\n            })\n    );\n\n    const t = g.transition().duration(skipTransition ? 0 : 750);\n    path.transition(t)\n        .tween(\"data\", d => {\n            const i = interpolate(d.current, d.target);\n            return t => (d.current = i(t));\n        })\n        .filter(function(d) {\n            return +this.getAttribute(\"fill-opacity\") || arcVisible(d.target);\n        })\n        .attr(\"fill-opacity\", d => (arcVisible(d.target) ? 1 : 0))\n        .attr(\"user-select\", d => (arcVisible(d.target) ? \"initial\" : \"none\"))\n        .attr(\"pointer-events\", d => (arcVisible(d.target) ? \"initial\" : \"none\"))\n        .attrTween(\"d\", d => () => drawArc(radius)(d.current));\n\n    label\n        .filter(function(d) {\n            return +this.getAttribute(\"fill-opacity\") || labelVisible(d.target);\n        })\n        .transition(t)\n        .attr(\"fill-opacity\", d => +labelVisible(d.target))\n        .attrTween(\"transform\", d => () => labelTransform(d.current, radius));\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {drawArc, arcVisible} from \"./sunburstArc\";\nimport {labelVisible, labelTransform, cropLabel} from \"./sunburstLabel\";\nimport {clickHandler} from \"./sunburstClick\";\n\nexport function sunburstSeries() {\n    let settings = null;\n    let split = null;\n    let data = null;\n    let color = null;\n    let radius = null;\n\n    const _sunburstSeries = sunburstElement => {\n        const segment = sunburstElement.selectAll(\"g.segment\").data(data.descendants().slice(1));\n        const segmentEnter = segment\n            .enter()\n            .append(\"g\")\n            .attr(\"class\", \"segment\");\n\n        segmentEnter.append(\"path\");\n        segmentEnter\n            .append(\"text\")\n            .attr(\"class\", \"segment\")\n            .attr(\"dy\", \"0.35em\");\n        const segmentMerge = segmentEnter.merge(segment);\n\n        const path = segmentMerge\n            .select(\"path\")\n            .attr(\"fill-opacity\", d => (arcVisible(d.current) ? 1 : 0))\n            .attr(\"user-select\", d => (arcVisible(d.current) ? \"initial\" : \"none\"))\n            .attr(\"pointer-events\", d => (arcVisible(d.current) ? \"initial\" : \"none\"))\n            .attr(\"d\", d => drawArc(radius)(d.current));\n        color && path.style(\"fill\", d => color(d.data.color));\n\n        const label = segmentMerge\n            .select(\"text\")\n            .attr(\"fill-opacity\", d => +labelVisible(d.current))\n            .attr(\"transform\", d => labelTransform(d.current, radius))\n            .text(d => d.data.name)\n            .each(function(d) {\n                cropLabel.call(this, d, radius);\n            });\n\n        const parentTitle = sunburstElement.select(\"text.parent\");\n        const parent = sunburstElement\n            .select(\"circle\")\n            .attr(\"r\", radius)\n            .datum(data);\n\n        const onClick = clickHandler(data, sunburstElement, parent, parentTitle, path, label, radius, split, settings);\n        if (settings.sunburstLevel) {\n            const currentLevel = data.descendants().find(d => d.data.name === settings.sunburstLevel[split]);\n            currentLevel && onClick(currentLevel, true);\n        } else {\n            settings.sunburstLevel = {};\n        }\n        parent.on(\"click\", d => onClick(d, false));\n        path.filter(d => d.children)\n            .style(\"cursor\", \"pointer\")\n            .on(\"click\", d => onClick(d, false));\n    };\n\n    _sunburstSeries.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.split = (...args) => {\n        if (!args.length) {\n            return split;\n        }\n        split = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.data = (...args) => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.radius = (...args) => {\n        if (!args.length) {\n            return radius;\n        }\n        radius = args[0];\n        return _sunburstSeries;\n    };\n\n    return _sunburstSeries;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {getOrCreateElement} from \"../utils/utils\";\n\nexport function gridLayoutMultiChart() {\n    let elementsPrefix = \"element-prefix-unset\";\n\n    let chartContainer = null;\n    let chartEnter = null;\n    let chartDiv = null;\n    let chartTitle = null;\n    let color = null;\n    let containerSize = null;\n\n    const _gridLayoutMultiChart = container => {\n        const innerContainer = getOrCreateElement(container, \"div.inner-container\", () => container.append(\"div\").attr(\"class\", \"inner-container\"));\n\n        const innerRect = innerContainer.node().getBoundingClientRect();\n        const containerHeight = innerRect.height;\n        const containerWidth = innerRect.width - (color ? 70 : 0);\n\n        const minSize = 500;\n        const data = container.datum();\n        const cols = Math.min(data.length, Math.floor(containerWidth / minSize));\n        const rows = Math.ceil(data.length / cols);\n        containerSize = {\n            width: containerWidth / cols,\n            height: Math.min(containerHeight, Math.max(containerHeight / rows, containerWidth / cols))\n        };\n        if (containerHeight / rows > containerSize.height * 0.75) {\n            containerSize.height = containerHeight / rows;\n        }\n\n        innerContainer.style(\"grid-template-columns\", `repeat(${cols}, ${containerSize.width}px)`);\n        innerContainer.style(\"grid-template-rows\", `repeat(${rows}, ${containerSize.height}px)`);\n\n        chartDiv = innerContainer.selectAll(`div.${elementsPrefix}-container`).data(data, d => d.split);\n        chartDiv.exit().remove();\n\n        chartEnter = chartDiv\n            .enter()\n            .append(\"div\")\n            .attr(\"class\", `${elementsPrefix}-container`);\n\n        chartTitle = chartEnter\n            .append(\"div\")\n            .attr(\"class\", \"title-container\")\n            .style(\"text-align\", \"center\")\n            .attr(\"display\", \"inline-block\")\n            .append(\"text\")\n            .attr(\"class\", \"title\")\n            .style(\"text-align\", \"left\");\n\n        chartContainer = chartEnter\n            .append(\"svg\")\n            .append(\"g\")\n            .attr(\"class\", elementsPrefix);\n    };\n\n    _gridLayoutMultiChart.elementsPrefix = (...args) => {\n        if (!args.length) {\n            return elementsPrefix;\n        }\n        elementsPrefix = args[0];\n        return _gridLayoutMultiChart;\n    };\n\n    _gridLayoutMultiChart.chartContainer = () => chartContainer;\n\n    _gridLayoutMultiChart.chartEnter = () => chartEnter;\n\n    _gridLayoutMultiChart.chartDiv = () => chartDiv;\n\n    _gridLayoutMultiChart.chartTitle = () => chartTitle;\n\n    _gridLayoutMultiChart.containerSize = () => containerSize;\n\n    return _gridLayoutMultiChart;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {select} from \"d3\";\nimport {treeColor} from \"../series/sunburst/sunburstColor\";\nimport {treeData} from \"../data/treeData\";\nimport {sunburstSeries} from \"../series/sunburst/sunburstSeries\";\nimport {tooltip} from \"../tooltip/tooltip\";\nimport {gridLayoutMultiChart} from \"../layout/gridLayoutMultiChart\";\nimport {colorRangeLegend} from \"../legend/colorRangeLegend\";\n\nfunction sunburst(container, settings) {\n    if (settings.crossValues.length === 0) {\n        console.warn(\"Unable to render a chart in the absence of any groups.\");\n        return;\n    }\n\n    const data = treeData(settings);\n    const color = treeColor(\n        settings,\n        data.map(d => d.extents)\n    );\n    const sunburstGrid = gridLayoutMultiChart().elementsPrefix(\"sunburst\");\n\n    container.datum(data).call(sunburstGrid);\n\n    if (color) {\n        const legend = colorRangeLegend().scale(color);\n        container.call(legend);\n    }\n\n    const sunburstContainer = sunburstGrid.chartContainer();\n    const sunburstEnter = sunburstGrid.chartEnter();\n    const sunburstDiv = sunburstGrid.chartDiv();\n    const sunburstTitle = sunburstGrid.chartTitle();\n    const containerSize = sunburstGrid.containerSize();\n\n    sunburstTitle.each((d, i, nodes) => select(nodes[i]).text(d.split));\n\n    sunburstContainer\n        .append(\"circle\")\n        .attr(\"fill\", \"none\")\n        .attr(\"pointer-events\", \"all\");\n\n    sunburstContainer.append(\"text\").attr(\"class\", \"parent\");\n    sunburstEnter\n        .merge(sunburstDiv)\n        .select(\"svg\")\n        .select(\"g.sunburst\")\n        .attr(\"transform\", `translate(${containerSize.width / 2}, ${containerSize.height / 2})`)\n        .each(function({split, data}) {\n            const sunburstElement = select(this);\n            const svgNode = this.parentNode;\n            const {width, height} = svgNode.getBoundingClientRect();\n\n            const radius = (Math.min(width, height) - 120) / 6;\n            sunburstSeries()\n                .settings(settings)\n                .split(split)\n                .data(data)\n                .color(color)\n                .radius(radius)(sunburstElement);\n\n            tooltip().settings(settings)(sunburstElement.selectAll(\"g.segment\"));\n        });\n}\n\nsunburst.plugin = {\n    type: \"d3_sunburst\",\n    name: \"Sunburst\",\n    max_cells: 7500,\n    max_columns: 50,\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [\"Size\", \"Color\", \"Tooltip\"]\n    }\n};\n\nexport default sunburst;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {flattenExtent} from \"../../axis/flatten\";\nimport {seriesColorRange} from \"../seriesRange\";\n\nexport function treeColor(settings, extents) {\n    if (settings.realValues.length > 1 && settings.realValues[1] !== null) {\n        return seriesColorRange(settings, null, null, flattenExtent(extents));\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {seriesColorRange} from \"../seriesRange\";\n\nexport function treeColor(settings, data) {\n    if (settings.realValues.length < 1 || settings.realValues[1] === null) return;\n    const colors = data\n        .filter(x => x.height > 0)\n        .map(x => getColors(x))\n        .reduce((a, b) => a.concat(b));\n    let min = Math.min(...colors);\n    let max = Math.max(...colors);\n    return seriesColorRange(settings, null, null, [min, max]);\n}\n\n// only get the colors from the bottom level (e.g. nodes with no children)\nfunction getColors(nodes, colors = []) {\n    nodes.children && nodes.children.length > 0 ? nodes.children.forEach(child => colors.concat(getColors(child, colors))) : colors.push(nodes.data.color);\n    return colors;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {select} from \"d3\";\nimport {isElementOverlapping, isElementOverflowing} from \"../../utils/utils\";\n\nconst minTextSize = 7;\n\nexport const labelMapExists = d => (d.target && d.target.textAttributes ? true : false);\n\nexport const toggleLabels = (nodes, treemapLevel, crossValues) => {\n    nodes\n        .selectAll(\"text\")\n        .style(\"font-size\", null)\n        .attr(\"class\", d => textLevelHelper(d, treemapLevel, crossValues));\n\n    const visibleNodes = selectVisibleNodes(nodes);\n    centerLabels(visibleNodes);\n    preventTextCollisions(visibleNodes);\n};\n\nexport const restoreLabels = nodes => {\n    nodes.each((d, i, nodes) => {\n        const label = select(nodes[i]).selectAll(\"text\");\n        label\n            .attr(\"dx\", d.target.textAttributes.dx)\n            .attr(\"dy\", d.target.textAttributes.dy)\n            .attr(\"class\", d.target.textAttributes.class)\n            .style(\"font-size\", d.target.textAttributes[\"font-size\"]);\n    });\n};\n\nexport const preventTextCollisions = nodes => {\n    const textCollisionFuzzFactorPx = -2;\n    const textAdjustPx = 19; // This should remain the same as the css value for .top => font-size in the chart.less\n    const rect = element => element.getBoundingClientRect();\n\n    const topNodes = [];\n    nodes\n        .selectAll(\"text\")\n        .filter((_, i, nodes) => select(nodes[i]).attr(\"class\") === textVisability.high)\n        .each((_, i, nodes) => topNodes.push(nodes[i]));\n\n    nodes\n        .selectAll(\"text\")\n        .filter((_, i, nodes) => select(nodes[i]).attr(\"class\") === textVisability.low)\n        .each((_, i, nodes) => {\n            const lowerNode = nodes[i];\n            topNodes\n                .filter(topNode => isElementOverlapping(\"x\", rect(topNode), rect(lowerNode)) && isElementOverlapping(\"y\", rect(topNode), rect(lowerNode), textCollisionFuzzFactorPx))\n                .forEach(() => select(lowerNode).attr(\"dy\", Number(select(lowerNode).attr(\"dy\")) + textAdjustPx));\n        });\n};\n\nexport const lockTextOpacity = d => select(d).style(\"opacity\", textOpacity[select(d).attr(\"class\")]);\n\nexport const unlockTextOpacity = d => select(d).style(\"opacity\", null);\n\nexport const textOpacity = {top: 1, mid: 0.7, lower: 0};\n\nexport const selectVisibleNodes = nodes =>\n    nodes.filter(\n        (_, i, nodes) =>\n            select(nodes[i])\n                .selectAll(\"text\")\n                .attr(\"class\") !== textVisability.zero\n    );\n\nexport const adjustLabelsThatOverflow = nodes => nodes.selectAll(\"text\").each((_, i, nodes) => shrinkOrHideText(nodes[i]));\n\nconst centerLabels = nodes => nodes.selectAll(\"text\").each((_, i, nodes) => centerText(nodes[i]));\n\nconst centerText = d => {\n    const nodeSelect = select(d);\n    const rect = d.getBoundingClientRect();\n    nodeSelect.attr(\"dx\", 0 - rect.width / 2).attr(\"dy\", 0 + rect.height / 4);\n};\n\nconst shrinkOrHideText = d => {\n    const parent = d.parentNode;\n    const rect = parent.childNodes[0];\n\n    const textRect = d.getBoundingClientRect();\n    const rectRect = rect.getBoundingClientRect();\n\n    if (!needsToShrinkOrHide(d, rectRect, textRect, \"left\") && !needsToShrinkOrHide(d, rectRect, textRect, \"bottom\")) {\n        select(d).attr(\"class\", select(d).attr(\"class\"));\n    }\n};\n\nconst needsToShrinkOrHide = (d, rectRect, textRect, direction) => {\n    if (isElementOverflowing(rectRect, textRect, direction)) {\n        const fontSize = parseInt(select(d).style(\"font-size\"));\n        if (fontSize > minTextSize) {\n            select(d).style(\"font-size\", `${fontSize - 1}px`);\n            centerText(d);\n            shrinkOrHideText(d);\n        } else {\n            select(d).style(\"font-size\", null);\n            select(d).attr(\"class\", textVisability.zero);\n        }\n        return true;\n    }\n    return false;\n};\n\nconst textLevelHelper = (d, treemapLevel, crossValues) => {\n    if (!crossValues.filter(x => x !== \"\").every(x => d.crossValue.split(\"|\").includes(x))) return textVisability.zero;\n    switch (d.depth) {\n        case treemapLevel + 1:\n            return textVisability.high;\n        case treemapLevel + 2:\n            return textVisability.low;\n        default:\n            return textVisability.zero;\n    }\n};\n\nconst textVisability = {high: \"top\", low: \"mid\", zero: \"lower\"};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\n\nexport default (width, height) => {\n    const treemapLayout = d3\n        .treemap()\n        .size([width, height])\n        .paddingInner(d => 1 + 2 * d.height);\n\n    treemapLayout.tile(d3.treemapBinary);\n\n    return treemapLayout;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {calcWidth, calcHeight} from \"./treemapSeries\";\nimport {hierarchy, select} from \"d3\";\nimport treemapLayout from \"./treemapLayout\";\nimport {textOpacity} from \"./treemapLabel\";\n\nconst includesAllCrossValues = (d, crossValues) => crossValues.every(val => d.crossValue.split(\"|\").includes(val));\n\nexport function calculateSubTreeMap(d, crossValues, nodesMerge, treemapLevel, rootNode, treemapDiv) {\n    // We can approximate coordinates for most of the tree which will be shunted\n    // beyond the viewable area. This approach alone results in excessive\n    // margins as one goes deeper into the treemap.\n    approximateAttributesForAllNodes(d, crossValues, nodesMerge, treemapLevel, rootNode);\n    d.mapLevel[treemapLevel].levelRoot = true;\n    // Use the pre-existing d3 mechanism to calculate the subtree for the\n    // viewable area.\n    recalculateVisibleSubTreeCoordinates(d, treemapDiv.node().getBoundingClientRect().width, treemapDiv.node().getBoundingClientRect().height, treemapLevel);\n\n    calculateTextOpacities(nodesMerge, treemapLevel);\n}\n\nexport function calculateRootLevelMap(nodesMerge, rootNode) {\n    nodesMerge.each(d => {\n        d.mapLevel = [];\n        d.mapLevel[0] = {\n            x0: d.x0,\n            x1: calcWidth(d) + d.x0,\n            y0: d.y0,\n            y1: calcHeight(d) + d.y0,\n            visible: true,\n            opacity: 1\n        };\n    });\n    rootNode.mapLevel[0].levelRoot = true;\n    calculateTextOpacities(nodesMerge, 0);\n}\n\nexport const saveLabelMap = (nodes, treemapLevel) => {\n    nodes.each((d, i, nodes) => {\n        const label = select(nodes[i]).selectAll(\"text\");\n        d.mapLevel[treemapLevel].textAttributes = {\n            dx: label.attr(\"dx\"),\n            dy: label.attr(\"dy\"),\n            class: label.attr(\"class\"),\n            \"font-size\": label.style(\"font-size\")\n        };\n    });\n};\n\nfunction approximateAttributesForAllNodes(d, crossValues, nodesMerge, treemapLevel, rootNode) {\n    const oldDimensions = {x: d.x0, y: d.y0, width: d.x1 - d.x0, height: d.y1 - d.y0};\n    const newDimensions = {width: rootNode.x1 - rootNode.x0, height: rootNode.y1 - rootNode.y0};\n    const dimensionMultiplier = {width: newDimensions.width / oldDimensions.width, height: newDimensions.height / oldDimensions.height};\n\n    nodesMerge.each(d => {\n        const x0 = (d.x0 - oldDimensions.x) * dimensionMultiplier.width;\n        const y0 = (d.y0 - oldDimensions.y) * dimensionMultiplier.height;\n        const width = calcWidth(d) * dimensionMultiplier.width;\n        const height = calcHeight(d) * dimensionMultiplier.height;\n        const visible = includesAllCrossValues(d, crossValues) && d.data.name != crossValues[treemapLevel - 1];\n\n        d.mapLevel[treemapLevel] = {\n            x0,\n            x1: width + x0,\n            y0,\n            y1: height + y0,\n            visible,\n            opacity: visible ? 1 : 0\n        };\n    });\n    d.mapLevel[treemapLevel].levelRoot = true;\n}\n\nfunction recalculateVisibleSubTreeCoordinates(subTreeRoot, treeRootWidth, treeRootHeight, treemapLevel) {\n    const treemapBlueprinter = treemapLayout(treeRootWidth, treeRootHeight);\n    const treemapBlueprint = treemapBlueprinter(hierarchy(subTreeRoot.data).sum(d => d.size));\n\n    const dummiedDescendants = treemapBlueprint.descendants();\n    const descendants = subTreeRoot.descendants();\n\n    dummiedDescendants.forEach((_, i) => {\n        descendants[i].mapLevel[treemapLevel].x0 = dummiedDescendants[i].x0;\n        descendants[i].mapLevel[treemapLevel].x1 = dummiedDescendants[i].x1;\n        descendants[i].mapLevel[treemapLevel].y0 = dummiedDescendants[i].y0;\n        descendants[i].mapLevel[treemapLevel].y1 = dummiedDescendants[i].y1;\n    });\n}\n\nfunction calculateTextOpacities(nodesMerge, treemapLevel) {\n    nodesMerge.selectAll(\"text\").each((_, i, nodes) => {\n        const text = select(nodes[i]);\n        const d = select(nodes[i]).datum();\n        const textVis = text.attr(\"class\");\n        d.mapLevel[treemapLevel].textLockedAt = {opacity: textOpacity[textVis]};\n    });\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {calcWidth, calcHeight} from \"./treemapSeries\";\nimport {labelMapExists, toggleLabels, preventTextCollisions, lockTextOpacity, unlockTextOpacity, textOpacity, selectVisibleNodes, adjustLabelsThatOverflow, restoreLabels} from \"./treemapLabel\";\nimport {calculateSubTreeMap, saveLabelMap} from \"./treemapLevelCalculation\";\n\nexport function returnToLevel(rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls) {\n    if (settings.treemapLevel > 0) {\n        const crossValues = rootNode.crossValue.split(\"|\");\n        executeTransition(rootNode, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, 0, crossValues, parentCtrls, 1, false);\n\n        settings.treemapRoute.slice(1, settings.treemapRoute.length).forEach(cv => {\n            const d = nodesMerge.filter(d => d.crossValue === cv).datum();\n            const crossValues = d.crossValue.split(\"|\");\n            calculateSubTreeMap(d, crossValues, nodesMerge, d.depth, rootNode, treemapDiv);\n            executeTransition(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, d.depth, crossValues, parentCtrls, 1, false);\n        });\n    }\n}\n\nexport function changeLevel(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls) {\n    if (!d.children) return;\n\n    if (settings.treemapLevel < d.depth) {\n        settings.treemapRoute.push(d.crossValue);\n    } else {\n        settings.treemapRoute.pop();\n    }\n\n    settings.treemapLevel = d.depth;\n\n    const crossValues = d.crossValue.split(\"|\");\n    if (!d.mapLevel[settings.treemapLevel] || !d.mapLevel[settings.treemapLevel].levelRoot) {\n        calculateSubTreeMap(d, crossValues, nodesMerge, settings.treemapLevel, rootNode, treemapDiv);\n    }\n\n    executeTransition(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, settings.treemapLevel, crossValues, parentCtrls);\n}\n\nfunction executeTransition(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, treemapLevel, crossValues, parentCtrls, duration = 500, recordLabelMap = true) {\n    const parent = d.parent;\n\n    const t = treemapSvg\n        .transition(\"main transition\")\n        .duration(duration)\n        .ease(d3.easeCubicOut);\n\n    nodesMerge.each(d => (d.target = d.mapLevel[treemapLevel]));\n\n    if (!labelMapExists(d)) preventUserInteraction(nodesMerge, parentCtrls);\n\n    // hide hidden svgs\n    nodesMerge\n        .transition(t)\n        .tween(\"data\", d => {\n            const i = d3.interpolate(d.current, d.target);\n            return t => (d.current = i(t));\n        })\n        .styleTween(\"opacity\", d => () => d.current.opacity)\n        .attrTween(\"pointer-events\", d => () => (d.target.visible ? \"all\" : \"none\"));\n\n    rects\n        .transition(t)\n        .filter(d => d.target.visible)\n        .styleTween(\"x\", d => () => `${d.current.x0}px`)\n        .styleTween(\"y\", d => () => `${d.current.y0}px`)\n        .styleTween(\"width\", d => () => `${d.current.x1 - d.current.x0}px`)\n        .styleTween(\"height\", d => () => `${d.current.y1 - d.current.y0}px`);\n\n    labels\n        .transition(t)\n        .filter(d => d.target.visible)\n        .attrTween(\"x\", d => () => d.current.x0 + calcWidth(d.current) / 2)\n        .attrTween(\"y\", d => () => d.current.y0 + calcHeight(d.current) / 2)\n        .end()\n        .catch(() => enableUserInteraction(nodesMerge))\n        .then(() => {\n            if (!labelMapExists(d)) {\n                preventTextCollisions(visibleLabelNodes);\n                adjustLabelsThatOverflow(visibleLabelNodes);\n                fadeTextTransition(labels, treemapSvg, duration);\n                if (recordLabelMap) saveLabelMap(nodesMerge, treemapLevel);\n                enableUserInteraction(nodesMerge, parentCtrls, parent);\n            }\n        })\n        .catch(ex => {\n            console.error(\"Exception completing promises after main transition\", ex);\n            enableUserInteraction(nodesMerge, parentCtrls, parent);\n        });\n\n    if (!labelMapExists(d)) {\n        labels.each((_, i, labels) => lockTextOpacity(labels[i]));\n        toggleLabels(nodesMerge, treemapLevel, crossValues);\n    } else {\n        restoreLabels(nodesMerge);\n    }\n\n    const visibleLabelNodes = selectVisibleNodes(nodesMerge);\n\n    if (parent) {\n        parentCtrls\n            .hide(false)\n            .text(d.data.name)\n            .onClick(() => changeLevel(parent, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls, duration))();\n    } else {\n        parentCtrls.hide(true)();\n    }\n}\n\nasync function fadeTextTransition(labels, treemapSvg, duration = 400) {\n    const t = treemapSvg\n        .transition(\"text fade transition\")\n        .duration(duration)\n        .ease(d3.easeCubicOut);\n\n    await labels\n        .transition(t)\n        .filter(d => d.target.visible)\n        .tween(\"data\", (d, i, labels) => {\n            const label = labels[i];\n            const interpolation = d3.interpolate(lockedOpacity(d), targetOpacity(label));\n            return t => (d.current.opacity = interpolation(t));\n        })\n        .styleTween(\"opacity\", d => () => d.current.opacity)\n        .end()\n        .catch(ex => console.error(\"Exception in text fade transition\", ex))\n        .then(() => labels.each((_, i, labels) => unlockTextOpacity(labels[i])));\n}\n\nconst lockedOpacity = d => d.target.textLockedAt.opacity;\nconst targetOpacity = d => textOpacity[d3.select(d).attr(\"class\")];\n\nconst preventUserInteraction = (nodes, parentCtrls) => {\n    parentCtrls.deactivate(true);\n\n    nodes.each((_, i, nodes) => {\n        const rect = d3.select(nodes[i]).selectAll(\"rect\");\n        rect.attr(\"pointer-events\", \"none\");\n    });\n};\n\nconst enableUserInteraction = (nodes, parentCtrls) => {\n    if (parentCtrls) parentCtrls.deactivate(false);\n\n    nodes.each((_, i, nodes) => {\n        const rect = d3.select(nodes[i]).selectAll(\"rect\");\n        rect.attr(\"pointer-events\", null);\n    });\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {toggleLabels, adjustLabelsThatOverflow, selectVisibleNodes} from \"./treemapLabel\";\nimport treemapLayout from \"./treemapLayout\";\nimport {changeLevel, returnToLevel} from \"./treemapTransitions\";\nimport {parentControls} from \"./treemapControls\";\nimport {calculateRootLevelMap, saveLabelMap} from \"./treemapLevelCalculation\";\n\nexport const nodeLevel = {leaf: \"leafnode\", branch: \"branchnode\", root: \"rootnode\"};\nexport const calcWidth = d => d.x1 - d.x0;\nexport const calcHeight = d => d.y1 - d.y0;\nconst isLeafNode = (maxDepth, d) => d.depth === maxDepth;\nconst nodeLevelHelper = (maxDepth, d) => (d.depth === 0 ? nodeLevel.root : isLeafNode(maxDepth, d) ? nodeLevel.leaf : nodeLevel.branch);\n\nexport function treemapSeries() {\n    let settings = null;\n    let data = null;\n    let color = null;\n    let treemapDiv = null;\n    let parentCtrls = null;\n\n    const _treemapSeries = treemapSvg => {\n        parentCtrls = parentControls(treemapDiv);\n        parentCtrls();\n\n        const maxDepth = data.height;\n        if (!settings.treemapLevel) settings.treemapLevel = 0;\n        if (!settings.treemapRoute) settings.treemapRoute = [];\n        const treemap = treemapLayout(treemapDiv.node().getBoundingClientRect().width, treemapDiv.node().getBoundingClientRect().height);\n        treemap(data);\n\n        const nodes = treemapSvg.selectAll(\"g\").data(data.descendants());\n        const nodesEnter = nodes.enter().append(\"g\");\n\n        nodesEnter.append(\"rect\");\n        nodesEnter.append(\"text\");\n\n        // Draw child nodes first\n        const nodesMerge = nodesEnter.merge(nodes).sort((a, b) => b.depth - a.depth);\n\n        const rects = nodesMerge\n            .select(\"rect\")\n            .attr(\"class\", d => `treerect ${nodeLevelHelper(maxDepth, d)}`)\n            .style(\"x\", d => d.x0)\n            .style(\"y\", d => d.y0)\n            .style(\"width\", d => calcWidth(d))\n            .style(\"height\", d => calcHeight(d));\n        color && rects.style(\"fill\", d => color(d.data.color));\n\n        const labels = nodesMerge\n            .filter(d => d.value !== 0)\n            .select(\"text\")\n            .attr(\"x\", d => d.x0 + calcWidth(d) / 2)\n            .attr(\"y\", d => d.y0 + calcHeight(d) / 2)\n            .text(d => d.data.name);\n\n        const rootNode = rects.filter(d => d.crossValue === \"\").datum();\n        calculateRootLevelMap(nodesMerge, rootNode);\n\n        toggleLabels(nodesMerge, 0, []);\n        adjustLabelsThatOverflow(selectVisibleNodes(nodesMerge));\n        saveLabelMap(nodesMerge, 0);\n\n        if (settings.treemapRoute.length === 0) settings.treemapRoute.push(rootNode.crossValue);\n        rects.filter(d => d.children).on(\"click\", d => changeLevel(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls));\n\n        returnToLevel(rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls);\n    };\n\n    _treemapSeries.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _treemapSeries;\n    };\n\n    _treemapSeries.data = (...args) => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return _treemapSeries;\n    };\n\n    _treemapSeries.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _treemapSeries;\n    };\n\n    _treemapSeries.container = (...args) => {\n        if (!args.length) {\n            return treemapDiv;\n        }\n        treemapDiv = args[0];\n        return _treemapSeries;\n    };\n\n    return _treemapSeries;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {getOrCreateElement} from \"../../utils/utils\";\nimport template from \"../../../html/parent-controls.html\";\n\nexport function parentControls(container) {\n    let onClick = null;\n    let text = null;\n    let hide = true;\n    let deactivated = false;\n\n    const parent = getOrCreateElement(container, \".parent-controls\", () =>\n        container\n            .append(\"div\")\n            .attr(\"class\", \"parent-controls\")\n            .style(\"display\", hide ? \"none\" : \"\")\n            .html(template)\n    );\n\n    const controls = () => {\n        parent\n            .style(\"display\", hide ? \"none\" : \"\")\n            .select(\"#goto-parent\")\n            .style(\"pointer-events\", deactivated ? \"none\" : null)\n            .html(`⇪ ${text}`)\n            .on(\"click\", () => onClick());\n    };\n\n    controls.deactivate = (...args) => {\n        if (!args.length) {\n            return deactivated;\n        }\n        deactivated = args[0];\n\n        const button = parent.select(\"#goto-parent\");\n        if (deactivated) {\n            button.style(\"pointer-events\", \"none\");\n        } else {\n            button.style(\"pointer-events\", null);\n        }\n\n        return controls;\n    };\n\n    controls.hide = (...args) => {\n        if (!args.length) {\n            return hide;\n        }\n        hide = args[0];\n        return controls;\n    };\n\n    controls.text = (...args) => {\n        if (!args.length) {\n            return text;\n        }\n        text = args[0];\n        return controls;\n    };\n\n    controls.onClick = (...args) => {\n        if (!args.length) {\n            return onClick;\n        }\n        onClick = args[0];\n        return controls;\n    };\n\n    return controls;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {treeColor} from \"../series/treemap/treemapColor\";\nimport {treeData} from \"../data/treeData\";\nimport {treemapSeries} from \"../series/treemap/treemapSeries\";\nimport {tooltip} from \"../tooltip/tooltip\";\nimport {gridLayoutMultiChart} from \"../layout/gridLayoutMultiChart\";\nimport {colorRangeLegend} from \"../legend/colorRangeLegend\";\n\nfunction treemap(container, settings) {\n    if (settings.crossValues.length === 0) {\n        console.warn(\"Unable to render a chart in the absence of any groups.\");\n        return;\n    }\n    if (!settings.treemaps) settings.treemaps = {};\n\n    const data = treeData(settings);\n    const color = treeColor(\n        settings,\n        data.map(d => d.data)\n    );\n    const treemapGrid = gridLayoutMultiChart().elementsPrefix(\"treemap\");\n\n    container.datum(data).call(treemapGrid);\n\n    if (color) {\n        const legend = colorRangeLegend().scale(color);\n        container.call(legend);\n    }\n\n    const treemapEnter = treemapGrid.chartEnter();\n    const treemapDiv = treemapGrid.chartDiv();\n    const treemapTitle = treemapGrid.chartTitle();\n\n    treemapTitle.each((d, i, nodes) => d3.select(nodes[i]).text(d.split));\n    treemapEnter\n        .merge(treemapDiv)\n        .select(\"svg\")\n        .select(\"g.treemap\")\n        .each(function({split, data}) {\n            const treemapSvg = d3.select(this);\n\n            if (!settings.treemaps[split]) settings.treemaps[split] = {};\n\n            treemapSeries()\n                .settings(settings.treemaps[split])\n                .data(data)\n                .container(d3.select(d3.select(this.parentNode).node().parentNode))\n                .color(color)(treemapSvg);\n\n            tooltip()\n                .settings(settings)\n                .centered(true)(treemapSvg.selectAll(\"g\"));\n        });\n}\n\ntreemap.plugin = {\n    type: \"d3_treemap\",\n    name: \"Treemap\",\n    max_cells: 5000,\n    max_columns: 50,\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [\"Size\", \"Color\", \"Tooltip\"]\n    }\n};\nexport default treemap;\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nimport barChart from \"./bar\";\r\nimport columnChart from \"./column\";\r\nimport lineChart from \"./line\";\r\nimport areaChart from \"./area\";\r\nimport yScatter from \"./y-scatter\";\r\nimport xyScatter from \"./xy-scatter\";\r\nimport heatmap from \"./heatmap\";\r\nimport ohlc from \"./ohlc\";\r\nimport candlestick from \"./candlestick\";\r\nimport sunburst from \"./sunburst\";\r\nimport treemap from \"./treemap\";\r\n\r\nconst chartClasses = [barChart, columnChart, lineChart, areaChart, yScatter, xyScatter, heatmap, ohlc, candlestick, sunburst, treemap];\r\n\r\nexport default chartClasses;\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nimport * as d3 from \"d3\";\r\nimport * as gparser from \"gradient-parser\";\r\n\r\nexport const initialiseStyles = (container, settings) => {\r\n    if (!settings.colorStyles) {\r\n        const data = [\"series\"];\r\n        for (let n = 1; n <= 10; n++) {\r\n            data.push(`series-${n}`);\r\n        }\r\n\r\n        const styles = {\r\n            scheme: [],\r\n            gradient: {},\r\n            interpolator: {},\r\n            grid: {}\r\n        };\r\n\r\n        const computed = computedStyle(container);\r\n        data.forEach((d, i) => {\r\n            styles[d] = computed(`--d3fc-${d}`);\r\n\r\n            if (i > 0) {\r\n                styles.scheme.push(styles[d]);\r\n            }\r\n        });\r\n\r\n        styles.opacity = getOpacityFromColor(styles.series);\r\n        styles.grid.gridLineColor = computed`--d3fc-gridline--color`;\r\n\r\n        const gradients = [\"full\", \"positive\", \"negative\"];\r\n        gradients.forEach(g => {\r\n            const gradient = computed(`--d3fc-${g}--gradient`);\r\n            styles.gradient[g] = parseGradient(gradient, styles.opacity);\r\n        });\r\n\r\n        settings.colorStyles = styles;\r\n    }\r\n};\r\n\r\nconst getOpacityFromColor = color => {\r\n    return d3.color(color).opacity;\r\n};\r\n\r\nconst stepAsColor = (value, opacity) => {\r\n    const color = d3.color(`#${value}`);\r\n    color.opacity = opacity;\r\n    return color + \"\";\r\n};\r\n\r\nconst computedStyle = container => {\r\n    if (window.ShadyCSS) {\r\n        return d => window.ShadyCSS.getComputedStyleValue(container, d);\r\n    } else {\r\n        const containerStyles = getComputedStyle(container);\r\n        return d => containerStyles.getPropertyValue(d);\r\n    }\r\n};\r\n\r\nconst parseGradient = (gradient, opacity) => {\r\n    const parsed = gparser.parse(gradient)[0].colorStops;\r\n    return parsed.map((g, i) => [g.length ? g.length.value / 100 : i / (parsed.length - 1), stepAsColor(g.value, opacity)]).sort((a, b) => a[0] - b[0]);\r\n};\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\nimport * as d3 from \"d3\";\r\n\r\nimport style from \"../../less/chart.less\";\r\nimport template from \"../../html/d3fc-chart.html\";\r\nimport {areArraysEqualSimple} from \"../utils/utils\";\r\nimport {initialiseStyles} from \"../series/colorStyles\";\r\n\r\nimport {bindTemplate} from \"@finos/perspective-viewer/dist/esm/utils\";\r\n\r\nconst styleWithD3FC = `${style}${getD3FCStyles()}`;\r\n\r\n@bindTemplate(template, styleWithD3FC) // eslint-disable-next-line no-unused-vars\r\nclass D3FCChartElement extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        this._chart = null;\r\n        this._settings = null;\r\n    }\r\n\r\n    connectedCallback() {\r\n        console.log(\"connected callback\");\r\n        this._container = this.shadowRoot.querySelector(\".chart\");\r\n    }\r\n\r\n    render(chart, settings) {\r\n        this._chart = chart;\r\n        this._settings = this._configureSettings(this._settings, settings);\r\n        initialiseStyles(this._container, this._settings);\r\n\r\n        if ((this._settings.data && this._settings.data.length > 0) || chart.plugin.type !== this._chart.plugin.type) {\r\n            this.remove();\r\n        }\r\n        this.draw();\r\n\r\n        if (window.navigator.userAgent.indexOf(\"Edge\") > -1) {\r\n            // Workaround for MS Edge issue that doesn't draw content in the\r\n            // plot-area until the chart D3 object is redrawn\r\n            setTimeout(() => this.draw());\r\n        }\r\n    }\r\n\r\n    draw() {\r\n        if (this._settings.data) {\r\n            const containerDiv = d3.select(this._container);\r\n            const chartClass = `chart ${this._chart.plugin.type}`;\r\n            this._settings.size = this._container.getBoundingClientRect();\r\n\r\n            if (this._settings.data.length > 0) {\r\n                this._chart(containerDiv.attr(\"class\", chartClass), this._settings);\r\n            } else {\r\n                containerDiv.attr(\"class\", `${chartClass} disabled`);\r\n            }\r\n        }\r\n    }\r\n\r\n    resize() {\r\n        this.draw();\r\n    }\r\n\r\n    remove() {\r\n        this._container.innerHTML = \"\";\r\n    }\r\n\r\n    delete() {\r\n        this.remove();\r\n    }\r\n\r\n    getContainer() {\r\n        return this._container;\r\n    }\r\n\r\n    getSettings() {\r\n        const excludeSettings = [\"crossValues\", \"mainValues\", \"splitValues\", \"filter\", \"data\", \"size\", \"colorStyles\"];\r\n        const settings = {...this._settings};\r\n        excludeSettings.forEach(s => {\r\n            delete settings[s];\r\n        });\r\n        return settings;\r\n    }\r\n\r\n    setSettings(settings) {\r\n        this._settings = {...this._settings, ...settings};\r\n        this.draw();\r\n    }\r\n\r\n    _configureSettings(oldSettings, newSettings) {\r\n        if (oldSettings) {\r\n            if (!oldSettings.data) {\r\n                // Combine with the restored settings\r\n                return {...oldSettings, ...newSettings};\r\n            }\r\n\r\n            const oldValues = [oldSettings.crossValues, oldSettings.mainValues, oldSettings.splitValues, oldSettings.realValues];\r\n            const newValues = [newSettings.crossValues, newSettings.mainValues, newSettings.splitValues, newSettings.realValues];\r\n            if (areArraysEqualSimple(oldValues, newValues)) return {...oldSettings, data: newSettings.data, colorStyles: null};\r\n        }\r\n        this.remove();\r\n        return newSettings;\r\n    }\r\n}\r\n\r\nfunction getD3FCStyles() {\r\n    const headerStyles = document.querySelector(\"head\").querySelectorAll(\"style\");\r\n    const d3fcStyles = [];\r\n    headerStyles.forEach(s => {\r\n        if (s.innerText.indexOf(\"d3fc-\") !== -1) {\r\n            d3fcStyles.push(s.innerText);\r\n        }\r\n    });\r\n    return d3fcStyles.join(\"\");\r\n}\r\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nimport {registerPlugin} from \"@finos/perspective-viewer/dist/esm/utils.js\";\r\nimport charts from \"../charts/charts\";\r\nimport \"./polyfills/index\";\r\nimport \"./template\";\r\n\r\nexport const PRIVATE = Symbol(\"D3FC chart\");\r\n\r\nconst DEFAULT_PLUGIN_SETTINGS = {\r\n    initial: {\r\n        type: \"number\",\r\n        count: 1\r\n    },\r\n    selectMode: \"select\"\r\n};\r\n\r\nexport function register(...plugins) {\r\n    plugins = new Set(plugins.length > 0 ? plugins : charts.map(chart => chart.plugin.type));\r\n    charts.forEach(chart => {\r\n        if (plugins.has(chart.plugin.type)) {\r\n            registerPlugin(chart.plugin.type, {\r\n                ...DEFAULT_PLUGIN_SETTINGS,\r\n                ...chart.plugin,\r\n                create: drawChart(chart),\r\n                resize: resizeChart,\r\n                delete: deleteChart,\r\n                save,\r\n                restore\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\nfunction drawChart(chart) {\r\n    return async function(el, view, task, end_col, end_row) {\r\n        let jsonp;\r\n        const realValues = JSON.parse(this.getAttribute(\"columns\"));\r\n\r\n        if (end_col && end_row) {\r\n            jsonp = view.to_json({end_row, end_col, leaves_only: true});\r\n        } else if (end_col) {\r\n            jsonp = view.to_json({end_col, leaves_only: true});\r\n        } else if (end_row) {\r\n            jsonp = view.to_json({end_row, leaves_only: true});\r\n        } else {\r\n            jsonp = view.to_json({leaves_only: true});\r\n        }\r\n\r\n        let [tschema, schema, json, config] = await Promise.all([this._table.schema(false), view.schema(false), jsonp, view.get_config()]);\r\n\r\n        if (task.cancelled) {\r\n            return;\r\n        }\r\n\r\n        const {columns, row_pivots, column_pivots, filter} = config;\r\n        const filtered = row_pivots.length > 0 ? json.filter(col => col.__ROW_PATH__ && col.__ROW_PATH__.length == row_pivots.length) : json;\r\n        const dataMap = (col, i) => (!row_pivots.length ? {...col, __ROW_PATH__: [i]} : col);\r\n        const mapped = filtered.map(dataMap);\r\n\r\n        let settings = {\r\n            realValues,\r\n            crossValues: row_pivots.map(r => ({name: r, type: tschema[r]})),\r\n            mainValues: columns.map(a => ({name: a, type: schema[a]})),\r\n            splitValues: column_pivots.map(r => ({name: r, type: tschema[r]})),\r\n            filter,\r\n            data: mapped\r\n        };\r\n\r\n        createOrUpdateChart.call(this, el, chart, settings);\r\n    };\r\n}\r\n\r\nfunction getOrCreatePluginElement() {\r\n    let perspective_d3fc_element;\r\n    this[PRIVATE] = this[PRIVATE] || {};\r\n    if (!this[PRIVATE].chart) {\r\n        perspective_d3fc_element = this[PRIVATE].chart = document.createElement(\"perspective-d3fc-chart\");\r\n    } else {\r\n        perspective_d3fc_element = this[PRIVATE].chart;\r\n    }\r\n    return perspective_d3fc_element;\r\n}\r\n\r\nfunction createOrUpdateChart(div, chart, settings) {\r\n    const perspective_d3fc_element = getOrCreatePluginElement.call(this);\r\n\r\n    if (!document.body.contains(perspective_d3fc_element)) {\r\n        div.innerHTML = \"\";\r\n        div.appendChild(perspective_d3fc_element);\r\n    }\r\n\r\n    perspective_d3fc_element.render(chart, settings);\r\n}\r\n\r\nfunction resizeChart() {\r\n    if (this[PRIVATE] && this[PRIVATE].chart) {\r\n        const perspective_d3fc_element = this[PRIVATE].chart;\r\n        perspective_d3fc_element.resize();\r\n    }\r\n}\r\n\r\nfunction deleteChart() {\r\n    if (this[PRIVATE] && this[PRIVATE].chart) {\r\n        const perspective_d3fc_element = this[PRIVATE].chart;\r\n        perspective_d3fc_element.delete();\r\n    }\r\n}\r\n\r\nfunction save() {\r\n    if (this[PRIVATE] && this[PRIVATE].chart) {\r\n        const perspective_d3fc_element = this[PRIVATE].chart;\r\n        return perspective_d3fc_element.getSettings();\r\n    }\r\n}\r\n\r\nfunction restore(config) {\r\n    const perspective_d3fc_element = getOrCreatePluginElement.call(this);\r\n    perspective_d3fc_element.setSettings(config);\r\n}\r\n\r\nif (!Element.prototype.matches) {\r\n    Element.prototype.matches = Element.prototype.msMatchesSelector;\r\n}\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {register} from \"./plugin/plugin.js\";\nregister();\n"],"sourceRoot":""}