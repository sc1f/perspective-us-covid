!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("chevrotain"),require("lit-html"),require("core-js/modules/es.array.iterator"),require("core-js/modules/web.dom-collections.iterator"),require("@finos/perspective/dist/esm/config"),require("@finos/perspective"),require("core-js/modules/es.promise"),require("core-js/modules/es.string.replace"),require("core-js/modules/es.string.includes"),require("core-js/modules/es.regexp.to-string"),require("lodash/debounce"),require("awesomplete"),require("core-js/modules/es.array.reverse"),require("core-js/modules/es.string.trim"),require("core-js/modules/es.symbol.description"),require("lodash/isEqual"),require("core-js/modules/es.array-buffer.slice"),require("core-js/modules/es.typed-array.uint8-array"),require("core-js/modules/es.typed-array.to-locale-string"),require("core-js/modules/web.url"),require("@webcomponents/webcomponentsjs"),require("core-js/modules/es.string.match"),require("core-js/modules/es.string.split"),require("core-js/modules/es.symbol.replace"),require("core-js/modules/es.regexp.constructor"),require("core-js/modules/es.array.flat-map"),require("core-js/modules/es.array.sort"),require("core-js/modules/es.array.unscopables.flat-map"));else if("function"==typeof define&&define.amd)define(["chevrotain","lit-html","core-js/modules/es.array.iterator","core-js/modules/web.dom-collections.iterator","@finos/perspective/dist/esm/config","@finos/perspective","core-js/modules/es.promise","core-js/modules/es.string.replace","core-js/modules/es.string.includes","core-js/modules/es.regexp.to-string","lodash/debounce","awesomplete","core-js/modules/es.array.reverse","core-js/modules/es.string.trim","core-js/modules/es.symbol.description","lodash/isEqual","core-js/modules/es.array-buffer.slice","core-js/modules/es.typed-array.uint8-array","core-js/modules/es.typed-array.to-locale-string","core-js/modules/web.url","@webcomponents/webcomponentsjs","core-js/modules/es.string.match","core-js/modules/es.string.split","core-js/modules/es.symbol.replace","core-js/modules/es.regexp.constructor","core-js/modules/es.array.flat-map","core-js/modules/es.array.sort","core-js/modules/es.array.unscopables.flat-map"],t);else{var i="object"==typeof exports?t(require("chevrotain"),require("lit-html"),require("core-js/modules/es.array.iterator"),require("core-js/modules/web.dom-collections.iterator"),require("@finos/perspective/dist/esm/config"),require("@finos/perspective"),require("core-js/modules/es.promise"),require("core-js/modules/es.string.replace"),require("core-js/modules/es.string.includes"),require("core-js/modules/es.regexp.to-string"),require("lodash/debounce"),require("awesomplete"),require("core-js/modules/es.array.reverse"),require("core-js/modules/es.string.trim"),require("core-js/modules/es.symbol.description"),require("lodash/isEqual"),require("core-js/modules/es.array-buffer.slice"),require("core-js/modules/es.typed-array.uint8-array"),require("core-js/modules/es.typed-array.to-locale-string"),require("core-js/modules/web.url"),require("@webcomponents/webcomponentsjs"),require("core-js/modules/es.string.match"),require("core-js/modules/es.string.split"),require("core-js/modules/es.symbol.replace"),require("core-js/modules/es.regexp.constructor"),require("core-js/modules/es.array.flat-map"),require("core-js/modules/es.array.sort"),require("core-js/modules/es.array.unscopables.flat-map")):t(e.chevrotain,e["lit-html"],e["core-js/modules/es.array.iterator"],e["core-js/modules/web.dom-collections.iterator"],e["@finos/perspective/dist/esm/config"],e["@finos/perspective"],e["core-js/modules/es.promise"],e["core-js/modules/es.string.replace"],e["core-js/modules/es.string.includes"],e["core-js/modules/es.regexp.to-string"],e["lodash/debounce"],e.awesomplete,e["core-js/modules/es.array.reverse"],e["core-js/modules/es.string.trim"],e["core-js/modules/es.symbol.description"],e["lodash/isEqual"],e["core-js/modules/es.array-buffer.slice"],e["core-js/modules/es.typed-array.uint8-array"],e["core-js/modules/es.typed-array.to-locale-string"],e["core-js/modules/web.url"],e["@webcomponents/webcomponentsjs"],e["core-js/modules/es.string.match"],e["core-js/modules/es.string.split"],e["core-js/modules/es.symbol.replace"],e["core-js/modules/es.regexp.constructor"],e["core-js/modules/es.array.flat-map"],e["core-js/modules/es.array.sort"],e["core-js/modules/es.array.unscopables.flat-map"]);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}(window,(function(e,t,i,o,n,r,s,a,c,l,d,p,u,_,h,g,m,f,v,b,y,w,x,O,E,A,k,S){return function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=41)}([function(t,i){t.exports=e},function(e,t,i){"use strict";(function(e){i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"f",(function(){return c})),i.d(t,"e",(function(){return l})),i.d(t,"d",(function(){return d})),i.d(t,"a",(function(){return p}));i(18),i(3),i(15),i(8),i(12),i(4);function o(e,t,i){const o=function(e){const t=document.createElement("div");return t.innerHTML=e,Array.prototype.slice.call(t.children)[0]}(e);!function(e){if(e.content)return;let t;for(e.content=document.createDocumentFragment();t=e.firstChild;)Node.prototype.appendChild.call(e.content,t)}(o),t&&(o.innerHTML="<style>".concat(t.toString(),"</style>")+o.innerHTML),o.innerHTML='<style id="psp_styles" scope="'.concat(o.getAttribute("id"),'">test{}</style>')+o.innerHTML;for(let e of Object.getOwnPropertyNames(i.prototype)){let t=Object.getOwnPropertyDescriptor(i.prototype,e);if(t&&t.set){let o=t.set;t.set=function(t){this.hasAttribute(e)&&this.getAttribute(e)===t?(this._initializing||this._initialized)&&o.call(this,t):this.setAttribute(e,t)},Object.defineProperty(i.prototype,e,t)}}let n=o.getAttribute("id");console.log("Registered ".concat(n)),window.customElements.define(n,class extends i{attributeChangedCallback(e,t,o){null===o&&(o="null"),"_"!==e[0]&&t!=o&&Object.getOwnPropertyDescriptor(i.prototype,e).set&&(this[e]=o)}connectedCallback(){if(!this._initialized){this._initializing=!0;var e=document.importNode(o.content,!0);this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(e),super.connectedCallback&&super.connectedCallback();for(let e of Object.getOwnPropertyNames(i.prototype))"connectedCallback"!==e&&this.hasAttribute(e)&&"_"!==e[0]&&Object.getOwnPropertyDescriptor(i.prototype,e).set&&(this[e]=this.getAttribute(e));this._initializing=!1,this._initialized=!0}}static get observedAttributes(){return Object.getOwnPropertyNames(i.prototype)}})}function n(e,...t){const i=t.map(e=>e.toString()).join("\n");return function(t){return o(e,{toString:()=>i},t)}}function r(e){return function(t,i,o){const n=o.value;return o.set=function(t){let o=this.getAttribute(i);try{null!=t&&""!==t||(t=e()),"string"!=typeof t&&(t=JSON.stringify(t)),t!==o&&(o=t),o=JSON.parse(o)}catch(n){console.warn('Invalid value for attribute "'.concat(i,'": ').concat(t)),o=e()}n.call(this,o)},o.get=function(){return this.hasAttribute(i)?JSON.parse(this.getAttribute(i)):e()},delete o.value,delete o.writable,o}}function s(e){let t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}const a=()=>{let e,t=new Promise(t=>{e=t});return t.resolve=e,t};function c(e,t,i){const o=Symbol("private lock"),n=i.value;return i.value=async function(...e){if(this[o]&&(await this[o],this[o]))return void await this[o];let t;this[o]=a();try{t=await n.call(this,...e)}catch(e){console.error(e)}finally{const e=this[o];return this[o]=void 0,e.resolve(),t}},i}function l(e,...t){if(t[0]===t[1])return;if(t.every(e=>e.classList.contains("null-column")))return;let[i,o]=t.map(t=>Array.prototype.slice.call(e.children).indexOf(t));o<i&&([i,o]=[o,i],t=t.reverse()),e.insertBefore(t[1],t[0]),o+1===e.children.length?e.appendChild(t[0]):e.insertBefore(t[0],e.children[o+1])}const d=r(()=>({})),p=r(()=>[])}).call(this,i(17))},function(e,i){e.exports=t},function(e,t){e.exports=i},function(e,t){e.exports=o},function(e,t){e.exports=n},function(e,t,i){"use strict";(function(e){i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return c}));i(3),i(8),i(4);var o=i(2);function n(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n        <pre style="margin:0;overflow:scroll;position:absolute;width:100%;height:100%">',"</pre>\n    "]);return n=function(){return e},e}const r={},s=new class{registerPlugin(e,t){if(r[e])throw new Error('A perspective-viewer plugin "'.concat(e,'" has already been registered'));for(const i in r){const o=r[i];o&&o.name===t.name&&(console.warn('Conflicting plugin name "'.concat(t.name,'", qualifying with id')),o.name="".concat(o.name," [").concat(i,"]"),t.name="".concat(t.name," [").concat(e,"]"))}r[e]=t}getPlugin(e){return r[e]}getInstance(){return r}};e.registerPlugin=s.registerPlugin,e.getPlugin=s.getPlugin,e.__perspective_plugins__&&e.__perspective_plugins__.forEach(([t,i])=>e.registerPlugin(t,i));const a=e=>Object(o.html)(n(),e);function c(){e.registerPlugin("debug",{name:"Debug",create:async function(e){const t=await this._view.to_csv({config:{delimiter:"|"}}),i=this._render_time();Object(o.render)(a(t),e),i()},selectMode:"toggle",resize:function(){},delete:function(){}})}}).call(this,i(17))},function(e,t){e.exports=r},function(e,t){e.exports=s},function(e,t){e.exports=a},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",o=e[3];if(!o)return i;if(t&&"function"==typeof btoa){var n=(s=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),r=o.sources.map((function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"}));return[i].concat(r).concat([n]).join("\n")}var s;return[i].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},n=0;n<this.length;n++){var r=this[n][0];"number"==typeof r&&(o[r]=!0)}for(n=0;n<e.length;n++){var s=e[n];"number"==typeof s[0]&&o[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),t.push(s))}},t}},function(e,t){e.exports=c},function(e,t){e.exports=l},function(e,t){e.exports=d},function(e,t){e.exports=p},function(e,t){e.exports=u},function(e,t){e.exports=_},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t){e.exports=h},function(e,t,i){(e.exports=i(10)(!1)).push([e.i,'.awesomplete [hidden] {\n    display: none;\n}\n\n.awesomplete .visually-hidden {\n    position: absolute;\n    clip: rect(0, 0, 0, 0);\n}\n\n.awesomplete {\n    display: inline-block;\n    position: relative;\n}\n\n.awesomplete > input {\n    display: block;\n}\n\n.awesomplete > ul {\n    position: absolute;\n    left: 0;\n    z-index: 1;\n    min-width: 100%;\n    box-sizing: border-box;\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    background: #fff;\n}\n\n.awesomplete > ul:empty {\n    display: none;\n}\n\n.awesomplete > ul {\n\tborder-radius: .3em;\n\tmargin: .2em 0 0;\n\tbackground: hsla(0,0%,100%,.9);\n\tbackground: linear-gradient(to bottom right, white, hsla(0,0%,100%,.8));\n\tborder: 1px solid rgba(0,0,0,.3);\n\tbox-shadow: .05em .2em .6em rgba(0,0,0,.2);\n\ttext-shadow: none;\n}\n\n@supports (transform: scale(0)) {\n\t.awesomplete > ul {\n\t\ttransition: .3s cubic-bezier(.4,.2,.5,1.4);\n\t\ttransform-origin: 1.43em -.43em;\n\t}\n\t\n\t.awesomplete > ul[hidden],\n\t.awesomplete > ul:empty {\n\t\topacity: 0;\n\t\ttransform: scale(0);\n\t\tdisplay: block;\n\t\ttransition-timing-function: ease;\n\t}\n}\n\n\t/* Pointer */\n\t.awesomplete > ul:before {\n\t\tcontent: "";\n\t\tposition: absolute;\n\t\ttop: -.43em;\n\t\tleft: 1em;\n\t\twidth: 0; height: 0;\n\t\tpadding: .4em;\n\t\tbackground: white;\n\t\tborder: inherit;\n\t\tborder-right: 0;\n\t\tborder-bottom: 0;\n\t\t-webkit-transform: rotate(45deg);\n\t\ttransform: rotate(45deg);\n\t}\n\n\t.awesomplete > ul > li {\n\t\tposition: relative;\n\t\tpadding: .2em .5em;\n\t\tcursor: pointer;\n\t}\n\t\n\t.awesomplete > ul > li:hover {\n\t\tbackground: hsl(200, 40%, 80%);\n\t\tcolor: black;\n\t}\n\t\n\t.awesomplete > ul > li[aria-selected="true"] {\n\t\tbackground: hsl(205, 40%, 40%);\n\t\tcolor: white;\n\t}\n\t\n\t\t.awesomplete mark {\n\t\t\tbackground: hsl(65, 100%, 50%);\n\t\t}\n\t\t\n\t\t.awesomplete li:hover mark {\n\t\t\tbackground: hsl(68, 100%, 41%);\n\t\t}\n\t\t\n\t\t.awesomplete li[aria-selected="true"] mark {\n\t\t\tbackground: hsl(86, 100%, 21%);\n\t\t\tcolor: inherit;\n\t\t}\n',""])},function(e,t){e.exports='\x3c!--\r\n   \r\n   Copyright (c) 2017, the Perspective Authors.\r\n   \r\n   This file is part of the Perspective library, distributed under the terms of\r\n   the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n\r\n--\x3e\r\n\r\n<template id="perspective-row">\r\n    <div id="psp_row">\r\n        <span class=\'is_visible\'></span>\r\n        <div draggable=\'true\' class="row_draggable">\r\n            <span id=\'name\' class="column_name"></span>\r\n            <div class="row_computed">\r\n                <span id="row_edit"></span>\r\n            </div>\r\n            <span id="sort_order"></span>\r\n            <select id="column_aggregate" class="string"></select>\r\n            <select id="filter_operator"></select>\r\n            <input id="filter_operand" placeholder="Value" />\r\n            <span id="row_exclamation" hidden>&#x26A0;</span>\r\n            <span id=\'row_close\'>&#x2715;</span>\r\n        </div>\r\n    </div>\r\n</template>'},function(e,t,i){(e.exports=i(10)(!1)).push([e.i,':host{display:block;border:0 solid transparent}:host .row_computed{display:none;flex-direction:row}.dropping *{pointer-events:none}:host #psp_row{display:var(--psp_row-display,flex);margin:var(--psp_row-margin,0);overflow:visible;align-items:var(--column_selector--align-items,center);width:auto!important;height:auto!important;float:none!important}:host .is_visible{width:var(--column_selector--width,20px);min-width:var(--column_selector--width,20px);height:var(--is_visible--height,auto);cursor:var(--is_visible--cursor,pointer);font-size:var(--column_selector--font-size,14px);margin-top:-2px;display:var(--is_visible-display,none);color:var(--column-selector--color,#999);font-family:var(--column-selector--font-family,Arial)!important}:host #sort_order{display:none;font-family:var(--button--font-family,inherit);margin-right:4px;cursor:pointer;width:10px;display:var(--sort_order-display,none);padding:var(--sort_order-padding,0)}:host #sort_order:before{content:var(--row-sort-order--before, "-")}:host #sort_order:hover{color:var(--active--color,inherit)}:host #filter_operand{display:var(--filter_operand-display,none);margin:0;padding:0;height:19px;color:inherit;outline:0;border-color:var(--inactive--color,#ccc)}:host #filter_operator{margin:0 0 0 15px;display:var(--filter_operator-display,none);height:17px}:host #filter_operator:hover{color:var(--active--color,inherit)}@keyframes expand2{from{transform:translateX(10px)}}@keyframes expand3{from{transform:scale(.9)}}:host(:hover) .is_visible{color:var(--active--color,--column-selector--color)}:host #row_close{display:var(--row_close-display,inline);cursor:pointer;min-width:5px;max-width:5px;margin-right:3px;flex-grow:0;margin-left:3px;color:#999;font-family:Arial;font-size:10px}:host .is_visible:before{content:var(--is_visible--before,none)}:host #row_exclamation{color:red}:host #row_close:hover{color:var(--active--color,inherit)}:host .row_draggable select{border:none}:host .row_draggable select:focus{outline:0}:host select::-ms-expand{display:none}:host select{margin-left:15px;padding-right:15px;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;background:var(--select--background,url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNC45IDEwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0LjkgMTA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojQUFBQUFBO30KPC9zdHlsZT4KPHRpdGxlPmFycm93czwvdGl0bGU+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMS40LDQuNyAyLjUsMy4yIDMuNSw0LjcgIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMy41LDUuMyAyLjUsNi44IDEuNCw1LjMgIi8+Cjwvc3ZnPg==) no-repeat 95% 50%);background-color:var(--select--background-color,#fff);color:inherit;border-radius:5px;height:24px;padding:var(--column_type--padding,0 0 0 5px);font-size:12px}:host .awesomplete>ul{border-radius:0;margin:0;border:none;transition:none!important;background:var(--plugin--background,#fff)!important}:host .awesomplete>ul:before{content:none}:host .awesomplete>input,:host input{border-color:#ccc;border-width:0 0 1px;box-sizing:border-box;background-color:transparent}:host .row_draggable{animation:var(--row_draggable--animation,expand2 .5s ease-out);cursor:move;border-style:solid;background-color:var(--row_draggable-background-color,none);overflow:var(--row_draggable-overflow,visible);border-color:var(--row_draggable-border-color,none);border-width:var(--row_draggable-border-width,0);padding:var(--row_draggable-padding,0);font-size:12px;flex-grow:1;color:inherit;transition:height .2s;box-sizing:border-box;height:var(--row_draggable-height,21px);min-height:var(--row_draggable-height,21px);display:var(--row_draggable-display,flex);align-items:var(--row-draggable--align-items);flex-direction:var(--row-draggable--flex-direction,column);justify-content:var(--row_draggable--justify-content,center);margin:var(--row_draggable--margin,0);transition:var(--row_draggable--transition,none)}:host .row_draggable *{opacity:var(--row_draggable_children-opacity,1)}:host .row_draggable select{margin:0 0 0 27px}:host ul{transition:background-color .2s,border-color .2s}:host(.null-column) .is_visible{opacity:0!important}:host(.null-column) .row_draggable{background-color:var(--null--background,transparent)!important;border-color:#ccc!important;border-width:0 0 1px!important}:host([drop-target]) .row_draggable{background-color:var(--active--background,#f0f0ff)!important;animation:var(--drop-target--animation,var(--row_draggable--animation,expand3 .5s ease-out));border:none!important}:host .float:before,:host .integer:before{content:var(--float--column-type--content, var(--column-type--content, "123"));color:var(--float--column-type--color,var(--column-type--color,#016bc6))}:host .string:before{content:var(--string--column-type--content, var(--column-type--content, "abc"));color:var(--string--column-type--color,var(--column-type--color,#fe9292))}:host .boolean:before{content:var(--boolean--column-type--content, var(--column-type--content, "t/f"));color:var(--boolean--column-type--color,var(--column-type--color,#999))}:host .date:before{content:var(--date--column-type--content, var(--column-type--content, "mdy"));color:var(--date--column-type--color,var(--column-type--color,#999))}:host .datetime:before{content:var(--datetime--column-type--content, var(--column-type--content, "mdy"));color:var(--datetime--column-type--color,var(--column-type--color,#999))}:host .column_name{overflow:hidden;max-width:var(--column_name-max-width,none);white-space:nowrap;text-overflow:ellipsis}:host span#name:before{font-family:var(--interface-monospace--font-family,monospace);position:relative;display:inline-block;padding:var(--column_type--padding,0 5px);min-width:18px;display:var(--name-before-display,none);width:var(--column_type--width,auto)}:host #column_aggregate{display:var(--column_aggregate-display,none);font-size:10px;font-family:Arial,sans-serif;width:88%;height:20px}:host span#name{flex:var(--column-name--flex,0 1 auto);width:100%;white-space:nowrap;margin:var(--column_name-margin,0)}',""])},function(e,t){e.exports='\x3c!--\n\nCopyright (c) 2017, the Perspective Authors.\n\nThis file is part of the Perspective library, distributed under the terms of\nthe Apache License 2.0.  The full license can be found in the LICENSE file.\n\n--\x3e\n\n<template id="perspective-computed-expression-editor">\n    <div id="psp-expression__body">\n        <div class="psp-expression__container">\n            <span id="psp-expression-close" aria-label="Close Expression Editor">&times;</span>\n            <div class="psp-expression__content psp-expression__content--nomargin">\n                <textarea placeholder="Write an expression" autocomplete="off" id="psp-expression-input"></textarea>\n                <div class="psp-expression__label psp-expression__error" id="psp-expression-error"></div>\n            </div>\n        </div>\n        <div id="psp-expression-actions">\n            <button id="psp-expression-button-remove" class="psp-expression__button" disabled>Remove All</button>\n            <button id="psp-expression-button-save" class="psp-expression__button" disabled>Save</button>\n        </div>\n    </div>\n</template>'},function(e,t,i){(e.exports=i(10)(!1)).push([e.i,":host{display:none;flex-direction:column;max-height:35%;margin-top:34px;margin-bottom:24px;width:100%;flex:0 0 auto!important}:host *{box-sizing:border-box}:host #psp-expression__body,:host .psp-expression__container{display:flex;flex-direction:column}:host #psp-expression__body.row,:host .psp-expression__container.row{align-items:center;flex-direction:row}:host .psp-expression__container:first-of-type{margin-bottom:0}:host .psp-expression__content{align-items:center;display:flex;margin-top:5px}:host .psp-expression__content.psp_expression__content--absolute{position:absolute}:host .psp-expression__content.psp-expression__content--nomargin{margin-top:0;position:relative}:host #psp-expression-actions{display:flex;justify-content:flex-end;margin-left:20px;margin-top:12px}:host span#psp-expression-close{color:#666;padding-left:3px}:host span#psp-expression-close:hover{cursor:pointer}:host textarea#psp-expression-input{background:var(--background-color,none);border-color:var(--inactive-color,#ccc);color:var(--color,#666);font-size:12px;font-family:var(--interface-monospace--font-family,monospace);height:75px;margin-top:5px;padding-left:5px;resize:auto;overflow:auto;width:100%}:host .psp-expression__label{color:var(--color,#a9a9a9);font-size:10px;margin-top:5px;max-width:100%}:host .psp-expression__label.psp-expression__error{background-color:#cb4549;box-sizing:border-box;color:#fff!important;display:none;position:absolute;z-index:10000;max-height:75px;padding:10px;overflow-x:hidden;overflow-y:scroll;top:100%;width:100%;word-break:break-word}:host .psp-expression__button{border-radius:0;border-bottom:1px solid #ccc;border-left:0;border-right:0;border-top:0;font-size:12px;margin-left:6px;padding:2px 5px}:host .psp-expression__button:hover{cursor:pointer}:host .psp-expression__button[disabled]{background:#666!important;color:#a0a0a0!important;cursor:not-allowed;border-bottom-color:#000!important;opacity:.5}:host .psp-expression__button#psp-expression-button-remove{background:#e76056;border-bottom-color:#bf4d45;color:#fff;display:none}:host .psp-expression__button#psp-expression-button-remove:active{background:#bf4d45;border-bottom-color:#9d3f39}:host .psp-expression__button#psp-expression-button-save{background:#0171d2;border-bottom-color:#0160b1;color:#fff;height:22px}:host .psp-expression__button#psp-expression-button-save:active{background:#0160b1;border-bottom-color:#014986}",""])},function(e,t){e.exports='\x3c!--\r\n   \r\n   Copyright (c) 2017, the Perspective Authors.\r\n   \r\n   This file is part of the Perspective library, distributed under the terms of\r\n   the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n\r\n--\x3e\r\n\r\n<template id="perspective-viewer">\r\n\r\n    <div id="app">\r\n        <div id="menubar">\r\n            <div id="copy_button" class="noselect button" title="Copy CSV"></div>\r\n            <div id="download_button" class="noselect button" title="Download CSV"></div>\r\n            <div id="reset_button" class="noselect button" title="Reset Viewer"></div>\r\n        </div>\r\n        <div id=\'side_panel\' class="column fixed noselect">\r\n            <div id="vis_selector_container">\r\n                <select id="vis_selector">\r\n                </select>\r\n            </div>\r\n            <div id="columns_container" style="visibility: hidden">\r\n                <ul id=\'active_columns\'></ul>\r\n                <div id="sub_columns">\r\n                    <ul id=\'inactive_columns\'></ul>\r\n                    <div id="side_panel__actions" style="visibility: hidden">\r\n                        <div id="add-computed-expression" class="side_panel-action"><span class="psp-icon psp-icon__add"></span><span class="psp-title__columnName">New Column</span></div>\r\n                    </div>\r\n                </div>\r\n                <perspective-computed-expression-editor></perspective-computed-expression-editor>\r\n            </div>\r\n            <div id="resize_bar"></div>\r\n        </div>\r\n        <div class="column noselect">\r\n            <div id=\'top_panel\'>\r\n                <div class="rrow">\r\n                    <div id="row_pivots">\r\n                        <div class="psp-text-field">\r\n                            <ul class="psp-text-field__input" for="row-pivots"></ul>\r\n                            <label for="row_pivots"></label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <span id="transpose_button" class="rrow centered" title="Transpose Pivots">&#x21C4;</span>\r\n                <div class="rrow">\r\n                    <div id="column_pivots">\r\n                        <div class="psp-text-field">\r\n                            <ul class="psp-text-field__input" for="column-pivots"></ul>\r\n                            <label for="column_pivots"></label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="rrow">\r\n                    <div id="sort">\r\n                        <div class="psp-text-field">\r\n                            <ul class="psp-text-field__input" for="sort"></ul>\r\n                            <label for="sort"></label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="rrow" style=\'flex-grow:3;height:auto;flex:1 1 400px;max-width:none\'>\r\n                    <div id="filters">\r\n                        <div class="psp-text-field">\r\n                            <ul class="psp-text-field__input" for=\'filters\'></ul>\r\n                            <label for="filters"></label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div id="pivot_chart_container">\r\n                <div class="plugin_information plugin_information--warning hidden" id="plugin_information--size">\r\n                    <span class="plugin_information__text" id="plugin_information_count">Estimated rendering</span>\r\n                    <span class="plugin_information__actions">\r\n                        <span class="plugin_information__action">Render all points</span>\r\n                        <span class="plugin_information__action--close" id="close_button"></span>\r\n                    </span>\r\n                </div>\r\n                <div id="pivot_chart"></div>\r\n            </div>\r\n        </div>\r\n\r\n        <div id="config_button" class="noselect button" title="Right click for additional options"></div>\r\n\r\n        <div id=\'drop_target\'>\r\n            <div id=\'drop_target_inner\'>\r\n\r\n            </div>\r\n        </div>\r\n\r\n        <slot></slot>\r\n    </div>\r\n\r\n</template>'},function(e,t,i){(e.exports=i(10)(!1)).push([e.i,':host #app #top_panel #row_pivots label:before{content:var(--row_pivots--before, "Row Pivots")}:host #app #top_panel #column_pivots label:before{content:var(--column_pivots--before, "Column Pivots")}:host #app #top_panel #sort label:before{content:"Sort"}:host #app #top_panel #filters label:before{content:"Filter"}:host #app #side_panel #active_columns perspective-row:before{font-size:10px;margin-left:var(--column_selector--width,20px);left:1px;padding:var(--column_type--padding,0 0 0 5px);color:var(--inactive--color,#666);position:absolute;margin-top:-15px}:host:hover #config_button{opacity:1}#config_button{background:0 0;opacity:1!important}.button{padding:var(--button--padding,12px 14px 24px 8px)}[settings=true] #config_button{opacity:1!important}@keyframes expand{from{opacity:0}}:host{position:relative;display:inline-block;overflow:hidden;word-wrap:normal;--highcharts-full--gradient:linear-gradient(#4d342f 0%, #e4521b 22.5%, #feeb65 42.5%, #f0f0f0 50%, #dcedc8 57.5%, #42b3d5 67.5%, #1a237e 100%);--highcharts-positive--gradient:linear-gradient(#dcedc8 0%, #42b3d5 35%, #1a237e 100%);--highcharts-negative--gradient:linear-gradient(#feeb65 100%, #e4521b 70%, #4d342f 0%);--hypergrid-tree-header--background:#fff;--hypergrid-tree-header--color:#666;--hypergrid-header--background:#fff;--hypergrid-separator--color:#666;--hypergrid-header--color:#666;--hypergrid-positive--color:#1078d1;--hypergrid-negative--color:#ff8888;--hypergrid--font-size:12px;--hypergrid-header--font-size:12px;--hypergrid--font-family:Helvetica,Arial,sans-serif;--hypergrid-header--font-family:Helvetica,Arial,sans-serif;--hypergrid-row-hover--background:#f6f6f6;--hypergrid-row-hover--color:#666;--hypergrid-cell-hover--background:#eeeeee;--hypergrid-cell-hover--color:#666;--integer--hypergrid--text-align:right;--float--hypergrid--text-align:right;--d3fc-series:rgba(31, 119, 180, 0.5);--d3fc-series-1:#0366d6;--d3fc-series-2:#ff7f0e;--d3fc-series-3:#2ca02c;--d3fc-series-4:#d62728;--d3fc-series-5:#9467bd;--d3fc-series-6:#8c564b;--d3fc-series-7:#e377c2;--d3fc-series-8:#7f7f7f;--d3fc-series-9:#bcbd22;--d3fc-series-10:#17becf;--d3fc-full--gradient:linear-gradient(#4d342f 0%, #e4521b 22.5%, #feeb65 42.5%, #f0f0f0 50%, #dcedc8 57.5%, #42b3d5 67.5%, #1a237e 100%);--d3fc-positive--gradient:linear-gradient(#dcedc8 0%, #42b3d5 35%, #1a237e 100%);--d3fc-negative--gradient:linear-gradient(#feeb65 100%, #e4521b 70%, #4d342f 0%)}:host #pivot_chart{position:absolute;width:100%;height:100%;display:grid;justify-content:stretch}:host .hidden{display:none}:host .psp-icon{color:#999}:host .psp-icon:hover{cursor:pointer}:host .psp-icon__add{display:flex;width:20px;min-width:20px;margin-top:-2px;height:0;font-family:var(--column-add--font-family,inherit)}:host .psp-icon__add:before{font-feature-settings:"liga";content:var(--column-add--before, "+")}:host .psp-title__columnName{display:flex;margin-left:34px;margin-top:3px;font-size:12px;color:#666}:host .side_panel-action:hover{cursor:pointer}:host *{box-sizing:border-box;line-height:1.42857143}:host #app{display:flex;position:relative;width:100%;height:100%}:host #app.hide_message #drop_target{display:none}:host .chart{padding:15px}:host #pivot_chart_container{flex-grow:1;position:relative;border:var(--plugin--border,none);overflow:hidden}:host .config{display:flex}:host #column_pivots #psp_row,:host #filters #psp_row,:host #row_pivots #psp_row,:host #sort #psp_row{display:inline}:host ul{min-height:20px;padding:0;margin:0;font-size:12px}:host #active_columns perspective-row{animation:.3s ease-out expand;--column-selector--color:var(--active--color, #999);--is_visible--before:var(--active-column-selector--content, "\\25CF")}:host #inactive_columns perspective-row{animation:.3s ease-out expand;--column-selector--color:var(--inactive-column-selector--color, #999);--is_visible--before:var(--inactive-column-selector--content, "\\25CB");--row_draggable--animation:none;opacity:var(--inactive-column--opacity,1);transition:opacity .3s}:host #inactive_columns perspective-row:hover{transition:none;opacity:1}:host #top_panel perspective-row{animation:.3s ease-out expand;--column-name--flex:1;padding:0 10px 0 0;margin-bottom:-1px;display:var(--top-panel-row--display,inline-block);--psp_row-display:inline-block}:host #active_columns,:host #inactive_columns{list-style:none;padding:0;width:100%;margin:var(--column-container--margin,8px 0 0 0);overflow-y:auto;overflow-x:hidden;position:relative}:host #inactive_columns perspective-row.active{--row_draggable--margin:0px 0px 0px 10px;opacity:0;height:0!important;overflow:hidden}:host .columns_horizontal #sub_columns.collapse #side_panel__actions{margin-top:0}:host #sub_columns{min-height:33.3%;flex-shrink:100000;display:flex;flex-direction:column;overflow-x:hidden;width:100%}:host #sub_columns.collapse{flex-shrink:0;min-height:64px}:host #sub_columns.collapse #inactive_columns{display:none}:host .column{display:flex;list-style:none;flex-direction:column;flex:1}:host .rrow{display:flex;flex-grow:1;min-height:24px;align-items:center;max-width:400px;list-style:none;min-width:140px;margin:var(--column-drop-container--margin,5px 10px 0 0)}:host .rrow>div{display:flex;min-height:24px;flex-direction:column;justify-content:flex-end}:host #top_panel>.rrow>*{width:100%;padding:12px 0;margin:-12px 0}:host .rrow #psp_row{white-space:nowrap}:host #sort perspective-row{--sort_order-display:inline;--sort_order-padding:0 0 0 4px}:host #sort perspective-row[sort-order=asc]{--row-sort-order--before:var(--sort-order-asc--before, "\\2191")}:host #sort perspective-row[sort-order=desc]{--row-sort-order--before:var(--sort-order-desc--before, "\\2193")}:host #sort perspective-row[sort-order=none]{--row-sort-order--before:var(--sort-order-none--before, "-")}:host #sort perspective-row[sort-order="asc abs"]{--row-sort-order--before:var(--sort-order-asc-abs--before, "\\21E7")}:host #sort perspective-row[sort-order="desc abs"]{--row-sort-order--before:var(--sort-order-desc-abs--before, "\\21E9")}:host #sort perspective-row[sort-order="col asc"]{--row-sort-order--before:var(--sort-order-col-asc--before, "\\2192")}:host #sort perspective-row[sort-order="col desc"]{--row-sort-order--before:var(--sort-order-col-desc--before, "\\2190")}:host #sort perspective-row[sort-order="col asc abs"]{--row-sort-order--before:var(--sort-order-col-asc-abs--before, "\\21E8")}:host #sort perspective-row[sort-order="col desc abs"]{--row-sort-order--before:var(--sort-order-col-desc-abs--before, "\\21E6")}:host #top_panel perspective-row::after{content:","}:host #top_panel perspective-row:last-child::after{display:none;content:""!important}:host label{white-space:nowrap;display:inline-block;vertical-align:middle;margin-bottom:0}:host #drop_target{position:absolute;left:0;top:0;right:0;bottom:0;padding:30px}:host #drop_target_inner{width:100%;height:100%;display:flex;align-items:center;justify-content:center}:host #drop_target_inner h3{font-weight:300}:host #config_button{position:absolute;top:0;left:0;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}:host #config_button:hover{color:var(--active--color,inherit)}:host .button{cursor:pointer;font-size:16px;font-weight:400}:host select::-ms-expand{display:none}:host select{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;background:var(--select--background,url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNC45IDEwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0LjkgMTA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojQUFBQUFBO30KPC9zdHlsZT4KPHRpdGxlPmFycm93czwvdGl0bGU+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMS40LDQuNyAyLjUsMy4yIDMuNSw0LjcgIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMy41LDUuMyAyLjUsNi44IDEuNCw1LjMgIi8+Cjwvc3ZnPg==) no-repeat 95% 50%);background-color:#fff;color:inherit;border-radius:5px;height:24px;padding:var(--select--padding,0 0 0 6px);font-size:12px;font-family:inherit}:host input{padding:0 10px}:host .centered{display:flex;align-items:center;justify-content:center}:host #top_panel{display:flex;flex-wrap:wrap;justify-content:flex-start;padding:var(--top_panel--padding,5px 0 10px 0);max-width:1000px;z-index:1}:host #side_panel{position:relative;flex:0 0 auto;padding:var(--side_panel--padding,10px 10px 0 11px)}:host #side_panel>div{display:flex}:host #vis_selector_container{min-height:29px;margin-left:var(--column_selector--width,20px);overflow:hidden}:host #vis_selector{flex-grow:1}:host #transpose_button{cursor:pointer;min-width:5px;max-width:5px;flex-grow:0;color:#999;font-family:Arial;font-size:12px}:host #transpose_button:hover{color:var(--active--color,inherit)}:host #resize_bar{position:absolute;top:0;right:0;bottom:0;width:8px;cursor:col-resize}',""])},function(e,t,i){(e.exports=i(10)(!1)).push([e.i,'.psp-text-field{position:relative;background-color:var(--column-drop-container--background,#fff);border-width:0 0 1px;border-style:solid;border-color:var(--inactive--color,#ccc);display:flex;flex-direction:column;justify-content:flex-end;min-height:24px;transition:border-color .3s ease-out}:host(.dragging) .psp-text-field.dropping{border-bottom-width:2px;border-style:solid;border-color:var(--active--color,#1a7da1)}:host(.dragging) .psp-text-field{border-bottom-width:1px;border-style:solid;border-color:var(--active--color,#1a7da1)}.psp-text-field>.psp-text-field__input{border:0;line-height:20px;vertical-align:bottom;padding-bottom:0;display:none}.psp-text-field__input+label{height:var(--column--height,auto);line-height:17px;box-sizing:border-box;color:var(--inactive--color,#ccc);font-weight:400;white-space:nowrap;padding:var(--column-drop-container--padding,0 0 2px 10px);font-size:12px;display:inline-block;transition:font-size .3s,margin .3s}.dropping .psp-text-field__input,.psp-text-field__input:not(:empty){display:block!important}.dropping .psp-text-field__input::after{content:"|";width:0;overflow:visible;margin-top:-1px;position:absolute}.dropping *{pointer-events:none}.dropping .psp-text-field label,.psp-text-field__input:not(:empty)+label{position:absolute;top:0;margin:var(--column-drop-label--margin,0);font-size:var(--column-drop-label--font-size,12px);display:var(--column-drop-label--display,none)}.dropping perspective-row.inserting{border-top:25px solid transparent}.dropping perspective-row.postserting{border-bottom:25px solid transparent}:host perspective-row{height:var(--column--height,21px);--row_draggable-height:var(--column--height, 21px)}:host([row-pivots]) #active_columns perspective-row{height:var(--active-column--height,41px);min-height:var(--active-column--height,41px);--row_draggable-height:var(--active-column--height, 41px);--column_aggregate-display:inline-block;--is_visible--height:var(--active-column-selector--height, auto)}:host{font-family:Arial,sans-serif;background-color:#eee;color:#333}:host #app.columns_horizontal #columns_container{flex-direction:row-reverse}:host #app.columns_horizontal #active_columns,:host #app.columns_horizontal #inactive_columns{display:flex;flex-direction:column;flex:0 1 auto;width:100%}:host #app.columns_horizontal #inactive_columns{flex:1 1 auto}:host #app.columns_horizontal #sub_columns{flex-shrink:1}:host #app.columns_horizontal #sub_columns perspective-row{--column_name-margin:0 25px 0 0}:host #app.columns_horizontal #side_panel #divider{display:none}:host #app.columns_horizontal perspective-computed-expression-editor{max-height:none;margin-right:24px;width:auto}:host #side_panel perspective-row{--name-before-display:inline-block;--is_visible-display:inline-block;--row_draggable-padding:0px 10px 0px 0px;--row_close-display:none;--column_name-max-width:180px}:host #top_panel perspective-row{--row_draggable-display:inline-flex;--row-draggable--flex-direction:row;--row-draggable--align-items:center}:host #columns_container{flex-direction:column;height:calc(100% - 29px)}:host #columns_container #active_columns{flex:0 1 auto}:host #columns_container #active_columns perspective-row{margin-bottom:2px;--row_draggable-background-color:var(--column--background, white);--row_draggable-border-color:var(--inactive--color, #ccc);--row_draggable-border-width:0 0 1px 0;--row_draggable-overflow:hidden;--row_draggable--justify-content:space-evenly}:host #columns_container #active_columns perspective-row:last-child{--row_draggable-border-width:var(--row_draggable-border-last-child-width, 0 0 1px 0)}:host #columns_container #active_columns perspective-row[drop-target]{--row_draggable_children-opacity:0}:host #columns_container #active_columns perspective-row.null-column{--row_draggable_children-opacity:0;pointer-events:none}:host #columns_container #active_columns.one_lock perspective-row:first-child,:host #columns_container #active_columns.two_lock perspective-row:first-child{--active--color:#ccc;--is_visible--cursor:normal}:host #columns_container #active_columns.two_lock perspective-row:nth-child(2){--active--color:#ccc;--is_visible--cursor:normal}:host #columns_container #active_columns perspective-row:only-child{--active--color:#ccc;--is_visible--cursor:normal}:host #columns_container #active_columns,:host #columns_container #inactive_columns{border:none!important}:host ul{transition:background-color .2s,border-color .2s;outline:0;border-style:solid;border-color:var(--inactive--color,#ccc);font-size:12px;padding:var(--column-drop-container--padding,0 10px 0 10px);border-width:0 0 1px}:host #side_panel #side_panel__actions{display:flex;flex-direction:column;flex-shrink:1000;justify-content:flex-start;position:relative;overflow-y:hidden;width:100%;padding-top:20px;margin:var(--column-container--margin,8px);min-height:36px}:host #side_panel #side_panel__actions button.side_panel-action{align-items:center;align-content:center;background:0 0;border:none;display:flex;flex-direction:row;font-size:12px;padding-right:10px;-webkit-appearance:none;-moz-appearance:none;appearance:none}:host #side_panel #side_panel__actions button.side_panel-action span{margin-left:5px;font-size:15px}:host #side_panel #side_panel__actions button.side_panel-action:hover{cursor:pointer}:host .noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}:host svg .highcharts-legend-box{fill:none}:host #pivot_chart{background-color:var(--plugin--background,#fff)}:host #drop_target{border:var(--plugin--border,none);background:var(--plugin--background,#fff)}:host #pivot_chart_container{box-shadow:var(--plugin--box-shadow,none)}:host #filters perspective-row{margin:0;--filter_operator-display:inline-block;--filter_operand-display:inline-block}:host .plugin_information{color:var(--warning--color,inherit);display:flex;position:absolute;flex-direction:row;justify-content:flex-start;padding:.5rem;width:100%;z-index:10000;transition:opacity .3s ease-out;opacity:1}:host .plugin_information.hidden{display:none;opacity:0}:host .plugin_information.plugin_information--warning{background:#ffca28}:host .plugin_information .plugin_information__text{font-size:12px;margin-right:.25rem;display:flex;flex-wrap:wrap;align-items:center}:host .plugin_information .plugin_information__text:before{content:var(--overflow_hint--before);font-family:var(--overflow_hint--font-family);color:var(--overflow_hint--color);padding:var(--overflow_hint--padding);font-size:16px}:host .plugin_information .plugin_information__action{font-size:12px;text-decoration:underline;cursor:pointer;margin-right:.25rem}:host .plugin_information .plugin_information__action--close{margin-left:12px;display:inline-flex;font-size:12px;cursor:pointer}:host .plugin_information .plugin_information__actions{margin-left:auto;display:flex;align-items:center;flex-direction:row;justify-content:flex-start}:host .plugin_information .plugin_information--overflow-hint-percent{font-weight:700}:host .plugin_information .plugin_information--overflow-hint{white-space:nowrap}:host #drop_target_inner h3{color:#aaa;font-weight:300}:host #config_button,:host #copy_button,:host #download_button,:host #reset_button{font-weight:400;font-family:var(--button--font-family,Arial);color:var(--inactive--color,#999);font-size:var(--button--font-size,16px);transition:opacity .3s;overflow:hidden}:host #config_button:hover,:host #copy_button:hover,:host #download_button:hover,:host #reset_button:hover{color:var(--active--color,inherit)}:host #config_button:before{font-feature-settings:"liga";content:var(--settings-button--content, "\\1F527")}:host #reset_button:before{font-feature-settings:"liga";content:var(--reset_button--before, "Reset")}:host #close_button:before{font-family:var(--button--font-family,Arial);font-feature-settings:"liga";content:var(--close_button--before, "Close")}:host #download_button:before{font-feature-settings:"liga";content:var(--download_button--before, "Save")}:host #copy_button:before{font-feature-settings:"liga";content:var(--copy_button--before, "Copy")}:host #menubar{display:none;flex-direction:column;padding-top:55px}:host #app.show_menu #menubar{display:flex}:host select{border-radius:0;background-color:var(--select--background-color,#fff);border-style:solid;border-color:var(--inactive--color,#ccc);border-width:0 0 1px}:host select:focus{outline:0}:host input{border-style:solid;border-color:var(--inactive--color,#ccc);border-width:0 0 1px}:host input::placeholder{color:var(--inactive--color,#ccc)}:host option[value=""]{color:#fff!important}:host #app{background-color:inherit}:host ::-webkit-scrollbar,:host ::shadow ::-webkit-scrollbar{width:12px}:host ::-webkit-scrollbar-thumb,:host ::shadow ::-webkit-scrollbar-thumb{background:#ccc}:host ::-webkit-scrollbar-track,:host ::shadow ::-webkit-scrollbar-track{background:0 0}',""])},function(e,t){e.exports=g},function(e,t){e.exports=m},function(e,t){e.exports=f},function(e,t){e.exports=v},function(e,t){e.exports=b},function(e,t){e.exports=y},function(e,t,i){i(3),i(9),i(4);const o="dnd-poly-snapback",n="dnd-poly-dragstart-pending",r="dnd-poly-dragstart-cancel",s=["none","copy","copyLink","copyMove","link","linkMove","move","all"],a=["none","copy","move","link"];const c=function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return e}();function l(e){return e&&e.tagName}function d(e,t,i){void 0===i&&(i=!0),document.addEventListener(e,t,!!c&&{passive:i})}function p(e,t){document.removeEventListener(e,t)}function u(e,t,i,o){void 0===o&&(o=!1);const n=c?{passive:!0,capture:o}:o;return e.addEventListener(t,i,n),{off:function(){e.removeEventListener(t,i,n)}}}function _(e){return 0===e.length?0:e.reduce((function(e,t){return t+e}),0)/e.length}function h(e,t){for(let i=0;i<e.changedTouches.length;i++){if(e.changedTouches[i].identifier===t)return!0}return!1}function g(e,t,i){const o=[],n=[];for(let i=0;i<t.touches.length;i++){const r=t.touches[i];o.push(r[e+"X"]),n.push(r[e+"Y"])}i.x=_(o),i.y=_(n)}const m=["","-webkit-"];function f(e,t,i,o,n){void 0===n&&(n=!0);let r=t.x,s=t.y;o&&(r+=o.x,s+=o.y),n&&(r-=parseInt(e.offsetWidth,10)/2,s-=parseInt(e.offsetHeight,10)/2);const a="translate3d("+r+"px,"+s+"px, 0)";for(let t=0;t<m.length;t++){const o=m[t]+"transform";e.style[o]=a+" "+i[t]}}const v=function(){function e(e,t){this._dataStore=e,this._setDragImageHandler=t,this._dropEffect=a[0]}return Object.defineProperty(e.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(e){0!==this._dataStore.mode&&s.indexOf(e)>-1&&(this._dropEffect=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){if(0!==this._dataStore.mode)return Object.freeze(this._dataStore.types)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effectAllowed",{get:function(){return this._dataStore.effectAllowed},set:function(e){2===this._dataStore.mode&&s.indexOf(e)>-1&&(this._dataStore.effectAllowed=e)},enumerable:!0,configurable:!0}),e.prototype.setData=function(e,t){if(2===this._dataStore.mode){if(e.indexOf(" ")>-1)throw new Error("illegal arg: type contains space");this._dataStore.data[e]=t,-1===this._dataStore.types.indexOf(e)&&this._dataStore.types.push(e)}},e.prototype.getData=function(e){if(1===this._dataStore.mode||2===this._dataStore.mode)return this._dataStore.data[e]||""},e.prototype.clearData=function(e){if(2===this._dataStore.mode){if(e&&this._dataStore.data[e]){delete this._dataStore.data[e];const t=this._dataStore.types.indexOf(e);return void(t>-1&&this._dataStore.types.splice(t,1))}this._dataStore.data={},this._dataStore.types=[]}},e.prototype.setDragImage=function(e,t,i){2===this._dataStore.mode&&this._setDragImageHandler(e,t,i)},e}();function b(e,t){return e?e===s[0]?a[0]:0===e.indexOf(s[1])||e===s[7]?a[1]:0===e.indexOf(s[4])?a[3]:e===s[6]?a[2]:a[1]:3===t.nodeType&&"A"===t.tagName?a[3]:a[1]}function y(e,t,i,o,n,r,s){void 0===r&&(r=!0),void 0===s&&(s=null),console.log("dnd-poly: dispatching "+e);const a=function(e,t,i,o,n,r,s){void 0===s&&(s=null);const a=t.changedTouches[0],c=new Event(i,{bubbles:!0,cancelable:o});c.dataTransfer=r,c.relatedTarget=s,c.screenX=a.screenX,c.screenY=a.screenY,c.clientX=a.clientX,c.clientY=a.clientY,c.pageX=a.pageX,c.pageY=a.pageY;const l=e.getBoundingClientRect();return c.offsetX=c.clientX-l.left,c.offsetY=c.clientY-l.top,c}(t,i,e,r,document.defaultView,n,s),c=!t.dispatchEvent(a);return o.mode=0,c}function w(e,t){if(!e||e===s[7])return t;if(t===a[1]){if(0===e.indexOf(a[1]))return a[1]}else if(t===a[3]){if(0===e.indexOf(a[3])||e.indexOf("Link")>-1)return a[3]}else if(t===a[2]&&(0===e.indexOf(a[2])||e.indexOf("Move")>-1))return a[2];return a[0]}const x=function(){function e(e,t,i,o){this._initialEvent=e,this._config=t,this._sourceNode=i,this._dragOperationEndedCb=o,this._dragOperationState=0,this._immediateUserSelection=null,this._currentDropTarget=null,console.log("dnd-poly: setting up potential drag operation.."),this._lastTouchEvent=e,this._initialTouch=e.changedTouches[0],this._touchMoveHandler=this._onTouchMove.bind(this),this._touchEndOrCancelHandler=this._onTouchEndOrCancel.bind(this),d("touchmove",this._touchMoveHandler,!1),d("touchend",this._touchEndOrCancelHandler,!1),d("touchcancel",this._touchEndOrCancelHandler,!1)}return e.prototype._setup=function(){const e=this;console.log("dnd-poly: starting drag and drop operation"),this._dragOperationState=1,this._currentDragOperation=a[0],this._dragDataStore={data:{},effectAllowed:void 0,mode:3,types:[]},this._currentHotspotCoordinates={x:null,y:null},this._dragImagePageCoordinates={x:null,y:null};let t=this._sourceNode;if(this._dataTransfer=new v(this._dragDataStore,(function(i,o,n){t=i,"number"!=typeof o&&"number"!=typeof n||(e._dragImageOffset={x:o||0,y:n||0})})),this._dragDataStore.mode=2,this._dataTransfer.dropEffect=a[0],y("dragstart",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer))return console.log("dnd-poly: dragstart cancelled"),this._dragOperationState=3,this._cleanup(),!1;g("page",this._lastTouchEvent,this._dragImagePageCoordinates);const i=this._config.dragImageSetup(t);var o;if(this._dragImageTransforms=(o=i,m.map((function(e){const t=o.style[e+"transform"];return t&&"none"!==t?t.replace(/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,""):""}))),i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.zIndex="999999",i.classList.add("dnd-poly-drag-image"),i.classList.add("dnd-poly-icon"),this._dragImage=i,!this._dragImageOffset)if(this._config.dragImageOffset)this._dragImageOffset={x:this._config.dragImageOffset.x,y:this._config.dragImageOffset.y};else if(this._config.dragImageCenterOnTouch){const e=getComputedStyle(t);this._dragImageOffset={x:0-parseInt(e.marginLeft,10),y:0-parseInt(e.marginTop,10)}}else{const e=t.getBoundingClientRect(),i=getComputedStyle(t);this._dragImageOffset={x:e.left-this._initialTouch.clientX-parseInt(i.marginLeft,10)+e.width/2,y:e.top-this._initialTouch.clientY-parseInt(i.marginTop,10)+e.height/2}}return f(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch),document.body.appendChild(this._dragImage),this._iterationIntervalId=window.setInterval((function(){e._iterationLock?console.log("dnd-poly: iteration skipped because previous iteration hast not yet finished."):(e._iterationLock=!0,e._dragAndDropProcessModelIteration(),e._iterationLock=!1)}),this._config.iterationInterval),!0},e.prototype._cleanup=function(){console.log("dnd-poly: cleanup"),this._iterationIntervalId&&(clearInterval(this._iterationIntervalId),this._iterationIntervalId=null),p("touchmove",this._touchMoveHandler),p("touchend",this._touchEndOrCancelHandler),p("touchcancel",this._touchEndOrCancelHandler),this._dragImage&&(this._dragImage.parentNode.removeChild(this._dragImage),this._dragImage=null),this._dragOperationEndedCb(this._config,this._lastTouchEvent,this._dragOperationState)},e.prototype._onTouchMove=function(e){const t=this;if(!1!==h(e,this._initialTouch.identifier)){if(this._lastTouchEvent=e,0===this._dragOperationState){let t=void 0;if(this._config.dragStartConditionOverride)try{t=this._config.dragStartConditionOverride(e)}catch(e){console.error("dnd-poly: error in dragStartConditionOverride hook: "+e),t=!1}else t=1===e.touches.length;return t?void(!0===this._setup()&&(this._initialEvent.preventDefault(),e.preventDefault())):void this._cleanup()}if(console.log("dnd-poly: moving draggable.."),e.preventDefault(),g("client",e,this._currentHotspotCoordinates),g("page",e,this._dragImagePageCoordinates),this._config.dragImageTranslateOverride)try{let i=!1;if(this._config.dragImageTranslateOverride(e,{x:this._currentHotspotCoordinates.x,y:this._currentHotspotCoordinates.y},this._immediateUserSelection,(function(e,o){t._dragImage&&(i=!0,t._currentHotspotCoordinates.x+=e,t._currentHotspotCoordinates.y+=o,t._dragImagePageCoordinates.x+=e,t._dragImagePageCoordinates.y+=o,f(t._dragImage,t._dragImagePageCoordinates,t._dragImageTransforms,t._dragImageOffset,t._config.dragImageCenterOnTouch))})),i)return}catch(e){console.log("dnd-poly: error in dragImageTranslateOverride hook: "+e)}f(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch)}},e.prototype._onTouchEndOrCancel=function(e){if(!1!==h(e,this._initialTouch.identifier)){if(this._config.dragImageTranslateOverride)try{this._config.dragImageTranslateOverride(void 0,void 0,void 0,(function(){}))}catch(e){console.log("dnd-poly: error in dragImageTranslateOverride hook: "+e)}0!==this._dragOperationState?(e.preventDefault(),this._dragOperationState="touchcancel"===e.type?3:2):this._cleanup()}},e.prototype._dragAndDropProcessModelIteration=function(){const e=this,t=this._currentDragOperation;this._dragDataStore.mode=3,this._dataTransfer.dropEffect=a[0];const i=y("drag",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer);if(i&&(console.log("dnd-poly: drag event cancelled."),this._currentDragOperation=a[0]),i||2===this._dragOperationState||3===this._dragOperationState){return this._dragOperationEnded(this._dragOperationState)?void function(e,t,i,n){const r=getComputedStyle(e);if("hidden"===r.visibility||"none"===r.display)return console.log("dnd-poly: source node is not visible. skipping snapback transition."),void n();t.classList.add(o);const s=getComputedStyle(t),a=parseFloat(s.transitionDuration);if(isNaN(a)||0===a)return console.log("dnd-poly: no transition used - skipping snapback"),void n();console.log("dnd-poly: starting dragimage snap back");const c=e.getBoundingClientRect(),l={x:c.left,y:c.top};l.x+=document.body.scrollLeft||document.documentElement.scrollLeft,l.y+=document.body.scrollTop||document.documentElement.scrollTop,l.x-=parseInt(r.marginLeft,10),l.y-=parseInt(r.marginTop,10);const d=parseFloat(s.transitionDelay),p=Math.round(1e3*(a+d));f(t,l,i,void 0,!1),setTimeout(n,p)}(this._sourceNode,this._dragImage,this._dragImageTransforms,(function(){e._finishDragOperation()})):void this._finishDragOperation()}const n=this._config.elementFromPoint(this._currentHotspotCoordinates.x,this._currentHotspotCoordinates.y);console.log("dnd-poly: new immediate user selection is: "+n);const r=this._currentDropTarget;n!==this._immediateUserSelection&&n!==this._currentDropTarget&&(this._immediateUserSelection=n,null!==this._currentDropTarget&&(this._dragDataStore.mode=3,this._dataTransfer.dropEffect=a[0],y("dragexit",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)),null===this._immediateUserSelection?(this._currentDropTarget=this._immediateUserSelection,console.log("dnd-poly: current drop target changed to null")):(this._dragDataStore.mode=3,this._dataTransfer.dropEffect=b(this._dragDataStore.effectAllowed,this._sourceNode),y("dragenter",this._immediateUserSelection,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?(console.log("dnd-poly: dragenter default prevented"),this._currentDropTarget=this._immediateUserSelection,this._currentDragOperation=w(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect)):this._immediateUserSelection!==document.body&&(this._currentDropTarget=document.body))),r!==this._currentDropTarget&&l(r)&&(console.log("dnd-poly: current drop target changed."),this._dragDataStore.mode=3,this._dataTransfer.dropEffect=a[0],y("dragleave",r,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1,this._currentDropTarget)),l(this._currentDropTarget)&&(this._dragDataStore.mode=3,this._dataTransfer.dropEffect=b(this._dragDataStore.effectAllowed,this._sourceNode),!1===y("dragover",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?(console.log("dnd-poly: dragover not prevented on possible drop-target."),this._currentDragOperation=a[0]):(console.log("dnd-poly: dragover prevented."),this._currentDragOperation=w(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect))),console.log("dnd-poly: d'n'd iteration ended. current drag operation: "+this._currentDragOperation),t!==this._currentDragOperation&&this._dragImage.classList.remove("dnd-poly-"+t);const s="dnd-poly-"+this._currentDragOperation;this._dragImage.classList.add(s)},e.prototype._dragOperationEnded=function(e){console.log("dnd-poly: drag operation end detected with "+this._currentDragOperation);const t=this._currentDragOperation===a[0]||null===this._currentDropTarget||3===e;return t?l(this._currentDropTarget)&&(this._dragDataStore.mode=3,this._dataTransfer.dropEffect=a[0],y("dragleave",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)):l(this._currentDropTarget)&&(this._dragDataStore.mode=1,this._dataTransfer.dropEffect=this._currentDragOperation,!0===y("drop",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?this._currentDragOperation=this._dataTransfer.dropEffect:this._currentDragOperation=a[0]),t},e.prototype._finishDragOperation=function(){console.log("dnd-poly: dragimage snap back transition ended"),this._dragDataStore.mode=3,this._dataTransfer.dropEffect=this._currentDragOperation,y("dragend",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1),this._dragOperationState=2,this._cleanup()},e}(),O={iterationInterval:150,tryFindDraggableTarget:function(e){let t=e.target;do{if(!1!==t.draggable){if(!0===t.draggable)return t;if(t.getAttribute&&"true"===t.getAttribute("draggable"))return t}}while((t=t.parentNode)&&t!==document.body)},dragImageSetup:function(e){const t=e.cloneNode(!0);return function e(t,i){if(1===t.nodeType){const e=getComputedStyle(t);for(let t=0;t<e.length;t++){const o=e[t];i.style.setProperty(o,e.getPropertyValue(o),e.getPropertyPriority(o))}if(i.style.pointerEvents="none",i.removeAttribute("id"),i.removeAttribute("class"),i.removeAttribute("draggable"),"CANVAS"===i.nodeName){const e=t,o=i,n=e.getContext("2d").getImageData(0,0,e.width,e.height);o.getContext("2d").putImageData(n,0,0)}}if(t.hasChildNodes())for(let o=0;o<t.childNodes.length;o++)e(t.childNodes[o],i.childNodes[o])}(e,t),t},elementFromPoint:function(e,t){return document.elementFromPoint(e,t)}};let E;function A(e,t){if(console.log("dnd-poly: global touchstart"),E)return void console.log("dnd-poly: drag operation already active");const i=O.tryFindDraggableTarget(e,t);if(i)try{E=new x(e,O,i,S)}catch(t){throw S(O,e,3),t}else console.log("dnd-poly: no draggable at touchstart coordinates")}function k(e){console.log("dnd-poly: setup delayed dragstart..");const t=e.target,i=e.composedPath(),o=function(e){console.log("dnd-poly: aborting delayed drag because of "+e.type),a.off(),c.off(),l.off(),d.off(),t&&t.dispatchEvent(new CustomEvent(r,{bubbles:!0,cancelable:!0})),clearTimeout(s)};t&&t.dispatchEvent(new CustomEvent(n,{bubbles:!0,cancelable:!0}));const s=window.setTimeout((function(){console.log("dnd-poly: starting delayed drag.."),a.off(),c.off(),l.off(),d.off(),A(e,i)}),O.holdToDrag),a=u(t,"touchend",o),c=u(t,"touchcancel",o),l=u(t,"touchmove",o),d=u(window,"scroll",o,!0)}function S(e,t,i){if(0===i&&(console.log("dnd-poly: Drag never started. Last event was "+t.type),e.defaultActionOverride))try{e.defaultActionOverride(t),t.defaultPrevented&&console.log("dnd-poly: defaultActionOverride has taken care of triggering the default action. preventing default on original event")}catch(e){console.log("dnd-poly: error in defaultActionOverride: "+e)}E=null}!function(e){if(e&&Object.keys(e).forEach((function(t){O[t]=e[t]})),!O.forceApply){const e=function(){const e={dragEvents:"ondragstart"in document.documentElement,draggable:"draggable"in document.documentElement,userAgentSupportingNativeDnD:void 0},t=!!window.chrome||/chrome/i.test(navigator.userAgent);return e.userAgentSupportingNativeDnD=!(/iPad|iPhone|iPod|Android/.test(navigator.userAgent)||t&&"ontouchstart"in document.documentElement),e}();if(e.userAgentSupportingNativeDnD&&e.draggable&&e.dragEvents)return!1}console.log("dnd-poly: Applying mobile drag and drop polyfill."),O.holdToDrag?(console.log("dnd-poly: holdToDrag set to "+O.holdToDrag),d("touchstart",k,!1)):d("touchstart",A,!1)}({tryFindDraggableTarget:function(e,t){const i=t||e.composedPath();for(let e of i){let t=e;do{if(!1!==t.draggable&&t.getAttribute&&"true"===t.getAttribute("draggable"))return t}while((t=t.parentNode)&&t!==document.body)}},elementFromPoint:function(e,t){for(let i of this._path)if(i.elementFromPoint){let o=i.elementFromPoint(e,t);if(o){for(;o.shadowRoot;)o=o.shadowRoot.elementFromPoint(e,t);return o}}},dragStartConditionOverride:function(e){return this._path=e.composedPath(),!0},holdToDrag:500})},function(e,t){e.exports=w},function(e,t){e.exports=x},function(e,t){e.exports=O},function(e,t){e.exports=E},function(e,t){e.exports=A},function(e,t){e.exports=k},function(e,t){e.exports=S},function(e,t,i){"use strict";i.r(t);i(3),i(15),i(28),i(8),i(11),i(9),i(16),i(29),i(30),i(4),i(31),i(32),i(33);var o,n=i(1),r=i(6),s=(i(12),i(34),i(35),i(13)),a=i.n(s),c=i(14),l=i.n(c),d=i(19),p=i.n(d),u=i(7),_=i.n(u),h=i(5),g=i(20),m=i.n(g),f=i(21),v=i.n(f),b=i(2);function y(){const e=O(["\n            "," ","\n        "]);return y=function(){return e},e}function w(){const e=O(['\n            <optgroup label="weighted mean">\n                ',"\n            </optgroup>\n        "]);return w=function(){return e},e}function x(){const e=O(['\n            <option value="','" data-desc="','">',"</option>\n        "]);return x=function(){return e},e}function O(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function E(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(E.prototype,HTMLElement.prototype),Object.setPrototypeOf(E,HTMLElement);const A=document.createElement("span");function k(e,t=0){A.innerHTML=e,document.body.appendChild(A);const i="".concat(Math.max(t,A.offsetWidth)+20,"px");return document.body.removeChild(A),i}A.style.visibility="hidden",A.style.fontFamily="monospace",A.style.fontSize="12px",A.style.position="absolute";Object(n.b)(m.a,{toString:()=>v.a+"\n"+p.a})(o=class extends E{set name(e){this.shadowRoot.querySelector("#name").innerHTML=this.getAttribute("name")}_option_template(e,t){return Object(b.html)(x(),e,t,t||e)}_select_template(e,t){const i=_.a[e][t]||[],o=Object(b.html)(w(),this._weights.map(e=>this._option_template(JSON.stringify(["weighted mean",e]),e))),n="TYPE_AGGREGATES"===e&&("integer"===t||"float"===t);return Object(b.html)(y(),i.map(e=>this._option_template(e)),n?o:b.nothing)}set_weights(e){this._weights=e}set type(e){const t=this.shadowRoot.querySelector("#name"),i=this.getAttribute("type");if(!i)return;const o=Object(h.get_type_config)(i);o.type&&t.classList.add(o.type),t.classList.add(i);const n=this.shadowRoot.querySelector("#column_aggregate"),r=this.shadowRoot.querySelector("#filter_operator");Object(b.render)(this._select_template("TYPE_AGGREGATES",o.type||i),n),Object(b.render)(this._select_template("TYPE_FILTERS",o.type||i),r),this.hasAttribute("aggregate")?this.aggregate=this.getAttribute("aggregate"):this.aggregate=o.aggregate,this.hasAttribute("filter")&&(this.filter=this.getAttribute("filter"));const s=this.shadowRoot.querySelector("#filter_operand");this._callback=e=>this._update_filter(e),s.addEventListener("keyup",this._callback.bind(this))}choices(e){const t=this.shadowRoot.querySelector("#filter_operand"),i=this.shadowRoot.querySelector("#filter_operator"),o=new l.a(t,{label:this.getAttribute("name"),list:e,minChars:0,autoFirst:!0,filter:function(e,t){return l.a.FILTER_CONTAINS(e,t.match(/[^,]*$/)[0])},item:function(e,t){return l.a.ITEM(e,t.match(/[^,]*$/)[0])},replace:function(e){const t=this.input.value.match(/^.+,\s*|/)[0];"in"===i.value||"not in"===i.value?this.input.value=t+e+", ":this.input.value=t+e}});""===t.value&&o.evaluate(),t.focus(),this._filter_operand.addEventListener("focus",()=>{0===t.value.trim().length&&o.evaluate()}),t.addEventListener("awesomplete-selectcomplete",this._callback)}set filter(e){const t=this.shadowRoot.querySelector("#filter_operator"),i=JSON.parse(this.getAttribute("filter"));t.value!==i.operator&&(t.value=i.operator||Object(h.get_type_config)(this.getAttribute("type")).filter_operator),t.style.width=k(t.value);const o=this.shadowRoot.querySelector("#filter_operand"),n=i.operand?i.operand.toString():"";this._initialized||(o.value=n),t.value===_.a.FILTER_OPERATORS.isNull||t.value===_.a.FILTER_OPERATORS.isNotNull?o.style.display="none":(o.style.display="inline-block",o.style.width=k(n,30))}set aggregate(e){const t=this.shadowRoot.querySelector("#column_aggregate"),i=this.getAttribute("aggregate");if(t.value!==i&&this.hasAttribute("type")){const e=this.getAttribute("type");t.value=i||Object(h.get_type_config)(e).aggregate}this._blur_agg_dropdown()}set computed_column(e){}_get_computed_data(){const e=JSON.parse(this.getAttribute("computed_column"));return{column_name:e.column_name,input_columns:e.input_columns,input_type:e.input_type,computation:e.computation,type:e.type}}_update_filter(e){const t=this.shadowRoot.querySelector("#filter_operand"),i=this.shadowRoot.querySelector("#filter_operator");let o=t.value;switch(this.getAttribute("type")){case"float":o=parseFloat(o);break;case"integer":o=parseInt(o);break;case"boolean":o=o.toLowerCase().indexOf("true")>-1}i.value!==_.a.FILTER_OPERATORS.isIn&&i.value!==_.a.FILTER_OPERATORS.isNotIn||(o=o.split(",").map(e=>e.trim())),this.setAttribute("filter",JSON.stringify({operator:i.value,operand:o})),this.dispatchEvent(new CustomEvent("filter-selected",{detail:e}))}_set_data_transfer(e){if(this.hasAttribute("filter")){const{operator:t,operand:i}=JSON.parse(this.getAttribute("filter"));e.dataTransfer.setData("text",JSON.stringify([this.getAttribute("name"),t,i,this.getAttribute("type"),this.getAttribute("aggregate")]))}else e.dataTransfer.setData("text",JSON.stringify([this.getAttribute("name"),Object(h.get_type_config)(this.getAttribute("type")).filter_operator,void 0,this.getAttribute("type"),this.getAttribute("aggregate")]));this.dispatchEvent(new CustomEvent("row-drag"))}_register_ids(){this._li=this.shadowRoot.querySelector(".row_draggable"),this._visible=this.shadowRoot.querySelector(".is_visible"),this._row_close=this.shadowRoot.querySelector("#row_close"),this._agg_dropdown=this.shadowRoot.querySelector("#column_aggregate"),this._sort_order=this.shadowRoot.querySelector("#sort_order"),this._filter_operand=this.shadowRoot.querySelector("#filter_operand"),this._filter_operator=this.shadowRoot.querySelector("#filter_operator"),this._edit_computed_column_button=this.shadowRoot.querySelector("#row_edit"),this._column_aggregate_category=this.shadowRoot.querySelector("#column_aggregate_category")}_blur_agg_dropdown(){if(this._agg_dropdown.blur(),"["===this._agg_dropdown.value[0])for(const e of this._agg_dropdown.querySelectorAll("optgroup option")){const t=e.getAttribute("data-desc");e.innerHTML="mean by ".concat(t)}}_focus_agg_dropdown(){for(const e of this._agg_dropdown.querySelectorAll("optgroup option")){const t=e.getAttribute("data-desc");e.innerHTML="by ".concat(t)}}_register_callbacks(){this._li.addEventListener("dragstart",this._set_data_transfer.bind(this)),this._li.addEventListener("dragend",()=>{this.dispatchEvent(new CustomEvent("row-dragend"))}),this._visible.addEventListener("mousedown",e=>this.dispatchEvent(new CustomEvent("visibility-clicked",{detail:e}))),this._row_close.addEventListener("mousedown",e=>this.dispatchEvent(new CustomEvent("close-clicked",{detail:e}))),this._agg_dropdown.addEventListener("focus",this._focus_agg_dropdown.bind(this)),this._agg_dropdown.addEventListener("change",e=>{this._blur_agg_dropdown();const t=this._agg_dropdown.value;this.setAttribute("aggregate",t),this.dispatchEvent(new CustomEvent("aggregate-selected",{detail:e}))}),this._sort_order.addEventListener("click",e=>{this.dispatchEvent(new CustomEvent("sort-order",{detail:e}))});const e=a()(e=>this._update_filter(e),50);this._filter_operator.addEventListener("change",()=>{this._filter_operand.focus(),this._filter_operator.style.width=k(this._filter_operator.value),this.shadowRoot.querySelector("#filter_operand").style.width=k(""+this._filter_operand.value,30),e()}),this._edit_computed_column_button.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("perspective-computed-column-edit",{bubbles:!0,detail:this._get_computed_data()}))})}connectedCallback(){this._register_ids(),this._register_callbacks()}});var S=i(22),T=i.n(S),L=i(23),j=i.n(L),C=(i(18),i(36),i(37),i(0));const N={columnName:"column name",leftParen:"(",rightParen:")",add:"+",subtract:"-",multiply:"*",divide:"/",percent_of:"%"},I=e=>{let t;return t=Array.isArray(e)?e.filter(e=>"EOF"!==e.tokenType.name).map(e=>e.payload?e.payload:e.image):e.payload?e.payload:e.image,t&&0!==t.length||(t="EOF"),t},R={buildEarlyExitMessage:e=>{let t=I(e.actual);const i=e.expectedIterationPaths.map(e=>{let t=[];return e.map(e=>{const i=N[e.name];t.push(i)}),t.join(", ")});return"Unexpected token: `".concat(t,"`\n\nExpected one of the following tokens: \n ").concat(i.join("\n"))},buildMismatchTokenMessage:e=>{let t=I(e.actual),i=e.expected.name;N[i]&&(i=N[i]);let o="Expecting token `".concat(i,"`, but found `").concat(t,"`.");return")"!==i&&"rightParen"!==i||(o+="\n\nMake sure all left parentheses are matched\nwith right parentheses."),o},buildNoViableAltMessage:e=>{let t=I(e.actual),i="Unexpected token: `".concat(t,"`.");return"Expression"===e.ruleName?i+="\n\nExpected a column name, `(`,\nor functional operator such as:\n- `sqrt`\n- `uppercase`\n- `day_of_week`":"ColumnName"===e.ruleName?i+="\n\nExpected a column name or `(`":"TerminalColumnName"===e.ruleName&&(i+="\n\nExpected a column name after 'AS'"),i}};function z(e,t){z=function(e,t){return new r(e,void 0,t)};var i=P(RegExp),o=RegExp.prototype,n=new WeakMap;function r(e,t,o){var r=i.call(this,e,t);return n.set(r,o||n.get(e)),r}function s(e,t){var i=n.get(t);return Object.keys(i).reduce((function(t,o){return t[o]=e[i[o]],t}),Object.create(null))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(r,i),r.prototype.exec=function(e){var t=o.exec.call(this,e);return t&&(t.groups=s(t,this)),t},r.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var i=n.get(this);return o[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+i[t]})))}if("function"==typeof t){var r=this;return o[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(s(e,r)),t.apply(this,e)}))}return o[Symbol.replace].call(this,e,t)},z.apply(this,arguments)}function P(e){var t="function"==typeof Map?new Map:void 0;return(P=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return q(e,arguments,M(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),D(o,e)})(e)}function q(e,t,i){return(q=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,i){var o=[null];o.push.apply(o,t);var n=new(Function.bind.apply(e,o));return i&&D(n,i.prototype),n}).apply(null,arguments)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const U={},H=Object(C.createToken)({name:"OperatorTokenType",pattern:C.Lexer.NA}),J=Object(C.createToken)({name:"FunctionTokenType",pattern:C.Lexer.NA}),B=Object(C.createToken)({name:"UpperLowerTokenType",pattern:/(uppercase|lowercase)/}),F=z(/(["'])(.*?[\0-\[\]-\uFFFF])\1/y,{column_name:2}),W=Object(C.createToken)({name:"columnName",pattern:{exec:function(e,t){F.lastIndex=t;const i=F.exec(e);if(null!==i){const e=i[0],t=e.substr(1,e.length-2);i.payload=t}return i}},line_breaks:!1}),G=Object(C.createToken)({name:"as",pattern:/(AS|As|as)/,longer_alt:B}),Y=Object(C.createToken)({name:"add",pattern:/\+/,categories:[H]}),Z=Object(C.createToken)({name:"subtract",pattern:/-/,categories:[H]}),X=Object(C.createToken)({name:"multiply",pattern:/\*/,categories:[H]}),K=Object(C.createToken)({name:"divide",pattern:/\//,categories:[H]}),V=Object(C.createToken)({name:"pow",pattern:/\^/,categories:[H]}),Q=Object(C.createToken)({name:"percent_of",pattern:/\%/,categories:[H]}),$=Object(C.createToken)({name:"equals",pattern:/\==/,categories:[H]}),ee=Object(C.createToken)({name:"not_equals",pattern:/\!=/,categories:[H]}),te=Object(C.createToken)({name:"greater_than",pattern:/\>/,categories:[H]}),ie=Object(C.createToken)({name:"less_than",pattern:/\</,categories:[H]}),oe=Object(C.createToken)({name:"is",pattern:/\is/,categories:[H]}),ne=Object(C.createToken)({name:"sqrt",pattern:/sqrt/,categories:[J]}),re=Object(C.createToken)({name:"pow2",pattern:/pow2/,categories:[J]}),se=Object(C.createToken)({name:"abs",pattern:/abs/,categories:[J]}),ae=Object(C.createToken)({name:"invert",pattern:/invert/,categories:[J]}),ce=Object(C.createToken)({name:"log",pattern:/log/,categories:[J]}),le=Object(C.createToken)({name:"exp",pattern:/exp/,categories:[J]}),de=Object(C.createToken)({name:"bin10",pattern:/bin10/,categories:[J]}),pe=Object(C.createToken)({name:"bin100",pattern:/bin100/,categories:[J]}),ue=Object(C.createToken)({name:"bin1000",pattern:/bin1000/,categories:[J]}),_e=Object(C.createToken)({name:"bin10th",pattern:/bin10th/,categories:[J]}),he=Object(C.createToken)({name:"bin100th",pattern:/bin100th/,categories:[J]}),ge=Object(C.createToken)({name:"bin1000th",pattern:/bin1000th/,categories:[J]}),me=Object(C.createToken)({name:"length",pattern:/length/,categories:[J]}),fe=Object(C.createToken)({name:"lowercase",pattern:/lowercase/,categories:[J]}),ve=Object(C.createToken)({name:"uppercase",pattern:/uppercase/,categories:[J]}),be=Object(C.createToken)({name:"concat_comma",pattern:/concat_comma/,categories:[J]}),ye=Object(C.createToken)({name:"concat_space",pattern:/concat_space/,categories:[J]}),we=Object(C.createToken)({name:"hour_of_day",pattern:/hour_of_day/,categories:[J]}),xe=Object(C.createToken)({name:"day_of_week",pattern:/day_of_week/,categories:[J]}),Oe=Object(C.createToken)({name:"month_of_year",pattern:/month_of_year/,categories:[J]}),Ee=Object(C.createToken)({name:"second_bucket",pattern:/second_bucket/,categories:[J]}),Ae=Object(C.createToken)({name:"minute_bucket",pattern:/minute_bucket/,categories:[J]}),ke=Object(C.createToken)({name:"hour_bucket",pattern:/hour_bucket/}),Se=Object(C.createToken)({name:"day_bucket",pattern:/day_bucket/,categories:[J]}),Te=Object(C.createToken)({name:"week_bucket",pattern:/week_bucket/,categories:[J]}),Le=Object(C.createToken)({name:"month_bucket",pattern:/month_bucket/,categories:[J]}),je=Object(C.createToken)({name:"year_bucket",pattern:/year_bucket/,categories:[J]}),Ce=Object(C.createToken)({name:"leftParen",pattern:/\(/}),Ne=Object(C.createToken)({name:"rightParen",pattern:/\)/}),Ie=Object(C.createToken)({name:"comma",pattern:/,/}),Re=[Object(C.createToken)({name:"whitespace",pattern:/\s+/,group:C.Lexer.SKIPPED}),Ie,G,W,Ce,Ne,Y,Z,X,K,V,Q,$,ee,te,ie,ne,re,se,ae,ce,le,ge,ue,he,pe,_e,de,me,oe,be,ye,ve,fe,we,xe,Oe,Ee,Ae,ke,Se,Te,Le,je,B];Re.forEach(e=>{U[e.name]=e});const ze=new C.Lexer(Re,{errorMessageProvider:{buildUnexpectedCharactersMessage:(e,t,i,o,n)=>"Ln ".concat(o,", Col ").concat(n,": Unexpected input `").concat(e,"` at character ").concat(t)}});class Pe extends C.CstParser{constructor(){super(U,{errorMessageProvider:R}),this.RULE("SuperExpression",()=>{this.SUBRULE(this.Expression)}),this.RULE("Expression",()=>{this.OR([{ALT:()=>{this.SUBRULE(this.OperatorComputedColumn)}},{ALT:()=>{this.SUBRULE(this.FunctionComputedColumn)}}],{ERR_MSG:"Expected an expression of the form `x + y` or `func(x)`."})}),this.RULE("OperatorComputedColumn",()=>{this.SUBRULE(this.ColumnName,{LABEL:"left"}),this.AT_LEAST_ONE(()=>{this.SUBRULE(this.Operator),this.SUBRULE2(this.ColumnName,{LABEL:"right"})}),this.OPTION(()=>{this.SUBRULE(this.As,{LABEL:"as"})})}),this.RULE("FunctionComputedColumn",()=>{this.SUBRULE(this.Function),this.CONSUME(Ce),this.AT_LEAST_ONE_SEP({SEP:Ie,DEF:()=>{this.SUBRULE(this.ColumnName)}}),this.CONSUME(Ne),this.OPTION(()=>{this.SUBRULE(this.As,{LABEL:"as"})})}),this.RULE("ColumnName",()=>{this.OR([{ALT:()=>this.SUBRULE(this.ParentheticalExpression)},{ALT:()=>this.CONSUME(W)}],{ERR_MSG:"Expected a column name (wrapped in double quotes) or a parenthesis-wrapped expression."})}),this.RULE("TerminalColumnName",()=>{this.CONSUME(W)}),this.RULE("As",()=>{this.CONSUME(G),this.SUBRULE(this.TerminalColumnName)}),this.RULE("Function",()=>{this.OR([{ALT:()=>this.CONSUME(ne)},{ALT:()=>this.CONSUME(re)},{ALT:()=>this.CONSUME(se)},{ALT:()=>this.CONSUME(ae)},{ALT:()=>this.CONSUME(ce)},{ALT:()=>this.CONSUME(le)},{ALT:()=>this.CONSUME(ge)},{ALT:()=>this.CONSUME(ue)},{ALT:()=>this.CONSUME(he)},{ALT:()=>this.CONSUME(pe)},{ALT:()=>this.CONSUME(_e)},{ALT:()=>this.CONSUME(de)},{ALT:()=>this.CONSUME(me)},{ALT:()=>this.CONSUME(ve)},{ALT:()=>this.CONSUME(fe)},{ALT:()=>this.CONSUME(be)},{ALT:()=>this.CONSUME(ye)},{ALT:()=>this.CONSUME(we)},{ALT:()=>this.CONSUME(xe)},{ALT:()=>this.CONSUME(Oe)},{ALT:()=>this.CONSUME(Ee)},{ALT:()=>this.CONSUME(Ae)},{ALT:()=>this.CONSUME(ke)},{ALT:()=>this.CONSUME(Se)},{ALT:()=>this.CONSUME(Te)},{ALT:()=>this.CONSUME(Le)},{ALT:()=>this.CONSUME(je)}])}),this.RULE("Operator",()=>{this.OR([{ALT:()=>this.CONSUME(Y)},{ALT:()=>this.CONSUME(Z)},{ALT:()=>this.CONSUME(X)},{ALT:()=>this.CONSUME(K)},{ALT:()=>this.CONSUME(V)},{ALT:()=>this.CONSUME(Q)},{ALT:()=>this.CONSUME($)},{ALT:()=>this.CONSUME(ee)},{ALT:()=>this.CONSUME(te)},{ALT:()=>this.CONSUME(ie)},{ALT:()=>this.CONSUME(oe)}])}),this.RULE("ParentheticalExpression",()=>{this.CONSUME(Ce),this.SUBRULE(this.Expression),this.CONSUME(Ne)}),this.performSelfAnalysis()}}const qe={"+":(e,t)=>"(".concat(e," + ").concat(t,")"),"-":(e,t)=>"(".concat(e," - ").concat(t,")"),"*":(e,t)=>"(".concat(e," * ").concat(t,")"),"/":(e,t)=>"(".concat(e," / ").concat(t,")"),"%":(e,t)=>"(".concat(e," %% ").concat(t,")"),"==":(e,t)=>"(".concat(e," == ").concat(t,")"),"!=":(e,t)=>"(".concat(e," != ").concat(t,")"),">":(e,t)=>"(".concat(e," > ").concat(t,")"),"<":(e,t)=>"(".concat(e," < ").concat(t,")"),"^":(e,t)=>"(".concat(e," ^ ").concat(t,")"),invert:e=>"(1 / ".concat(e,")"),log:e=>"log(".concat(e,")"),exp:e=>"exp(".concat(e,")"),pow2:e=>"(".concat(e," ^ 2)"),sqrt:e=>"sqrt(".concat(e,")"),abs:e=>"abs(".concat(e,")"),bin10:e=>"bin10(".concat(e,")"),bin100:e=>"bin100(".concat(e,")"),bin1000:e=>"bin1000(".concat(e,")"),bin10th:e=>"bin10th(".concat(e,")"),bin100th:e=>"bin100th(".concat(e,")"),bin1000th:e=>"bin1000th(".concat(e,")"),uppercase:e=>"uppercase(".concat(e,")"),lowercase:e=>"lowercase(".concat(e,")"),length:e=>"length(".concat(e,")"),is:(e,t)=>"(".concat(e," is ").concat(t,")"),concat_space:(e,t)=>"concat_space(".concat(e,", ").concat(t,")"),concat_comma:(e,t)=>"concat_comma(".concat(e,", ").concat(t,")"),hour_of_day:e=>"hour_of_day(".concat(e,")"),day_of_week:e=>"day_of_week(".concat(e,")"),month_of_year:e=>"month_of_year(".concat(e,")"),second_bucket:e=>"second_bucket(".concat(e,")"),minute_bucket:e=>"minute_bucket(".concat(e,")"),hour_bucket:e=>"hour_bucket(".concat(e,")"),day_bucket:e=>"day_bucket(".concat(e,")"),week_bucket:e=>"week_bucket(".concat(e,")"),month_bucket:e=>"month_bucket(".concat(e,")"),year_bucket:e=>"year_bucket(".concat(e,")")},De=new Pe([]),Me=De.getBaseCstVisitorConstructor();const Ue=new class extends Me{constructor(){super(),this.validateVisitor()}SuperExpression(e){let t=[];return this.visit(e.Expression,t),t}Expression(e,t){if(e.OperatorComputedColumn)this.visit(e.OperatorComputedColumn,t);else{if(!e.FunctionComputedColumn)return;this.visit(e.FunctionComputedColumn,t)}}OperatorComputedColumn(e,t){let i=this.visit(e.left,t);void 0===i&&(i=t[t.length-1].column);let o=this.visit(e.Operator);if(!o)return;let n=this.visit(e.right,t);void 0===n&&(n=t[t.length-1].column);let r=this.visit(e.as),s=qe[o](i,n);r&&(s=r),t.push({column:s,computed_function_name:o,inputs:[i,n]})}FunctionComputedColumn(e,t){const i=this.visit(e.Function);let o=[];for(const i of e.ColumnName){let e=this.visit(i,t);void 0===e?o.push(t[t.length-1].column):o.push(e)}const n=this.visit(e.as);let r=qe[i](...o);n&&(r=n);const s={column:r,computed_function_name:i,inputs:o};t.push(s)}ColumnName(e,t){return e.ParentheticalExpression?this.visit(e.ParentheticalExpression,t):e.columnName[0].payload}TerminalColumnName(e){return e.columnName[0].payload}Operator(e){return e.add?e.add[0].image:e.subtract?e.subtract[0].image:e.multiply?e.multiply[0].image:e.divide?e.divide[0].image:e.pow?e.pow[0].image:e.percent_of?e.percent_of[0].image:e.equals?e.equals[0].image:e.not_equals?e.not_equals[0].image:e.greater_than?e.greater_than[0].image:e.less_than?e.less_than[0].image:e.is?e.is[0].image:void 0}Function(e){return e.sqrt?e.sqrt[0].image:e.pow2?e.pow2[0].image:e.abs?e.abs[0].image:e.invert?e.invert[0].image:e.log?e.log[0].image:e.exp?e.exp[0].image:e.length?e.length[0].image:e.uppercase?e.uppercase[0].image:e.lowercase?e.lowercase[0].image:e.concat_comma?e.concat_comma[0].image:e.concat_space?e.concat_space[0].image:e.bin10?e.bin10[0].image:e.bin100?e.bin100[0].image:e.bin1000?e.bin1000[0].image:e.bin10th?e.bin10th[0].image:e.bin100th?e.bin100th[0].image:e.bin1000th?e.bin1000th[0].image:e.hour_of_day?e.hour_of_day[0].image:e.day_of_week?e.day_of_week[0].image:e.month_of_year?e.month_of_year[0].image:e.second_bucket?e.second_bucket[0].image:e.minute_bucket?e.minute_bucket[0].image:e.hour_bucket?e.hour_bucket[0].image:e.day_bucket?e.day_bucket[0].image:e.week_bucket?e.week_bucket[0].image:e.month_bucket?e.month_bucket[0].image:e.year_bucket?e.year_bucket[0].image:void 0}As(e){return e.TerminalColumnName[0].children.columnName[0].payload}ParentheticalExpression(e,t){return this.visit(e.Expression,t)}},He=function(e){const t=function(e){const t=ze.tokenize(e);if(t.errors.length>0){let e=t.errors.map(e=>e.message);throw new Error("".concat(e.join("\n")))}return t}(e);De.input=t.tokens;const i=De.SuperExpression();if(De.errors.length>0){let e=De.errors.map(e=>e.message);throw new Error("".concat(e.join("\n")))}return Ue.visit(i)};var Je,Be;function Fe(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}function We(e,t,i,o,n){var r={};return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.setPrototypeOf(Fe.prototype,HTMLElement.prototype),Object.setPrototypeOf(Fe,HTMLElement);Object(n.b)(T.a,j.a)((We((Be=class extends Fe{constructor(){super(),this._parsed_expression=void 0,this.expressions=[]}connectedCallback(){this._register_ids(),this._register_callbacks(),this._textarea_observer=new MutationObserver(this._resize_textarea.bind(this))}_observe_textarea(){this._textarea_observer.observe(this._expression_input,{attributes:!0,attributeFilter:["style"]})}_resize_textarea(){const e=new CustomEvent("perspective-computed-expression-resize");this.dispatchEvent(e),this._textarea_observer.disconnect()}_capture_drop_data(e){const t=e.dataTransfer.getData("text");if(""!==t)try{const i=JSON.parse(t);Array.isArray(i)&&i.length>4&&(e.preventDefault(),this._expression_input.value+='"'.concat(i[0],'"'))}catch(e){}finally{this._validate_expression()}}async _validate_expression(){const e=this._expression_input.value;if(0===e.length)return this._clear_error_messages(),void this._enable_save_button();try{this._parsed_expression=He(e)}catch(e){const t=e.message?e.message:JSON.stringify(e);return this._disable_save_button(),void this._set_error_message(t,this._error)}const t=new CustomEvent("perspective-computed-expression-type-check",{detail:{parsed_expression:this._parsed_expression}});this.dispatchEvent(t)}async _type_check_expression(e,t){const i=this._parsed_expression||[],o=[];for(const t of i)e[t.column]||o.push(t.column);if(o.length>0){let e="TypeError:\n";for(const i of o)e+="- `".concat(i,"` expected input column types ").concat(t[i].join("/"),"\n");this._disable_save_button(),this._set_error_message(e,this._error)}else this._clear_error_messages(),this._enable_save_button()}_remove_all_expressions(){const e=new CustomEvent("perspective-computed-expression-remove");this.dispatchEvent(e),this.expressions=[]}_save_expression(){const e=this._expression_input.value,t=this._parsed_expression||[],i=new CustomEvent("perspective-computed-expression-save",{detail:{expression:e,parsed_expression:t}});this.dispatchEvent(i),this.expressions.push(e)}_clear_expression_input(){this._expression_input.value=""}_close_expression_editor(){this.style.display="none",this._side_panel_actions.style.display="flex",this._clear_error_messages(),this._clear_expression_input(),this._textarea_observer.disconnect()}_set_error_message(e,t){t&&(t.innerText=e,t.style.display="block")}_clear_error_messages(){this._error.innerText="",this._error.style.display="none"}_disable_save_button(){this._save_button.toggleAttribute("disabled",!0)}_enable_save_button(){this._save_button.removeAttribute("disabled")}_disable_remove_button(){this._remove_button.toggleAttribute("disabled",!0)}_enable_remove_button(){this._remove_button.removeAttribute("disabled")}_register_ids(){this._side_panel_actions=this.parentElement.querySelector("#side_panel__actions"),this._close_button=this.shadowRoot.querySelector("#psp-expression-close"),this._expression_input=this.shadowRoot.querySelector("#psp-expression-input"),this._error=this.shadowRoot.querySelector("#psp-expression-error"),this._save_button=this.shadowRoot.querySelector("#psp-expression-button-save"),this._remove_button=this.shadowRoot.querySelector("#psp-expression-button-remove")}_register_callbacks(){this._close_button.addEventListener("click",this._close_expression_editor.bind(this)),this._expression_input.addEventListener("keyup",this._validate_expression.bind(this)),this._expression_input.addEventListener("drop",this._capture_drop_data.bind(this)),this._save_button.addEventListener("click",this._save_expression.bind(this))}}).prototype,"_validate_expression",[n.f],Object.getOwnPropertyDescriptor(Be.prototype,"_validate_expression"),Be.prototype),We(Be.prototype,"_type_check_expression",[n.f],Object.getOwnPropertyDescriptor(Be.prototype,"_type_check_expression"),Be.prototype),Je=Be));var Ge=i(24),Ye=i.n(Ge),Ze=i(25),Xe=i.n(Ze),Ke=i(26),Ve=i.n(Ke);function Qe(e){if(0==this._active_columns.children.length)return 0;{let i=!1;for(let o in this._active_columns.children){var t;let n=this._active_columns.children[o];if(i=i||(null==n?void 0:null===(t=n.classList)||void 0===t?void 0:t.contains("null-column")),n.offsetTop+n.offsetHeight>e.offsetY+this._active_columns.scrollTop)return parseInt(o)}let o=this._active_columns.children.length;return i&&o--,o}}function $e(e){let t=e.target.getRootNode().host,i=t;i="PERSPECTIVE-VIEWER"===i.tagName?e.target.parentElement:t.parentElement;let o=Array.prototype.slice.call(i.children).indexOf("PERSPECTIVE-ROW"===t.tagName?t:e.target),n=i.getAttribute("for");if(this.hasAttribute(n)){let e=JSON.parse(this.getAttribute(n));e.splice(o,1),0===e.length?this.removeAttribute(n):this.setAttribute(n,JSON.stringify(e))}}function et(e){e.preventDefault(),e.currentTarget.classList.remove("dropping"),this._drop_target_hover&&this._drop_target_hover.removeAttribute("drop-target");let t=e.dataTransfer.getData("text");if(!t)return;t=JSON.parse(t);let i=e.currentTarget.querySelector("ul").getAttribute("for")||e.currentTarget.getAttribute("id").replace("_","-"),o=JSON.parse(this.getAttribute(i)||"[]"),n=o.indexOf(t[0]);-1!==n&&o.splice(n,1);const r=i.indexOf("filter")>-1;if(r?this.setAttribute(i,JSON.stringify(o.concat([t]))):i.indexOf("sort")>-1?this.setAttribute(i,JSON.stringify(o.concat([[t[0]]]))):this.setAttribute(i,JSON.stringify(o.concat([t[0]]))),"pivots"===this._plugin.deselectMode&&this._get_visible_column_count()>1&&"sort"!==i&&!r){for(let e of this.shadowRoot.querySelectorAll("#active_columns perspective-row"))if(e.getAttribute("name")===t[0]){this._active_columns.removeChild(e);break}this._update_column_view()}this._debounce_update()}function tt(e){let t=e.target.parentElement.parentElement;Array.prototype.slice(this._active_columns.children).indexOf(t)>-1&&this._get_visible_column_count()>1&&"move"!==e.dataTransfer.dropEffect&&(this._active_columns.removeChild(t),this._update_column_view()),this._active_columns.classList.remove("dropping")}function it(e){let t=e.relatedTarget;for(;t&&t!==this._active_columns;)t=t.parentElement;null===t&&(this._active_columns.classList.remove("dropping"),this._drop_target_null&&(this._active_columns.replaceChild(this._drop_target_null,this._drop_target_hover),delete this._drop_target_null),this._drop_target_hover.parentElement===this._active_columns&&this._active_columns.removeChild(this._drop_target_hover),-1!==this._original_index&&this._active_columns.insertBefore(this._drop_target_hover,this._active_columns.children[this._original_index]),this._drop_target_hover.removeAttribute("drop-target"))}function ot(){this._drop_target_null&&(this._drop_target_null.parentElement===this._active_columns?Object(n.e)(this._active_columns,this._drop_target_hover,this._drop_target_null):this._active_columns.replaceChild(this._drop_target_null,this._drop_target_hover),delete this._drop_target_null)}function nt(e){ot.call(this),this._active_columns.children[e]&&this._drop_target_hover!==this._active_columns.children[e]&&(this._drop_target_null=this._active_columns.children[e],Object(n.e)(this._active_columns,this._active_columns.children[e],this._drop_target_hover))}function rt(e){ot.call(this),this._active_columns.children[e]&&(this._drop_target_null=this._active_columns.children[e],this._active_columns.replaceChild(this._drop_target_hover,this._active_columns.children[e]))}function st(e){var t,i,o,r,s,a,c,l;e.preventDefault(),e.dataTransfer.dropEffect="move","dropping"!==e.currentTarget.className&&e.currentTarget.classList.add("dropping"),this._drop_target_hover.hasAttribute("drop-target")||this._drop_target_hover.toggleAttribute("drop-target",!0);let d=Qe.call(this,e);const p=Array.prototype.slice.call(this._active_columns.children).indexOf(this._drop_target_hover),u=this._active_columns.children[d],_=d<(null===(t=this._plugin.initial)||void 0===t?void 0:null===(i=t.names)||void 0===i?void 0:i.length)-1,h=this._drop_target_hover!==this._active_columns.children[d],g=-1!==this._original_index,m=g&&this._original_index<(null===(o=this._plugin.initial)||void 0===o?void 0:null===(r=o.names)||void 0===r?void 0:r.length)-1,f=g&&this._original_index>=(null===(s=this._plugin.initial)||void 0===s?void 0:null===(a=s.names)||void 0===a?void 0:a.length)-1,v=g&&this._original_index<(null===(c=this._plugin.initial)||void 0===c?void 0:c.count),b=!(d<(null===(l=this._plugin.initial)||void 0===l?void 0:l.count))&&(null==u?void 0:u.classList.contains("null-column"));if(v&&b)ot.call(this);else if(_&&f&&h){var y,w,x,O,E;ot.call(this),this._original_index===(null===(y=this._plugin.initial)||void 0===y?void 0:null===(w=y.names)||void 0===w?void 0:w.length)-1&&this._drop_target_hover===this._active_columns.children[this._original_index]&&this._active_columns.children.length===(null===(x=this._plugin.initial)||void 0===x?void 0:null===(O=x.names)||void 0===O?void 0:O.length)?(this._drop_target_null=this._active_columns.children[d],Object(n.e)(this._active_columns,this._active_columns.children[d],this._drop_target_hover)):(null===(E=this._active_columns.children[d])||void 0===E?void 0:E.classList.contains("null-column"))?this._drop_target_hover!==this._active_columns.children[d]&&(this._drop_target_null=this._active_columns.children[d],this._active_columns.replaceChild(this._drop_target_hover,this._active_columns.children[d])):(this._drop_target_null=this._active_columns.children[d],this._active_columns.replaceChild(this._drop_target_hover,this._active_columns.children[d]),this._active_columns.insertBefore(this._drop_target_null,this._active_columns.children[this._original_index]))}else _&&g&&h?nt.call(this,d):_&&!g&&h?rt.call(this,d):!_&&m&&h?nt.call(this,d):b&&g?nt.call(this,d):b&&!g?rt.call(this,d):p<d?d+1<this._active_columns.children.length?this._active_columns.children[d+1].hasAttribute("drop-target")||(ot.call(this),this._active_columns.insertBefore(this._drop_target_hover,this._active_columns.children[d+1])):this._active_columns.children[this._active_columns.children.length-1].hasAttribute("drop-target")||(ot.call(this),this._active_columns.appendChild(this._drop_target_hover)):d<this._active_columns.children.length?this._active_columns.children[d].hasAttribute("drop-target")||(ot.call(this),this._active_columns.insertBefore(this._drop_target_hover,this._active_columns.children[d])):this._active_columns.children[this._active_columns.children.length-1].hasAttribute("drop-target")||(ot.call(this),this._active_columns.appendChild(this._drop_target_hover))}function at(e){e.preventDefault(),delete this._drop_target_null,e.currentTarget.classList.remove("dropping"),this._drop_target_hover.parentElement===this._active_columns&&this._drop_target_hover.removeAttribute("drop-target"),e.dataTransfer.getData("text")&&this._update_column_view()}function ct(e){e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.add("dropping")}function lt(e){e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.add("dropping"),e.dataTransfer.dropEffect="move"}function dt(e){e.currentTarget==e.target&&(e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.remove("dropping"))}i(38),i(39),i(40);var pt=i(27),ut=i.n(pt);class _t{constructor(e,t=!1){this._on_cancel=e,this._cancelled=!1,this.initial=t}cancel(){!this._cancelled&&this._on_cancel&&(this._on_cancel(),this._on_cancel=void 0),this._cancelled=!0}get cancelled(){return this._cancelled}}function ht(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(ht.prototype,HTMLElement.prototype),Object.setPrototypeOf(ht,HTMLElement);class gt extends ht{get _plugin(){let e=r.b.getInstance(),t=this.getAttribute("plugin");return t||(t=Object.keys(e)[0],this.setAttribute("plugin",t)),e[t]||e[Object.keys(e)[0]]}_get_view_dom_columns(e,t){e=e||"#active_columns perspective-row";let i=Array.prototype.slice.call(this.shadowRoot.querySelectorAll(e));return t?i.map(t).filter(e=>e):i}_get_view_all_columns(){return Array.prototype.slice.call(this.shadowRoot.querySelectorAll("#inactive_columns perspective-row"))}_get_view_active_columns(){return Array.prototype.slice.call(this.shadowRoot.querySelectorAll("#active_columns perspective-row"))}_get_view_active_valid_columns(){return Array.prototype.slice.call(this.shadowRoot.querySelectorAll("#active_columns perspective-row")).filter(e=>!e.classList.contains("null-column"))}_get_view_inactive_columns(){return Array.prototype.slice.call(this.shadowRoot.querySelectorAll("#inactive_columns perspective-row"))}_get_view_all_column_names(){return this._get_view_all_columns().map(e=>e.getAttribute("name"))}_get_view_active_column_names(){return this._get_view_active_columns().map(e=>e.getAttribute("name"))}_get_view_all_valid_column_names(){return this._get_view_all_column_names().filter(e=>e)}_get_view_active_valid_column_names(){return this._get_view_active_column_names().filter(e=>e)}_get_view_active_valid_column_count(){return this._get_view_active_valid_column_names().length}_get_view_columns({active:e=!0}={}){let t;return t=e?"#active_columns perspective-row":"#inactive_columns perspective-row",this._get_view_dom_columns(t,e=>e.getAttribute("name"))}_get_view_aggregates(e){return e=e||"#active_columns perspective-row",this._get_view_dom_columns(e,e=>{let t=e.getAttribute("aggregate");if("["===t[0])try{t=JSON.parse(t)}catch(e){console.error(e)}const i=e.getAttribute("name");return i&&{op:t,column:i}})}_get_view_row_pivots(){return this._get_view_dom_columns("#row_pivots perspective-row",e=>e.getAttribute("name"))}_get_view_column_pivots(){return this._get_view_dom_columns("#column_pivots perspective-row",e=>e.getAttribute("name"))}_get_view_filter_nodes(){return this._get_view_dom_columns("#filters perspective-row")}_get_view_filters(){return this._get_view_dom_columns("#filters perspective-row",e=>{let{operator:t,operand:i}=JSON.parse(e.getAttribute("filter"));return[e.getAttribute("name"),t,i]})}_get_view_sorts(){return this._get_view_dom_columns("#sort perspective-row",e=>{let t=e.getAttribute("sort-order")||"asc";return[e.getAttribute("name"),t]})}_get_view_computed_columns(){return JSON.parse(this.getAttribute("computed-columns"))||[]}_get_view_parsed_computed_columns(){return JSON.parse(this.getAttribute("parsed-computed-columns"))||[]}_get_visible_column_count(){return this._get_view_active_columns().length}get_aggregate_attribute(){const e=JSON.parse(this.getAttribute("aggregates"))||{},t=new Set,i=Object.keys(e).map(i=>(t.add(i),{column:i,op:e[i]}));if(this._aggregate_defaults)for(const e of Object.keys(this._aggregate_defaults))t.has(e)||i.push({column:e,op:this._aggregate_defaults[e]});return i}}function mt(){const e=wt(["Rendering "," of points."]);return mt=function(){return e},e}function ft(){const e=wt(["Rendering "," of columns."]);return ft=function(){return e},e}function vt(){const e=wt(["Rendering "," of columns and "," of points."]);return vt=function(){return e},e}function bt(){const e=wt(['\n            <span style="white-space:nowrap">',"</span>\n        "]);return bt=function(){return e},e}function yt(){const e=wt(['\n            <span title="'," / ",'" class="plugin_information--overflow-hint">&nbsp;<span class="plugin_information--overflow-hint-percent">',"%</span>&nbsp;</span>\n        "]);return yt=function(){return e},e}function wt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function xt(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}let Ot={integer:2,string:0,float:3,boolean:4,datetime:1,date:1};const Et=e=>(t,i)=>{const o=Ot[e[t]],n=Ot[e[i]];let r=0;return r=o==n?t.toLowerCase()<i.toLowerCase()?-1:1:o<n?-1:1,r};const At=e=>{if(e){const t=xt(e[0]),i=xt(e[1]),o=Math.floor(e[0]/e[1]*100);return Object(b.html)(yt(),t,i,o)}},kt=e=>{if(""!==e)return Object(b.html)(bt(),e)},St=(e,...t)=>e.flatMap((e,i)=>[kt(e),At(t[i])]).filter(e=>e);class Tt extends gt{_validate_parsed_computed_columns(e,t){if(!e||0===e.length)return[];const i=[];for(const o of e)t[o.column]&&i.push(o);return i}async _load_table(e){this.shadowRoot.querySelector("#app").classList.add("hide_message");const t=this._set_updating();this._clear_state(),this._table=e;let[i,o]=await Promise.all([e.columns(),e.schema(!0)]);this._initial_col_order=i.slice();let n=this._get_view_parsed_computed_columns();if(0===n.length){const e=this._get_view_computed_columns();for(const t of e)"string"==typeof t?n=n.concat(He(t)):n.push(t)}const r=n.map(e=>e.column),s=await e.computed_schema(n);i=i.concat(r),this.hasAttribute("columns")||this.setAttribute("columns",JSON.stringify(this._initial_col_order)),i.sort(Et(o));const a=function(e,t,i,o){const n=new Set,r=[];for(const t of e){let e=i[t.column];e||(e=o[t.column]);const s=Object(h.get_type_config)(e);n.add(t.column),s.type||e?(""!==t.op&&-1!==_.a.TYPE_AGGREGATES[s.type||e].indexOf(t.op)||(t.op=s.aggregate),r.push(t)):console.warn('No column "'.concat(t.column,'" found (specified in aggregates attribute).'))}for(const e of t)if(!n.has(e)){let t=i[e];t||(t=o[e.column]),r.push({column:e,op:Object(h.get_type_config)(t).aggregate})}return r}(this.get_aggregate_attribute(),i,o,s);let c=JSON.parse(this.getAttribute("columns"));0===c.filter(e=>i.indexOf(e)>-1).length&&(c=this._initial_col_order),this._aggregate_defaults=function(e,t,i){const o={};for(const n of e){let e=t[n];e||(e=i[n]),o[n]=Object(h.get_type_config)(e).aggregate}return o}(i,o,s),this._clear_columns();for(const e of i){let t=a.find(t=>t.column===e).op;const i=r.includes(e)?e:void 0;let n=o[e];n||(n=s[e]);const l=this._new_row(e,n,t,null,null,i);this._inactive_columns.appendChild(l),c.includes(e)&&l.classList.add("active")}for(;c.length<(null===(l=this._plugin.initial)||void 0===l?void 0:null===(d=l.names)||void 0===d?void 0:d.length);){var l,d;c.push(null)}for(const e of c){const t=r.includes(e)?e:void 0;let i=o[name];i||(i=s[name]);const n=this._new_row(e,i,void 0,void 0,void 0,t);this._active_columns.appendChild(n)}i.length===c.filter(e=>i.indexOf(e)>-1).length?this._inactive_columns.parentElement.classList.add("collapse"):this._inactive_columns.parentElement.classList.remove("collapse"),this._show_column_container(),!0===await this._table.compute()&&this._show_side_panel_actions(),this.hasAttribute("filters")&&(this.filters=this.getAttribute("filters"));try{await this._debounce_update({force_update:!0})}catch(e){throw console.warn("Initial view failed, resetting UI state"),await this.reset(),e}t()}async get_maxes(){let e,t;const[i,o]=await Promise.all([this._view.schema(),this._view.num_columns()]),n=Object.keys(i||{}).length||1;if(void 0!==this._plugin.max_columns){const t=this._plugin.max_columns%n,i=this._plugin.max_columns+t;e=i<o?i:void 0}return void 0!==this._plugin.max_cells&&(t=Math.ceil(e?this._plugin.max_cells/e:this._plugin.max_cells/(o||1))),{max_cols:e,max_rows:t}}async _warn_render_size_exceeded(e,t){if(this._show_warnings&&(e||t)){const i=await this._view.num_columns(),o=await this._view.num_rows(),n=i*o,r=e&&e<i,s=t&&t<o;if(r&&s){this._plugin_information.classList.remove("hidden");const o=St(vt(),[e,i],[i*t,n]);return Object(b.render)(o,this._plugin_information_message),!0}if(r){this._plugin_information.classList.remove("hidden");const t=St(ft(),[e,i]);return Object(b.render)(t,this._plugin_information_message),!0}if(s){this._plugin_information.classList.remove("hidden");const e=St(mt(),[i*t,n]);return Object(b.render)(e,this._plugin_information_message),!0}this._plugin_information.classList.add("hidden")}return!1}_calculate_throttle_timeout(){let e;const t=this.getAttribute("throttle");if(void 0!==t&&"null"!==t&&this.hasAttribute("throttle")){if(e=parseInt(t),isNaN(e)||e<0)return console.warn('Bad throttle attribute value "'.concat(t,'".  Can be (non-negative integer) milliseconds.')),this.removeAttribute("throttle"),0}else{if(!this.__render_times||this.__render_times.length<5)return 0;e=this.__render_times.reduce((e,t)=>e+t,0)/this.__render_times.length,e=Math.min(5e3,e)}return Math.max(0,e)}_view_on_update(e){this._debounced||(this._debounced=setTimeout(async()=>{this._debounced=void 0;const t=this._render_time();this._task&&!this._task.initial&&this._task.cancel();const i=this._task=new _t,o=this._plugin.update||this._plugin.create;try{if(e){const{max_cols:e,max_rows:t}=await this.get_maxes();i.cancelled||(await this._warn_render_size_exceeded(e,t),await o.call(this,this._datavis,this._view,i,e,t))}else await o.call(this,this._datavis,this._view,i);t(),i.cancel()}catch(e){console.error("Error rendering plugin.",e)}finally{this.dispatchEvent(new Event("perspective-view-update"))}},this._calculate_throttle_timeout()))}async _validate_filters(){const e=[];for(const t of this._get_view_filter_nodes()){const i=t.shadowRoot.getElementById("filter_operand"),o=t.shadowRoot.getElementById("row_exclamation"),{operator:n,operand:r}=JSON.parse(t.getAttribute("filter")),s=[t.getAttribute("name"),n,r];await this._table.is_valid_filter(s)?(e.push(s),t.title="",i.style.borderColor="",o.hidden=!0):(t.title="Invalid Filter",i.style.borderColor="red",o.hidden=!1)}return e}_is_config_changed(e){const t=this.getAttribute("plugin");return(!ut()(e,this._previous_config)||t!==this._previous_plugin_name)&&(this._previous_config=e,this._previous_plugin_name=t,!0)}async _new_view({force_update:e=!1,ignore_size_check:t=!1,limit_points:i=!0}={}){if(!this._table)return;this._check_responsive_layout();const o=this._get_view_row_pivots(),n=this._get_view_column_pivots(),r=await this._validate_filters(),s=this._get_view_aggregates();if(0===s.length)return;const a=this._get_view_sorts();let c=s.map(e=>e.column),l={};for(const e of s)l[e.column]=e.op;for(const e of a){const t=e[0];if(-1===c.indexOf(t)&&!(n.indexOf(e)>-1||o.indexOf(e)>-1)){const e=this.get_aggregate_attribute(),{column:i,op:o}=e.reduce((e,i)=>i.column===t?i:e);l[i]=o}}const d={filter:r,row_pivots:o,column_pivots:n,aggregates:l,columns:c,sort:a,computed_columns:this._get_view_parsed_computed_columns()};this._view&&(this._view.remove_update(this._view_updater),this._view.delete(),this._view=void 0);try{this._view=this._table.view(d),this._view_updater=()=>this._view_on_update(i),this._view.on_update(this._view_updater)}catch(e){throw this._view.delete(),e}const p=this._render_time();this._render_count=(this._render_count||0)+1,this._task&&this._task.cancel();const u=this._task=new _t(()=>this._render_count--,!0);try{const{max_cols:o,max_rows:n}=await this.get_maxes();t||await this._warn_render_size_exceeded(o,n),i?await this._plugin.create.call(this,this._datavis,this._view,u,o,n,e):await this._plugin.create.call(this,this._datavis,this._view,u,void 0,void 0,e)}catch(e){console.warn(e)}finally{this.__render_times||(this.__render_times=[],this.dispatchEvent(new Event("perspective-view-update"))),p(),u.cancel(),0===this._render_count&&(this.removeAttribute("updating"),this.dispatchEvent(new Event("perspective-update-complete")))}}_check_loaded_table(){if(this._table){const e=this._table;delete this._table,this._load_table(e)}}_render_time(){const e=performance.now();return()=>{this.__render_times.unshift(performance.now()-e),this.__render_times=this.__render_times.slice(0,5)}}_restyle_plugin(){if(this._plugin.styleElement){const e=this._task=new _t;this._plugin.styleElement.call(this,this._datavis,this._view,e)}}_clear_state(e=!0){this._task&&this._task.cancel();const t=[];if(this._view){const e=this._view;this._view=void 0,t.push(e.delete()),e.remove_update(this._view_updater),e.remove_delete()}if(this._table&&e){const e=this._table;this._table=void 0,e._owner_viewer&&e._owner_viewer===this&&t.push(e.delete())}return Promise.all(t)}_set_updating(){let e;return this.toggleAttribute("updating",!0),this._updating_promise=new Promise(t=>{e=t}),e}_register_debounce_instance(){const e=a()((e,t,i,o)=>{this._new_view({ignore_size_check:t,force_update:i,limit_points:o}).then(e)},0);this._debounce_update=async({force_update:t=!1,ignore_size_check:i=!1,limit_points:o=!0}={})=>{if(this._table){let n=this._set_updating();await new Promise(n=>e(n,i,t,o)),n()}}}_get_worker(){return this._table?this._table._worker:_.a.shared_worker()}}function Lt(){const e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(['\n            <option value="','">',"</option>\n        "]);return Lt=function(){return e},e}const jt=e=>{const t=[];for(name in e)t.push(Object(b.html)(Lt(),name,e[name].name||name));return t};class Ct extends Tt{_clear_columns(){this._inactive_columns.innerHTML="",this._active_columns.innerHTML=""}set_aggregate_attribute(e){let t=!1,i=e.reduce((e,i)=>(this._aggregate_defaults[i.column]!==i.op&&(e[i.column]=i.op,t=!0),e),{});t?this.setAttribute("aggregates",JSON.stringify(i)):this.removeAttribute("aggregates")}_get_type(e){let t=this._get_view_inactive_columns();if(t.length>0){const i=t.find(t=>t.getAttribute("name")===e);return i?i.getAttribute("type"):"integer"}return""}_set_row_type(e){const t=this._get_view_inactive_columns().filter(e=>"integer"===e.getAttribute("type")||"float"===e.getAttribute("type")).map(e=>e.getAttribute("name"));e.set_weights(t),e.setAttribute("type",this._get_type(e.getAttribute("name")))}_new_row(e,t,i,o,n,r){let s=document.createElement("perspective-row");if(t=t||this._get_type(e),!i){let o=this.get_aggregate_attribute();i=o&&(i=o.find(t=>t.column===e))?i.op:Object(h.get_type_config)(t).aggregate}if(o&&(s.setAttribute("filter",o),"string"===t)){const t=this._table.view({row_pivots:[e],aggregates:{}});t.to_json().then(e=>{s.choices(this._autocomplete_choices(e))}),t.delete()}n?s.setAttribute("sort-order",n):this._get_view_column_pivots().indexOf(e)>-1?s.setAttribute("sort-order","col asc"):s.setAttribute("sort-order","asc");const a=this._get_view_inactive_columns().filter(e=>"integer"===e.getAttribute("type")||"float"===e.getAttribute("type")).map(e=>e.getAttribute("name"));return s.set_weights(a),null===e?s.classList.add("null-column"):(s.setAttribute("type",t),s.setAttribute("name",e)),s.setAttribute("aggregate",Array.isArray(i)?JSON.stringify(i):i),s.addEventListener("visibility-clicked",this._column_visibility_clicked.bind(this)),s.addEventListener("aggregate-selected",this._column_aggregate_clicked.bind(this)),s.addEventListener("filter-selected",this._column_filter_clicked.bind(this)),s.addEventListener("close-clicked",e=>$e.call(this,e.detail)),s.addEventListener("sort-order",this._sort_order_clicked.bind(this)),s.addEventListener("row-drag",()=>{this.classList.add("dragging"),this._active_columns.style.overflow="hidden",this._original_index=Array.prototype.slice.call(this._active_columns.children).findIndex(t=>t.getAttribute("name")===e),-1!==this._original_index?(this._drop_target_hover=this._active_columns.children[this._original_index],setTimeout(()=>s.setAttribute("drop-target",!0))):this._drop_target_hover=this._new_row(e,t,i)}),s.addEventListener("row-dragend",()=>{this._active_columns.style.overflow="auto",this.classList.remove("dragging")}),r&&(s.setAttribute("computed_column",JSON.stringify(r)),s.classList.add("computed")),s}_update_computed_column_view(e){const t=this._get_view_parsed_computed_columns(),i=this._get_view_all_column_names(),o=this._get_view_active_column_names();if(0===Object.keys(e).length||0===t.length)return;let n=0;const r=JSON.parse(this.getAttribute("columns"))||[];let s=!1;for(const a of t){const t=a.column;if(!i.includes(t)&&r.includes(t)&&(s=!0),!(!i.includes(t)&&!o.includes(t)))continue;const c=this._new_row(t,e[t],null,null,null,t);this._inactive_columns.appendChild(c),n++}s?this._update_column_view(r,!0):n>0&&this._inactive_columns.parentElement.classList.contains("collapse")&&this._inactive_columns.parentElement.classList.remove("collapse")}_diff_computed_column_view(e,t){const i=[],o=t.map(e=>e.column);for(const t of e)o.includes(t.column)||i.push(t);return i}_reset_computed_column_view(e){if(!e||0===e.length)return;const t=e.map(e=>e.column),i=this._get_view_active_column_names().filter(e=>!t.includes(e)),o=this._get_view_aggregates().filter(e=>!t.includes(e.column)),n=this._get_view_row_pivots().filter(e=>!t.includes(e)),r=this._get_view_column_pivots().filter(e=>!t.includes(e)),s=this._get_view_sorts().filter(e=>!t.includes(e[0])),a=this._get_view_filters().filter(e=>!t.includes(e[0]));this.set_aggregate_attribute(o),this.setAttribute("columns",JSON.stringify(i)),this.setAttribute("row-pivots",JSON.stringify(n)),this.setAttribute("column-pivots",JSON.stringify(r)),this.setAttribute("sort",JSON.stringify(s)),this.setAttribute("filters",JSON.stringify(a));const c=this._get_view_all_columns().filter(e=>e.classList.contains("computed"));for(const e of c)this._inactive_columns.removeChild(e);const l=this._get_view_active_columns().filter(e=>null!=e),d=this._get_view_inactive_columns();l.length===d.length?this._inactive_columns.parentElement.classList.add("collapse"):this._inactive_columns.parentElement.classList.remove("collapse")}_update_column_view(e,t=!1){if(e||(e=this._get_view_active_column_names()),this._plugin.initial&&this._plugin.initial.names)for(;e.length<this._plugin.initial.names.length;)e.push(null);this.setAttribute("columns",JSON.stringify(e));const i=e.filter(e=>null!=e),o=this._get_view_inactive_columns();i.length===o.length?this._inactive_columns.parentElement.classList.add("collapse"):this._inactive_columns.parentElement.classList.remove("collapse"),o.forEach(e=>{-1===i.indexOf(e.getAttribute("name"))?e.classList.remove("active"):e.classList.add("active")}),t&&this._update_column_list(e,this._active_columns,(e,t)=>{if(null===e)return this._new_row(null);{const i=o.find(t=>t.getAttribute("name")===e);if(i){const e=i.getAttribute("name");let o;return t.includes(e)&&(o=e),this._new_row(e,i.getAttribute("type"),void 0,void 0,void 0,o)}}})}_update_column_list(e,t,i,o){o=o||((e,t)=>t.getAttribute("name")===e);const n=Array.prototype.slice.call(t.children),r=this._get_view_parsed_computed_columns().map(e=>e.column);for(let s=0,a=0;s<n.length||a<e.length;s++,a++){const c=e[a],l=n[s],d=n[s+1];if(l)if(void 0===c)t.removeChild(l);else if(o(c,l))this._set_row_type(l);else if(l.classList.contains("null-column")){const e=i(c,r);e&&t.replaceChild(e,l)}else if(d&&o(c,d))t.removeChild(l),s++;else{const e=i(c,r);e&&(t.insertBefore(e,l),s--)}else{const e=i(c,r);e&&t.appendChild(e)}}}_set_row_styles(){let e="";if(this._plugin.initial&&this._plugin.initial.names)for(const t in this._plugin.initial.names){const i=this._plugin.initial.names[t];e+="#active_columns perspective-row:nth-child(".concat(parseInt(t)+1,"){margin-top:23px;}"),e+="#active_columns perspective-row:nth-child(".concat(parseInt(t)+1,'):before{content:"').concat(i,'";}')}this.shadowRoot.querySelector("#psp_styles").innerHTML=e}_show_column_container(){this.shadowRoot.querySelector("#columns_container").style.visibility="visible"}_show_side_panel_actions(){this.shadowRoot.querySelector("#side_panel__actions").style.visibility="visible"}_remove_null_columns(e=0){const t=this._get_view_active_columns();for(;++e<t.length;){const i=t[e];i.classList.contains("null-column")&&this.shadowRoot.querySelector("#active_columns").removeChild(i)}}_set_column_defaults(){const e=this._get_view_all_columns(),t=this._get_view_active_valid_columns(),i=this._get_view_active_valid_column_names();if(e.length>0)if(this._plugin.initial){let i=[],o=this._plugin.initial.count||2;this._fill_numeric(t,i),this._fill_numeric(e,i),this._fill_numeric(e,i,!0),i=i.slice(0,o);const n=this._plugin.initial.names;for(;n&&i.length<n.length;)i.push(null);this.setAttribute("columns",JSON.stringify(i))}else"select"===this._plugin.selectMode?this.setAttribute("columns",JSON.stringify([e[0].getAttribute("name")])):(this.setAttribute("columns",JSON.stringify(i)),this._remove_null_columns())}_fill_numeric(e,t,i=!1){for(let o of e){let e=o.getAttribute("type"),n=o.getAttribute("name");(i||["float","integer"].indexOf(e)>-1&&-1===t.indexOf(n))&&t.push(n)}}async _check_responsive_layout(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("#app");if(this.clientHeight<500&&this.clientWidth>600&&this._get_view_columns({active:!1}).length>this._get_view_columns().length){if(!e.classList.contains("columns_horizontal")){const t=this._persisted_side_panel_width;return this._persisted_side_panel_width=this._side_panel.style.width,this._side_panel.style.width=t||"",e.classList.add("columns_horizontal"),!1}return!1}if(e.classList.contains("columns_horizontal")){const t=this.shadowRoot.querySelector("#pivot_chart_container");t.clientWidth,this._side_panel.clientWidth;const i=this._persisted_side_panel_width||t.clientWidth+this._side_panel.clientWidth/2,o=t.clientHeight+50;return await this._pre_resize(i,o,()=>{const t=this._persisted_side_panel_width;this._persisted_side_panel_width=this._side_panel.style.width,this._side_panel.style.width=t||"",e.classList.remove("columns_horizontal")}),!0}}return!1}_register_ids(){this._aggregate_selector=this.shadowRoot.querySelector("#aggregate_selector"),this._vis_selector=this.shadowRoot.querySelector("#vis_selector"),this._filters=this.shadowRoot.querySelector("#filters"),this._row_pivots=this.shadowRoot.querySelector("#row_pivots"),this._column_pivots=this.shadowRoot.querySelector("#column_pivots"),this._datavis=this.shadowRoot.querySelector("#pivot_chart"),this._active_columns=this.shadowRoot.querySelector("#active_columns"),this._inactive_columns=this.shadowRoot.querySelector("#inactive_columns"),this._side_panel_actions=this.shadowRoot.querySelector("#side_panel__actions"),this._add_computed_expression_button=this.shadowRoot.querySelector("#add-computed-expression"),this._computed_expression_editor=this.shadowRoot.querySelector("perspective-computed-expression-editor"),this._inner_drop_target=this.shadowRoot.querySelector("#drop_target_inner"),this._drop_target=this.shadowRoot.querySelector("#drop_target"),this._config_button=this.shadowRoot.querySelector("#config_button"),this._reset_button=this.shadowRoot.querySelector("#reset_button"),this._download_button=this.shadowRoot.querySelector("#download_button"),this._copy_button=this.shadowRoot.querySelector("#copy_button"),this._side_panel=this.shadowRoot.querySelector("#side_panel"),this._top_panel=this.shadowRoot.querySelector("#top_panel"),this._sort=this.shadowRoot.querySelector("#sort"),this._transpose_button=this.shadowRoot.querySelector("#transpose_button"),this._plugin_information=this.shadowRoot.querySelector(".plugin_information"),this._plugin_information_action=this.shadowRoot.querySelector(".plugin_information__action"),this._plugin_information_action_close=this.shadowRoot.querySelector(".plugin_information__action--close"),this._plugin_information_message=this.shadowRoot.querySelector("#plugin_information_count"),this._resize_bar=this.shadowRoot.querySelector("#resize_bar")}_register_view_options(){let e=r.b.getInstance();Object(b.render)(jt(e),this._vis_selector)}_register_data_attribute(){if(this.getAttribute("data")){let e=this.getAttribute("data");try{e=JSON.parse(e)}catch(e){}this.load(e)}}_autocomplete_choices(e){return e.slice(1,e.length).map(e=>e.__ROW_PATH__).filter(e=>Array.isArray(e)?e.filter(e=>!!e).length>0:!!e)}}class Nt extends Ct{_show_context_menu(e){return this.shadowRoot.querySelector("#app").classList.toggle("show_menu"),e.stopPropagation(),e.preventDefault(),!1}_hide_context_menu(){this.shadowRoot.querySelector("#app").classList.remove("show_menu")}async _toggle_config(e){if(!e||2!==e.button){this._show_config=!this._show_config,this._hide_context_menu();const e=this.shadowRoot.querySelector("#pivot_chart_container");this._show_config?await this._post_resize(()=>{this.toggleAttribute("settings",!0)},()=>{this._side_panel.style.display="flex",this._top_panel.style.display="flex",this.dispatchEvent(new CustomEvent("perspective-toggle-settings",{detail:this._show_config}))}):await this._pre_resize(e.clientWidth+this._side_panel.clientWidth,e.clientHeight+this._top_panel.clientHeight,()=>{this._side_panel.style.display="none",this._top_panel.style.display="none",this.removeAttribute("settings")},()=>this.dispatchEvent(new CustomEvent("perspective-toggle-settings",{detail:this._show_config})))}}async _pre_resize(e,t,i,o){this._datavis.style.width="".concat(e,"px"),this._datavis.style.height="".concat(t,"px");try{!document.hidden&&this.offsetParent&&await this._plugin.resize.call(this)}finally{null==o||o(),this._datavis.style.width="100%",this._datavis.style.height="100%",i()}}async _post_resize(e,t){null==t||t();try{!document.hidden&&this.offsetParent&&await this._plugin.resize.call(this)}finally{e()}}_open_computed_expression_editor(e){e.stopImmediatePropagation(),0==this._computed_expression_editor.expressions.length?this._computed_expression_editor._disable_remove_button():this._computed_expression_editor._enable_remove_button(),this._computed_expression_editor.style.display="flex",this._side_panel_actions.style.display="none",this._computed_expression_editor._observe_textarea()}_save_computed_expression(e){const t=e.detail.expression;let i=this._get_view_computed_columns();i.includes(t)?console.warn('"'.concat(t,'" was not applied because it already exists.')):(i.push(t),this.setAttribute("computed-columns",JSON.stringify(i)))}async _type_check_computed_expression(e){const t=e.detail.parsed_expression||[];if(0===t.length)return void this._computed_expression_editor._type_check_expression({});const i={};for(const e of t)i[e.column]=e.computed_function_name;const o=await this._table.computed_schema(t),n={};for(const e in i)o[e]||(n[e]=await this._table.get_computation_input_types(i[e]));this._computed_expression_editor._type_check_expression(o,n)}_clear_all_computed_expressions(){this.setAttribute("computed-columns",JSON.stringify([]))}_set_computed_expression(e){return e}_column_visibility_clicked(e){const t=e.currentTarget;if("active_columns"===t.parentElement.getAttribute("id")){var i;const s=(null===(i=this._plugin.initial)||void 0===i?void 0:i.count)||1;if(this._get_view_active_valid_column_count()===s)return;if(e.detail.shiftKey)for(let e of Array.prototype.slice.call(this._active_columns.children))e!==t&&this._active_columns.removeChild(e);else{var o,n,r;const e=Array.prototype.slice.call(this._active_columns.children).indexOf(t);if(e<(null===(o=this._plugin.initial)||void 0===o?void 0:o.count))return;e<(null===(n=this._plugin.initial)||void 0===n?void 0:null===(r=n.names)||void 0===r?void 0:r.length)-1&&this._active_columns.insertBefore(this._new_row(null),t),this._active_columns.removeChild(t)}}else{var s;if(e.detail.shiftKey&&"toggle"===this._plugin.selectMode||!e.detail.shiftKey&&"select"===this._plugin.selectMode)for(let e of Array.prototype.slice.call(this._active_columns.children))this._active_columns.removeChild(e);let i=this._new_row(t.getAttribute("name"),t.getAttribute("type"));const o=this._get_view_active_columns();let n=o.length-1;if(o[n]&&(null===(s=o[n])||void 0===s?void 0:s.classList.contains("null-column"))){for(;n-- >0;)if(!o[n].classList.contains("null-column")){this._active_columns.replaceChild(i,o[n+1]);break}}else this._active_columns.appendChild(i)}this._check_responsive_layout(),this._update_column_view()}_column_aggregate_clicked(){let e=this.get_aggregate_attribute(),t=this._get_view_aggregates();for(let i of e){let e=t.find(e=>e.column===i.column);e&&(i.op=e.op)}this.set_aggregate_attribute(e),this._update_column_view(),this._debounce_update()}_column_filter_clicked(){let e=this._get_view_filters();this._updating_filter=!0,this.setAttribute("filters",JSON.stringify(e)),this._updating_filter=!1,this._debounce_update()}_increment_sort(e,t,i){let o=["asc","desc"];return t&&o.push("col asc","col desc"),i&&(o=o.map(e=>"".concat(e," abs"))),o.push("none"),o[(o.indexOf(e)+1)%o.length]}_sort_order_clicked(e){const t=e.target,i=e.detail.shiftKey&&"string"!==t.getAttribute("type"),o=this._increment_sort(t.getAttribute("sort-order"),this._get_view_column_pivots().length>0,i);t.setAttribute("sort-order",o);const n=this._get_view_sorts();this.setAttribute("sort",JSON.stringify(n))}_transpose(){const e=this.hasAttribute("row-pivots"),t=this.hasAttribute("column-pivots");if(e&&t){let e=this.getAttribute("row-pivots");this.setAttribute("row-pivots",this.getAttribute("column-pivots")),this.setAttribute("column-pivots",e)}else if(e){let e=this.getAttribute("row-pivots");this.removeAttribute("row-pivots"),this.setAttribute("column-pivots",e)}else if(t){let e=this.getAttribute("column-pivots");this.removeAttribute("column-pivots"),this.setAttribute("row-pivots",e)}else this.removeAttribute("column-pivots"),this.removeAttribute("row-pivots")}_reset_sidepanel(){this._side_panel.style.width=""}_resize_sidepanel(e){const t=document.body.style.cursor;document.body.style.cursor="col-resize";const i=e.clientX,o=this._side_panel.offsetWidth,n=e=>{const t=Math.max(0,Math.min(o+(e.clientX-i),this.offsetWidth-10));this._side_panel.style.width="".concat(t,"px"),this._plugin&&this.notifyResize()},r=()=>{document.body.style.cursor=t,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",r)}_vis_selector_changed(){var e;this._plugin_information.classList.add("hidden"),this.setAttribute("plugin",this._vis_selector.value),this._active_columns.classList.remove("one_lock","two_lock");const t=["one_lock","two_lock"][(null===(e=this._plugin.initial)||void 0===e?void 0:e.count)-1];t&&this._active_columns.classList.add(t),this._debounce_update()}_register_callbacks(){this._sort.addEventListener("drop",et.bind(this)),this._sort.addEventListener("dragend",$e.bind(this)),this._sort.addEventListener("dragenter",ct.bind(this)),this._sort.addEventListener("dragover",lt.bind(this)),this._sort.addEventListener("dragleave",dt.bind(this)),this._row_pivots.addEventListener("drop",et.bind(this)),this._row_pivots.addEventListener("dragend",$e.bind(this)),this._row_pivots.addEventListener("dragenter",ct.bind(this)),this._row_pivots.addEventListener("dragover",lt.bind(this)),this._row_pivots.addEventListener("dragleave",dt.bind(this)),this._column_pivots.addEventListener("drop",et.bind(this)),this._column_pivots.addEventListener("dragend",$e.bind(this)),this._column_pivots.addEventListener("dragenter",ct.bind(this)),this._column_pivots.addEventListener("dragover",lt.bind(this)),this._column_pivots.addEventListener("dragleave",dt.bind(this)),this._filters.addEventListener("drop",et.bind(this)),this._filters.addEventListener("dragend",$e.bind(this)),this._filters.addEventListener("dragenter",ct.bind(this)),this._filters.addEventListener("dragover",lt.bind(this)),this._filters.addEventListener("dragleave",dt.bind(this)),this._active_columns.addEventListener("drop",at.bind(this)),this._active_columns.addEventListener("dragenter",ct.bind(this)),this._active_columns.addEventListener("dragend",tt.bind(this)),this._active_columns.addEventListener("dragover",st.bind(this)),this._active_columns.addEventListener("dragleave",it.bind(this)),this._add_computed_expression_button.addEventListener("click",this._open_computed_expression_editor.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-save",this._save_computed_expression.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-resize",this._reset_sidepanel.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-type-check",this._type_check_computed_expression.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-remove",this._clear_all_computed_expressions.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-update",this._set_computed_expression.bind(this)),this._config_button.addEventListener("mousedown",this._toggle_config.bind(this)),this._config_button.addEventListener("contextmenu",this._show_context_menu.bind(this)),this._reset_button.addEventListener("click",this.reset.bind(this)),this._copy_button.addEventListener("click",e=>this.copy(e.shiftKey)),this._download_button.addEventListener("click",e=>this.download(e.shiftKey)),this._transpose_button.addEventListener("click",this._transpose.bind(this)),this._drop_target.addEventListener("dragover",lt.bind(this)),this._resize_bar.addEventListener("mousedown",this._resize_sidepanel.bind(this)),this._resize_bar.addEventListener("dblclick",this._reset_sidepanel.bind(this)),this._vis_selector.addEventListener("change",this._vis_selector_changed.bind(this)),this._plugin_information_action.addEventListener("click",()=>{this._debounce_update({ignore_size_check:!0,limit_points:!1}),this._plugin_information.classList.add("hidden")}),this._plugin_information_action_close.addEventListener("click",()=>{this._plugin_information.classList.add("hidden")})}}var It,Rt;function zt(e,t,i,o,n){var r={};return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}const Pt=["selectable","editable","plugin","computed-columns","row-pivots","column-pivots","aggregates","filters","sort","columns"];Object(n.b)(Ye.a,Xe.a,Ve.a)((zt((Rt=class extends Nt{constructor(){super(),this._register_debounce_instance(),this._show_config=!0,this._show_warnings=!0,this.__render_times=[],this._resize_handler=this.notifyResize.bind(this),window.addEventListener("resize",this._resize_handler)}connectedCallback(){0===Object.keys(r.b.getInstance()).length&&Object(r.a)(),this.toggleAttribute("settings",!0),this._register_ids(),this._register_callbacks(),this._register_view_options(),this._register_data_attribute(),this.toggleConfig(),this._check_loaded_table()}sort(e){null!=e&&0!==e.length||(this.hasAttribute("sort")&&this.removeAttribute("sort"),e=[]);var t=this._sort.querySelector("ul");this._update_column_list(e,t,(e,t)=>{let i="asc";Array.isArray(e)&&(i=e[1],e=e[0]);let o=void 0;return t.includes(e)&&(o=e),this._new_row(e,!1,!1,!1,i,o)},(e,t)=>Array.isArray(e)?t.getAttribute("name")===e[0]&&t.getAttribute("sort-order")===e[1]:t.getAttribute("name")===e),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}columns(e){null!=e&&0!==e.length||(this.hasAttribute("columns")&&(this._initial_col_order?this.setAttribute("columns",JSON.stringify(this._initial_col_order)):this.removeAttribute("columns")),e=(this._initial_col_order||[]).slice()),this._update_column_view(e,!0),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}"computed-columns"(e){const t=this._set_updating();(async()=>{if("none"!==this._computed_expression_editor.style.display&&this._computed_expression_editor._close_expression_editor(),null==e||0===e.length){if(this.hasAttribute("computed-columns")){this.removeAttribute("computed-columns");const e=this._get_view_parsed_computed_columns();return this._reset_computed_column_view(e),this.removeAttribute("parsed-computed-columns"),void t()}e=[]}let i=[];for(const t of e)"string"==typeof t?i=i.concat(He(t)):i.push(t);let o={};if(this._table){o=await this._table.computed_schema(i);const e=await this._validate_parsed_computed_columns(i,o);if(e.length!==i.length){const t=[];for(let o=0;o<i.length;o++)o>e.length-1?t.push(i[o]):i[o].column!==e[o].column&&t.push(i[o]);console.warn("Could not apply these computed columns:",JSON.stringify(t))}i=e}const n=this._get_view_parsed_computed_columns(),r=this._diff_computed_column_view(n,i);this._reset_computed_column_view(r),this.setAttribute("parsed-computed-columns",JSON.stringify(i)),this._update_computed_column_view(o),this.dispatchEvent(new Event("perspective-config-update")),await this._debounce_update(),t()})()}aggregates(e){null!=e&&0!==Object.keys(e).length||(this.hasAttribute("aggregates")&&this.removeAttribute("aggregates"),e={}),this._get_view_dom_columns().map(t=>{let i=e[t.getAttribute("name")];i&&t.setAttribute("aggregate",Array.isArray(i)?JSON.stringify(i):i)}),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}filters(e){if(null!=e&&0!==e.length||(this.hasAttribute("filters")&&this.removeAttribute("filters"),e=[]),!this._updating_filter){var t=this._filters.querySelector("ul");this._update_column_list(e,t,(e,t)=>{const i=JSON.stringify({operator:e[1],operand:e[2]}),o=e[0];let n=void 0;return t.includes(o)&&(n=o),this._new_row(o,void 0,void 0,i,void 0,n)},(e,t)=>t.getAttribute("name")===e[0]&&t.getAttribute("filter")===JSON.stringify({operator:e[1],operand:e[2]}))}this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}set plugin(e){if("null"===e||null==e)return void this.setAttribute("plugin",this._vis_selector.options[0].value);const t=Object.keys(r.b.getInstance());if(this.hasAttribute("plugin")){let e=this.getAttribute("plugin");if(-1===t.indexOf(e)){const i=t.find(t=>t.indexOf(e)>-1);i?(console.warn('Unknown plugin "'.concat(e,'", using "').concat(i,'"')),this.setAttribute("plugin",i)):(console.error('Unknown plugin "'.concat(e,'"')),this.setAttribute("plugin",this._vis_selector.options[0].value))}else this._vis_selector.value!==e&&(this._vis_selector.value=e,this._vis_selector_changed()),this._set_row_styles(),this._set_column_defaults(),this.dispatchEvent(new Event("perspective-config-update"))}else this.setAttribute("plugin",this._vis_selector.options[0].value)}"column-pivots"(e){null!=e&&0!==e.length||(this.hasAttribute("column-pivots")&&this.removeAttribute("column-pivots"),e=[]);const t=this._column_pivots.querySelector("ul");this._update_column_list(e,t,(e,t)=>{let i=void 0;return t.includes(e)&&(i=e),this._new_row(e,void 0,void 0,void 0,void 0,i)}),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}"row-pivots"(e){null!=e&&0!==e.length||(this.hasAttribute("row-pivots")&&this.removeAttribute("row-pivots"),e=[]);const t=this._row_pivots.querySelector("ul");this._update_column_list(e,t,(e,t)=>{let i=void 0;return t.includes(e)&&(i=e),this._new_row(e,void 0,void 0,void 0,void 0,i)}),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}set editable(e){"null"===e?this.hasAttribute("editable")&&this.removeAttribute("editable"):this.toggleAttribute("editable",!0),this._debounce_update({force_update:!0}),this.dispatchEvent(new Event("perspective-config-update"))}set throttle(e){"null"===e&&this.hasAttribute("throttle")&&this.removeAttribute("throttle"),this._calculate_throttle_timeout()}set selectable(e){"null"===e?this.hasAttribute("selectable")&&this.removeAttribute("selectable"):this.toggleAttribute("selectable",!0),this._debounce_update({force_update:!0}),this.dispatchEvent(new Event("perspective-config-update"))}get worker(){return this._get_worker()}get table(){return this._table}get view(){return this._view}async load(e,t){let i;if(e instanceof Promise)i=await e;else{try{e=e.trim()}catch(e){}"table"===e.type?i=e:(i=this.worker.table(e,t),i._owner_viewer=this)}this.isConnected?await this._load_table(i):this._table=i}update(e){void 0===this._table?this.load(e):this._table.update(e)}async notifyResize(e){await this._check_responsive_layout()||document.hidden||!this.offsetParent||await this._plugin.resize.call(this,e)}clone(e){this._inner_drop_target&&(this._inner_drop_target.innerHTML=e._inner_drop_target.innerHTML),this._load_table(e.table),this.restore(e.save())}delete(e=!0){let t=this._clear_state(e);return this._plugin.delete&&this._plugin.delete.call(this),window.removeEventListener("load",this._resize_handler),window.removeEventListener("resize",this._resize_handler),t}restyleElement(){this._restyle_plugin()}save(){let e={};const t=new Set(Pt);for(let i=0;i<this.attributes.length;i++){let o=this.attributes[i];t.has(o.name)&&(""===o.value?e[o.name]=!0:"plugin"!==o.name&&void 0!==o.value&&null!==o.value?e[o.name]=JSON.parse(o.value):e[o.name]=o.value,t.delete(o.name))}for(const i of t)e[i]=null;return this._plugin.save&&(e.plugin_config=this._plugin.save.call(this)),e}async restore(e){"string"==typeof e&&(e=JSON.parse(e));for(const t of Pt)if(e.hasOwnProperty(t)){let i=e[t];!0===i?this.toggleAttribute(t,!0):null!=i&&!1!==i?("string"!=typeof i&&(i=JSON.stringify(i)),this.setAttribute(t,i)):this.removeAttribute(t)}this._plugin.restore&&e.plugin_config&&this._plugin.restore.call(this,e.plugin_config),await this._debounce_update()}async flush(){for(await new Promise(setTimeout);this.hasAttribute("updating");)await this._updating_promise}clear(){var e;null===(e=this._table)||void 0===e||e.clear()}replace(e){this._table?this._table.replace(e):this._load(e)}reset(){this.removeAttribute("row-pivots"),this.removeAttribute("column-pivots"),this.removeAttribute("filters"),this.removeAttribute("sort"),this._initial_col_order?this.setAttribute("columns",JSON.stringify(this._initial_col_order)):this.removeAttribute("columns"),this.setAttribute("plugin",Object.keys(r.b.getInstance())[0]),this.dispatchEvent(new Event("perspective-config-update")),this._hide_context_menu()}async download(e=!1){const t=e?this._table.view():this._view,i=await t.to_csv(),o=document.createElement("a"),n=i,r=n.length,s=new Uint8Array(r);for(let e=0;e<r;e++)s[e]=n.charCodeAt(e);const a=new Blob([s]);o.setAttribute("href",URL.createObjectURL(a)),o.setAttribute("download","perspective.csv"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),this._hide_context_menu()}copy(e=!1){let t;(e?this._table.view():this._view).to_csv().then(e=>{t=e}).catch(e=>{console.error(e),t=""});let i=0,o=()=>{void 0!==t?Object(n.c)(t):i<200?(i++,setTimeout(o,50)):console.warn("Timeout expired - copy to clipboard cancelled.")};o(),this._hide_context_menu()}async toggleConfig(){await this._toggle_config()}}).prototype,"sort",[n.a],Object.getOwnPropertyDescriptor(Rt.prototype,"sort"),Rt.prototype),zt(Rt.prototype,"columns",[n.a],Object.getOwnPropertyDescriptor(Rt.prototype,"columns"),Rt.prototype),zt(Rt.prototype,"computed-columns",[n.a],Object.getOwnPropertyDescriptor(Rt.prototype,"computed-columns"),Rt.prototype),zt(Rt.prototype,"aggregates",[n.d],Object.getOwnPropertyDescriptor(Rt.prototype,"aggregates"),Rt.prototype),zt(Rt.prototype,"filters",[n.a],Object.getOwnPropertyDescriptor(Rt.prototype,"filters"),Rt.prototype),zt(Rt.prototype,"column-pivots",[n.a],Object.getOwnPropertyDescriptor(Rt.prototype,"column-pivots"),Rt.prototype),zt(Rt.prototype,"row-pivots",[n.a],Object.getOwnPropertyDescriptor(Rt.prototype,"row-pivots"),Rt.prototype),zt(Rt.prototype,"notifyResize",[n.f],Object.getOwnPropertyDescriptor(Rt.prototype,"notifyResize"),Rt.prototype),It=Rt))}])}));
//# sourceMappingURL=perspective-viewer.js.map