!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("chevrotain"),require("lit-html"),require("core-js/modules/web.dom-collections.iterator"),require("@finos/perspective/dist/esm/config"),require("@finos/perspective"),require("core-js/modules/es.string.replace"),require("lodash/debounce"),require("awesomplete"),require("lodash/isEqual"),require("core-js/modules/es.typed-array.uint8-array"),require("core-js/modules/web.url"),require("@webcomponents/webcomponentsjs"),require("core-js/modules/es.array.unscopables.flat-map"));else if("function"==typeof define&&define.amd)define(["chevrotain","lit-html","core-js/modules/web.dom-collections.iterator","@finos/perspective/dist/esm/config","@finos/perspective","core-js/modules/es.string.replace","lodash/debounce","awesomplete","lodash/isEqual","core-js/modules/es.typed-array.uint8-array","core-js/modules/web.url","@webcomponents/webcomponentsjs","core-js/modules/es.array.unscopables.flat-map"],e);else{var i="object"==typeof exports?e(require("chevrotain"),require("lit-html"),require("core-js/modules/web.dom-collections.iterator"),require("@finos/perspective/dist/esm/config"),require("@finos/perspective"),require("core-js/modules/es.string.replace"),require("lodash/debounce"),require("awesomplete"),require("lodash/isEqual"),require("core-js/modules/es.typed-array.uint8-array"),require("core-js/modules/web.url"),require("@webcomponents/webcomponentsjs"),require("core-js/modules/es.array.unscopables.flat-map")):e(t.chevrotain,t["lit-html"],t["core-js/modules/web.dom-collections.iterator"],t["@finos/perspective/dist/esm/config"],t["@finos/perspective"],t["core-js/modules/es.string.replace"],t["lodash/debounce"],t.awesomplete,t["lodash/isEqual"],t["core-js/modules/es.typed-array.uint8-array"],t["core-js/modules/web.url"],t["@webcomponents/webcomponentsjs"],t["core-js/modules/es.array.unscopables.flat-map"]);for(var o in i)("object"==typeof exports?exports:t)[o]=i[o]}}(window,(function(t,e,i,o,n,r,s,a,l,c,d,p,_){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=26)}([function(e,i){e.exports=t},function(t,e,i){"use strict";(function(t){i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return s})),i.d(e,"f",(function(){return l})),i.d(e,"e",(function(){return c})),i.d(e,"d",(function(){return d})),i.d(e,"a",(function(){return p}));i(3);function o(t,e,i){const o=function(t){const e=document.createElement("div");return e.innerHTML=t,Array.prototype.slice.call(e.children)[0]}(t);!function(t){if(t.content)return;let e;for(t.content=document.createDocumentFragment();e=t.firstChild;)Node.prototype.appendChild.call(t.content,e)}(o),e&&(o.innerHTML=`<style>${e.toString()}</style>`+o.innerHTML),o.innerHTML=`<style id="psp_styles" scope="${o.getAttribute("id")}">test{}</style>`+o.innerHTML;for(let t of Object.getOwnPropertyNames(i.prototype)){let e=Object.getOwnPropertyDescriptor(i.prototype,t);if(e&&e.set){let o=e.set;e.set=function(e){this.hasAttribute(t)&&this.getAttribute(t)===e?(this._initializing||this._initialized)&&o.call(this,e):this.setAttribute(t,e)},Object.defineProperty(i.prototype,t,e)}}let n=o.getAttribute("id");console.log(`Registered ${n}`),window.customElements.define(n,class extends i{attributeChangedCallback(t,e,o){null===o&&(o="null"),"_"!==t[0]&&e!=o&&Object.getOwnPropertyDescriptor(i.prototype,t).set&&(this[t]=o)}connectedCallback(){if(!this._initialized){this._initializing=!0;var t=document.importNode(o.content,!0);this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t),super.connectedCallback&&super.connectedCallback();for(let t of Object.getOwnPropertyNames(i.prototype))"connectedCallback"!==t&&this.hasAttribute(t)&&"_"!==t[0]&&Object.getOwnPropertyDescriptor(i.prototype,t).set&&(this[t]=this.getAttribute(t));this._initializing=!1,this._initialized=!0}}static get observedAttributes(){return Object.getOwnPropertyNames(i.prototype)}})}function n(t,...e){const i=e.map(t=>t.toString()).join("\n");return function(e){return o(t,{toString:()=>i},e)}}function r(t){return function(e,i,o){const n=o.value;return o.set=function(e){let o=this.getAttribute(i);try{null!=e&&""!==e||(e=t()),"string"!=typeof e&&(e=JSON.stringify(e)),e!==o&&(o=e),o=JSON.parse(o)}catch(n){console.warn(`Invalid value for attribute "${i}": ${e}`),o=t()}n.call(this,o)},o.get=function(){return this.hasAttribute(i)?JSON.parse(this.getAttribute(i)):t()},delete o.value,delete o.writable,o}}function s(t){let e=document.createElement("textarea");document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e)}const a=()=>{let t,e=new Promise(e=>{t=e});return e.resolve=t,e};function l(t,e,i){const o=Symbol("private lock"),n=i.value;return i.value=async function(...t){if(this[o]&&(await this[o],this[o]))return void await this[o];let e;this[o]=a();try{e=await n.call(this,...t)}catch(t){console.error(t)}finally{const t=this[o];return this[o]=void 0,t.resolve(),e}},i}function c(t,...e){if(e[0]===e[1])return;if(e.every(t=>t.classList.contains("null-column")))return;let[i,o]=e.map(e=>Array.prototype.slice.call(t.children).indexOf(e));o<i&&([i,o]=[o,i],e=e.reverse()),t.insertBefore(e[1],e[0]),o+1===t.children.length?t.appendChild(e[0]):t.insertBefore(e[0],t.children[o+1])}const d=r(()=>({})),p=r(()=>[])}).call(this,i(11))},function(t,i){t.exports=e},function(t,e){t.exports=i},function(t,e){t.exports=o},function(t,e,i){"use strict";(function(t){i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return a}));i(3);var o=i(2);const n={},r=new class{registerPlugin(t,e){if(n[t])throw new Error(`A perspective-viewer plugin "${t}" has already been registered`);for(const i in n){const o=n[i];o&&o.name===e.name&&(console.warn(`Conflicting plugin name "${e.name}", qualifying with id`),o.name=`${o.name} [${i}]`,e.name=`${e.name} [${t}]`)}n[t]=e}getPlugin(t){return n[t]}getInstance(){return n}};t.registerPlugin=r.registerPlugin,t.getPlugin=r.getPlugin,t.__perspective_plugins__&&t.__perspective_plugins__.forEach(([e,i])=>t.registerPlugin(e,i));const s=t=>o.html`
        <pre style="margin:0;overflow:scroll;position:absolute;width:100%;height:100%">${t}</pre>
    `;function a(){t.registerPlugin("debug",{name:"Debug",create:async function(t){const e=await this._view.to_csv({config:{delimiter:"|"}}),i=this._render_time();Object(o.render)(s(e),t),i()},selectMode:"toggle",resize:function(){},delete:function(){}})}}).call(this,i(11))},function(t,e){t.exports=n},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",o=t[3];if(!o)return i;if(e&&"function"==typeof btoa){var n=(s=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),r=o.sources.map((function(t){return"/*# sourceURL="+o.sourceRoot+t+" */"}));return[i].concat(r).concat([n]).join("\n")}var s;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var o={},n=0;n<this.length;n++){var r=this[n][0];"number"==typeof r&&(o[r]=!0)}for(n=0;n<t.length;n++){var s=t[n];"number"==typeof s[0]&&o[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),e.push(s))}},e}},function(t,e){t.exports=r},function(t,e){t.exports=s},function(t,e){t.exports=a},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){(t.exports=i(7)(!1)).push([t.i,'.awesomplete [hidden] {\n    display: none;\n}\n\n.awesomplete .visually-hidden {\n    position: absolute;\n    clip: rect(0, 0, 0, 0);\n}\n\n.awesomplete {\n    display: inline-block;\n    position: relative;\n}\n\n.awesomplete > input {\n    display: block;\n}\n\n.awesomplete > ul {\n    position: absolute;\n    left: 0;\n    z-index: 1;\n    min-width: 100%;\n    box-sizing: border-box;\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    background: #fff;\n}\n\n.awesomplete > ul:empty {\n    display: none;\n}\n\n.awesomplete > ul {\n\tborder-radius: .3em;\n\tmargin: .2em 0 0;\n\tbackground: hsla(0,0%,100%,.9);\n\tbackground: linear-gradient(to bottom right, white, hsla(0,0%,100%,.8));\n\tborder: 1px solid rgba(0,0,0,.3);\n\tbox-shadow: .05em .2em .6em rgba(0,0,0,.2);\n\ttext-shadow: none;\n}\n\n@supports (transform: scale(0)) {\n\t.awesomplete > ul {\n\t\ttransition: .3s cubic-bezier(.4,.2,.5,1.4);\n\t\ttransform-origin: 1.43em -.43em;\n\t}\n\t\n\t.awesomplete > ul[hidden],\n\t.awesomplete > ul:empty {\n\t\topacity: 0;\n\t\ttransform: scale(0);\n\t\tdisplay: block;\n\t\ttransition-timing-function: ease;\n\t}\n}\n\n\t/* Pointer */\n\t.awesomplete > ul:before {\n\t\tcontent: "";\n\t\tposition: absolute;\n\t\ttop: -.43em;\n\t\tleft: 1em;\n\t\twidth: 0; height: 0;\n\t\tpadding: .4em;\n\t\tbackground: white;\n\t\tborder: inherit;\n\t\tborder-right: 0;\n\t\tborder-bottom: 0;\n\t\t-webkit-transform: rotate(45deg);\n\t\ttransform: rotate(45deg);\n\t}\n\n\t.awesomplete > ul > li {\n\t\tposition: relative;\n\t\tpadding: .2em .5em;\n\t\tcursor: pointer;\n\t}\n\t\n\t.awesomplete > ul > li:hover {\n\t\tbackground: hsl(200, 40%, 80%);\n\t\tcolor: black;\n\t}\n\t\n\t.awesomplete > ul > li[aria-selected="true"] {\n\t\tbackground: hsl(205, 40%, 40%);\n\t\tcolor: white;\n\t}\n\t\n\t\t.awesomplete mark {\n\t\t\tbackground: hsl(65, 100%, 50%);\n\t\t}\n\t\t\n\t\t.awesomplete li:hover mark {\n\t\t\tbackground: hsl(68, 100%, 41%);\n\t\t}\n\t\t\n\t\t.awesomplete li[aria-selected="true"] mark {\n\t\t\tbackground: hsl(86, 100%, 21%);\n\t\t\tcolor: inherit;\n\t\t}\n',""])},function(t,e){t.exports='\x3c!--\r\n   \r\n   Copyright (c) 2017, the Perspective Authors.\r\n   \r\n   This file is part of the Perspective library, distributed under the terms of\r\n   the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n\r\n--\x3e\r\n\r\n<template id="perspective-row">\r\n    <div id="psp_row">\r\n        <span class=\'is_visible\'></span>\r\n        <div draggable=\'true\' class="row_draggable">\r\n            <span id=\'name\' class="column_name"></span>\r\n            <div class="row_computed">\r\n                <span id="row_edit"></span>\r\n            </div>\r\n            <span id="sort_order"></span>\r\n            <select id="column_aggregate" class="string"></select>\r\n            <select id="filter_operator"></select>\r\n            <input id="filter_operand" placeholder="Value" />\r\n            <span id="row_exclamation" hidden>&#x26A0;</span>\r\n            <span id=\'row_close\'>&#x2715;</span>\r\n        </div>\r\n    </div>\r\n</template>'},function(t,e,i){(t.exports=i(7)(!1)).push([t.i,':host{display:block;border:0 solid transparent}:host .row_computed{display:none;flex-direction:row}.dropping *{pointer-events:none}:host #psp_row{display:var(--psp_row-display,flex);margin:var(--psp_row-margin,0);overflow:visible;align-items:var(--column_selector--align-items,center);width:auto!important;height:auto!important;float:none!important}:host .is_visible{width:var(--column_selector--width,20px);min-width:var(--column_selector--width,20px);height:var(--is_visible--height,auto);cursor:var(--is_visible--cursor,pointer);font-size:var(--column_selector--font-size,14px);margin-top:-2px;display:var(--is_visible-display,none);color:var(--column-selector--color,#999);font-family:var(--column-selector--font-family,Arial)!important}:host #sort_order{display:none;font-family:var(--button--font-family,inherit);margin-right:4px;cursor:pointer;width:10px;display:var(--sort_order-display,none);padding:var(--sort_order-padding,0)}:host #sort_order:before{content:var(--row-sort-order--before, "-")}:host #sort_order:hover{color:var(--active--color,inherit)}:host #filter_operand{display:var(--filter_operand-display,none);margin:0;padding:0;height:19px;color:inherit;outline:0;border-color:var(--inactive--color,#ccc)}:host #filter_operator{margin:0 0 0 15px;display:var(--filter_operator-display,none);height:17px}:host #filter_operator:hover{color:var(--active--color,inherit)}@keyframes expand2{from{transform:translateX(10px)}}@keyframes expand3{from{transform:scale(.9)}}:host(:hover) .is_visible{color:var(--active--color,--column-selector--color)}:host #row_close{display:var(--row_close-display,inline);cursor:pointer;min-width:5px;max-width:5px;margin-right:3px;flex-grow:0;margin-left:3px;color:#999;font-family:Arial;font-size:10px}:host .is_visible:before{content:var(--is_visible--before,none)}:host #row_exclamation{color:red}:host #row_close:hover{color:var(--active--color,inherit)}:host .row_draggable select{border:none}:host .row_draggable select:focus{outline:0}:host select::-ms-expand{display:none}:host select{margin-left:15px;padding-right:15px;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;background:var(--select--background,url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNC45IDEwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0LjkgMTA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojQUFBQUFBO30KPC9zdHlsZT4KPHRpdGxlPmFycm93czwvdGl0bGU+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMS40LDQuNyAyLjUsMy4yIDMuNSw0LjcgIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMy41LDUuMyAyLjUsNi44IDEuNCw1LjMgIi8+Cjwvc3ZnPg==) no-repeat 95% 50%);background-color:var(--select--background-color,#fff);color:inherit;border-radius:5px;height:24px;padding:var(--column_type--padding,0 0 0 5px);font-size:12px}:host .awesomplete>ul{border-radius:0;margin:0;border:none;transition:none!important;background:var(--plugin--background,#fff)!important}:host .awesomplete>ul:before{content:none}:host .awesomplete>input,:host input{border-color:#ccc;border-width:0 0 1px;box-sizing:border-box;background-color:transparent}:host .row_draggable{animation:var(--row_draggable--animation,expand2 .5s ease-out);cursor:move;border-style:solid;background-color:var(--row_draggable-background-color,none);overflow:var(--row_draggable-overflow,visible);border-color:var(--row_draggable-border-color,none);border-width:var(--row_draggable-border-width,0);padding:var(--row_draggable-padding,0);font-size:12px;flex-grow:1;color:inherit;transition:height .2s;box-sizing:border-box;height:var(--row_draggable-height,21px);min-height:var(--row_draggable-height,21px);display:var(--row_draggable-display,flex);align-items:var(--row-draggable--align-items);flex-direction:var(--row-draggable--flex-direction,column);justify-content:var(--row_draggable--justify-content,center);margin:var(--row_draggable--margin,0);transition:var(--row_draggable--transition,none)}:host .row_draggable *{opacity:var(--row_draggable_children-opacity,1)}:host .row_draggable select{margin:0 0 0 27px}:host ul{transition:background-color .2s,border-color .2s}:host(.null-column) .is_visible{opacity:0!important}:host(.null-column) .row_draggable{background-color:var(--null--background,transparent)!important;border-color:#ccc!important;border-width:0 0 1px!important}:host([drop-target]) .row_draggable{background-color:var(--active--background,#f0f0ff)!important;animation:var(--drop-target--animation,var(--row_draggable--animation,expand3 .5s ease-out));border:none!important}:host .float:before,:host .integer:before{content:var(--float--column-type--content, var(--column-type--content, "123"));color:var(--float--column-type--color,var(--column-type--color,#016bc6))}:host .string:before{content:var(--string--column-type--content, var(--column-type--content, "abc"));color:var(--string--column-type--color,var(--column-type--color,#fe9292))}:host .boolean:before{content:var(--boolean--column-type--content, var(--column-type--content, "t/f"));color:var(--boolean--column-type--color,var(--column-type--color,#999))}:host .date:before{content:var(--date--column-type--content, var(--column-type--content, "mdy"));color:var(--date--column-type--color,var(--column-type--color,#999))}:host .datetime:before{content:var(--datetime--column-type--content, var(--column-type--content, "mdy"));color:var(--datetime--column-type--color,var(--column-type--color,#999))}:host .column_name{overflow:hidden;max-width:var(--column_name-max-width,none);white-space:nowrap;text-overflow:ellipsis}:host span#name:before{font-family:var(--interface-monospace--font-family,monospace);position:relative;display:inline-block;padding:var(--column_type--padding,0 5px);min-width:18px;display:var(--name-before-display,none);width:var(--column_type--width,auto)}:host #column_aggregate{display:var(--column_aggregate-display,none);font-size:10px;font-family:Arial,sans-serif;width:88%;height:20px}:host span#name{flex:var(--column-name--flex,0 1 auto);width:100%;white-space:nowrap;margin:var(--column_name-margin,0)}',""])},function(t,e){t.exports='\x3c!--\n\nCopyright (c) 2017, the Perspective Authors.\n\nThis file is part of the Perspective library, distributed under the terms of\nthe Apache License 2.0.  The full license can be found in the LICENSE file.\n\n--\x3e\n\n<template id="perspective-computed-expression-editor">\n    <div id="psp-expression__body">\n        <div class="psp-expression__container">\n            <span id="psp-expression-close" aria-label="Close Expression Editor">&times;</span>\n            <div class="psp-expression__content psp-expression__content--nomargin">\n                <textarea placeholder="Write an expression" autocomplete="off" id="psp-expression-input"></textarea>\n                <div class="psp-expression__label psp-expression__error" id="psp-expression-error"></div>\n            </div>\n        </div>\n        <div id="psp-expression-actions">\n            <button id="psp-expression-button-remove" class="psp-expression__button" disabled>Remove All</button>\n            <button id="psp-expression-button-save" class="psp-expression__button" disabled>Save</button>\n        </div>\n    </div>\n</template>'},function(t,e,i){(t.exports=i(7)(!1)).push([t.i,":host{display:none;flex-direction:column;max-height:35%;margin-top:34px;margin-bottom:24px;width:100%;flex:0 0 auto!important}:host *{box-sizing:border-box}:host #psp-expression__body,:host .psp-expression__container{display:flex;flex-direction:column}:host #psp-expression__body.row,:host .psp-expression__container.row{align-items:center;flex-direction:row}:host .psp-expression__container:first-of-type{margin-bottom:0}:host .psp-expression__content{align-items:center;display:flex;margin-top:5px}:host .psp-expression__content.psp_expression__content--absolute{position:absolute}:host .psp-expression__content.psp-expression__content--nomargin{margin-top:0;position:relative}:host #psp-expression-actions{display:flex;justify-content:flex-end;margin-left:20px;margin-top:12px}:host span#psp-expression-close{color:#666;padding-left:3px}:host span#psp-expression-close:hover{cursor:pointer}:host textarea#psp-expression-input{background:var(--background-color,none);border-color:var(--inactive-color,#ccc);color:var(--color,#666);font-size:12px;font-family:var(--interface-monospace--font-family,monospace);height:75px;margin-top:5px;padding-left:5px;resize:auto;overflow:auto;width:100%}:host .psp-expression__label{color:var(--color,#a9a9a9);font-size:10px;margin-top:5px;max-width:100%}:host .psp-expression__label.psp-expression__error{background-color:#cb4549;box-sizing:border-box;color:#fff!important;display:none;position:absolute;z-index:10000;max-height:75px;padding:10px;overflow-x:hidden;overflow-y:scroll;top:100%;width:100%;word-break:break-word}:host .psp-expression__button{border-radius:0;border-bottom:1px solid #ccc;border-left:0;border-right:0;border-top:0;font-size:12px;margin-left:6px;padding:2px 5px}:host .psp-expression__button:hover{cursor:pointer}:host .psp-expression__button[disabled]{background:#666!important;color:#a0a0a0!important;cursor:not-allowed;border-bottom-color:#000!important;opacity:.5}:host .psp-expression__button#psp-expression-button-remove{background:#e76056;border-bottom-color:#bf4d45;color:#fff;display:none}:host .psp-expression__button#psp-expression-button-remove:active{background:#bf4d45;border-bottom-color:#9d3f39}:host .psp-expression__button#psp-expression-button-save{background:#0171d2;border-bottom-color:#0160b1;color:#fff;height:22px}:host .psp-expression__button#psp-expression-button-save:active{background:#0160b1;border-bottom-color:#014986}",""])},function(t,e){t.exports='\x3c!--\r\n   \r\n   Copyright (c) 2017, the Perspective Authors.\r\n   \r\n   This file is part of the Perspective library, distributed under the terms of\r\n   the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n\r\n--\x3e\r\n\r\n<template id="perspective-viewer">\r\n\r\n    <div id="app">\r\n        <div id="menubar">\r\n            <div id="copy_button" class="noselect button" title="Copy CSV"></div>\r\n            <div id="download_button" class="noselect button" title="Download CSV"></div>\r\n            <div id="reset_button" class="noselect button" title="Reset Viewer"></div>\r\n        </div>\r\n        <div id=\'side_panel\' class="column fixed noselect">\r\n            <div id="vis_selector_container">\r\n                <select id="vis_selector">\r\n                </select>\r\n            </div>\r\n            <div id="columns_container" style="visibility: hidden">\r\n                <ul id=\'active_columns\'></ul>\r\n                <div id="sub_columns">\r\n                    <ul id=\'inactive_columns\'></ul>\r\n                    <div id="side_panel__actions" style="visibility: hidden">\r\n                        <div id="add-computed-expression" class="side_panel-action"><span class="psp-icon psp-icon__add"></span><span class="psp-title__columnName">New Column</span></div>\r\n                    </div>\r\n                </div>\r\n                <perspective-computed-expression-editor></perspective-computed-expression-editor>\r\n            </div>\r\n            <div id="resize_bar"></div>\r\n        </div>\r\n        <div class="column noselect">\r\n            <div id=\'top_panel\'>\r\n                <div class="rrow">\r\n                    <div id="row_pivots">\r\n                        <div class="psp-text-field">\r\n                            <ul class="psp-text-field__input" for="row-pivots"></ul>\r\n                            <label for="row_pivots"></label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <span id="transpose_button" class="rrow centered" title="Transpose Pivots">&#x21C4;</span>\r\n                <div class="rrow">\r\n                    <div id="column_pivots">\r\n                        <div class="psp-text-field">\r\n                            <ul class="psp-text-field__input" for="column-pivots"></ul>\r\n                            <label for="column_pivots"></label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="rrow">\r\n                    <div id="sort">\r\n                        <div class="psp-text-field">\r\n                            <ul class="psp-text-field__input" for="sort"></ul>\r\n                            <label for="sort"></label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="rrow" style=\'flex-grow:3;height:auto;flex:1 1 400px;max-width:none\'>\r\n                    <div id="filters">\r\n                        <div class="psp-text-field">\r\n                            <ul class="psp-text-field__input" for=\'filters\'></ul>\r\n                            <label for="filters"></label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div id="pivot_chart_container">\r\n                <div class="plugin_information plugin_information--warning hidden" id="plugin_information--size">\r\n                    <span class="plugin_information__text" id="plugin_information_count">Estimated rendering</span>\r\n                    <span class="plugin_information__actions">\r\n                        <span class="plugin_information__action">Render all points</span>\r\n                        <span class="plugin_information__action--close" id="close_button"></span>\r\n                    </span>\r\n                </div>\r\n                <div id="pivot_chart"></div>\r\n            </div>\r\n        </div>\r\n\r\n        <div id="config_button" class="noselect button" title="Right click for additional options"></div>\r\n\r\n        <div id=\'drop_target\'>\r\n            <div id=\'drop_target_inner\'>\r\n\r\n            </div>\r\n        </div>\r\n\r\n        <slot></slot>\r\n    </div>\r\n\r\n</template>'},function(t,e,i){(t.exports=i(7)(!1)).push([t.i,':host #app #top_panel #row_pivots label:before{content:var(--row_pivots--before, "Row Pivots")}:host #app #top_panel #column_pivots label:before{content:var(--column_pivots--before, "Column Pivots")}:host #app #top_panel #sort label:before{content:"Sort"}:host #app #top_panel #filters label:before{content:"Filter"}:host #app #side_panel #active_columns perspective-row:before{font-size:10px;margin-left:var(--column_selector--width,20px);left:1px;padding:var(--column_type--padding,0 0 0 5px);color:var(--inactive--color,#666);position:absolute;margin-top:-15px}:host:hover #config_button{opacity:1}#config_button{background:0 0;opacity:1!important}.button{padding:var(--button--padding,12px 14px 24px 8px)}[settings=true] #config_button{opacity:1!important}@keyframes expand{from{opacity:0}}:host{position:relative;display:inline-block;overflow:hidden;word-wrap:normal;--highcharts-full--gradient:linear-gradient(#4d342f 0%, #e4521b 22.5%, #feeb65 42.5%, #f0f0f0 50%, #dcedc8 57.5%, #42b3d5 67.5%, #1a237e 100%);--highcharts-positive--gradient:linear-gradient(#dcedc8 0%, #42b3d5 35%, #1a237e 100%);--highcharts-negative--gradient:linear-gradient(#feeb65 100%, #e4521b 70%, #4d342f 0%);--hypergrid-tree-header--background:#fff;--hypergrid-tree-header--color:#666;--hypergrid-header--background:#fff;--hypergrid-separator--color:#666;--hypergrid-header--color:#666;--hypergrid-positive--color:#1078d1;--hypergrid-negative--color:#ff8888;--hypergrid--font-size:12px;--hypergrid-header--font-size:12px;--hypergrid--font-family:Helvetica,Arial,sans-serif;--hypergrid-header--font-family:Helvetica,Arial,sans-serif;--hypergrid-row-hover--background:#f6f6f6;--hypergrid-row-hover--color:#666;--hypergrid-cell-hover--background:#eeeeee;--hypergrid-cell-hover--color:#666;--integer--hypergrid--text-align:right;--float--hypergrid--text-align:right;--d3fc-series:rgba(31, 119, 180, 0.5);--d3fc-series-1:#0366d6;--d3fc-series-2:#ff7f0e;--d3fc-series-3:#2ca02c;--d3fc-series-4:#d62728;--d3fc-series-5:#9467bd;--d3fc-series-6:#8c564b;--d3fc-series-7:#e377c2;--d3fc-series-8:#7f7f7f;--d3fc-series-9:#bcbd22;--d3fc-series-10:#17becf;--d3fc-full--gradient:linear-gradient(#4d342f 0%, #e4521b 22.5%, #feeb65 42.5%, #f0f0f0 50%, #dcedc8 57.5%, #42b3d5 67.5%, #1a237e 100%);--d3fc-positive--gradient:linear-gradient(#dcedc8 0%, #42b3d5 35%, #1a237e 100%);--d3fc-negative--gradient:linear-gradient(#feeb65 100%, #e4521b 70%, #4d342f 0%)}:host #pivot_chart{position:absolute;width:100%;height:100%;display:grid;justify-content:stretch}:host .hidden{display:none}:host .psp-icon{color:#999}:host .psp-icon:hover{cursor:pointer}:host .psp-icon__add{display:flex;width:20px;min-width:20px;margin-top:-2px;height:0;font-family:var(--column-add--font-family,inherit)}:host .psp-icon__add:before{font-feature-settings:"liga";content:var(--column-add--before, "+")}:host .psp-title__columnName{display:flex;margin-left:34px;margin-top:3px;font-size:12px;color:#666}:host .side_panel-action:hover{cursor:pointer}:host *{box-sizing:border-box;line-height:1.42857143}:host #app{display:flex;position:relative;width:100%;height:100%}:host #app.hide_message #drop_target{display:none}:host .chart{padding:15px}:host #pivot_chart_container{flex-grow:1;position:relative;border:var(--plugin--border,none);overflow:hidden}:host .config{display:flex}:host #column_pivots #psp_row,:host #filters #psp_row,:host #row_pivots #psp_row,:host #sort #psp_row{display:inline}:host ul{min-height:20px;padding:0;margin:0;font-size:12px}:host #active_columns perspective-row{animation:.3s ease-out expand;--column-selector--color:var(--active--color, #999);--is_visible--before:var(--active-column-selector--content, "\\25CF")}:host #inactive_columns perspective-row{animation:.3s ease-out expand;--column-selector--color:var(--inactive-column-selector--color, #999);--is_visible--before:var(--inactive-column-selector--content, "\\25CB");--row_draggable--animation:none;opacity:var(--inactive-column--opacity,1);transition:opacity .3s}:host #inactive_columns perspective-row:hover{transition:none;opacity:1}:host #top_panel perspective-row{animation:.3s ease-out expand;--column-name--flex:1;padding:0 10px 0 0;margin-bottom:-1px;display:var(--top-panel-row--display,inline-block);--psp_row-display:inline-block}:host #active_columns,:host #inactive_columns{list-style:none;padding:0;width:100%;margin:var(--column-container--margin,8px 0 0 0);overflow-y:auto;overflow-x:hidden;position:relative}:host #inactive_columns perspective-row.active{--row_draggable--margin:0px 0px 0px 10px;opacity:0;height:0!important;overflow:hidden}:host .columns_horizontal #sub_columns.collapse #side_panel__actions{margin-top:0}:host #sub_columns{min-height:33.3%;flex-shrink:100000;display:flex;flex-direction:column;overflow-x:hidden;width:100%}:host #sub_columns.collapse{flex-shrink:0;min-height:64px}:host #sub_columns.collapse #inactive_columns{display:none}:host .column{display:flex;list-style:none;flex-direction:column;flex:1}:host .rrow{display:flex;flex-grow:1;min-height:24px;align-items:center;max-width:400px;list-style:none;min-width:140px;margin:var(--column-drop-container--margin,5px 10px 0 0)}:host .rrow>div{display:flex;min-height:24px;flex-direction:column;justify-content:flex-end}:host #top_panel>.rrow>*{width:100%;padding:12px 0;margin:-12px 0}:host .rrow #psp_row{white-space:nowrap}:host #sort perspective-row{--sort_order-display:inline;--sort_order-padding:0 0 0 4px}:host #sort perspective-row[sort-order=asc]{--row-sort-order--before:var(--sort-order-asc--before, "\\2191")}:host #sort perspective-row[sort-order=desc]{--row-sort-order--before:var(--sort-order-desc--before, "\\2193")}:host #sort perspective-row[sort-order=none]{--row-sort-order--before:var(--sort-order-none--before, "-")}:host #sort perspective-row[sort-order="asc abs"]{--row-sort-order--before:var(--sort-order-asc-abs--before, "\\21E7")}:host #sort perspective-row[sort-order="desc abs"]{--row-sort-order--before:var(--sort-order-desc-abs--before, "\\21E9")}:host #sort perspective-row[sort-order="col asc"]{--row-sort-order--before:var(--sort-order-col-asc--before, "\\2192")}:host #sort perspective-row[sort-order="col desc"]{--row-sort-order--before:var(--sort-order-col-desc--before, "\\2190")}:host #sort perspective-row[sort-order="col asc abs"]{--row-sort-order--before:var(--sort-order-col-asc-abs--before, "\\21E8")}:host #sort perspective-row[sort-order="col desc abs"]{--row-sort-order--before:var(--sort-order-col-desc-abs--before, "\\21E6")}:host #top_panel perspective-row::after{content:","}:host #top_panel perspective-row:last-child::after{display:none;content:""!important}:host label{white-space:nowrap;display:inline-block;vertical-align:middle;margin-bottom:0}:host #drop_target{position:absolute;left:0;top:0;right:0;bottom:0;padding:30px}:host #drop_target_inner{width:100%;height:100%;display:flex;align-items:center;justify-content:center}:host #drop_target_inner h3{font-weight:300}:host #config_button{position:absolute;top:0;left:0;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}:host #config_button:hover{color:var(--active--color,inherit)}:host .button{cursor:pointer;font-size:16px;font-weight:400}:host select::-ms-expand{display:none}:host select{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;background:var(--select--background,url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNC45IDEwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0LjkgMTA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojQUFBQUFBO30KPC9zdHlsZT4KPHRpdGxlPmFycm93czwvdGl0bGU+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMS40LDQuNyAyLjUsMy4yIDMuNSw0LjcgIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMy41LDUuMyAyLjUsNi44IDEuNCw1LjMgIi8+Cjwvc3ZnPg==) no-repeat 95% 50%);background-color:#fff;color:inherit;border-radius:5px;height:24px;padding:var(--select--padding,0 0 0 6px);font-size:12px;font-family:inherit}:host input{padding:0 10px}:host .centered{display:flex;align-items:center;justify-content:center}:host #top_panel{display:flex;flex-wrap:wrap;justify-content:flex-start;padding:var(--top_panel--padding,5px 0 10px 0);max-width:1000px;z-index:1}:host #side_panel{position:relative;flex:0 0 auto;padding:var(--side_panel--padding,10px 10px 0 11px)}:host #side_panel>div{display:flex}:host #vis_selector_container{min-height:29px;margin-left:var(--column_selector--width,20px);overflow:hidden}:host #vis_selector{flex-grow:1}:host #transpose_button{cursor:pointer;min-width:5px;max-width:5px;flex-grow:0;color:#999;font-family:Arial;font-size:12px}:host #transpose_button:hover{color:var(--active--color,inherit)}:host #resize_bar{position:absolute;top:0;right:0;bottom:0;width:8px;cursor:col-resize}',""])},function(t,e,i){(t.exports=i(7)(!1)).push([t.i,'.psp-text-field{position:relative;background-color:var(--column-drop-container--background,#fff);border-width:0 0 1px;border-style:solid;border-color:var(--inactive--color,#ccc);display:flex;flex-direction:column;justify-content:flex-end;min-height:24px;transition:border-color .3s ease-out}:host(.dragging) .psp-text-field.dropping{border-bottom-width:2px;border-style:solid;border-color:var(--active--color,#1a7da1)}:host(.dragging) .psp-text-field{border-bottom-width:1px;border-style:solid;border-color:var(--active--color,#1a7da1)}.psp-text-field>.psp-text-field__input{border:0;line-height:20px;vertical-align:bottom;padding-bottom:0;display:none}.psp-text-field__input+label{height:var(--column--height,auto);line-height:17px;box-sizing:border-box;color:var(--inactive--color,#ccc);font-weight:400;white-space:nowrap;padding:var(--column-drop-container--padding,0 0 2px 10px);font-size:12px;display:inline-block;transition:font-size .3s,margin .3s}.dropping .psp-text-field__input,.psp-text-field__input:not(:empty){display:block!important}.dropping .psp-text-field__input::after{content:"|";width:0;overflow:visible;margin-top:-1px;position:absolute}.dropping *{pointer-events:none}.dropping .psp-text-field label,.psp-text-field__input:not(:empty)+label{position:absolute;top:0;margin:var(--column-drop-label--margin,0);font-size:var(--column-drop-label--font-size,12px);display:var(--column-drop-label--display,none)}.dropping perspective-row.inserting{border-top:25px solid transparent}.dropping perspective-row.postserting{border-bottom:25px solid transparent}:host perspective-row{height:var(--column--height,21px);--row_draggable-height:var(--column--height, 21px)}:host([row-pivots]) #active_columns perspective-row{height:var(--active-column--height,41px);min-height:var(--active-column--height,41px);--row_draggable-height:var(--active-column--height, 41px);--column_aggregate-display:inline-block;--is_visible--height:var(--active-column-selector--height, auto)}:host{font-family:Arial,sans-serif;background-color:#eee;color:#333}:host #app.columns_horizontal #columns_container{flex-direction:row-reverse}:host #app.columns_horizontal #active_columns,:host #app.columns_horizontal #inactive_columns{display:flex;flex-direction:column;flex:0 1 auto;width:100%}:host #app.columns_horizontal #inactive_columns{flex:1 1 auto}:host #app.columns_horizontal #sub_columns{flex-shrink:1}:host #app.columns_horizontal #sub_columns perspective-row{--column_name-margin:0 25px 0 0}:host #app.columns_horizontal #side_panel #divider{display:none}:host #app.columns_horizontal perspective-computed-expression-editor{max-height:none;margin-right:24px;width:auto}:host #side_panel perspective-row{--name-before-display:inline-block;--is_visible-display:inline-block;--row_draggable-padding:0px 10px 0px 0px;--row_close-display:none;--column_name-max-width:180px}:host #top_panel perspective-row{--row_draggable-display:inline-flex;--row-draggable--flex-direction:row;--row-draggable--align-items:center}:host #columns_container{flex-direction:column;height:calc(100% - 29px)}:host #columns_container #active_columns{flex:0 1 auto}:host #columns_container #active_columns perspective-row{margin-bottom:2px;--row_draggable-background-color:var(--column--background, white);--row_draggable-border-color:var(--inactive--color, #ccc);--row_draggable-border-width:0 0 1px 0;--row_draggable-overflow:hidden;--row_draggable--justify-content:space-evenly}:host #columns_container #active_columns perspective-row:last-child{--row_draggable-border-width:var(--row_draggable-border-last-child-width, 0 0 1px 0)}:host #columns_container #active_columns perspective-row[drop-target]{--row_draggable_children-opacity:0}:host #columns_container #active_columns perspective-row.null-column{--row_draggable_children-opacity:0;pointer-events:none}:host #columns_container #active_columns.one_lock perspective-row:first-child,:host #columns_container #active_columns.two_lock perspective-row:first-child{--active--color:#ccc;--is_visible--cursor:normal}:host #columns_container #active_columns.two_lock perspective-row:nth-child(2){--active--color:#ccc;--is_visible--cursor:normal}:host #columns_container #active_columns perspective-row:only-child{--active--color:#ccc;--is_visible--cursor:normal}:host #columns_container #active_columns,:host #columns_container #inactive_columns{border:none!important}:host ul{transition:background-color .2s,border-color .2s;outline:0;border-style:solid;border-color:var(--inactive--color,#ccc);font-size:12px;padding:var(--column-drop-container--padding,0 10px 0 10px);border-width:0 0 1px}:host #side_panel #side_panel__actions{display:flex;flex-direction:column;flex-shrink:1000;justify-content:flex-start;position:relative;overflow-y:hidden;width:100%;padding-top:20px;margin:var(--column-container--margin,8px);min-height:36px}:host #side_panel #side_panel__actions button.side_panel-action{align-items:center;align-content:center;background:0 0;border:none;display:flex;flex-direction:row;font-size:12px;padding-right:10px;-webkit-appearance:none;-moz-appearance:none;appearance:none}:host #side_panel #side_panel__actions button.side_panel-action span{margin-left:5px;font-size:15px}:host #side_panel #side_panel__actions button.side_panel-action:hover{cursor:pointer}:host .noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}:host svg .highcharts-legend-box{fill:none}:host #pivot_chart{background-color:var(--plugin--background,#fff)}:host #drop_target{border:var(--plugin--border,none);background:var(--plugin--background,#fff)}:host #pivot_chart_container{box-shadow:var(--plugin--box-shadow,none)}:host #filters perspective-row{margin:0;--filter_operator-display:inline-block;--filter_operand-display:inline-block}:host .plugin_information{color:var(--warning--color,inherit);display:flex;position:absolute;flex-direction:row;justify-content:flex-start;padding:.5rem;width:100%;z-index:10000;transition:opacity .3s ease-out;opacity:1}:host .plugin_information.hidden{display:none;opacity:0}:host .plugin_information.plugin_information--warning{background:#ffca28}:host .plugin_information .plugin_information__text{font-size:12px;margin-right:.25rem;display:flex;flex-wrap:wrap;align-items:center}:host .plugin_information .plugin_information__text:before{content:var(--overflow_hint--before);font-family:var(--overflow_hint--font-family);color:var(--overflow_hint--color);padding:var(--overflow_hint--padding);font-size:16px}:host .plugin_information .plugin_information__action{font-size:12px;text-decoration:underline;cursor:pointer;margin-right:.25rem}:host .plugin_information .plugin_information__action--close{margin-left:12px;display:inline-flex;font-size:12px;cursor:pointer}:host .plugin_information .plugin_information__actions{margin-left:auto;display:flex;align-items:center;flex-direction:row;justify-content:flex-start}:host .plugin_information .plugin_information--overflow-hint-percent{font-weight:700}:host .plugin_information .plugin_information--overflow-hint{white-space:nowrap}:host #drop_target_inner h3{color:#aaa;font-weight:300}:host #config_button,:host #copy_button,:host #download_button,:host #reset_button{font-weight:400;font-family:var(--button--font-family,Arial);color:var(--inactive--color,#999);font-size:var(--button--font-size,16px);transition:opacity .3s;overflow:hidden}:host #config_button:hover,:host #copy_button:hover,:host #download_button:hover,:host #reset_button:hover{color:var(--active--color,inherit)}:host #config_button:before{font-feature-settings:"liga";content:var(--settings-button--content, "\\1F527")}:host #reset_button:before{font-feature-settings:"liga";content:var(--reset_button--before, "Reset")}:host #close_button:before{font-family:var(--button--font-family,Arial);font-feature-settings:"liga";content:var(--close_button--before, "Close")}:host #download_button:before{font-feature-settings:"liga";content:var(--download_button--before, "Save")}:host #copy_button:before{font-feature-settings:"liga";content:var(--copy_button--before, "Copy")}:host #menubar{display:none;flex-direction:column;padding-top:55px}:host #app.show_menu #menubar{display:flex}:host select{border-radius:0;background-color:var(--select--background-color,#fff);border-style:solid;border-color:var(--inactive--color,#ccc);border-width:0 0 1px}:host select:focus{outline:0}:host input{border-style:solid;border-color:var(--inactive--color,#ccc);border-width:0 0 1px}:host input::placeholder{color:var(--inactive--color,#ccc)}:host option[value=""]{color:#fff!important}:host #app{background-color:inherit}:host ::-webkit-scrollbar,:host ::shadow ::-webkit-scrollbar{width:12px}:host ::-webkit-scrollbar-thumb,:host ::shadow ::-webkit-scrollbar-thumb{background:#ccc}:host ::-webkit-scrollbar-track,:host ::shadow ::-webkit-scrollbar-track{background:0 0}',""])},function(t,e){t.exports=l},function(t,e){t.exports=c},function(t,e){t.exports=d},function(t,e){t.exports=p},function(t,e,i){i(8),i(3);const o="dnd-poly-snapback",n="dnd-poly-dragstart-pending",r="dnd-poly-dragstart-cancel",s=["none","copy","copyLink","copyMove","link","linkMove","move","all"],a=["none","copy","move","link"];const l=function(){let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return t}();function c(t){return t&&t.tagName}function d(t,e,i){void 0===i&&(i=!0),document.addEventListener(t,e,!!l&&{passive:i})}function p(t,e){document.removeEventListener(t,e)}function _(t,e,i,o){void 0===o&&(o=!1);const n=l?{passive:!0,capture:o}:o;return t.addEventListener(e,i,n),{off:function(){t.removeEventListener(e,i,n)}}}function h(t){return 0===t.length?0:t.reduce((function(t,e){return e+t}),0)/t.length}function u(t,e){for(let i=0;i<t.changedTouches.length;i++){if(t.changedTouches[i].identifier===e)return!0}return!1}function g(t,e,i){const o=[],n=[];for(let i=0;i<e.touches.length;i++){const r=e.touches[i];o.push(r[t+"X"]),n.push(r[t+"Y"])}i.x=h(o),i.y=h(n)}const m=["","-webkit-"];function v(t,e,i,o,n){void 0===n&&(n=!0);let r=e.x,s=e.y;o&&(r+=o.x,s+=o.y),n&&(r-=parseInt(t.offsetWidth,10)/2,s-=parseInt(t.offsetHeight,10)/2);const a="translate3d("+r+"px,"+s+"px, 0)";for(let e=0;e<m.length;e++){const o=m[e]+"transform";t.style[o]=a+" "+i[e]}}const f=function(){function t(t,e){this._dataStore=t,this._setDragImageHandler=e,this._dropEffect=a[0]}return Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){0!==this._dataStore.mode&&s.indexOf(t)>-1&&(this._dropEffect=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){if(0!==this._dataStore.mode)return Object.freeze(this._dataStore.types)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._dataStore.effectAllowed},set:function(t){2===this._dataStore.mode&&s.indexOf(t)>-1&&(this._dataStore.effectAllowed=t)},enumerable:!0,configurable:!0}),t.prototype.setData=function(t,e){if(2===this._dataStore.mode){if(t.indexOf(" ")>-1)throw new Error("illegal arg: type contains space");this._dataStore.data[t]=e,-1===this._dataStore.types.indexOf(t)&&this._dataStore.types.push(t)}},t.prototype.getData=function(t){if(1===this._dataStore.mode||2===this._dataStore.mode)return this._dataStore.data[t]||""},t.prototype.clearData=function(t){if(2===this._dataStore.mode){if(t&&this._dataStore.data[t]){delete this._dataStore.data[t];const e=this._dataStore.types.indexOf(t);return void(e>-1&&this._dataStore.types.splice(e,1))}this._dataStore.data={},this._dataStore.types=[]}},t.prototype.setDragImage=function(t,e,i){2===this._dataStore.mode&&this._setDragImageHandler(t,e,i)},t}();function b(t,e){return t?t===s[0]?a[0]:0===t.indexOf(s[1])||t===s[7]?a[1]:0===t.indexOf(s[4])?a[3]:t===s[6]?a[2]:a[1]:3===e.nodeType&&"A"===e.tagName?a[3]:a[1]}function w(t,e,i,o,n,r,s){void 0===r&&(r=!0),void 0===s&&(s=null),console.log("dnd-poly: dispatching "+t);const a=function(t,e,i,o,n,r,s){void 0===s&&(s=null);const a=e.changedTouches[0],l=new Event(i,{bubbles:!0,cancelable:o});l.dataTransfer=r,l.relatedTarget=s,l.screenX=a.screenX,l.screenY=a.screenY,l.clientX=a.clientX,l.clientY=a.clientY,l.pageX=a.pageX,l.pageY=a.pageY;const c=t.getBoundingClientRect();return l.offsetX=l.clientX-c.left,l.offsetY=l.clientY-c.top,l}(e,i,t,r,document.defaultView,n,s),l=!e.dispatchEvent(a);return o.mode=0,l}function y(t,e){if(!t||t===s[7])return e;if(e===a[1]){if(0===t.indexOf(a[1]))return a[1]}else if(e===a[3]){if(0===t.indexOf(a[3])||t.indexOf("Link")>-1)return a[3]}else if(e===a[2]&&(0===t.indexOf(a[2])||t.indexOf("Move")>-1))return a[2];return a[0]}const x=function(){function t(t,e,i,o){this._initialEvent=t,this._config=e,this._sourceNode=i,this._dragOperationEndedCb=o,this._dragOperationState=0,this._immediateUserSelection=null,this._currentDropTarget=null,console.log("dnd-poly: setting up potential drag operation.."),this._lastTouchEvent=t,this._initialTouch=t.changedTouches[0],this._touchMoveHandler=this._onTouchMove.bind(this),this._touchEndOrCancelHandler=this._onTouchEndOrCancel.bind(this),d("touchmove",this._touchMoveHandler,!1),d("touchend",this._touchEndOrCancelHandler,!1),d("touchcancel",this._touchEndOrCancelHandler,!1)}return t.prototype._setup=function(){const t=this;console.log("dnd-poly: starting drag and drop operation"),this._dragOperationState=1,this._currentDragOperation=a[0],this._dragDataStore={data:{},effectAllowed:void 0,mode:3,types:[]},this._currentHotspotCoordinates={x:null,y:null},this._dragImagePageCoordinates={x:null,y:null};let e=this._sourceNode;if(this._dataTransfer=new f(this._dragDataStore,(function(i,o,n){e=i,"number"!=typeof o&&"number"!=typeof n||(t._dragImageOffset={x:o||0,y:n||0})})),this._dragDataStore.mode=2,this._dataTransfer.dropEffect=a[0],w("dragstart",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer))return console.log("dnd-poly: dragstart cancelled"),this._dragOperationState=3,this._cleanup(),!1;g("page",this._lastTouchEvent,this._dragImagePageCoordinates);const i=this._config.dragImageSetup(e);var o;if(this._dragImageTransforms=(o=i,m.map((function(t){const e=o.style[t+"transform"];return e&&"none"!==e?e.replace(/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,""):""}))),i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.zIndex="999999",i.classList.add("dnd-poly-drag-image"),i.classList.add("dnd-poly-icon"),this._dragImage=i,!this._dragImageOffset)if(this._config.dragImageOffset)this._dragImageOffset={x:this._config.dragImageOffset.x,y:this._config.dragImageOffset.y};else if(this._config.dragImageCenterOnTouch){const t=getComputedStyle(e);this._dragImageOffset={x:0-parseInt(t.marginLeft,10),y:0-parseInt(t.marginTop,10)}}else{const t=e.getBoundingClientRect(),i=getComputedStyle(e);this._dragImageOffset={x:t.left-this._initialTouch.clientX-parseInt(i.marginLeft,10)+t.width/2,y:t.top-this._initialTouch.clientY-parseInt(i.marginTop,10)+t.height/2}}return v(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch),document.body.appendChild(this._dragImage),this._iterationIntervalId=window.setInterval((function(){t._iterationLock?console.log("dnd-poly: iteration skipped because previous iteration hast not yet finished."):(t._iterationLock=!0,t._dragAndDropProcessModelIteration(),t._iterationLock=!1)}),this._config.iterationInterval),!0},t.prototype._cleanup=function(){console.log("dnd-poly: cleanup"),this._iterationIntervalId&&(clearInterval(this._iterationIntervalId),this._iterationIntervalId=null),p("touchmove",this._touchMoveHandler),p("touchend",this._touchEndOrCancelHandler),p("touchcancel",this._touchEndOrCancelHandler),this._dragImage&&(this._dragImage.parentNode.removeChild(this._dragImage),this._dragImage=null),this._dragOperationEndedCb(this._config,this._lastTouchEvent,this._dragOperationState)},t.prototype._onTouchMove=function(t){const e=this;if(!1!==u(t,this._initialTouch.identifier)){if(this._lastTouchEvent=t,0===this._dragOperationState){let e=void 0;if(this._config.dragStartConditionOverride)try{e=this._config.dragStartConditionOverride(t)}catch(t){console.error("dnd-poly: error in dragStartConditionOverride hook: "+t),e=!1}else e=1===t.touches.length;return e?void(!0===this._setup()&&(this._initialEvent.preventDefault(),t.preventDefault())):void this._cleanup()}if(console.log("dnd-poly: moving draggable.."),t.preventDefault(),g("client",t,this._currentHotspotCoordinates),g("page",t,this._dragImagePageCoordinates),this._config.dragImageTranslateOverride)try{let i=!1;if(this._config.dragImageTranslateOverride(t,{x:this._currentHotspotCoordinates.x,y:this._currentHotspotCoordinates.y},this._immediateUserSelection,(function(t,o){e._dragImage&&(i=!0,e._currentHotspotCoordinates.x+=t,e._currentHotspotCoordinates.y+=o,e._dragImagePageCoordinates.x+=t,e._dragImagePageCoordinates.y+=o,v(e._dragImage,e._dragImagePageCoordinates,e._dragImageTransforms,e._dragImageOffset,e._config.dragImageCenterOnTouch))})),i)return}catch(t){console.log("dnd-poly: error in dragImageTranslateOverride hook: "+t)}v(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch)}},t.prototype._onTouchEndOrCancel=function(t){if(!1!==u(t,this._initialTouch.identifier)){if(this._config.dragImageTranslateOverride)try{this._config.dragImageTranslateOverride(void 0,void 0,void 0,(function(){}))}catch(t){console.log("dnd-poly: error in dragImageTranslateOverride hook: "+t)}0!==this._dragOperationState?(t.preventDefault(),this._dragOperationState="touchcancel"===t.type?3:2):this._cleanup()}},t.prototype._dragAndDropProcessModelIteration=function(){const t=this,e=this._currentDragOperation;this._dragDataStore.mode=3,this._dataTransfer.dropEffect=a[0];const i=w("drag",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer);if(i&&(console.log("dnd-poly: drag event cancelled."),this._currentDragOperation=a[0]),i||2===this._dragOperationState||3===this._dragOperationState){return this._dragOperationEnded(this._dragOperationState)?void function(t,e,i,n){const r=getComputedStyle(t);if("hidden"===r.visibility||"none"===r.display)return console.log("dnd-poly: source node is not visible. skipping snapback transition."),void n();e.classList.add(o);const s=getComputedStyle(e),a=parseFloat(s.transitionDuration);if(isNaN(a)||0===a)return console.log("dnd-poly: no transition used - skipping snapback"),void n();console.log("dnd-poly: starting dragimage snap back");const l=t.getBoundingClientRect(),c={x:l.left,y:l.top};c.x+=document.body.scrollLeft||document.documentElement.scrollLeft,c.y+=document.body.scrollTop||document.documentElement.scrollTop,c.x-=parseInt(r.marginLeft,10),c.y-=parseInt(r.marginTop,10);const d=parseFloat(s.transitionDelay),p=Math.round(1e3*(a+d));v(e,c,i,void 0,!1),setTimeout(n,p)}(this._sourceNode,this._dragImage,this._dragImageTransforms,(function(){t._finishDragOperation()})):void this._finishDragOperation()}const n=this._config.elementFromPoint(this._currentHotspotCoordinates.x,this._currentHotspotCoordinates.y);console.log("dnd-poly: new immediate user selection is: "+n);const r=this._currentDropTarget;n!==this._immediateUserSelection&&n!==this._currentDropTarget&&(this._immediateUserSelection=n,null!==this._currentDropTarget&&(this._dragDataStore.mode=3,this._dataTransfer.dropEffect=a[0],w("dragexit",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)),null===this._immediateUserSelection?(this._currentDropTarget=this._immediateUserSelection,console.log("dnd-poly: current drop target changed to null")):(this._dragDataStore.mode=3,this._dataTransfer.dropEffect=b(this._dragDataStore.effectAllowed,this._sourceNode),w("dragenter",this._immediateUserSelection,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?(console.log("dnd-poly: dragenter default prevented"),this._currentDropTarget=this._immediateUserSelection,this._currentDragOperation=y(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect)):this._immediateUserSelection!==document.body&&(this._currentDropTarget=document.body))),r!==this._currentDropTarget&&c(r)&&(console.log("dnd-poly: current drop target changed."),this._dragDataStore.mode=3,this._dataTransfer.dropEffect=a[0],w("dragleave",r,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1,this._currentDropTarget)),c(this._currentDropTarget)&&(this._dragDataStore.mode=3,this._dataTransfer.dropEffect=b(this._dragDataStore.effectAllowed,this._sourceNode),!1===w("dragover",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?(console.log("dnd-poly: dragover not prevented on possible drop-target."),this._currentDragOperation=a[0]):(console.log("dnd-poly: dragover prevented."),this._currentDragOperation=y(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect))),console.log("dnd-poly: d'n'd iteration ended. current drag operation: "+this._currentDragOperation),e!==this._currentDragOperation&&this._dragImage.classList.remove("dnd-poly-"+e);const s="dnd-poly-"+this._currentDragOperation;this._dragImage.classList.add(s)},t.prototype._dragOperationEnded=function(t){console.log("dnd-poly: drag operation end detected with "+this._currentDragOperation);const e=this._currentDragOperation===a[0]||null===this._currentDropTarget||3===t;return e?c(this._currentDropTarget)&&(this._dragDataStore.mode=3,this._dataTransfer.dropEffect=a[0],w("dragleave",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)):c(this._currentDropTarget)&&(this._dragDataStore.mode=1,this._dataTransfer.dropEffect=this._currentDragOperation,!0===w("drop",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?this._currentDragOperation=this._dataTransfer.dropEffect:this._currentDragOperation=a[0]),e},t.prototype._finishDragOperation=function(){console.log("dnd-poly: dragimage snap back transition ended"),this._dragDataStore.mode=3,this._dataTransfer.dropEffect=this._currentDragOperation,w("dragend",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1),this._dragOperationState=2,this._cleanup()},t}(),E={iterationInterval:150,tryFindDraggableTarget:function(t){let e=t.target;do{if(!1!==e.draggable){if(!0===e.draggable)return e;if(e.getAttribute&&"true"===e.getAttribute("draggable"))return e}}while((e=e.parentNode)&&e!==document.body)},dragImageSetup:function(t){const e=t.cloneNode(!0);return function t(e,i){if(1===e.nodeType){const t=getComputedStyle(e);for(let e=0;e<t.length;e++){const o=t[e];i.style.setProperty(o,t.getPropertyValue(o),t.getPropertyPriority(o))}if(i.style.pointerEvents="none",i.removeAttribute("id"),i.removeAttribute("class"),i.removeAttribute("draggable"),"CANVAS"===i.nodeName){const t=e,o=i,n=t.getContext("2d").getImageData(0,0,t.width,t.height);o.getContext("2d").putImageData(n,0,0)}}if(e.hasChildNodes())for(let o=0;o<e.childNodes.length;o++)t(e.childNodes[o],i.childNodes[o])}(t,e),e},elementFromPoint:function(t,e){return document.elementFromPoint(t,e)}};let A;function O(t,e){if(console.log("dnd-poly: global touchstart"),A)return void console.log("dnd-poly: drag operation already active");const i=E.tryFindDraggableTarget(t,e);if(i)try{A=new x(t,E,i,S)}catch(e){throw S(E,t,3),e}else console.log("dnd-poly: no draggable at touchstart coordinates")}function k(t){console.log("dnd-poly: setup delayed dragstart..");const e=t.target,i=t.composedPath(),o=function(t){console.log("dnd-poly: aborting delayed drag because of "+t.type),a.off(),l.off(),c.off(),d.off(),e&&e.dispatchEvent(new CustomEvent(r,{bubbles:!0,cancelable:!0})),clearTimeout(s)};e&&e.dispatchEvent(new CustomEvent(n,{bubbles:!0,cancelable:!0}));const s=window.setTimeout((function(){console.log("dnd-poly: starting delayed drag.."),a.off(),l.off(),c.off(),d.off(),O(t,i)}),E.holdToDrag),a=_(e,"touchend",o),l=_(e,"touchcancel",o),c=_(e,"touchmove",o),d=_(window,"scroll",o,!0)}function S(t,e,i){if(0===i&&(console.log("dnd-poly: Drag never started. Last event was "+e.type),t.defaultActionOverride))try{t.defaultActionOverride(e),e.defaultPrevented&&console.log("dnd-poly: defaultActionOverride has taken care of triggering the default action. preventing default on original event")}catch(t){console.log("dnd-poly: error in defaultActionOverride: "+t)}A=null}!function(t){if(t&&Object.keys(t).forEach((function(e){E[e]=t[e]})),!E.forceApply){const t=function(){const t={dragEvents:"ondragstart"in document.documentElement,draggable:"draggable"in document.documentElement,userAgentSupportingNativeDnD:void 0},e=!!window.chrome||/chrome/i.test(navigator.userAgent);return t.userAgentSupportingNativeDnD=!(/iPad|iPhone|iPod|Android/.test(navigator.userAgent)||e&&"ontouchstart"in document.documentElement),t}();if(t.userAgentSupportingNativeDnD&&t.draggable&&t.dragEvents)return!1}console.log("dnd-poly: Applying mobile drag and drop polyfill."),E.holdToDrag?(console.log("dnd-poly: holdToDrag set to "+E.holdToDrag),d("touchstart",k,!1)):d("touchstart",O,!1)}({tryFindDraggableTarget:function(t,e){const i=e||t.composedPath();for(let t of i){let e=t;do{if(!1!==e.draggable&&e.getAttribute&&"true"===e.getAttribute("draggable"))return e}while((e=e.parentNode)&&e!==document.body)}},elementFromPoint:function(t,e){for(let i of this._path)if(i.elementFromPoint){let o=i.elementFromPoint(t,e);if(o){for(;o.shadowRoot;)o=o.shadowRoot.elementFromPoint(t,e);return o}}},dragStartConditionOverride:function(t){return this._path=t.composedPath(),!0},holdToDrag:500})},function(t,e){t.exports=_},function(t,e,i){"use strict";i.r(e);i(8),i(21),i(3),i(22),i(23),i(24);var o,n=i(1),r=i(5),s=i(9),a=i.n(s),l=i(10),c=i.n(l),d=i(12),p=i.n(d),_=i(6),h=i.n(_),u=i(4),g=i(13),m=i.n(g),v=i(14),f=i.n(v),b=i(2);function w(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(w.prototype,HTMLElement.prototype),Object.setPrototypeOf(w,HTMLElement);const y=document.createElement("span");function x(t,e=0){y.innerHTML=t,document.body.appendChild(y);const i=`${Math.max(e,y.offsetWidth)+20}px`;return document.body.removeChild(y),i}y.style.visibility="hidden",y.style.fontFamily="monospace",y.style.fontSize="12px",y.style.position="absolute";Object(n.b)(m.a,{toString:()=>f.a+"\n"+p.a})(o=class extends w{set name(t){this.shadowRoot.querySelector("#name").innerHTML=this.getAttribute("name")}_option_template(t,e){return b.html`
            <option value="${t}" data-desc="${e}">${e||t}</option>
        `}_select_template(t,e){const i=h.a[t][e]||[],o=b.html`
            <optgroup label="weighted mean">
                ${this._weights.map(t=>this._option_template(JSON.stringify(["weighted mean",t]),t))}
            </optgroup>
        `,n="TYPE_AGGREGATES"===t&&("integer"===e||"float"===e);return b.html`
            ${i.map(t=>this._option_template(t))} ${n?o:b.nothing}
        `}set_weights(t){this._weights=t}set type(t){const e=this.shadowRoot.querySelector("#name"),i=this.getAttribute("type");if(!i)return;const o=Object(u.get_type_config)(i);o.type&&e.classList.add(o.type),e.classList.add(i);const n=this.shadowRoot.querySelector("#column_aggregate"),r=this.shadowRoot.querySelector("#filter_operator");Object(b.render)(this._select_template("TYPE_AGGREGATES",o.type||i),n),Object(b.render)(this._select_template("TYPE_FILTERS",o.type||i),r),this.hasAttribute("aggregate")?this.aggregate=this.getAttribute("aggregate"):this.aggregate=o.aggregate,this.hasAttribute("filter")&&(this.filter=this.getAttribute("filter"));const s=this.shadowRoot.querySelector("#filter_operand");this._callback=t=>this._update_filter(t),s.addEventListener("keyup",this._callback.bind(this))}choices(t){const e=this.shadowRoot.querySelector("#filter_operand"),i=this.shadowRoot.querySelector("#filter_operator"),o=new c.a(e,{label:this.getAttribute("name"),list:t,minChars:0,autoFirst:!0,filter:function(t,e){return c.a.FILTER_CONTAINS(t,e.match(/[^,]*$/)[0])},item:function(t,e){return c.a.ITEM(t,e.match(/[^,]*$/)[0])},replace:function(t){const e=this.input.value.match(/^.+,\s*|/)[0];"in"===i.value||"not in"===i.value?this.input.value=e+t+", ":this.input.value=e+t}});""===e.value&&o.evaluate(),e.focus(),this._filter_operand.addEventListener("focus",()=>{0===e.value.trim().length&&o.evaluate()}),e.addEventListener("awesomplete-selectcomplete",this._callback)}set filter(t){const e=this.shadowRoot.querySelector("#filter_operator"),i=JSON.parse(this.getAttribute("filter"));e.value!==i.operator&&(e.value=i.operator||Object(u.get_type_config)(this.getAttribute("type")).filter_operator),e.style.width=x(e.value);const o=this.shadowRoot.querySelector("#filter_operand"),n=i.operand?i.operand.toString():"";this._initialized||(o.value=n),e.value===h.a.FILTER_OPERATORS.isNull||e.value===h.a.FILTER_OPERATORS.isNotNull?o.style.display="none":(o.style.display="inline-block",o.style.width=x(n,30))}set aggregate(t){const e=this.shadowRoot.querySelector("#column_aggregate"),i=this.getAttribute("aggregate");if(e.value!==i&&this.hasAttribute("type")){const t=this.getAttribute("type");e.value=i||Object(u.get_type_config)(t).aggregate}this._blur_agg_dropdown()}set computed_column(t){}_get_computed_data(){const t=JSON.parse(this.getAttribute("computed_column"));return{column_name:t.column_name,input_columns:t.input_columns,input_type:t.input_type,computation:t.computation,type:t.type}}_update_filter(t){const e=this.shadowRoot.querySelector("#filter_operand"),i=this.shadowRoot.querySelector("#filter_operator");let o=e.value;switch(this.getAttribute("type")){case"float":o=parseFloat(o);break;case"integer":o=parseInt(o);break;case"boolean":o=o.toLowerCase().indexOf("true")>-1}i.value!==h.a.FILTER_OPERATORS.isIn&&i.value!==h.a.FILTER_OPERATORS.isNotIn||(o=o.split(",").map(t=>t.trim())),this.setAttribute("filter",JSON.stringify({operator:i.value,operand:o})),this.dispatchEvent(new CustomEvent("filter-selected",{detail:t}))}_set_data_transfer(t){if(this.hasAttribute("filter")){const{operator:e,operand:i}=JSON.parse(this.getAttribute("filter"));t.dataTransfer.setData("text",JSON.stringify([this.getAttribute("name"),e,i,this.getAttribute("type"),this.getAttribute("aggregate")]))}else t.dataTransfer.setData("text",JSON.stringify([this.getAttribute("name"),Object(u.get_type_config)(this.getAttribute("type")).filter_operator,void 0,this.getAttribute("type"),this.getAttribute("aggregate")]));this.dispatchEvent(new CustomEvent("row-drag"))}_register_ids(){this._li=this.shadowRoot.querySelector(".row_draggable"),this._visible=this.shadowRoot.querySelector(".is_visible"),this._row_close=this.shadowRoot.querySelector("#row_close"),this._agg_dropdown=this.shadowRoot.querySelector("#column_aggregate"),this._sort_order=this.shadowRoot.querySelector("#sort_order"),this._filter_operand=this.shadowRoot.querySelector("#filter_operand"),this._filter_operator=this.shadowRoot.querySelector("#filter_operator"),this._edit_computed_column_button=this.shadowRoot.querySelector("#row_edit"),this._column_aggregate_category=this.shadowRoot.querySelector("#column_aggregate_category")}_blur_agg_dropdown(){if(this._agg_dropdown.blur(),"["===this._agg_dropdown.value[0])for(const t of this._agg_dropdown.querySelectorAll("optgroup option")){const e=t.getAttribute("data-desc");t.innerHTML=`mean by ${e}`}}_focus_agg_dropdown(){for(const t of this._agg_dropdown.querySelectorAll("optgroup option")){const e=t.getAttribute("data-desc");t.innerHTML=`by ${e}`}}_register_callbacks(){this._li.addEventListener("dragstart",this._set_data_transfer.bind(this)),this._li.addEventListener("dragend",()=>{this.dispatchEvent(new CustomEvent("row-dragend"))}),this._visible.addEventListener("mousedown",t=>this.dispatchEvent(new CustomEvent("visibility-clicked",{detail:t}))),this._row_close.addEventListener("mousedown",t=>this.dispatchEvent(new CustomEvent("close-clicked",{detail:t}))),this._agg_dropdown.addEventListener("focus",this._focus_agg_dropdown.bind(this)),this._agg_dropdown.addEventListener("change",t=>{this._blur_agg_dropdown();const e=this._agg_dropdown.value;this.setAttribute("aggregate",e),this.dispatchEvent(new CustomEvent("aggregate-selected",{detail:t}))}),this._sort_order.addEventListener("click",t=>{this.dispatchEvent(new CustomEvent("sort-order",{detail:t}))});const t=a()(t=>this._update_filter(t),50);this._filter_operator.addEventListener("change",()=>{this._filter_operand.focus(),this._filter_operator.style.width=x(this._filter_operator.value),this.shadowRoot.querySelector("#filter_operand").style.width=x(""+this._filter_operand.value,30),t()}),this._edit_computed_column_button.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("perspective-computed-column-edit",{bubbles:!0,detail:this._get_computed_data()}))})}connectedCallback(){this._register_ids(),this._register_callbacks()}});var E=i(15),A=i.n(E),O=i(16),k=i.n(O),S=i(0);const T={columnName:"column name",leftParen:"(",rightParen:")",add:"+",subtract:"-",multiply:"*",divide:"/",percent_of:"%"},L=t=>{let e;return e=Array.isArray(t)?t.filter(t=>"EOF"!==t.tokenType.name).map(t=>t.payload?t.payload:t.image):t.payload?t.payload:t.image,e&&0!==e.length||(e="EOF"),e},C={buildEarlyExitMessage:t=>{return`Unexpected token: \`${L(t.actual)}\`\n\nExpected one of the following tokens: \n ${t.expectedIterationPaths.map(t=>{let e=[];return t.map(t=>{const i=T[t.name];e.push(i)}),e.join(", ")}).join("\n")}`},buildMismatchTokenMessage:t=>{let e=L(t.actual),i=t.expected.name;T[i]&&(i=T[i]);let o=`Expecting token \`${i}\`, but found \`${e}\`.`;return")"!==i&&"rightParen"!==i||(o+="\n\nMake sure all left parentheses are matched\nwith right parentheses."),o},buildNoViableAltMessage:t=>{let e=`Unexpected token: \`${L(t.actual)}\`.`;return"Expression"===t.ruleName?e+="\n\nExpected a column name, `(`,\nor functional operator such as:\n- `sqrt`\n- `uppercase`\n- `day_of_week`":"ColumnName"===t.ruleName?e+="\n\nExpected a column name or `(`":"TerminalColumnName"===t.ruleName&&(e+="\n\nExpected a column name after 'AS'"),e}},j={},N=Object(S.createToken)({name:"OperatorTokenType",pattern:S.Lexer.NA}),I=Object(S.createToken)({name:"FunctionTokenType",pattern:S.Lexer.NA}),R=Object(S.createToken)({name:"UpperLowerTokenType",pattern:/(uppercase|lowercase)/}),z=/(["'])(?<column_name>.*?[^\\])\1/y,P=Object(S.createToken)({name:"columnName",pattern:{exec:function(t,e){z.lastIndex=e;const i=z.exec(t);if(null!==i){const t=i[0],e=t.substr(1,t.length-2);i.payload=e}return i}},line_breaks:!1}),D=Object(S.createToken)({name:"as",pattern:/(AS|As|as)/,longer_alt:R}),M=Object(S.createToken)({name:"add",pattern:/\+/,categories:[N]}),q=Object(S.createToken)({name:"subtract",pattern:/-/,categories:[N]}),U=Object(S.createToken)({name:"multiply",pattern:/\*/,categories:[N]}),$=Object(S.createToken)({name:"divide",pattern:/\//,categories:[N]}),H=Object(S.createToken)({name:"pow",pattern:/\^/,categories:[N]}),J=Object(S.createToken)({name:"percent_of",pattern:/\%/,categories:[N]}),B=Object(S.createToken)({name:"equals",pattern:/\==/,categories:[N]}),F=Object(S.createToken)({name:"not_equals",pattern:/\!=/,categories:[N]}),W=Object(S.createToken)({name:"greater_than",pattern:/\>/,categories:[N]}),G=Object(S.createToken)({name:"less_than",pattern:/\</,categories:[N]}),Y=Object(S.createToken)({name:"is",pattern:/\is/,categories:[N]}),Z=Object(S.createToken)({name:"sqrt",pattern:/sqrt/,categories:[I]}),X=Object(S.createToken)({name:"pow2",pattern:/pow2/,categories:[I]}),K=Object(S.createToken)({name:"abs",pattern:/abs/,categories:[I]}),V=Object(S.createToken)({name:"invert",pattern:/invert/,categories:[I]}),Q=Object(S.createToken)({name:"log",pattern:/log/,categories:[I]}),tt=Object(S.createToken)({name:"exp",pattern:/exp/,categories:[I]}),et=Object(S.createToken)({name:"bin10",pattern:/bin10/,categories:[I]}),it=Object(S.createToken)({name:"bin100",pattern:/bin100/,categories:[I]}),ot=Object(S.createToken)({name:"bin1000",pattern:/bin1000/,categories:[I]}),nt=Object(S.createToken)({name:"bin10th",pattern:/bin10th/,categories:[I]}),rt=Object(S.createToken)({name:"bin100th",pattern:/bin100th/,categories:[I]}),st=Object(S.createToken)({name:"bin1000th",pattern:/bin1000th/,categories:[I]}),at=Object(S.createToken)({name:"length",pattern:/length/,categories:[I]}),lt=Object(S.createToken)({name:"lowercase",pattern:/lowercase/,categories:[I]}),ct=Object(S.createToken)({name:"uppercase",pattern:/uppercase/,categories:[I]}),dt=Object(S.createToken)({name:"concat_comma",pattern:/concat_comma/,categories:[I]}),pt=Object(S.createToken)({name:"concat_space",pattern:/concat_space/,categories:[I]}),_t=Object(S.createToken)({name:"hour_of_day",pattern:/hour_of_day/,categories:[I]}),ht=Object(S.createToken)({name:"day_of_week",pattern:/day_of_week/,categories:[I]}),ut=Object(S.createToken)({name:"month_of_year",pattern:/month_of_year/,categories:[I]}),gt=Object(S.createToken)({name:"second_bucket",pattern:/second_bucket/,categories:[I]}),mt=Object(S.createToken)({name:"minute_bucket",pattern:/minute_bucket/,categories:[I]}),vt=Object(S.createToken)({name:"hour_bucket",pattern:/hour_bucket/}),ft=Object(S.createToken)({name:"day_bucket",pattern:/day_bucket/,categories:[I]}),bt=Object(S.createToken)({name:"week_bucket",pattern:/week_bucket/,categories:[I]}),wt=Object(S.createToken)({name:"month_bucket",pattern:/month_bucket/,categories:[I]}),yt=Object(S.createToken)({name:"year_bucket",pattern:/year_bucket/,categories:[I]}),xt=Object(S.createToken)({name:"leftParen",pattern:/\(/}),Et=Object(S.createToken)({name:"rightParen",pattern:/\)/}),At=Object(S.createToken)({name:"comma",pattern:/,/}),Ot=[Object(S.createToken)({name:"whitespace",pattern:/\s+/,group:S.Lexer.SKIPPED}),At,D,P,xt,Et,M,q,U,$,H,J,B,F,W,G,Z,X,K,V,Q,tt,st,ot,rt,it,nt,et,at,Y,dt,pt,ct,lt,_t,ht,ut,gt,mt,vt,ft,bt,wt,yt,R];Ot.forEach(t=>{j[t.name]=t});const kt=new S.Lexer(Ot,{errorMessageProvider:{buildUnexpectedCharactersMessage:(t,e,i,o,n)=>`Ln ${o}, Col ${n}: Unexpected input \`${t}\` at character ${e}`}});class St extends S.CstParser{constructor(){super(j,{errorMessageProvider:C}),this.RULE("SuperExpression",()=>{this.SUBRULE(this.Expression)}),this.RULE("Expression",()=>{this.OR([{ALT:()=>{this.SUBRULE(this.OperatorComputedColumn)}},{ALT:()=>{this.SUBRULE(this.FunctionComputedColumn)}}],{ERR_MSG:"Expected an expression of the form `x + y` or `func(x)`."})}),this.RULE("OperatorComputedColumn",()=>{this.SUBRULE(this.ColumnName,{LABEL:"left"}),this.AT_LEAST_ONE(()=>{this.SUBRULE(this.Operator),this.SUBRULE2(this.ColumnName,{LABEL:"right"})}),this.OPTION(()=>{this.SUBRULE(this.As,{LABEL:"as"})})}),this.RULE("FunctionComputedColumn",()=>{this.SUBRULE(this.Function),this.CONSUME(xt),this.AT_LEAST_ONE_SEP({SEP:At,DEF:()=>{this.SUBRULE(this.ColumnName)}}),this.CONSUME(Et),this.OPTION(()=>{this.SUBRULE(this.As,{LABEL:"as"})})}),this.RULE("ColumnName",()=>{this.OR([{ALT:()=>this.SUBRULE(this.ParentheticalExpression)},{ALT:()=>this.CONSUME(P)}],{ERR_MSG:"Expected a column name (wrapped in double quotes) or a parenthesis-wrapped expression."})}),this.RULE("TerminalColumnName",()=>{this.CONSUME(P)}),this.RULE("As",()=>{this.CONSUME(D),this.SUBRULE(this.TerminalColumnName)}),this.RULE("Function",()=>{this.OR([{ALT:()=>this.CONSUME(Z)},{ALT:()=>this.CONSUME(X)},{ALT:()=>this.CONSUME(K)},{ALT:()=>this.CONSUME(V)},{ALT:()=>this.CONSUME(Q)},{ALT:()=>this.CONSUME(tt)},{ALT:()=>this.CONSUME(st)},{ALT:()=>this.CONSUME(ot)},{ALT:()=>this.CONSUME(rt)},{ALT:()=>this.CONSUME(it)},{ALT:()=>this.CONSUME(nt)},{ALT:()=>this.CONSUME(et)},{ALT:()=>this.CONSUME(at)},{ALT:()=>this.CONSUME(ct)},{ALT:()=>this.CONSUME(lt)},{ALT:()=>this.CONSUME(dt)},{ALT:()=>this.CONSUME(pt)},{ALT:()=>this.CONSUME(_t)},{ALT:()=>this.CONSUME(ht)},{ALT:()=>this.CONSUME(ut)},{ALT:()=>this.CONSUME(gt)},{ALT:()=>this.CONSUME(mt)},{ALT:()=>this.CONSUME(vt)},{ALT:()=>this.CONSUME(ft)},{ALT:()=>this.CONSUME(bt)},{ALT:()=>this.CONSUME(wt)},{ALT:()=>this.CONSUME(yt)}])}),this.RULE("Operator",()=>{this.OR([{ALT:()=>this.CONSUME(M)},{ALT:()=>this.CONSUME(q)},{ALT:()=>this.CONSUME(U)},{ALT:()=>this.CONSUME($)},{ALT:()=>this.CONSUME(H)},{ALT:()=>this.CONSUME(J)},{ALT:()=>this.CONSUME(B)},{ALT:()=>this.CONSUME(F)},{ALT:()=>this.CONSUME(W)},{ALT:()=>this.CONSUME(G)},{ALT:()=>this.CONSUME(Y)}])}),this.RULE("ParentheticalExpression",()=>{this.CONSUME(xt),this.SUBRULE(this.Expression),this.CONSUME(Et)}),this.performSelfAnalysis()}}const Tt={"+":(t,e)=>`(${t} + ${e})`,"-":(t,e)=>`(${t} - ${e})`,"*":(t,e)=>`(${t} * ${e})`,"/":(t,e)=>`(${t} / ${e})`,"%":(t,e)=>`(${t} %% ${e})`,"==":(t,e)=>`(${t} == ${e})`,"!=":(t,e)=>`(${t} != ${e})`,">":(t,e)=>`(${t} > ${e})`,"<":(t,e)=>`(${t} < ${e})`,"^":(t,e)=>`(${t} ^ ${e})`,invert:t=>`(1 / ${t})`,log:t=>`log(${t})`,exp:t=>`exp(${t})`,pow2:t=>`(${t} ^ 2)`,sqrt:t=>`sqrt(${t})`,abs:t=>`abs(${t})`,bin10:t=>`bin10(${t})`,bin100:t=>`bin100(${t})`,bin1000:t=>`bin1000(${t})`,bin10th:t=>`bin10th(${t})`,bin100th:t=>`bin100th(${t})`,bin1000th:t=>`bin1000th(${t})`,uppercase:t=>`uppercase(${t})`,lowercase:t=>`lowercase(${t})`,length:t=>`length(${t})`,is:(t,e)=>`(${t} is ${e})`,concat_space:(t,e)=>`concat_space(${t}, ${e})`,concat_comma:(t,e)=>`concat_comma(${t}, ${e})`,hour_of_day:t=>`hour_of_day(${t})`,day_of_week:t=>`day_of_week(${t})`,month_of_year:t=>`month_of_year(${t})`,second_bucket:t=>`second_bucket(${t})`,minute_bucket:t=>`minute_bucket(${t})`,hour_bucket:t=>`hour_bucket(${t})`,day_bucket:t=>`day_bucket(${t})`,week_bucket:t=>`week_bucket(${t})`,month_bucket:t=>`month_bucket(${t})`,year_bucket:t=>`year_bucket(${t})`},Lt=new St([]),Ct=Lt.getBaseCstVisitorConstructor();const jt=new class extends Ct{constructor(){super(),this.validateVisitor()}SuperExpression(t){let e=[];return this.visit(t.Expression,e),e}Expression(t,e){if(t.OperatorComputedColumn)this.visit(t.OperatorComputedColumn,e);else{if(!t.FunctionComputedColumn)return;this.visit(t.FunctionComputedColumn,e)}}OperatorComputedColumn(t,e){let i=this.visit(t.left,e);void 0===i&&(i=e[e.length-1].column);let o=this.visit(t.Operator);if(!o)return;let n=this.visit(t.right,e);void 0===n&&(n=e[e.length-1].column);let r=this.visit(t.as),s=Tt[o](i,n);r&&(s=r),e.push({column:s,computed_function_name:o,inputs:[i,n]})}FunctionComputedColumn(t,e){const i=this.visit(t.Function);let o=[];for(const i of t.ColumnName){let t=this.visit(i,e);void 0===t?o.push(e[e.length-1].column):o.push(t)}const n=this.visit(t.as);let r=Tt[i](...o);n&&(r=n);const s={column:r,computed_function_name:i,inputs:o};e.push(s)}ColumnName(t,e){return t.ParentheticalExpression?this.visit(t.ParentheticalExpression,e):t.columnName[0].payload}TerminalColumnName(t){return t.columnName[0].payload}Operator(t){return t.add?t.add[0].image:t.subtract?t.subtract[0].image:t.multiply?t.multiply[0].image:t.divide?t.divide[0].image:t.pow?t.pow[0].image:t.percent_of?t.percent_of[0].image:t.equals?t.equals[0].image:t.not_equals?t.not_equals[0].image:t.greater_than?t.greater_than[0].image:t.less_than?t.less_than[0].image:t.is?t.is[0].image:void 0}Function(t){return t.sqrt?t.sqrt[0].image:t.pow2?t.pow2[0].image:t.abs?t.abs[0].image:t.invert?t.invert[0].image:t.log?t.log[0].image:t.exp?t.exp[0].image:t.length?t.length[0].image:t.uppercase?t.uppercase[0].image:t.lowercase?t.lowercase[0].image:t.concat_comma?t.concat_comma[0].image:t.concat_space?t.concat_space[0].image:t.bin10?t.bin10[0].image:t.bin100?t.bin100[0].image:t.bin1000?t.bin1000[0].image:t.bin10th?t.bin10th[0].image:t.bin100th?t.bin100th[0].image:t.bin1000th?t.bin1000th[0].image:t.hour_of_day?t.hour_of_day[0].image:t.day_of_week?t.day_of_week[0].image:t.month_of_year?t.month_of_year[0].image:t.second_bucket?t.second_bucket[0].image:t.minute_bucket?t.minute_bucket[0].image:t.hour_bucket?t.hour_bucket[0].image:t.day_bucket?t.day_bucket[0].image:t.week_bucket?t.week_bucket[0].image:t.month_bucket?t.month_bucket[0].image:t.year_bucket?t.year_bucket[0].image:void 0}As(t){return t.TerminalColumnName[0].children.columnName[0].payload}ParentheticalExpression(t,e){return this.visit(t.Expression,e)}},Nt=function(t){const e=function(t){const e=kt.tokenize(t);if(e.errors.length>0){let t=e.errors.map(t=>t.message);throw new Error(`${t.join("\n")}`)}return e}(t);Lt.input=e.tokens;const i=Lt.SuperExpression();if(Lt.errors.length>0){let t=Lt.errors.map(t=>t.message);throw new Error(`${t.join("\n")}`)}return jt.visit(i)};var It,Rt;function zt(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}function Pt(t,e,i,o,n){var r={};return Object.keys(o).forEach((function(t){r[t]=o[t]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(t,e,i)||i}),r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(t,e,r),r=null),r}Object.setPrototypeOf(zt.prototype,HTMLElement.prototype),Object.setPrototypeOf(zt,HTMLElement);Object(n.b)(A.a,k.a)((Pt((Rt=class extends zt{constructor(){super(),this._parsed_expression=void 0,this.expressions=[]}connectedCallback(){this._register_ids(),this._register_callbacks(),this._textarea_observer=new MutationObserver(this._resize_textarea.bind(this))}_observe_textarea(){this._textarea_observer.observe(this._expression_input,{attributes:!0,attributeFilter:["style"]})}_resize_textarea(){const t=new CustomEvent("perspective-computed-expression-resize");this.dispatchEvent(t),this._textarea_observer.disconnect()}_capture_drop_data(t){const e=t.dataTransfer.getData("text");if(""!==e)try{const i=JSON.parse(e);Array.isArray(i)&&i.length>4&&(t.preventDefault(),this._expression_input.value+=`"${i[0]}"`)}catch(t){}finally{this._validate_expression()}}async _validate_expression(){const t=this._expression_input.value;if(0===t.length)return this._clear_error_messages(),void this._enable_save_button();try{this._parsed_expression=Nt(t)}catch(t){const e=t.message?t.message:JSON.stringify(t);return this._disable_save_button(),void this._set_error_message(e,this._error)}const e=new CustomEvent("perspective-computed-expression-type-check",{detail:{parsed_expression:this._parsed_expression}});this.dispatchEvent(e)}async _type_check_expression(t,e){const i=this._parsed_expression||[],o=[];for(const e of i)t[e.column]||o.push(e.column);if(o.length>0){let t="TypeError:\n";for(const i of o)t+=`- \`${i}\` expected input column types ${e[i].join("/")}\n`;this._disable_save_button(),this._set_error_message(t,this._error)}else this._clear_error_messages(),this._enable_save_button()}_remove_all_expressions(){const t=new CustomEvent("perspective-computed-expression-remove");this.dispatchEvent(t),this.expressions=[]}_save_expression(){const t=this._expression_input.value,e=this._parsed_expression||[],i=new CustomEvent("perspective-computed-expression-save",{detail:{expression:t,parsed_expression:e}});this.dispatchEvent(i),this.expressions.push(t)}_clear_expression_input(){this._expression_input.value=""}_close_expression_editor(){this.style.display="none",this._side_panel_actions.style.display="flex",this._clear_error_messages(),this._clear_expression_input(),this._textarea_observer.disconnect()}_set_error_message(t,e){e&&(e.innerText=t,e.style.display="block")}_clear_error_messages(){this._error.innerText="",this._error.style.display="none"}_disable_save_button(){this._save_button.toggleAttribute("disabled",!0)}_enable_save_button(){this._save_button.removeAttribute("disabled")}_disable_remove_button(){this._remove_button.toggleAttribute("disabled",!0)}_enable_remove_button(){this._remove_button.removeAttribute("disabled")}_register_ids(){this._side_panel_actions=this.parentElement.querySelector("#side_panel__actions"),this._close_button=this.shadowRoot.querySelector("#psp-expression-close"),this._expression_input=this.shadowRoot.querySelector("#psp-expression-input"),this._error=this.shadowRoot.querySelector("#psp-expression-error"),this._save_button=this.shadowRoot.querySelector("#psp-expression-button-save"),this._remove_button=this.shadowRoot.querySelector("#psp-expression-button-remove")}_register_callbacks(){this._close_button.addEventListener("click",this._close_expression_editor.bind(this)),this._expression_input.addEventListener("keyup",this._validate_expression.bind(this)),this._expression_input.addEventListener("drop",this._capture_drop_data.bind(this)),this._save_button.addEventListener("click",this._save_expression.bind(this))}}).prototype,"_validate_expression",[n.f],Object.getOwnPropertyDescriptor(Rt.prototype,"_validate_expression"),Rt.prototype),Pt(Rt.prototype,"_type_check_expression",[n.f],Object.getOwnPropertyDescriptor(Rt.prototype,"_type_check_expression"),Rt.prototype),It=Rt));var Dt=i(17),Mt=i.n(Dt),qt=i(18),Ut=i.n(qt),$t=i(19),Ht=i.n($t);function Jt(t){if(0==this._active_columns.children.length)return 0;{let i=!1;for(let o in this._active_columns.children){var e;let n=this._active_columns.children[o];if(i=i||(null==n?void 0:null===(e=n.classList)||void 0===e?void 0:e.contains("null-column")),n.offsetTop+n.offsetHeight>t.offsetY+this._active_columns.scrollTop)return parseInt(o)}let o=this._active_columns.children.length;return i&&o--,o}}function Bt(t){let e=t.target.getRootNode().host,i=e;i="PERSPECTIVE-VIEWER"===i.tagName?t.target.parentElement:e.parentElement;let o=Array.prototype.slice.call(i.children).indexOf("PERSPECTIVE-ROW"===e.tagName?e:t.target),n=i.getAttribute("for");if(this.hasAttribute(n)){let t=JSON.parse(this.getAttribute(n));t.splice(o,1),0===t.length?this.removeAttribute(n):this.setAttribute(n,JSON.stringify(t))}}function Ft(t){t.preventDefault(),t.currentTarget.classList.remove("dropping"),this._drop_target_hover&&this._drop_target_hover.removeAttribute("drop-target");let e=t.dataTransfer.getData("text");if(!e)return;e=JSON.parse(e);let i=t.currentTarget.querySelector("ul").getAttribute("for")||t.currentTarget.getAttribute("id").replace("_","-"),o=JSON.parse(this.getAttribute(i)||"[]"),n=o.indexOf(e[0]);-1!==n&&o.splice(n,1);const r=i.indexOf("filter")>-1;if(r?this.setAttribute(i,JSON.stringify(o.concat([e]))):i.indexOf("sort")>-1?this.setAttribute(i,JSON.stringify(o.concat([[e[0]]]))):this.setAttribute(i,JSON.stringify(o.concat([e[0]]))),"pivots"===this._plugin.deselectMode&&this._get_visible_column_count()>1&&"sort"!==i&&!r){for(let t of this.shadowRoot.querySelectorAll("#active_columns perspective-row"))if(t.getAttribute("name")===e[0]){this._active_columns.removeChild(t);break}this._update_column_view()}this._debounce_update()}function Wt(t){let e=t.target.parentElement.parentElement;Array.prototype.slice(this._active_columns.children).indexOf(e)>-1&&this._get_visible_column_count()>1&&"move"!==t.dataTransfer.dropEffect&&(this._active_columns.removeChild(e),this._update_column_view()),this._active_columns.classList.remove("dropping")}function Gt(t){let e=t.relatedTarget;for(;e&&e!==this._active_columns;)e=e.parentElement;null===e&&(this._active_columns.classList.remove("dropping"),this._drop_target_null&&(this._active_columns.replaceChild(this._drop_target_null,this._drop_target_hover),delete this._drop_target_null),this._drop_target_hover.parentElement===this._active_columns&&this._active_columns.removeChild(this._drop_target_hover),-1!==this._original_index&&this._active_columns.insertBefore(this._drop_target_hover,this._active_columns.children[this._original_index]),this._drop_target_hover.removeAttribute("drop-target"))}function Yt(){this._drop_target_null&&(this._drop_target_null.parentElement===this._active_columns?Object(n.e)(this._active_columns,this._drop_target_hover,this._drop_target_null):this._active_columns.replaceChild(this._drop_target_null,this._drop_target_hover),delete this._drop_target_null)}function Zt(t){Yt.call(this),this._active_columns.children[t]&&this._drop_target_hover!==this._active_columns.children[t]&&(this._drop_target_null=this._active_columns.children[t],Object(n.e)(this._active_columns,this._active_columns.children[t],this._drop_target_hover))}function Xt(t){Yt.call(this),this._active_columns.children[t]&&(this._drop_target_null=this._active_columns.children[t],this._active_columns.replaceChild(this._drop_target_hover,this._active_columns.children[t]))}function Kt(t){var e,i,o,r,s,a,l,c;t.preventDefault(),t.dataTransfer.dropEffect="move","dropping"!==t.currentTarget.className&&t.currentTarget.classList.add("dropping"),this._drop_target_hover.hasAttribute("drop-target")||this._drop_target_hover.toggleAttribute("drop-target",!0);let d=Jt.call(this,t);const p=Array.prototype.slice.call(this._active_columns.children).indexOf(this._drop_target_hover),_=this._active_columns.children[d],h=d<(null===(e=this._plugin.initial)||void 0===e?void 0:null===(i=e.names)||void 0===i?void 0:i.length)-1,u=this._drop_target_hover!==this._active_columns.children[d],g=-1!==this._original_index,m=g&&this._original_index<(null===(o=this._plugin.initial)||void 0===o?void 0:null===(r=o.names)||void 0===r?void 0:r.length)-1,v=g&&this._original_index>=(null===(s=this._plugin.initial)||void 0===s?void 0:null===(a=s.names)||void 0===a?void 0:a.length)-1,f=g&&this._original_index<(null===(l=this._plugin.initial)||void 0===l?void 0:l.count),b=!(d<(null===(c=this._plugin.initial)||void 0===c?void 0:c.count))&&(null==_?void 0:_.classList.contains("null-column"));if(f&&b)Yt.call(this);else if(h&&v&&u){var w,y,x,E,A;Yt.call(this),this._original_index===(null===(w=this._plugin.initial)||void 0===w?void 0:null===(y=w.names)||void 0===y?void 0:y.length)-1&&this._drop_target_hover===this._active_columns.children[this._original_index]&&this._active_columns.children.length===(null===(x=this._plugin.initial)||void 0===x?void 0:null===(E=x.names)||void 0===E?void 0:E.length)?(this._drop_target_null=this._active_columns.children[d],Object(n.e)(this._active_columns,this._active_columns.children[d],this._drop_target_hover)):(null===(A=this._active_columns.children[d])||void 0===A?void 0:A.classList.contains("null-column"))?this._drop_target_hover!==this._active_columns.children[d]&&(this._drop_target_null=this._active_columns.children[d],this._active_columns.replaceChild(this._drop_target_hover,this._active_columns.children[d])):(this._drop_target_null=this._active_columns.children[d],this._active_columns.replaceChild(this._drop_target_hover,this._active_columns.children[d]),this._active_columns.insertBefore(this._drop_target_null,this._active_columns.children[this._original_index]))}else h&&g&&u?Zt.call(this,d):h&&!g&&u?Xt.call(this,d):!h&&m&&u?Zt.call(this,d):b&&g?Zt.call(this,d):b&&!g?Xt.call(this,d):p<d?d+1<this._active_columns.children.length?this._active_columns.children[d+1].hasAttribute("drop-target")||(Yt.call(this),this._active_columns.insertBefore(this._drop_target_hover,this._active_columns.children[d+1])):this._active_columns.children[this._active_columns.children.length-1].hasAttribute("drop-target")||(Yt.call(this),this._active_columns.appendChild(this._drop_target_hover)):d<this._active_columns.children.length?this._active_columns.children[d].hasAttribute("drop-target")||(Yt.call(this),this._active_columns.insertBefore(this._drop_target_hover,this._active_columns.children[d])):this._active_columns.children[this._active_columns.children.length-1].hasAttribute("drop-target")||(Yt.call(this),this._active_columns.appendChild(this._drop_target_hover))}function Vt(t){t.preventDefault(),delete this._drop_target_null,t.currentTarget.classList.remove("dropping"),this._drop_target_hover.parentElement===this._active_columns&&this._drop_target_hover.removeAttribute("drop-target"),t.dataTransfer.getData("text")&&this._update_column_view()}function Qt(t){t.stopPropagation(),t.preventDefault(),t.currentTarget.classList.add("dropping")}function te(t){t.stopPropagation(),t.preventDefault(),t.currentTarget.classList.add("dropping"),t.dataTransfer.dropEffect="move"}function ee(t){t.currentTarget==t.target&&(t.stopPropagation(),t.preventDefault(),t.currentTarget.classList.remove("dropping"))}i(25);var ie=i(20),oe=i.n(ie);class ne{constructor(t,e=!1){this._on_cancel=t,this._cancelled=!1,this.initial=e}cancel(){!this._cancelled&&this._on_cancel&&(this._on_cancel(),this._on_cancel=void 0),this._cancelled=!0}get cancelled(){return this._cancelled}}function re(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(re.prototype,HTMLElement.prototype),Object.setPrototypeOf(re,HTMLElement);class se extends re{get _plugin(){let t=r.b.getInstance(),e=this.getAttribute("plugin");return e||(e=Object.keys(t)[0],this.setAttribute("plugin",e)),t[e]||t[Object.keys(t)[0]]}_get_view_dom_columns(t,e){t=t||"#active_columns perspective-row";let i=Array.prototype.slice.call(this.shadowRoot.querySelectorAll(t));return e?i.map(e).filter(t=>t):i}_get_view_all_columns(){return Array.prototype.slice.call(this.shadowRoot.querySelectorAll("#inactive_columns perspective-row"))}_get_view_active_columns(){return Array.prototype.slice.call(this.shadowRoot.querySelectorAll("#active_columns perspective-row"))}_get_view_active_valid_columns(){return Array.prototype.slice.call(this.shadowRoot.querySelectorAll("#active_columns perspective-row")).filter(t=>!t.classList.contains("null-column"))}_get_view_inactive_columns(){return Array.prototype.slice.call(this.shadowRoot.querySelectorAll("#inactive_columns perspective-row"))}_get_view_all_column_names(){return this._get_view_all_columns().map(t=>t.getAttribute("name"))}_get_view_active_column_names(){return this._get_view_active_columns().map(t=>t.getAttribute("name"))}_get_view_all_valid_column_names(){return this._get_view_all_column_names().filter(t=>t)}_get_view_active_valid_column_names(){return this._get_view_active_column_names().filter(t=>t)}_get_view_active_valid_column_count(){return this._get_view_active_valid_column_names().length}_get_view_columns({active:t=!0}={}){let e;return e=t?"#active_columns perspective-row":"#inactive_columns perspective-row",this._get_view_dom_columns(e,t=>t.getAttribute("name"))}_get_view_aggregates(t){return t=t||"#active_columns perspective-row",this._get_view_dom_columns(t,t=>{let e=t.getAttribute("aggregate");if("["===e[0])try{e=JSON.parse(e)}catch(t){console.error(t)}const i=t.getAttribute("name");return i&&{op:e,column:i}})}_get_view_row_pivots(){return this._get_view_dom_columns("#row_pivots perspective-row",t=>t.getAttribute("name"))}_get_view_column_pivots(){return this._get_view_dom_columns("#column_pivots perspective-row",t=>t.getAttribute("name"))}_get_view_filter_nodes(){return this._get_view_dom_columns("#filters perspective-row")}_get_view_filters(){return this._get_view_dom_columns("#filters perspective-row",t=>{let{operator:e,operand:i}=JSON.parse(t.getAttribute("filter"));return[t.getAttribute("name"),e,i]})}_get_view_sorts(){return this._get_view_dom_columns("#sort perspective-row",t=>{let e=t.getAttribute("sort-order")||"asc";return[t.getAttribute("name"),e]})}_get_view_computed_columns(){return JSON.parse(this.getAttribute("computed-columns"))||[]}_get_view_parsed_computed_columns(){return JSON.parse(this.getAttribute("parsed-computed-columns"))||[]}_get_visible_column_count(){return this._get_view_active_columns().length}get_aggregate_attribute(){const t=JSON.parse(this.getAttribute("aggregates"))||{},e=new Set,i=Object.keys(t).map(i=>(e.add(i),{column:i,op:t[i]}));if(this._aggregate_defaults)for(const t of Object.keys(this._aggregate_defaults))e.has(t)||i.push({column:t,op:this._aggregate_defaults[t]});return i}}function ae(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}let le={integer:2,string:0,float:3,boolean:4,datetime:1,date:1};const ce=t=>(e,i)=>{const o=le[t[e]],n=le[t[i]];let r=0;return r=o==n?e.toLowerCase()<i.toLowerCase()?-1:1:o<n?-1:1,r};const de=t=>{if(t){const e=ae(t[0]),i=ae(t[1]),o=Math.floor(t[0]/t[1]*100);return b.html`
            <span title="${e} / ${i}" class="plugin_information--overflow-hint">&nbsp;<span class="plugin_information--overflow-hint-percent">${o}%</span>&nbsp;</span>
        `}},pe=t=>{if(""!==t)return b.html`
            <span style="white-space:nowrap">${t}</span>
        `},_e=(t,...e)=>t.flatMap((t,i)=>[pe(t),de(e[i])]).filter(t=>t);class he extends se{_validate_parsed_computed_columns(t,e){if(!t||0===t.length)return[];const i=[];for(const o of t)e[o.column]&&i.push(o);return i}async _load_table(t){this.shadowRoot.querySelector("#app").classList.add("hide_message");const e=this._set_updating();this._clear_state(),this._table=t;let[i,o]=await Promise.all([t.columns(),t.schema(!0)]);this._initial_col_order=i.slice();let n=this._get_view_parsed_computed_columns();if(0===n.length){const t=this._get_view_computed_columns();for(const e of t)"string"==typeof e?n=n.concat(Nt(e)):n.push(e)}const r=n.map(t=>t.column),s=await t.computed_schema(n);i=i.concat(r),this.hasAttribute("columns")||this.setAttribute("columns",JSON.stringify(this._initial_col_order)),i.sort(ce(o));const a=function(t,e,i,o){const n=new Set,r=[];for(const e of t){let t=i[e.column];t||(t=o[e.column]);const s=Object(u.get_type_config)(t);n.add(e.column),s.type||t?(""!==e.op&&-1!==h.a.TYPE_AGGREGATES[s.type||t].indexOf(e.op)||(e.op=s.aggregate),r.push(e)):console.warn(`No column "${e.column}" found (specified in aggregates attribute).`)}for(const t of e)if(!n.has(t)){let e=i[t];e||(e=o[t.column]),r.push({column:t,op:Object(u.get_type_config)(e).aggregate})}return r}(this.get_aggregate_attribute(),i,o,s);let l=JSON.parse(this.getAttribute("columns"));0===l.filter(t=>i.indexOf(t)>-1).length&&(l=this._initial_col_order),this._aggregate_defaults=function(t,e,i){const o={};for(const n of t){let t=e[n];t||(t=i[n]),o[n]=Object(u.get_type_config)(t).aggregate}return o}(i,o,s),this._clear_columns();for(const t of i){let e=a.find(e=>e.column===t).op;const i=r.includes(t)?t:void 0;let n=o[t];n||(n=s[t]);const c=this._new_row(t,n,e,null,null,i);this._inactive_columns.appendChild(c),l.includes(t)&&c.classList.add("active")}for(;l.length<(null===(c=this._plugin.initial)||void 0===c?void 0:null===(d=c.names)||void 0===d?void 0:d.length);){var c,d;l.push(null)}for(const t of l){const e=r.includes(t)?t:void 0;let i=o[name];i||(i=s[name]);const n=this._new_row(t,i,void 0,void 0,void 0,e);this._active_columns.appendChild(n)}i.length===l.filter(t=>i.indexOf(t)>-1).length?this._inactive_columns.parentElement.classList.add("collapse"):this._inactive_columns.parentElement.classList.remove("collapse"),this._show_column_container(),!0===await this._table.compute()&&this._show_side_panel_actions(),this.hasAttribute("filters")&&(this.filters=this.getAttribute("filters"));try{await this._debounce_update({force_update:!0})}catch(t){throw console.warn("Initial view failed, resetting UI state"),await this.reset(),t}e()}async get_maxes(){let t,e;const[i,o]=await Promise.all([this._view.schema(),this._view.num_columns()]),n=Object.keys(i||{}).length||1;if(void 0!==this._plugin.max_columns){const e=this._plugin.max_columns%n,i=this._plugin.max_columns+e;t=i<o?i:void 0}return void 0!==this._plugin.max_cells&&(e=Math.ceil(t?this._plugin.max_cells/t:this._plugin.max_cells/(o||1))),{max_cols:t,max_rows:e}}async _warn_render_size_exceeded(t,e){if(this._show_warnings&&(t||e)){const i=await this._view.num_columns(),o=await this._view.num_rows(),n=i*o,r=t&&t<i,s=e&&e<o;if(r&&s){this._plugin_information.classList.remove("hidden");const o=_e`Rendering ${[t,i]} of columns and ${[i*e,n]} of points.`;return Object(b.render)(o,this._plugin_information_message),!0}if(r){this._plugin_information.classList.remove("hidden");const e=_e`Rendering ${[t,i]} of columns.`;return Object(b.render)(e,this._plugin_information_message),!0}if(s){this._plugin_information.classList.remove("hidden");const t=_e`Rendering ${[i*e,n]} of points.`;return Object(b.render)(t,this._plugin_information_message),!0}this._plugin_information.classList.add("hidden")}return!1}_calculate_throttle_timeout(){let t;const e=this.getAttribute("throttle");if(void 0!==e&&"null"!==e&&this.hasAttribute("throttle")){if(t=parseInt(e),isNaN(t)||t<0)return console.warn(`Bad throttle attribute value "${e}".  Can be (non-negative integer) milliseconds.`),this.removeAttribute("throttle"),0}else{if(!this.__render_times||this.__render_times.length<5)return 0;t=this.__render_times.reduce((t,e)=>t+e,0)/this.__render_times.length,t=Math.min(5e3,t)}return Math.max(0,t)}_view_on_update(t){this._debounced||(this._debounced=setTimeout(async()=>{this._debounced=void 0;const e=this._render_time();this._task&&!this._task.initial&&this._task.cancel();const i=this._task=new ne,o=this._plugin.update||this._plugin.create;try{if(t){const{max_cols:t,max_rows:e}=await this.get_maxes();i.cancelled||(await this._warn_render_size_exceeded(t,e),await o.call(this,this._datavis,this._view,i,t,e))}else await o.call(this,this._datavis,this._view,i);e(),i.cancel()}catch(t){console.error("Error rendering plugin.",t)}finally{this.dispatchEvent(new Event("perspective-view-update"))}},this._calculate_throttle_timeout()))}async _validate_filters(){const t=[];for(const e of this._get_view_filter_nodes()){const i=e.shadowRoot.getElementById("filter_operand"),o=e.shadowRoot.getElementById("row_exclamation"),{operator:n,operand:r}=JSON.parse(e.getAttribute("filter")),s=[e.getAttribute("name"),n,r];await this._table.is_valid_filter(s)?(t.push(s),e.title="",i.style.borderColor="",o.hidden=!0):(e.title="Invalid Filter",i.style.borderColor="red",o.hidden=!1)}return t}_is_config_changed(t){const e=this.getAttribute("plugin");return(!oe()(t,this._previous_config)||e!==this._previous_plugin_name)&&(this._previous_config=t,this._previous_plugin_name=e,!0)}async _new_view({force_update:t=!1,ignore_size_check:e=!1,limit_points:i=!0}={}){if(!this._table)return;this._check_responsive_layout();const o=this._get_view_row_pivots(),n=this._get_view_column_pivots(),r=await this._validate_filters(),s=this._get_view_aggregates();if(0===s.length)return;const a=this._get_view_sorts();let l=s.map(t=>t.column),c={};for(const t of s)c[t.column]=t.op;for(const t of a){const e=t[0];if(-1===l.indexOf(e)&&!(n.indexOf(t)>-1||o.indexOf(t)>-1)){const t=this.get_aggregate_attribute(),{column:i,op:o}=t.reduce((t,i)=>i.column===e?i:t);c[i]=o}}const d={filter:r,row_pivots:o,column_pivots:n,aggregates:c,columns:l,sort:a,computed_columns:this._get_view_parsed_computed_columns()};this._view&&(this._view.remove_update(this._view_updater),this._view.delete(),this._view=void 0);try{this._view=this._table.view(d),this._view_updater=()=>this._view_on_update(i),this._view.on_update(this._view_updater)}catch(t){throw this._view.delete(),t}const p=this._render_time();this._render_count=(this._render_count||0)+1,this._task&&this._task.cancel();const _=this._task=new ne(()=>this._render_count--,!0);try{const{max_cols:o,max_rows:n}=await this.get_maxes();e||await this._warn_render_size_exceeded(o,n),i?await this._plugin.create.call(this,this._datavis,this._view,_,o,n,t):await this._plugin.create.call(this,this._datavis,this._view,_,void 0,void 0,t)}catch(t){console.warn(t)}finally{this.__render_times||(this.__render_times=[],this.dispatchEvent(new Event("perspective-view-update"))),p(),_.cancel(),0===this._render_count&&(this.removeAttribute("updating"),this.dispatchEvent(new Event("perspective-update-complete")))}}_check_loaded_table(){if(this._table){const t=this._table;delete this._table,this._load_table(t)}}_render_time(){const t=performance.now();return()=>{this.__render_times.unshift(performance.now()-t),this.__render_times=this.__render_times.slice(0,5)}}_restyle_plugin(){if(this._plugin.styleElement){const t=this._task=new ne;this._plugin.styleElement.call(this,this._datavis,this._view,t)}}_clear_state(t=!0){this._task&&this._task.cancel();const e=[];if(this._view){const t=this._view;this._view=void 0,e.push(t.delete()),t.remove_update(this._view_updater),t.remove_delete()}if(this._table&&t){const t=this._table;this._table=void 0,t._owner_viewer&&t._owner_viewer===this&&e.push(t.delete())}return Promise.all(e)}_set_updating(){let t;return this.toggleAttribute("updating",!0),this._updating_promise=new Promise(e=>{t=e}),t}_register_debounce_instance(){const t=a()((t,e,i,o)=>{this._new_view({ignore_size_check:e,force_update:i,limit_points:o}).then(t)},0);this._debounce_update=async({force_update:e=!1,ignore_size_check:i=!1,limit_points:o=!0}={})=>{if(this._table){let n=this._set_updating();await new Promise(n=>t(n,i,e,o)),n()}}}_get_worker(){return this._table?this._table._worker:h.a.shared_worker()}}const ue=t=>{const e=[];for(name in t)e.push(b.html`
            <option value="${name}">${t[name].name||name}</option>
        `);return e};class ge extends he{_clear_columns(){this._inactive_columns.innerHTML="",this._active_columns.innerHTML=""}set_aggregate_attribute(t){let e=!1,i=t.reduce((t,i)=>(this._aggregate_defaults[i.column]!==i.op&&(t[i.column]=i.op,e=!0),t),{});e?this.setAttribute("aggregates",JSON.stringify(i)):this.removeAttribute("aggregates")}_get_type(t){let e=this._get_view_inactive_columns();if(e.length>0){const i=e.find(e=>e.getAttribute("name")===t);return i?i.getAttribute("type"):"integer"}return""}_set_row_type(t){const e=this._get_view_inactive_columns().filter(t=>"integer"===t.getAttribute("type")||"float"===t.getAttribute("type")).map(t=>t.getAttribute("name"));t.set_weights(e),t.setAttribute("type",this._get_type(t.getAttribute("name")))}_new_row(t,e,i,o,n,r){let s=document.createElement("perspective-row");if(e=e||this._get_type(t),!i){let o=this.get_aggregate_attribute();i=o&&(i=o.find(e=>e.column===t))?i.op:Object(u.get_type_config)(e).aggregate}if(o&&(s.setAttribute("filter",o),"string"===e)){const e=this._table.view({row_pivots:[t],aggregates:{}});e.to_json().then(t=>{s.choices(this._autocomplete_choices(t))}),e.delete()}n?s.setAttribute("sort-order",n):this._get_view_column_pivots().indexOf(t)>-1?s.setAttribute("sort-order","col asc"):s.setAttribute("sort-order","asc");const a=this._get_view_inactive_columns().filter(t=>"integer"===t.getAttribute("type")||"float"===t.getAttribute("type")).map(t=>t.getAttribute("name"));return s.set_weights(a),null===t?s.classList.add("null-column"):(s.setAttribute("type",e),s.setAttribute("name",t)),s.setAttribute("aggregate",Array.isArray(i)?JSON.stringify(i):i),s.addEventListener("visibility-clicked",this._column_visibility_clicked.bind(this)),s.addEventListener("aggregate-selected",this._column_aggregate_clicked.bind(this)),s.addEventListener("filter-selected",this._column_filter_clicked.bind(this)),s.addEventListener("close-clicked",t=>Bt.call(this,t.detail)),s.addEventListener("sort-order",this._sort_order_clicked.bind(this)),s.addEventListener("row-drag",()=>{this.classList.add("dragging"),this._active_columns.style.overflow="hidden",this._original_index=Array.prototype.slice.call(this._active_columns.children).findIndex(e=>e.getAttribute("name")===t),-1!==this._original_index?(this._drop_target_hover=this._active_columns.children[this._original_index],setTimeout(()=>s.setAttribute("drop-target",!0))):this._drop_target_hover=this._new_row(t,e,i)}),s.addEventListener("row-dragend",()=>{this._active_columns.style.overflow="auto",this.classList.remove("dragging")}),r&&(s.setAttribute("computed_column",JSON.stringify(r)),s.classList.add("computed")),s}_update_computed_column_view(t){const e=this._get_view_parsed_computed_columns(),i=this._get_view_all_column_names(),o=this._get_view_active_column_names();if(0===Object.keys(t).length||0===e.length)return;let n=0;const r=JSON.parse(this.getAttribute("columns"))||[];let s=!1;for(const a of e){const e=a.column;if(!i.includes(e)&&r.includes(e)&&(s=!0),!(!i.includes(e)&&!o.includes(e)))continue;const l=this._new_row(e,t[e],null,null,null,e);this._inactive_columns.appendChild(l),n++}s?this._update_column_view(r,!0):n>0&&this._inactive_columns.parentElement.classList.contains("collapse")&&this._inactive_columns.parentElement.classList.remove("collapse")}_diff_computed_column_view(t,e){const i=[],o=e.map(t=>t.column);for(const e of t)o.includes(e.column)||i.push(e);return i}_reset_computed_column_view(t){if(!t||0===t.length)return;const e=t.map(t=>t.column),i=this._get_view_active_column_names().filter(t=>!e.includes(t)),o=this._get_view_aggregates().filter(t=>!e.includes(t.column)),n=this._get_view_row_pivots().filter(t=>!e.includes(t)),r=this._get_view_column_pivots().filter(t=>!e.includes(t)),s=this._get_view_sorts().filter(t=>!e.includes(t[0])),a=this._get_view_filters().filter(t=>!e.includes(t[0]));this.set_aggregate_attribute(o),this.setAttribute("columns",JSON.stringify(i)),this.setAttribute("row-pivots",JSON.stringify(n)),this.setAttribute("column-pivots",JSON.stringify(r)),this.setAttribute("sort",JSON.stringify(s)),this.setAttribute("filters",JSON.stringify(a));const l=this._get_view_all_columns().filter(t=>t.classList.contains("computed"));for(const t of l)this._inactive_columns.removeChild(t);const c=this._get_view_active_columns().filter(t=>null!=t),d=this._get_view_inactive_columns();c.length===d.length?this._inactive_columns.parentElement.classList.add("collapse"):this._inactive_columns.parentElement.classList.remove("collapse")}_update_column_view(t,e=!1){if(t||(t=this._get_view_active_column_names()),this._plugin.initial&&this._plugin.initial.names)for(;t.length<this._plugin.initial.names.length;)t.push(null);this.setAttribute("columns",JSON.stringify(t));const i=t.filter(t=>null!=t),o=this._get_view_inactive_columns();i.length===o.length?this._inactive_columns.parentElement.classList.add("collapse"):this._inactive_columns.parentElement.classList.remove("collapse"),o.forEach(t=>{-1===i.indexOf(t.getAttribute("name"))?t.classList.remove("active"):t.classList.add("active")}),e&&this._update_column_list(t,this._active_columns,(t,e)=>{if(null===t)return this._new_row(null);{const i=o.find(e=>e.getAttribute("name")===t);if(i){const t=i.getAttribute("name");let o;return e.includes(t)&&(o=t),this._new_row(t,i.getAttribute("type"),void 0,void 0,void 0,o)}}})}_update_column_list(t,e,i,o){o=o||((t,e)=>e.getAttribute("name")===t);const n=Array.prototype.slice.call(e.children),r=this._get_view_parsed_computed_columns().map(t=>t.column);for(let s=0,a=0;s<n.length||a<t.length;s++,a++){const l=t[a],c=n[s],d=n[s+1];if(c)if(void 0===l)e.removeChild(c);else if(o(l,c))this._set_row_type(c);else if(c.classList.contains("null-column")){const t=i(l,r);t&&e.replaceChild(t,c)}else if(d&&o(l,d))e.removeChild(c),s++;else{const t=i(l,r);t&&(e.insertBefore(t,c),s--)}else{const t=i(l,r);t&&e.appendChild(t)}}}_set_row_styles(){let t="";if(this._plugin.initial&&this._plugin.initial.names)for(const e in this._plugin.initial.names){const i=this._plugin.initial.names[e];t+=`#active_columns perspective-row:nth-child(${parseInt(e)+1}){margin-top:23px;}`,t+=`#active_columns perspective-row:nth-child(${parseInt(e)+1}):before{content:"${i}";}`}this.shadowRoot.querySelector("#psp_styles").innerHTML=t}_show_column_container(){this.shadowRoot.querySelector("#columns_container").style.visibility="visible"}_show_side_panel_actions(){this.shadowRoot.querySelector("#side_panel__actions").style.visibility="visible"}_remove_null_columns(t=0){const e=this._get_view_active_columns();for(;++t<e.length;){const i=e[t];i.classList.contains("null-column")&&this.shadowRoot.querySelector("#active_columns").removeChild(i)}}_set_column_defaults(){const t=this._get_view_all_columns(),e=this._get_view_active_valid_columns(),i=this._get_view_active_valid_column_names();if(t.length>0)if(this._plugin.initial){let i=[],o=this._plugin.initial.count||2;this._fill_numeric(e,i),this._fill_numeric(t,i),this._fill_numeric(t,i,!0),i=i.slice(0,o);const n=this._plugin.initial.names;for(;n&&i.length<n.length;)i.push(null);this.setAttribute("columns",JSON.stringify(i))}else"select"===this._plugin.selectMode?this.setAttribute("columns",JSON.stringify([t[0].getAttribute("name")])):(this.setAttribute("columns",JSON.stringify(i)),this._remove_null_columns())}_fill_numeric(t,e,i=!1){for(let o of t){let t=o.getAttribute("type"),n=o.getAttribute("name");(i||["float","integer"].indexOf(t)>-1&&-1===e.indexOf(n))&&e.push(n)}}async _check_responsive_layout(){if(this.shadowRoot){const t=this.shadowRoot.querySelector("#app");if(this.clientHeight<500&&this.clientWidth>600&&this._get_view_columns({active:!1}).length>this._get_view_columns().length){if(!t.classList.contains("columns_horizontal")){const e=this._persisted_side_panel_width;return this._persisted_side_panel_width=this._side_panel.style.width,this._side_panel.style.width=e||"",t.classList.add("columns_horizontal"),!1}return!1}if(t.classList.contains("columns_horizontal")){const e=this.shadowRoot.querySelector("#pivot_chart_container");e.clientWidth,this._side_panel.clientWidth;const i=this._persisted_side_panel_width||e.clientWidth+this._side_panel.clientWidth/2,o=e.clientHeight+50;return await this._pre_resize(i,o,()=>{const e=this._persisted_side_panel_width;this._persisted_side_panel_width=this._side_panel.style.width,this._side_panel.style.width=e||"",t.classList.remove("columns_horizontal")}),!0}}return!1}_register_ids(){this._aggregate_selector=this.shadowRoot.querySelector("#aggregate_selector"),this._vis_selector=this.shadowRoot.querySelector("#vis_selector"),this._filters=this.shadowRoot.querySelector("#filters"),this._row_pivots=this.shadowRoot.querySelector("#row_pivots"),this._column_pivots=this.shadowRoot.querySelector("#column_pivots"),this._datavis=this.shadowRoot.querySelector("#pivot_chart"),this._active_columns=this.shadowRoot.querySelector("#active_columns"),this._inactive_columns=this.shadowRoot.querySelector("#inactive_columns"),this._side_panel_actions=this.shadowRoot.querySelector("#side_panel__actions"),this._add_computed_expression_button=this.shadowRoot.querySelector("#add-computed-expression"),this._computed_expression_editor=this.shadowRoot.querySelector("perspective-computed-expression-editor"),this._inner_drop_target=this.shadowRoot.querySelector("#drop_target_inner"),this._drop_target=this.shadowRoot.querySelector("#drop_target"),this._config_button=this.shadowRoot.querySelector("#config_button"),this._reset_button=this.shadowRoot.querySelector("#reset_button"),this._download_button=this.shadowRoot.querySelector("#download_button"),this._copy_button=this.shadowRoot.querySelector("#copy_button"),this._side_panel=this.shadowRoot.querySelector("#side_panel"),this._top_panel=this.shadowRoot.querySelector("#top_panel"),this._sort=this.shadowRoot.querySelector("#sort"),this._transpose_button=this.shadowRoot.querySelector("#transpose_button"),this._plugin_information=this.shadowRoot.querySelector(".plugin_information"),this._plugin_information_action=this.shadowRoot.querySelector(".plugin_information__action"),this._plugin_information_action_close=this.shadowRoot.querySelector(".plugin_information__action--close"),this._plugin_information_message=this.shadowRoot.querySelector("#plugin_information_count"),this._resize_bar=this.shadowRoot.querySelector("#resize_bar")}_register_view_options(){let t=r.b.getInstance();Object(b.render)(ue(t),this._vis_selector)}_register_data_attribute(){if(this.getAttribute("data")){let t=this.getAttribute("data");try{t=JSON.parse(t)}catch(t){}this.load(t)}}_autocomplete_choices(t){return t.slice(1,t.length).map(t=>t.__ROW_PATH__).filter(t=>Array.isArray(t)?t.filter(t=>!!t).length>0:!!t)}}class me extends ge{_show_context_menu(t){return this.shadowRoot.querySelector("#app").classList.toggle("show_menu"),t.stopPropagation(),t.preventDefault(),!1}_hide_context_menu(){this.shadowRoot.querySelector("#app").classList.remove("show_menu")}async _toggle_config(t){if(!t||2!==t.button){this._show_config=!this._show_config,this._hide_context_menu();const t=this.shadowRoot.querySelector("#pivot_chart_container");this._show_config?await this._post_resize(()=>{this.toggleAttribute("settings",!0)},()=>{this._side_panel.style.display="flex",this._top_panel.style.display="flex",this.dispatchEvent(new CustomEvent("perspective-toggle-settings",{detail:this._show_config}))}):await this._pre_resize(t.clientWidth+this._side_panel.clientWidth,t.clientHeight+this._top_panel.clientHeight,()=>{this._side_panel.style.display="none",this._top_panel.style.display="none",this.removeAttribute("settings")},()=>this.dispatchEvent(new CustomEvent("perspective-toggle-settings",{detail:this._show_config})))}}async _pre_resize(t,e,i,o){this._datavis.style.width=`${t}px`,this._datavis.style.height=`${e}px`;try{!document.hidden&&this.offsetParent&&await this._plugin.resize.call(this)}finally{null==o||o(),this._datavis.style.width="100%",this._datavis.style.height="100%",i()}}async _post_resize(t,e){null==e||e();try{!document.hidden&&this.offsetParent&&await this._plugin.resize.call(this)}finally{t()}}_open_computed_expression_editor(t){t.stopImmediatePropagation(),0==this._computed_expression_editor.expressions.length?this._computed_expression_editor._disable_remove_button():this._computed_expression_editor._enable_remove_button(),this._computed_expression_editor.style.display="flex",this._side_panel_actions.style.display="none",this._computed_expression_editor._observe_textarea()}_save_computed_expression(t){const e=t.detail.expression;let i=this._get_view_computed_columns();i.includes(e)?console.warn(`"${e}" was not applied because it already exists.`):(i.push(e),this.setAttribute("computed-columns",JSON.stringify(i)))}async _type_check_computed_expression(t){const e=t.detail.parsed_expression||[];if(0===e.length)return void this._computed_expression_editor._type_check_expression({});const i={};for(const t of e)i[t.column]=t.computed_function_name;const o=await this._table.computed_schema(e),n={};for(const t in i)o[t]||(n[t]=await this._table.get_computation_input_types(i[t]));this._computed_expression_editor._type_check_expression(o,n)}_clear_all_computed_expressions(){this.setAttribute("computed-columns",JSON.stringify([]))}_set_computed_expression(t){return t}_column_visibility_clicked(t){const e=t.currentTarget;if("active_columns"===e.parentElement.getAttribute("id")){var i;const s=(null===(i=this._plugin.initial)||void 0===i?void 0:i.count)||1;if(this._get_view_active_valid_column_count()===s)return;if(t.detail.shiftKey)for(let t of Array.prototype.slice.call(this._active_columns.children))t!==e&&this._active_columns.removeChild(t);else{var o,n,r;const t=Array.prototype.slice.call(this._active_columns.children).indexOf(e);if(t<(null===(o=this._plugin.initial)||void 0===o?void 0:o.count))return;t<(null===(n=this._plugin.initial)||void 0===n?void 0:null===(r=n.names)||void 0===r?void 0:r.length)-1&&this._active_columns.insertBefore(this._new_row(null),e),this._active_columns.removeChild(e)}}else{var s;if(t.detail.shiftKey&&"toggle"===this._plugin.selectMode||!t.detail.shiftKey&&"select"===this._plugin.selectMode)for(let t of Array.prototype.slice.call(this._active_columns.children))this._active_columns.removeChild(t);let i=this._new_row(e.getAttribute("name"),e.getAttribute("type"));const o=this._get_view_active_columns();let n=o.length-1;if(o[n]&&(null===(s=o[n])||void 0===s?void 0:s.classList.contains("null-column"))){for(;n-- >0;)if(!o[n].classList.contains("null-column")){this._active_columns.replaceChild(i,o[n+1]);break}}else this._active_columns.appendChild(i)}this._check_responsive_layout(),this._update_column_view()}_column_aggregate_clicked(){let t=this.get_aggregate_attribute(),e=this._get_view_aggregates();for(let i of t){let t=e.find(t=>t.column===i.column);t&&(i.op=t.op)}this.set_aggregate_attribute(t),this._update_column_view(),this._debounce_update()}_column_filter_clicked(){let t=this._get_view_filters();this._updating_filter=!0,this.setAttribute("filters",JSON.stringify(t)),this._updating_filter=!1,this._debounce_update()}_increment_sort(t,e,i){let o=["asc","desc"];return e&&o.push("col asc","col desc"),i&&(o=o.map(t=>`${t} abs`)),o.push("none"),o[(o.indexOf(t)+1)%o.length]}_sort_order_clicked(t){const e=t.target,i=t.detail.shiftKey&&"string"!==e.getAttribute("type"),o=this._increment_sort(e.getAttribute("sort-order"),this._get_view_column_pivots().length>0,i);e.setAttribute("sort-order",o);const n=this._get_view_sorts();this.setAttribute("sort",JSON.stringify(n))}_transpose(){const t=this.hasAttribute("row-pivots"),e=this.hasAttribute("column-pivots");if(t&&e){let t=this.getAttribute("row-pivots");this.setAttribute("row-pivots",this.getAttribute("column-pivots")),this.setAttribute("column-pivots",t)}else if(t){let t=this.getAttribute("row-pivots");this.removeAttribute("row-pivots"),this.setAttribute("column-pivots",t)}else if(e){let t=this.getAttribute("column-pivots");this.removeAttribute("column-pivots"),this.setAttribute("row-pivots",t)}else this.removeAttribute("column-pivots"),this.removeAttribute("row-pivots")}_reset_sidepanel(){this._side_panel.style.width=""}_resize_sidepanel(t){const e=document.body.style.cursor;document.body.style.cursor="col-resize";const i=t.clientX,o=this._side_panel.offsetWidth,n=t=>{const e=Math.max(0,Math.min(o+(t.clientX-i),this.offsetWidth-10));this._side_panel.style.width=`${e}px`,this._plugin&&this.notifyResize()},r=()=>{document.body.style.cursor=e,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",r)}_vis_selector_changed(){var t;this._plugin_information.classList.add("hidden"),this.setAttribute("plugin",this._vis_selector.value),this._active_columns.classList.remove("one_lock","two_lock");const e=["one_lock","two_lock"][(null===(t=this._plugin.initial)||void 0===t?void 0:t.count)-1];e&&this._active_columns.classList.add(e),this._debounce_update()}_register_callbacks(){this._sort.addEventListener("drop",Ft.bind(this)),this._sort.addEventListener("dragend",Bt.bind(this)),this._sort.addEventListener("dragenter",Qt.bind(this)),this._sort.addEventListener("dragover",te.bind(this)),this._sort.addEventListener("dragleave",ee.bind(this)),this._row_pivots.addEventListener("drop",Ft.bind(this)),this._row_pivots.addEventListener("dragend",Bt.bind(this)),this._row_pivots.addEventListener("dragenter",Qt.bind(this)),this._row_pivots.addEventListener("dragover",te.bind(this)),this._row_pivots.addEventListener("dragleave",ee.bind(this)),this._column_pivots.addEventListener("drop",Ft.bind(this)),this._column_pivots.addEventListener("dragend",Bt.bind(this)),this._column_pivots.addEventListener("dragenter",Qt.bind(this)),this._column_pivots.addEventListener("dragover",te.bind(this)),this._column_pivots.addEventListener("dragleave",ee.bind(this)),this._filters.addEventListener("drop",Ft.bind(this)),this._filters.addEventListener("dragend",Bt.bind(this)),this._filters.addEventListener("dragenter",Qt.bind(this)),this._filters.addEventListener("dragover",te.bind(this)),this._filters.addEventListener("dragleave",ee.bind(this)),this._active_columns.addEventListener("drop",Vt.bind(this)),this._active_columns.addEventListener("dragenter",Qt.bind(this)),this._active_columns.addEventListener("dragend",Wt.bind(this)),this._active_columns.addEventListener("dragover",Kt.bind(this)),this._active_columns.addEventListener("dragleave",Gt.bind(this)),this._add_computed_expression_button.addEventListener("click",this._open_computed_expression_editor.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-save",this._save_computed_expression.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-resize",this._reset_sidepanel.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-type-check",this._type_check_computed_expression.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-remove",this._clear_all_computed_expressions.bind(this)),this._computed_expression_editor.addEventListener("perspective-computed-expression-update",this._set_computed_expression.bind(this)),this._config_button.addEventListener("mousedown",this._toggle_config.bind(this)),this._config_button.addEventListener("contextmenu",this._show_context_menu.bind(this)),this._reset_button.addEventListener("click",this.reset.bind(this)),this._copy_button.addEventListener("click",t=>this.copy(t.shiftKey)),this._download_button.addEventListener("click",t=>this.download(t.shiftKey)),this._transpose_button.addEventListener("click",this._transpose.bind(this)),this._drop_target.addEventListener("dragover",te.bind(this)),this._resize_bar.addEventListener("mousedown",this._resize_sidepanel.bind(this)),this._resize_bar.addEventListener("dblclick",this._reset_sidepanel.bind(this)),this._vis_selector.addEventListener("change",this._vis_selector_changed.bind(this)),this._plugin_information_action.addEventListener("click",()=>{this._debounce_update({ignore_size_check:!0,limit_points:!1}),this._plugin_information.classList.add("hidden")}),this._plugin_information_action_close.addEventListener("click",()=>{this._plugin_information.classList.add("hidden")})}}var ve,fe;function be(t,e,i,o,n){var r={};return Object.keys(o).forEach((function(t){r[t]=o[t]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(t,e,i)||i}),r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(t,e,r),r=null),r}const we=["selectable","editable","plugin","computed-columns","row-pivots","column-pivots","aggregates","filters","sort","columns"];Object(n.b)(Mt.a,Ut.a,Ht.a)((be((fe=class extends me{constructor(){super(),this._register_debounce_instance(),this._show_config=!0,this._show_warnings=!0,this.__render_times=[],this._resize_handler=this.notifyResize.bind(this),window.addEventListener("resize",this._resize_handler)}connectedCallback(){0===Object.keys(r.b.getInstance()).length&&Object(r.a)(),this.toggleAttribute("settings",!0),this._register_ids(),this._register_callbacks(),this._register_view_options(),this._register_data_attribute(),this.toggleConfig(),this._check_loaded_table()}sort(t){null!=t&&0!==t.length||(this.hasAttribute("sort")&&this.removeAttribute("sort"),t=[]);var e=this._sort.querySelector("ul");this._update_column_list(t,e,(t,e)=>{let i="asc";Array.isArray(t)&&(i=t[1],t=t[0]);let o=void 0;return e.includes(t)&&(o=t),this._new_row(t,!1,!1,!1,i,o)},(t,e)=>Array.isArray(t)?e.getAttribute("name")===t[0]&&e.getAttribute("sort-order")===t[1]:e.getAttribute("name")===t),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}columns(t){null!=t&&0!==t.length||(this.hasAttribute("columns")&&(this._initial_col_order?this.setAttribute("columns",JSON.stringify(this._initial_col_order)):this.removeAttribute("columns")),t=(this._initial_col_order||[]).slice()),this._update_column_view(t,!0),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}"computed-columns"(t){const e=this._set_updating();(async()=>{if("none"!==this._computed_expression_editor.style.display&&this._computed_expression_editor._close_expression_editor(),null==t||0===t.length){if(this.hasAttribute("computed-columns")){this.removeAttribute("computed-columns");const t=this._get_view_parsed_computed_columns();return this._reset_computed_column_view(t),this.removeAttribute("parsed-computed-columns"),void e()}t=[]}let i=[];for(const e of t)"string"==typeof e?i=i.concat(Nt(e)):i.push(e);let o={};if(this._table){o=await this._table.computed_schema(i);const t=await this._validate_parsed_computed_columns(i,o);if(t.length!==i.length){const e=[];for(let o=0;o<i.length;o++)o>t.length-1?e.push(i[o]):i[o].column!==t[o].column&&e.push(i[o]);console.warn("Could not apply these computed columns:",JSON.stringify(e))}i=t}const n=this._get_view_parsed_computed_columns(),r=this._diff_computed_column_view(n,i);this._reset_computed_column_view(r),this.setAttribute("parsed-computed-columns",JSON.stringify(i)),this._update_computed_column_view(o),this.dispatchEvent(new Event("perspective-config-update")),await this._debounce_update(),e()})()}aggregates(t){null!=t&&0!==Object.keys(t).length||(this.hasAttribute("aggregates")&&this.removeAttribute("aggregates"),t={}),this._get_view_dom_columns().map(e=>{let i=t[e.getAttribute("name")];i&&e.setAttribute("aggregate",Array.isArray(i)?JSON.stringify(i):i)}),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}filters(t){if(null!=t&&0!==t.length||(this.hasAttribute("filters")&&this.removeAttribute("filters"),t=[]),!this._updating_filter){var e=this._filters.querySelector("ul");this._update_column_list(t,e,(t,e)=>{const i=JSON.stringify({operator:t[1],operand:t[2]}),o=t[0];let n=void 0;return e.includes(o)&&(n=o),this._new_row(o,void 0,void 0,i,void 0,n)},(t,e)=>e.getAttribute("name")===t[0]&&e.getAttribute("filter")===JSON.stringify({operator:t[1],operand:t[2]}))}this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}set plugin(t){if("null"===t||null==t)return void this.setAttribute("plugin",this._vis_selector.options[0].value);this.innerHTML="";const e=Object.keys(r.b.getInstance());if(this.hasAttribute("plugin")){let t=this.getAttribute("plugin");if(-1===e.indexOf(t)){const i=e.find(e=>e.indexOf(t)>-1);i?(console.warn(`Unknown plugin "${t}", using "${i}"`),this.setAttribute("plugin",i)):(console.error(`Unknown plugin "${t}"`),this.setAttribute("plugin",this._vis_selector.options[0].value))}else this._vis_selector.value!==t&&(this._vis_selector.value=t,this._vis_selector_changed()),this._set_row_styles(),this._set_column_defaults(),this.dispatchEvent(new Event("perspective-config-update"))}else this.setAttribute("plugin",this._vis_selector.options[0].value)}"column-pivots"(t){null!=t&&0!==t.length||(this.hasAttribute("column-pivots")&&this.removeAttribute("column-pivots"),t=[]);const e=this._column_pivots.querySelector("ul");this._update_column_list(t,e,(t,e)=>{let i=void 0;return e.includes(t)&&(i=t),this._new_row(t,void 0,void 0,void 0,void 0,i)}),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}"row-pivots"(t){null!=t&&0!==t.length||(this.hasAttribute("row-pivots")&&this.removeAttribute("row-pivots"),t=[]);const e=this._row_pivots.querySelector("ul");this._update_column_list(t,e,(t,e)=>{let i=void 0;return e.includes(t)&&(i=t),this._new_row(t,void 0,void 0,void 0,void 0,i)}),this.dispatchEvent(new Event("perspective-config-update")),this._debounce_update()}set editable(t){"null"===t?this.hasAttribute("editable")&&this.removeAttribute("editable"):this.toggleAttribute("editable",!0),this._debounce_update({force_update:!0}),this.dispatchEvent(new Event("perspective-config-update"))}set throttle(t){"null"===t&&this.hasAttribute("throttle")&&this.removeAttribute("throttle"),this._calculate_throttle_timeout()}set selectable(t){"null"===t?this.hasAttribute("selectable")&&this.removeAttribute("selectable"):this.toggleAttribute("selectable",!0),this._debounce_update({force_update:!0}),this.dispatchEvent(new Event("perspective-config-update"))}get worker(){return this._get_worker()}get table(){return this._table}get view(){return this._view}async load(t,e){let i;if(t instanceof Promise)i=await t;else{try{t=t.trim()}catch(t){}"table"===t.type?i=t:(i=this.worker.table(t,e),i._owner_viewer=this)}this.isConnected?await this._load_table(i):this._table=i}update(t){void 0===this._table?this.load(t):this._table.update(t)}async notifyResize(t){await this._check_responsive_layout()||document.hidden||!this.offsetParent||await this._plugin.resize.call(this,t)}clone(t){this._inner_drop_target&&(this._inner_drop_target.innerHTML=t._inner_drop_target.innerHTML),this._load_table(t.table),this.restore(t.save())}delete(t=!0){let e=this._clear_state(t);return this._plugin.delete&&this._plugin.delete.call(this),window.removeEventListener("load",this._resize_handler),window.removeEventListener("resize",this._resize_handler),e}restyleElement(){this._restyle_plugin()}save(){let t={};const e=new Set(we);for(let i=0;i<this.attributes.length;i++){let o=this.attributes[i];e.has(o.name)&&(""===o.value?t[o.name]=!0:"plugin"!==o.name&&void 0!==o.value&&null!==o.value?t[o.name]=JSON.parse(o.value):t[o.name]=o.value,e.delete(o.name))}for(const i of e)t[i]=null;return this._plugin.save&&(t.plugin_config=this._plugin.save.call(this)),t}async restore(t){"string"==typeof t&&(t=JSON.parse(t));for(const e of we)if(t.hasOwnProperty(e)){let i=t[e];!0===i?this.toggleAttribute(e,!0):null!=i&&!1!==i?("string"!=typeof i&&(i=JSON.stringify(i)),this.setAttribute(e,i)):this.removeAttribute(e)}this._plugin.restore&&t.plugin_config&&this._plugin.restore.call(this,t.plugin_config),await this._debounce_update()}async flush(){for(await new Promise(setTimeout);this.hasAttribute("updating");)await this._updating_promise}clear(){var t;null===(t=this._table)||void 0===t||t.clear()}replace(t){this._table?this._table.replace(t):this._load(t)}reset(){this.removeAttribute("row-pivots"),this.removeAttribute("column-pivots"),this.removeAttribute("filters"),this.removeAttribute("sort"),this._initial_col_order?this.setAttribute("columns",JSON.stringify(this._initial_col_order)):this.removeAttribute("columns"),this.setAttribute("plugin",Object.keys(r.b.getInstance())[0]),this.dispatchEvent(new Event("perspective-config-update")),this._hide_context_menu()}async download(t=!1){const e=t?this._table.view():this._view,i=await e.to_csv(),o=document.createElement("a"),n=i,r=n.length,s=new Uint8Array(r);for(let t=0;t<r;t++)s[t]=n.charCodeAt(t);const a=new Blob([s]);o.setAttribute("href",URL.createObjectURL(a)),o.setAttribute("download","perspective.csv"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),this._hide_context_menu()}copy(t=!1){let e;(t?this._table.view():this._view).to_csv().then(t=>{e=t}).catch(t=>{console.error(t),e=""});let i=0,o=()=>{void 0!==e?Object(n.c)(e):i<200?(i++,setTimeout(o,50)):console.warn("Timeout expired - copy to clipboard cancelled.")};o(),this._hide_context_menu()}async toggleConfig(){await this._toggle_config()}}).prototype,"sort",[n.a],Object.getOwnPropertyDescriptor(fe.prototype,"sort"),fe.prototype),be(fe.prototype,"columns",[n.a],Object.getOwnPropertyDescriptor(fe.prototype,"columns"),fe.prototype),be(fe.prototype,"computed-columns",[n.a],Object.getOwnPropertyDescriptor(fe.prototype,"computed-columns"),fe.prototype),be(fe.prototype,"aggregates",[n.d],Object.getOwnPropertyDescriptor(fe.prototype,"aggregates"),fe.prototype),be(fe.prototype,"filters",[n.a],Object.getOwnPropertyDescriptor(fe.prototype,"filters"),fe.prototype),be(fe.prototype,"column-pivots",[n.a],Object.getOwnPropertyDescriptor(fe.prototype,"column-pivots"),fe.prototype),be(fe.prototype,"row-pivots",[n.a],Object.getOwnPropertyDescriptor(fe.prototype,"row-pivots"),fe.prototype),be(fe.prototype,"notifyResize",[n.f],Object.getOwnPropertyDescriptor(fe.prototype,"notifyResize"),fe.prototype),ve=fe))}])}));
//# sourceMappingURL=perspective-viewer.js.map