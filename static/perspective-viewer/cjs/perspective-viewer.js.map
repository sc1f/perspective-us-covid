{"version":3,"sources":["webpack:///packages/perspective-viewer/webpack/universalModuleDefinition","webpack:///packages/perspective-viewer/webpack/bootstrap","webpack:///packages/perspective-viewer/external \"chevrotain\"","webpack:///src/js/utils.js","webpack:///packages/perspective-viewer/external \"lit-html\"","webpack:///packages/perspective-viewer/external \"core-js/modules/web.dom-collections.iterator\"","webpack:///packages/perspective-viewer/external \"@finos/perspective/dist/esm/config\"","webpack:///../src/js/viewer/renderers.js","webpack:///packages/perspective-viewer/external \"@finos/perspective\"","webpack:///node_modules/css-loader/lib/css-base.js","webpack:///packages/perspective-viewer/external \"core-js/modules/es.string.replace\"","webpack:///packages/perspective-viewer/external \"lodash/debounce\"","webpack:///packages/perspective-viewer/external \"awesomplete\"","webpack:///node_modules/webpack/buildin/global.js","webpack:///node_modules/awesomplete/awesomplete.css","webpack:///packages/perspective-viewer/dist/html/row.html","webpack:///packages/perspective-viewer/dist/less/row.less","webpack:///packages/perspective-viewer/dist/html/computed_expression_editor.html","webpack:///packages/perspective-viewer/dist/less/computed_expression_editor.less","webpack:///packages/perspective-viewer/dist/html/viewer.html","webpack:///packages/perspective-viewer/dist/less/viewer.less","webpack:///packages/perspective-viewer/dist/less/default.less","webpack:///packages/perspective-viewer/external \"lodash/isEqual\"","webpack:///packages/perspective-viewer/external \"core-js/modules/es.typed-array.uint8-array\"","webpack:///packages/perspective-viewer/external \"core-js/modules/web.url\"","webpack:///packages/perspective-viewer/external \"@webcomponents/webcomponentsjs\"","webpack:///src/js/polyfill.js","webpack:///packages/perspective-viewer/external \"core-js/modules/es.array.unscopables.flat-map\"","webpack:///src/js/row.js","webpack:///../src/js/computed_expressions/error.js","webpack:///../src/js/computed_expressions/lexer.js","webpack:///../src/js/computed_expressions/parser.js","webpack:///../src/js/computed_expressions/formatter.js","webpack:///../src/js/computed_expressions/visitor.js","webpack:///src/js/computed_expression_editor.js","webpack:///../src/js/viewer/dragdrop.js","webpack:///../src/js/viewer/cancel_task.js","webpack:///../src/js/viewer/state_element.js","webpack:///../src/js/viewer/perspective_element.js","webpack:///../src/js/viewer/dom_element.js","webpack:///../src/js/viewer/action_element.js","webpack:///src/js/viewer.js"],"names":["root","factory","exports","module","require","define","amd","a","i","window","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__2__","__WEBPACK_EXTERNAL_MODULE__3__","__WEBPACK_EXTERNAL_MODULE__4__","__WEBPACK_EXTERNAL_MODULE__6__","__WEBPACK_EXTERNAL_MODULE__8__","__WEBPACK_EXTERNAL_MODULE__9__","__WEBPACK_EXTERNAL_MODULE__10__","__WEBPACK_EXTERNAL_MODULE__20__","__WEBPACK_EXTERNAL_MODULE__21__","__WEBPACK_EXTERNAL_MODULE__22__","__WEBPACK_EXTERNAL_MODULE__23__","__WEBPACK_EXTERNAL_MODULE__25__","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","registerElement","templateString","styleString","proto","template","div","document","createElement","innerHTML","Array","slice","children","importTemplate","content","child","createDocumentFragment","firstChild","Node","appendChild","setTemplateContent","toString","getAttribute","getOwnPropertyNames","descriptor","getOwnPropertyDescriptor","set","old","val","this","hasAttribute","_initializing","_initialized","setAttribute","console","log","customElements","attributeChangedCallback","connectedCallback","node","importNode","attachShadow","shadowRoot","super","bindTemplate","styleStrings","style","map","x","join","cls","_attribute","_default","desc","old_set","attr","JSON","stringify","parse","e","warn","copy_to_clipboard","csv","element","body","select","execCommand","removeChild","invertPromise","resolve","promise","Promise","_resolve","throttlePromise","target","lock","f","async","args","result","error","undefined","swap","container","elems","every","classList","contains","j","indexOf","reverse","insertBefore","length","json_attribute","array_attribute","RENDERERS","renderers","registerPlugin","plugin","Error","id","old_plugin","getPlugin","getInstance","global","__perspective_plugins__","forEach","html","register_debug_plugin","_view","to_csv","config","delimiter","timer","_render_time","render","selectMode","resize","delete","useSourceMap","list","item","cssMapping","btoa","sourceMapping","sourceMap","unescape","encodeURIComponent","sourceURLs","sources","source","sourceRoot","concat","cssWithMappingToString","mediaQuery","alreadyImportedModules","push","g","Function","CLASS_DRAG_IMAGE_SNAPBACK","CLASS_PREFIX","EVENT_DRAG_DRAGSTART_PENDING","EVENT_PREFIX","EVENT_DRAG_DRAGSTART_CANCEL","ALLOWED_EFFECTS","DROP_EFFECTS","supportsPassive","supportsPassiveEventListeners","opts","addEventListener","supportsPassiveEventListener","isDOMElement","tagName","addDocumentListener","ev","handler","passive","removeDocumentListener","removeEventListener","onEvt","el","event","capture","options","off","average","array","reduce","v","isTouchIdentifierContainedInTouchEvent","touchEvent","touchIdentifier","changedTouches","identifier","updateCentroidCoordinatesOfTouchesIn","coordinateProp","outPoint","pageXs","pageYs","touches","touch","y","TRANSFORM_CSS_VENDOR_PREFIXES","translateElementToPoint","pnt","originalTransforms","offset","centerOnCoordinates","parseInt","offsetWidth","offsetHeight","translate","transformProp","DataTransfer","_dataStore","_setDragImageHandler","_dropEffect","configurable","freeze","types","effectAllowed","setData","type","data","getData","clearData","format","index","splice","setDragImage","image","determineDropEffect","sourceNode","nodeType","dispatchDragEvent","dragEvent","targetElement","dataStore","dataTransfer","cancelable","relatedTarget","leaveEvt","dndEvent","Event","bubbles","screenX","screenY","clientX","clientY","pageX","pageY","targetRect","getBoundingClientRect","offsetX","left","offsetY","top","createDragEventFromTouch","defaultView","cancelled","dispatchEvent","determineDragOperation","dropEffect","DragOperationController","_initialEvent","_config","_sourceNode","_dragOperationEndedCb","_dragOperationState","_immediateUserSelection","_currentDropTarget","_lastTouchEvent","_initialTouch","_touchMoveHandler","_onTouchMove","_touchEndOrCancelHandler","_onTouchEndOrCancel","_setup","_this","_currentDragOperation","_dragDataStore","_currentHotspotCoordinates","_dragImagePageCoordinates","dragImageSrc","_dataTransfer","_dragImageOffset","_cleanup","dragImage","dragImageSetup","_dragImageTransforms","prefix","transform","replace","position","zIndex","add","_dragImage","dragImageOffset","dragImageCenterOnTouch","cs","getComputedStyle","marginLeft","marginTop","width","height","_iterationIntervalId","setInterval","_iterationLock","_dragAndDropProcessModelIteration","iterationInterval","clearInterval","parentNode","startDrag","dragStartConditionOverride","preventDefault","dragImageTranslateOverride","handledDragImageTranslate_1","previousDragOperation","dragCancelled","_dragOperationEnded","sourceEl","dragImageTransforms","transitionEndCb","visibility","display","csDragImage","durationInS","parseFloat","transitionDuration","isNaN","rect","scrollLeft","documentElement","scrollTop","delayInS","transitionDelay","durationInMs","Math","round","setTimeout","applyDragImageSnapback","_finishDragOperation","newUserSelection","elementFromPoint","previousTargetElement","remove","currentDragOperationClass","state","dragFailed","tryFindDraggableTarget","draggable","cloneNode","prepareNodeCopyAsDragImage","srcNode","dstNode","csName","setProperty","getPropertyValue","getPropertyPriority","pointerEvents","removeAttribute","nodeName","canvasSrc","canvasDst","canvasSrcImgData","getContext","getImageData","putImageData","hasChildNodes","childNodes","activeDragOperation","onTouchstart","composePath","dragTarget","dragOperationEnded","err","onDelayTouchstart","evt","composedPath","onReleasedItem","end","cancel","move","scroll","CustomEvent","clearTimeout","holdToDrag","defaultActionOverride","defaultPrevented","override","keys","forceApply","detectedFeatures","features","dragEvents","userAgentSupportingNativeDnD","isBlinkEngine","chrome","test","navigator","userAgent","detectFeatures","polyfill","cp","_path","SPAN","get_text_width","text","max","fontFamily","fontSize","awesomplete_style","querySelector","_option_template","agg","_select_template","category","items","perspective","weighted_options","_weights","has_weighted_mean","nothing","set_weights","xs","elem","type_config","get_type_config","agg_dropdown","filter_dropdown","aggregate","filter","filter_operand","_callback","_update_filter","choices","filter_operator","selector","Awesomplete","label","minChars","autoFirst","input","FILTER_CONTAINS","match","ITEM","before","evaluate","focus","_filter_operand","trim","operator","filter_input","operand","FILTER_OPERATORS","isNull","isNotNull","_blur_agg_dropdown","_get_computed_data","column_name","input_columns","input_type","computation","toLowerCase","isIn","isNotIn","split","detail","_set_data_transfer","_register_ids","_li","_visible","_row_close","_agg_dropdown","_sort_order","_filter_operator","_edit_computed_column_button","_column_aggregate_category","blur","option","querySelectorAll","_focus_agg_dropdown","_register_callbacks","debounced_filter","debounce","token_name_to_display_name","columnName","leftParen","rightParen","subtract","multiply","divide","percent_of","actual_token_to_string","token","actual","isArray","tokenType","payload","PerspectiveParserErrorMessage","buildEarlyExitMessage","expectedIterationPaths","expected","path","buildMismatchTokenMessage","message","buildNoViableAltMessage","ruleName","vocabulary","OperatorTokenType","createToken","pattern","Lexer","NA","FunctionTokenType","UpperLowerCaseTokenType","column_name_regex_pattern","ColumnName","exec","string","start_offset","lastIndex","full_match","quotes_removed","substr","line_breaks","As","longer_alt","Add","categories","Subtract","Multiply","Divide","Pow","PercentOf","Equals","NotEquals","GreaterThan","LessThan","Is","Sqrt","Pow2","Abs","Invert","Log","Exp","Bin10","Bin100","Bin1000","Bin10th","Bin100th","Bin1000th","Length","Lowercase","Uppercase","ConcatComma","ConcatSpace","HourOfDay","DayOfWeek","MonthOfYear","SecondBucket","MinuteBucket","HourBucket","DayBucket","WeekBucket","MonthBucket","YearBucket","LeftParen","RightParen","Comma","tokens","group","SKIPPED","lexer","errorMessageProvider","buildUnexpectedCharactersMessage","fullText","startOffset","line","column","ComputedExpressionColumnParser","CstParser","constructor","RULE","SUBRULE","Expression","OR","ALT","OperatorComputedColumn","FunctionComputedColumn","ERR_MSG","LABEL","AT_LEAST_ONE","Operator","SUBRULE2","OPTION","CONSUME","AT_LEAST_ONE_SEP","SEP","DEF","ParentheticalExpression","TerminalColumnName","performSelfAnalysis","COMPUTED_FUNCTION_FORMATTERS","invert","exp","pow2","sqrt","abs","bin10","bin100","bin1000","bin10th","bin100th","bin1000th","uppercase","lowercase","is","concat_space","concat_comma","hour_of_day","day_of_week","month_of_year","second_bucket","minute_bucket","hour_bucket","day_bucket","week_bucket","month_bucket","year_bucket","parser","base_visitor","getBaseCstVisitorConstructor","visitor","validateVisitor","SuperExpression","ctx","computed_columns","visit","right","as","computed_function_name","inputs","fn","computed","pow","equals","not_equals","greater_than","less_than","expression_to_computed_column_config","expression","lex_result","tokenize","errors","lex","cst","_parsed_expression","expressions","_textarea_observer","MutationObserver","_resize_textarea","_observe_textarea","observe","_expression_input","attributes","attributeFilter","disconnect","_capture_drop_data","parsed","_validate_expression","_clear_error_messages","_enable_save_button","_disable_save_button","_set_error_message","_error","parsed_expression","computed_schema","expected_types","invalid","col","_remove_all_expressions","_save_expression","_clear_expression_input","_close_expression_editor","_side_panel_actions","innerText","_save_button","toggleAttribute","_disable_remove_button","_remove_button","_enable_remove_button","parentElement","_close_button","calc_index","_active_columns","is_last_null","cidx","offsetTop","last_index","dragend","getRootNode","host","parent","idx","attr_name","attr_value","drop","currentTarget","_drop_target_hover","columns","data_index","filtering","_plugin","deselectMode","_get_visible_column_count","_update_column_view","_debounce_update","column_dragend","column_dragleave","src","_drop_target_null","replaceChild","_original_index","_unset_drop_target_null","column_swap","new_index","column_replace","column_dragover","className","current_index","over_elem","to_replace","initial","names","is_diff","from_active","from_replace","from_append","from_required","count","to_null","column_drop","dragenter","stopPropagation","dragover","dragleave","CancelTask","on_cancel","_on_cancel","_cancelled","StateElement","current_renderers","view","_get_view_dom_columns","callback","_get_view_all_columns","_get_view_active_columns","_get_view_active_valid_columns","_get_view_inactive_columns","_get_view_all_column_names","_get_view_active_column_names","_get_view_all_valid_column_names","_get_view_active_valid_column_names","_get_view_active_valid_column_count","_get_view_columns","active","_get_view_aggregates","op","_get_view_row_pivots","_get_view_column_pivots","_get_view_filter_nodes","_get_view_filters","_get_view_sorts","order","_get_view_computed_columns","_get_view_parsed_computed_columns","get_aggregate_attribute","aggs","found","Set","new_aggs","_aggregate_defaults","has","numberWithCommas","TYPE_ORDER","integer","float","boolean","datetime","date","column_sorter","schema","b","s1","s2","_total_template","total","floor","_nowrap_template","_warning","strings","flatMap","str","PerspectiveElement","_validate_parsed_computed_columns","validated","table","_set_updating","_clear_state","_table","cols","all","_initial_col_order","parsed_computed_columns","computed_expressions","computed_column_names","sort","aggregates","aggregate_attribute","TYPE_AGGREGATES","get_aggregates_with_defaults","shown","get_aggregate_defaults","_clear_columns","find","includes","row","_new_row","_inactive_columns","active_row","_show_column_container","compute","_show_side_panel_actions","filters","force_update","reset","max_cols","max_rows","num_columns","schema_columns","max_columns","column_group_diff","column_limit","max_cells","ceil","_show_warnings","num_rows","columns_are_truncated","rows_are_truncated","_plugin_information","warning","_plugin_information_message","_calculate_throttle_timeout","timeout","throttle","__render_times","min","_view_on_update","limit_points","_debounced","_task","task","updater","update","get_maxes","_warn_render_size_exceeded","_datavis","operandNode","getElementById","exclamation","is_valid_filter","title","borderColor","hidden","_is_config_changed","plugin_name","isEqual","_previous_config","_previous_plugin_name","ignore_size_check","_check_responsive_layout","row_pivots","column_pivots","_validate_filters","view_aggregates","obj","remove_update","_view_updater","on_update","_render_count","_check_loaded_table","_load_table","performance","now","unshift","_restyle_plugin","styleElement","clear_table","remove_delete","_owner_viewer","_updating_promise","_register_debounce_instance","_update","_new_view","then","_get_worker","_worker","shared_worker","vals","DomElement","set_aggregate_attribute","is_set","_get_type","_set_row_type","weights","to_json","json","_autocomplete_choices","_column_visibility_clicked","_column_aggregate_clicked","_column_filter_clicked","_sort_order_clicked","overflow","findIndex","_update_computed_column_view","added_count","reset_columns_attr","cc","_diff_computed_column_view","old_computed_columns","new_computed_columns","to_remove","new_names","_reset_computed_column_view","computed_names","filtered_active","rp","inactive_computed","pop_cols","lis","_update_column_list","ref","accessor","active_columns","next_col","_set_row_styles","nidx","_remove_null_columns","since_index","_set_column_defaults","active_cols","valid_active_cols","pref","_fill_numeric","labels","bypass","app","clientHeight","clientWidth","_persisted_side_panel_width","_side_panel","panel","_pre_resize","_aggregate_selector","_vis_selector","_filters","_row_pivots","_column_pivots","_add_computed_expression_button","_computed_expression_editor","_inner_drop_target","_drop_target","_config_button","_reset_button","_download_button","_copy_button","_top_panel","_sort","_transpose_button","_plugin_information_action","_plugin_information_action_close","_resize_bar","_register_view_options","_register_data_attribute","load","__ROW_PATH__","ActionElement","_show_context_menu","toggle","_hide_context_menu","button","_show_config","_post_resize","post","pre","offsetParent","_open_computed_expression_editor","stopImmediatePropagation","_save_computed_expression","_type_check_expression","functions","get_computation_input_types","_clear_all_computed_expressions","_set_computed_expression","min_columns","shiftKey","new_aggregates","updated_agg","new_filters","_updating_filter","_increment_sort","column_sorting","abs_sorting","sort_orders","new_sort_order","_transpose","has_row","has_col","_reset_sidepanel","_resize_sidepanel","cursor","start","new_width","notifyResize","stop","_vis_selector_changed","classname","_type_check_computed_expression","_toggle_config","copy","download","PERSISTENT_ATTRIBUTES","view_style","default_style","_resize_handler","toggleConfig","inner","dir","show","diff","old_columns","fterms","plugin_names","guess_plugin","pivots","pivot","worker","isConnected","immediate","clone","widget","restore","save","delete_table","restyleElement","plugin_config","clear","_load","flat","binStr","len","arr","Uint8Array","charCodeAt","blob","Blob","URL","createObjectURL","click","catch"],"mappings":"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","file":"perspective-viewer.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"chevrotain\"), require(\"lit-html\"), require(\"core-js/modules/web.dom-collections.iterator\"), require(\"@finos/perspective/dist/esm/config\"), require(\"@finos/perspective\"), require(\"core-js/modules/es.string.replace\"), require(\"lodash/debounce\"), require(\"awesomplete\"), require(\"lodash/isEqual\"), require(\"core-js/modules/es.typed-array.uint8-array\"), require(\"core-js/modules/web.url\"), require(\"@webcomponents/webcomponentsjs\"), require(\"core-js/modules/es.array.unscopables.flat-map\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"chevrotain\", \"lit-html\", \"core-js/modules/web.dom-collections.iterator\", \"@finos/perspective/dist/esm/config\", \"@finos/perspective\", \"core-js/modules/es.string.replace\", \"lodash/debounce\", \"awesomplete\", \"lodash/isEqual\", \"core-js/modules/es.typed-array.uint8-array\", \"core-js/modules/web.url\", \"@webcomponents/webcomponentsjs\", \"core-js/modules/es.array.unscopables.flat-map\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"chevrotain\"), require(\"lit-html\"), require(\"core-js/modules/web.dom-collections.iterator\"), require(\"@finos/perspective/dist/esm/config\"), require(\"@finos/perspective\"), require(\"core-js/modules/es.string.replace\"), require(\"lodash/debounce\"), require(\"awesomplete\"), require(\"lodash/isEqual\"), require(\"core-js/modules/es.typed-array.uint8-array\"), require(\"core-js/modules/web.url\"), require(\"@webcomponents/webcomponentsjs\"), require(\"core-js/modules/es.array.unscopables.flat-map\")) : factory(root[\"chevrotain\"], root[\"lit-html\"], root[\"core-js/modules/web.dom-collections.iterator\"], root[\"@finos/perspective/dist/esm/config\"], root[\"@finos/perspective\"], root[\"core-js/modules/es.string.replace\"], root[\"lodash/debounce\"], root[\"awesomplete\"], root[\"lodash/isEqual\"], root[\"core-js/modules/es.typed-array.uint8-array\"], root[\"core-js/modules/web.url\"], root[\"@webcomponents/webcomponentsjs\"], root[\"core-js/modules/es.array.unscopables.flat-map\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__, __WEBPACK_EXTERNAL_MODULE__2__, __WEBPACK_EXTERNAL_MODULE__3__, __WEBPACK_EXTERNAL_MODULE__4__, __WEBPACK_EXTERNAL_MODULE__6__, __WEBPACK_EXTERNAL_MODULE__8__, __WEBPACK_EXTERNAL_MODULE__9__, __WEBPACK_EXTERNAL_MODULE__10__, __WEBPACK_EXTERNAL_MODULE__20__, __WEBPACK_EXTERNAL_MODULE__21__, __WEBPACK_EXTERNAL_MODULE__22__, __WEBPACK_EXTERNAL_MODULE__23__, __WEBPACK_EXTERNAL_MODULE__25__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 26);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\n/**\n * Instantiate a Template DOM object from an HTML text string.\n *\n * Params\n * ------\n * template : An HTML string representing a template.\n *\n * Returns\n * -------\n * A Template DOM object.\n */\n\nexport function importTemplate(template) {\n    const div = document.createElement(\"div\");\n    div.innerHTML = template;\n    return Array.prototype.slice.call(div.children)[0];\n}\n\nfunction setTemplateContent(template) {\n    // return early in browsers that have template tag support\n    if (template.content) {\n        return;\n    }\n    template.content = document.createDocumentFragment();\n    let child;\n    while ((child = template.firstChild)) {\n        Node.prototype.appendChild.call(template.content, child);\n    }\n}\n\n/**\n * A simple tool for creating Web Components v0.\n *\n * Params\n * ------\n * template : An HTML string representing a template.  Should have an 'id'\n *     attribute which will become the new Web Component's tag name.\n * proto : The new Web Component's prototype object, as per spec.\n */\nexport function registerElement(templateString, styleString, proto) {\n    const template = importTemplate(templateString);\n    setTemplateContent(template);\n    if (styleString) {\n        template.innerHTML = `<style>${styleString.toString()}</style>` + template.innerHTML;\n    }\n    template.innerHTML = `<style id=\"psp_styles\" scope=\"${template.getAttribute(\"id\")}\">test{}</style>` + template.innerHTML;\n\n    const _perspective_element = class extends proto {\n        attributeChangedCallback(name, old, value) {\n            if (value === null) {\n                value = \"null\";\n            }\n            if (name[0] !== \"_\" && old != value && !!Object.getOwnPropertyDescriptor(proto.prototype, name).set) {\n                this[name] = value;\n            }\n        }\n\n        connectedCallback() {\n            if (this._initialized) {\n                return;\n            }\n            this._initializing = true;\n            var node = document.importNode(template.content, true);\n            this.attachShadow({mode: \"open\"});\n            this.shadowRoot.appendChild(node);\n\n            if (super.connectedCallback) {\n                super.connectedCallback();\n            }\n\n            // Call all attributes bound to setters on the proto\n            for (let key of Object.getOwnPropertyNames(proto.prototype)) {\n                if (key !== \"connectedCallback\") {\n                    if (this.hasAttribute(key) && key[0] !== \"_\" && !!Object.getOwnPropertyDescriptor(proto.prototype, key).set) {\n                        this[key] = this.getAttribute(key);\n                    }\n                }\n            }\n            this._initializing = false;\n            this._initialized = true;\n        }\n\n        static get observedAttributes() {\n            return Object.getOwnPropertyNames(proto.prototype);\n        }\n    };\n\n    for (let key of Object.getOwnPropertyNames(proto.prototype)) {\n        let descriptor = Object.getOwnPropertyDescriptor(proto.prototype, key);\n        if (descriptor && descriptor.set) {\n            let old = descriptor.set;\n            descriptor.set = function(val) {\n                if (!this.hasAttribute(key) || this.getAttribute(key) !== val) {\n                    this.setAttribute(key, val);\n                    return;\n                }\n                if (!this._initializing && !this._initialized) {\n                    return;\n                }\n                old.call(this, val);\n            };\n            Object.defineProperty(proto.prototype, key, descriptor);\n        }\n    }\n\n    let name = template.getAttribute(\"id\");\n    console.log(`Registered ${name}`);\n\n    window.customElements.define(name, _perspective_element);\n}\n\nexport function bindTemplate(template, ...styleStrings) {\n    const style = styleStrings.map(x => x.toString()).join(\"\\n\");\n    return function(cls) {\n        return registerElement(template, {toString: () => style}, cls);\n    };\n}\n\n/**\n * A decorator for declaring a setter property of an HTMLElement descendent\n * class as serialized JSON.  Handles converting these types before invoking\n * the underlying function/\n *\n * @param {object} _default the default value to supply the setter when\n * undefined, removed or invalid.\n */\nfunction _attribute(_default) {\n    return function(cls, name, desc) {\n        const old_set = desc.value;\n        desc.set = function(x) {\n            let attr = this.getAttribute(name);\n            try {\n                if (x === null || x === undefined || x === \"\") {\n                    x = _default();\n                }\n                if (typeof x !== \"string\") {\n                    x = JSON.stringify(x);\n                }\n                if (x !== attr) {\n                    attr = x;\n                }\n                attr = JSON.parse(attr);\n            } catch (e) {\n                console.warn(`Invalid value for attribute \"${name}\": ${x}`);\n                attr = _default();\n            }\n            old_set.call(this, attr);\n        };\n        desc.get = function() {\n            if (this.hasAttribute(name)) {\n                return JSON.parse(this.getAttribute(name));\n            } else {\n                return _default();\n            }\n        };\n        delete desc[\"value\"];\n        delete desc[\"writable\"];\n        return desc;\n    };\n}\n\nexport function copy_to_clipboard(csv) {\n    let element = document.createElement(\"textarea\");\n    document.body.appendChild(element);\n    element.value = csv;\n    element.select();\n    document.execCommand(\"copy\");\n    document.body.removeChild(element);\n}\n\n/**\n * Just like `setTimeout` except it returns a promise which resolves after the\n * callback has (also resolved).\n *\n * @param {func} cb\n * @param {*} timeout\n */\nexport async function setPromise(cb = async () => {}, timeout = 0) {\n    await new Promise(x => setTimeout(x, timeout));\n    return await cb();\n}\n\nconst invertPromise = () => {\n    let resolve;\n    let promise = new Promise(_resolve => {\n        resolve = _resolve;\n    });\n    promise.resolve = resolve;\n    return promise;\n};\n\nexport function throttlePromise(target, property, descriptor) {\n    const lock = Symbol(\"private lock\");\n    const f = descriptor.value;\n    descriptor.value = async function(...args) {\n        if (this[lock]) {\n            await this[lock];\n            if (this[lock]) {\n                await this[lock];\n                return;\n            }\n        }\n        this[lock] = invertPromise();\n        let result;\n        try {\n            result = await f.call(this, ...args);\n        } catch (e) {\n            console.error(e);\n        } finally {\n            const l = this[lock];\n            this[lock] = undefined;\n            l.resolve();\n            return result;\n        }\n    };\n    return descriptor;\n}\n\n/**\n * Swap 2 HTMLElements in a container.\n * @param {HTMLElement} container\n * @param {HTMLElement} elem1\n * @param {HTMLElement} elem2\n */\nexport function swap(container, ...elems) {\n    if (elems[0] === elems[1]) return;\n    if (elems.every(x => x.classList.contains(\"null-column\"))) return;\n    let [i, j] = elems.map(x => Array.prototype.slice.call(container.children).indexOf(x));\n    if (j < i) {\n        [i, j] = [j, i];\n        elems = elems.reverse();\n    }\n    container.insertBefore(elems[1], elems[0]);\n    if (j + 1 === container.children.length) {\n        container.appendChild(elems[0]);\n    } else {\n        container.insertBefore(elems[0], container.children[j + 1]);\n    }\n}\n\nexport const json_attribute = _attribute(() => ({}));\nexport const array_attribute = _attribute(() => []);\n\nexport const registerPlugin = (name, plugin) => {\n    if (global.registerPlugin) {\n        global.registerPlugin(name, plugin);\n    } else {\n        global.__perspective_plugins__ = global.__perspective_plugins__ || [];\n        global.__perspective_plugins__.push([name, plugin]);\n    }\n};\n","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","module.exports = __WEBPACK_EXTERNAL_MODULE__3__;","module.exports = __WEBPACK_EXTERNAL_MODULE__4__;","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {html, render} from \"lit-html\";\n\nconst RENDERERS = {};\n\nexport const renderers = new (class {\n    /**\n     * Register a plugin with the <perspective-viewer> component.\n     *\n     * @param {string} name The logical unique name of the plugin.  This will be\n     * used to set the component's `view` attribute.\n     * @param {object} plugin An object with this plugin's prototype.\n     *     Valid keys are:\n     * @param {string} plugin.name The display name for this plugin.\n     * @param {string} plugin.create (required) The creation function - may\n     *     return a `Promise`.\n     * @param {string} plugin.delete The deletion function.\n     * @param {string} plugin.mode The selection mode - may be \"toggle\" or\n     *     \"select\".\n     */\n    registerPlugin(name, plugin) {\n        if (RENDERERS[name]) {\n            throw new Error(`A perspective-viewer plugin \"${name}\" has already been registered`);\n        }\n        for (const id in RENDERERS) {\n            const old_plugin = RENDERERS[id];\n            if (old_plugin && old_plugin.name === plugin.name) {\n                console.warn(`Conflicting plugin name \"${plugin.name}\", qualifying with id`);\n                old_plugin.name = `${old_plugin.name} [${id}]`;\n                plugin.name = `${plugin.name} [${name}]`;\n            }\n        }\n        RENDERERS[name] = plugin;\n    }\n\n    getPlugin(name) {\n        return RENDERERS[name];\n    }\n\n    getInstance() {\n        return RENDERERS;\n    }\n})();\n\nglobal.registerPlugin = renderers.registerPlugin;\n\nglobal.getPlugin = renderers.getPlugin;\n\nif (global.__perspective_plugins__) {\n    global.__perspective_plugins__.forEach(([name, plugin]) => global.registerPlugin(name, plugin));\n}\n\nconst template = csv =>\n    html`\n        <pre style=\"margin:0;overflow:scroll;position:absolute;width:100%;height:100%\">${csv}</pre>\n    `;\n\nexport function register_debug_plugin() {\n    global.registerPlugin(\"debug\", {\n        name: \"Debug\",\n        create: async function(div) {\n            const csv = await this._view.to_csv({config: {delimiter: \"|\"}});\n            const timer = this._render_time();\n            render(template(csv), div);\n            timer();\n        },\n        selectMode: \"toggle\",\n        resize: function() {},\n        delete: function() {}\n    });\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__6__;","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__8__;","module.exports = __WEBPACK_EXTERNAL_MODULE__9__;","module.exports = __WEBPACK_EXTERNAL_MODULE__10__;","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","exports = module.exports = require(\"../css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".awesomplete [hidden] {\\n    display: none;\\n}\\n\\n.awesomplete .visually-hidden {\\n    position: absolute;\\n    clip: rect(0, 0, 0, 0);\\n}\\n\\n.awesomplete {\\n    display: inline-block;\\n    position: relative;\\n}\\n\\n.awesomplete > input {\\n    display: block;\\n}\\n\\n.awesomplete > ul {\\n    position: absolute;\\n    left: 0;\\n    z-index: 1;\\n    min-width: 100%;\\n    box-sizing: border-box;\\n    list-style: none;\\n    padding: 0;\\n    margin: 0;\\n    background: #fff;\\n}\\n\\n.awesomplete > ul:empty {\\n    display: none;\\n}\\n\\n.awesomplete > ul {\\n\\tborder-radius: .3em;\\n\\tmargin: .2em 0 0;\\n\\tbackground: hsla(0,0%,100%,.9);\\n\\tbackground: linear-gradient(to bottom right, white, hsla(0,0%,100%,.8));\\n\\tborder: 1px solid rgba(0,0,0,.3);\\n\\tbox-shadow: .05em .2em .6em rgba(0,0,0,.2);\\n\\ttext-shadow: none;\\n}\\n\\n@supports (transform: scale(0)) {\\n\\t.awesomplete > ul {\\n\\t\\ttransition: .3s cubic-bezier(.4,.2,.5,1.4);\\n\\t\\ttransform-origin: 1.43em -.43em;\\n\\t}\\n\\t\\n\\t.awesomplete > ul[hidden],\\n\\t.awesomplete > ul:empty {\\n\\t\\topacity: 0;\\n\\t\\ttransform: scale(0);\\n\\t\\tdisplay: block;\\n\\t\\ttransition-timing-function: ease;\\n\\t}\\n}\\n\\n\\t/* Pointer */\\n\\t.awesomplete > ul:before {\\n\\t\\tcontent: \\\"\\\";\\n\\t\\tposition: absolute;\\n\\t\\ttop: -.43em;\\n\\t\\tleft: 1em;\\n\\t\\twidth: 0; height: 0;\\n\\t\\tpadding: .4em;\\n\\t\\tbackground: white;\\n\\t\\tborder: inherit;\\n\\t\\tborder-right: 0;\\n\\t\\tborder-bottom: 0;\\n\\t\\t-webkit-transform: rotate(45deg);\\n\\t\\ttransform: rotate(45deg);\\n\\t}\\n\\n\\t.awesomplete > ul > li {\\n\\t\\tposition: relative;\\n\\t\\tpadding: .2em .5em;\\n\\t\\tcursor: pointer;\\n\\t}\\n\\t\\n\\t.awesomplete > ul > li:hover {\\n\\t\\tbackground: hsl(200, 40%, 80%);\\n\\t\\tcolor: black;\\n\\t}\\n\\t\\n\\t.awesomplete > ul > li[aria-selected=\\\"true\\\"] {\\n\\t\\tbackground: hsl(205, 40%, 40%);\\n\\t\\tcolor: white;\\n\\t}\\n\\t\\n\\t\\t.awesomplete mark {\\n\\t\\t\\tbackground: hsl(65, 100%, 50%);\\n\\t\\t}\\n\\t\\t\\n\\t\\t.awesomplete li:hover mark {\\n\\t\\t\\tbackground: hsl(68, 100%, 41%);\\n\\t\\t}\\n\\t\\t\\n\\t\\t.awesomplete li[aria-selected=\\\"true\\\"] mark {\\n\\t\\t\\tbackground: hsl(86, 100%, 21%);\\n\\t\\t\\tcolor: inherit;\\n\\t\\t}\\n\", \"\"]);\n\n// exports\n","module.exports = \"<!--\\r\\n   \\r\\n   Copyright (c) 2017, the Perspective Authors.\\r\\n   \\r\\n   This file is part of the Perspective library, distributed under the terms of\\r\\n   the Apache License 2.0.  The full license can be found in the LICENSE file.\\r\\n\\r\\n-->\\r\\n\\r\\n<template id=\\\"perspective-row\\\">\\r\\n    <div id=\\\"psp_row\\\">\\r\\n        <span class='is_visible'></span>\\r\\n        <div draggable='true' class=\\\"row_draggable\\\">\\r\\n            <span id='name' class=\\\"column_name\\\"></span>\\r\\n            <div class=\\\"row_computed\\\">\\r\\n                <span id=\\\"row_edit\\\"></span>\\r\\n            </div>\\r\\n            <span id=\\\"sort_order\\\"></span>\\r\\n            <select id=\\\"column_aggregate\\\" class=\\\"string\\\"></select>\\r\\n            <select id=\\\"filter_operator\\\"></select>\\r\\n            <input id=\\\"filter_operand\\\" placeholder=\\\"Value\\\" />\\r\\n            <span id=\\\"row_exclamation\\\" hidden>&#x26A0;</span>\\r\\n            <span id='row_close'>&#x2715;</span>\\r\\n        </div>\\r\\n    </div>\\r\\n</template>\";","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \":host{display:block;border:0 solid transparent}:host .row_computed{display:none;flex-direction:row}.dropping *{pointer-events:none}:host #psp_row{display:var(--psp_row-display,flex);margin:var(--psp_row-margin,0);overflow:visible;align-items:var(--column_selector--align-items,center);width:auto!important;height:auto!important;float:none!important}:host .is_visible{width:var(--column_selector--width,20px);min-width:var(--column_selector--width,20px);height:var(--is_visible--height,auto);cursor:var(--is_visible--cursor,pointer);font-size:var(--column_selector--font-size,14px);margin-top:-2px;display:var(--is_visible-display,none);color:var(--column-selector--color,#999);font-family:var(--column-selector--font-family,Arial)!important}:host #sort_order{display:none;font-family:var(--button--font-family,inherit);margin-right:4px;cursor:pointer;width:10px;display:var(--sort_order-display,none);padding:var(--sort_order-padding,0)}:host #sort_order:before{content:var(--row-sort-order--before, \\\"-\\\")}:host #sort_order:hover{color:var(--active--color,inherit)}:host #filter_operand{display:var(--filter_operand-display,none);margin:0;padding:0;height:19px;color:inherit;outline:0;border-color:var(--inactive--color,#ccc)}:host #filter_operator{margin:0 0 0 15px;display:var(--filter_operator-display,none);height:17px}:host #filter_operator:hover{color:var(--active--color,inherit)}@keyframes expand2{from{transform:translateX(10px)}}@keyframes expand3{from{transform:scale(.9)}}:host(:hover) .is_visible{color:var(--active--color,--column-selector--color)}:host #row_close{display:var(--row_close-display,inline);cursor:pointer;min-width:5px;max-width:5px;margin-right:3px;flex-grow:0;margin-left:3px;color:#999;font-family:Arial;font-size:10px}:host .is_visible:before{content:var(--is_visible--before,none)}:host #row_exclamation{color:red}:host #row_close:hover{color:var(--active--color,inherit)}:host .row_draggable select{border:none}:host .row_draggable select:focus{outline:0}:host select::-ms-expand{display:none}:host select{margin-left:15px;padding-right:15px;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;background:var(--select--background,url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNC45IDEwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0LjkgMTA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojQUFBQUFBO30KPC9zdHlsZT4KPHRpdGxlPmFycm93czwvdGl0bGU+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMS40LDQuNyAyLjUsMy4yIDMuNSw0LjcgIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMy41LDUuMyAyLjUsNi44IDEuNCw1LjMgIi8+Cjwvc3ZnPg==) no-repeat 95% 50%);background-color:var(--select--background-color,#fff);color:inherit;border-radius:5px;height:24px;padding:var(--column_type--padding,0 0 0 5px);font-size:12px}:host .awesomplete>ul{border-radius:0;margin:0;border:none;transition:none!important;background:var(--plugin--background,#fff)!important}:host .awesomplete>ul:before{content:none}:host .awesomplete>input,:host input{border-color:#ccc;border-width:0 0 1px;box-sizing:border-box;background-color:transparent}:host .row_draggable{animation:var(--row_draggable--animation,expand2 .5s ease-out);cursor:move;border-style:solid;background-color:var(--row_draggable-background-color,none);overflow:var(--row_draggable-overflow,visible);border-color:var(--row_draggable-border-color,none);border-width:var(--row_draggable-border-width,0);padding:var(--row_draggable-padding,0);font-size:12px;flex-grow:1;color:inherit;transition:height .2s;box-sizing:border-box;height:var(--row_draggable-height,21px);min-height:var(--row_draggable-height,21px);display:var(--row_draggable-display,flex);align-items:var(--row-draggable--align-items);flex-direction:var(--row-draggable--flex-direction,column);justify-content:var(--row_draggable--justify-content,center);margin:var(--row_draggable--margin,0);transition:var(--row_draggable--transition,none)}:host .row_draggable *{opacity:var(--row_draggable_children-opacity,1)}:host .row_draggable select{margin:0 0 0 27px}:host ul{transition:background-color .2s,border-color .2s}:host(.null-column) .is_visible{opacity:0!important}:host(.null-column) .row_draggable{background-color:var(--null--background,transparent)!important;border-color:#ccc!important;border-width:0 0 1px!important}:host([drop-target]) .row_draggable{background-color:var(--active--background,#f0f0ff)!important;animation:var(--drop-target--animation,var(--row_draggable--animation,expand3 .5s ease-out));border:none!important}:host .float:before,:host .integer:before{content:var(--float--column-type--content, var(--column-type--content, \\\"123\\\"));color:var(--float--column-type--color,var(--column-type--color,#016bc6))}:host .string:before{content:var(--string--column-type--content, var(--column-type--content, \\\"abc\\\"));color:var(--string--column-type--color,var(--column-type--color,#fe9292))}:host .boolean:before{content:var(--boolean--column-type--content, var(--column-type--content, \\\"t/f\\\"));color:var(--boolean--column-type--color,var(--column-type--color,#999))}:host .date:before{content:var(--date--column-type--content, var(--column-type--content, \\\"mdy\\\"));color:var(--date--column-type--color,var(--column-type--color,#999))}:host .datetime:before{content:var(--datetime--column-type--content, var(--column-type--content, \\\"mdy\\\"));color:var(--datetime--column-type--color,var(--column-type--color,#999))}:host .column_name{overflow:hidden;max-width:var(--column_name-max-width,none);white-space:nowrap;text-overflow:ellipsis}:host span#name:before{font-family:var(--interface-monospace--font-family,monospace);position:relative;display:inline-block;padding:var(--column_type--padding,0 5px);min-width:18px;display:var(--name-before-display,none);width:var(--column_type--width,auto)}:host #column_aggregate{display:var(--column_aggregate-display,none);font-size:10px;font-family:Arial,sans-serif;width:88%;height:20px}:host span#name{flex:var(--column-name--flex,0 1 auto);width:100%;white-space:nowrap;margin:var(--column_name-margin,0)}\", \"\"]);\n\n// exports\n","module.exports = \"<!--\\n\\nCopyright (c) 2017, the Perspective Authors.\\n\\nThis file is part of the Perspective library, distributed under the terms of\\nthe Apache License 2.0.  The full license can be found in the LICENSE file.\\n\\n-->\\n\\n<template id=\\\"perspective-computed-expression-editor\\\">\\n    <div id=\\\"psp-expression__body\\\">\\n        <div class=\\\"psp-expression__container\\\">\\n            <span id=\\\"psp-expression-close\\\" aria-label=\\\"Close Expression Editor\\\">&times;</span>\\n            <div class=\\\"psp-expression__content psp-expression__content--nomargin\\\">\\n                <textarea placeholder=\\\"Write an expression\\\" autocomplete=\\\"off\\\" id=\\\"psp-expression-input\\\"></textarea>\\n                <div class=\\\"psp-expression__label psp-expression__error\\\" id=\\\"psp-expression-error\\\"></div>\\n            </div>\\n        </div>\\n        <div id=\\\"psp-expression-actions\\\">\\n            <button id=\\\"psp-expression-button-remove\\\" class=\\\"psp-expression__button\\\" disabled>Remove All</button>\\n            <button id=\\\"psp-expression-button-save\\\" class=\\\"psp-expression__button\\\" disabled>Save</button>\\n        </div>\\n    </div>\\n</template>\";","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \":host{display:none;flex-direction:column;max-height:35%;margin-top:34px;margin-bottom:24px;width:100%;flex:0 0 auto!important}:host *{box-sizing:border-box}:host #psp-expression__body,:host .psp-expression__container{display:flex;flex-direction:column}:host #psp-expression__body.row,:host .psp-expression__container.row{align-items:center;flex-direction:row}:host .psp-expression__container:first-of-type{margin-bottom:0}:host .psp-expression__content{align-items:center;display:flex;margin-top:5px}:host .psp-expression__content.psp_expression__content--absolute{position:absolute}:host .psp-expression__content.psp-expression__content--nomargin{margin-top:0;position:relative}:host #psp-expression-actions{display:flex;justify-content:flex-end;margin-left:20px;margin-top:12px}:host span#psp-expression-close{color:#666;padding-left:3px}:host span#psp-expression-close:hover{cursor:pointer}:host textarea#psp-expression-input{background:var(--background-color,none);border-color:var(--inactive-color,#ccc);color:var(--color,#666);font-size:12px;font-family:var(--interface-monospace--font-family,monospace);height:75px;margin-top:5px;padding-left:5px;resize:auto;overflow:auto;width:100%}:host .psp-expression__label{color:var(--color,#a9a9a9);font-size:10px;margin-top:5px;max-width:100%}:host .psp-expression__label.psp-expression__error{background-color:#cb4549;box-sizing:border-box;color:#fff!important;display:none;position:absolute;z-index:10000;max-height:75px;padding:10px;overflow-x:hidden;overflow-y:scroll;top:100%;width:100%;word-break:break-word}:host .psp-expression__button{border-radius:0;border-bottom:1px solid #ccc;border-left:0;border-right:0;border-top:0;font-size:12px;margin-left:6px;padding:2px 5px}:host .psp-expression__button:hover{cursor:pointer}:host .psp-expression__button[disabled]{background:#666!important;color:#a0a0a0!important;cursor:not-allowed;border-bottom-color:#000!important;opacity:.5}:host .psp-expression__button#psp-expression-button-remove{background:#e76056;border-bottom-color:#bf4d45;color:#fff;display:none}:host .psp-expression__button#psp-expression-button-remove:active{background:#bf4d45;border-bottom-color:#9d3f39}:host .psp-expression__button#psp-expression-button-save{background:#0171d2;border-bottom-color:#0160b1;color:#fff;height:22px}:host .psp-expression__button#psp-expression-button-save:active{background:#0160b1;border-bottom-color:#014986}\", \"\"]);\n\n// exports\n","module.exports = \"<!--\\r\\n   \\r\\n   Copyright (c) 2017, the Perspective Authors.\\r\\n   \\r\\n   This file is part of the Perspective library, distributed under the terms of\\r\\n   the Apache License 2.0.  The full license can be found in the LICENSE file.\\r\\n\\r\\n-->\\r\\n\\r\\n<template id=\\\"perspective-viewer\\\">\\r\\n\\r\\n    <div id=\\\"app\\\">\\r\\n        <div id=\\\"menubar\\\">\\r\\n            <div id=\\\"copy_button\\\" class=\\\"noselect button\\\" title=\\\"Copy CSV\\\"></div>\\r\\n            <div id=\\\"download_button\\\" class=\\\"noselect button\\\" title=\\\"Download CSV\\\"></div>\\r\\n            <div id=\\\"reset_button\\\" class=\\\"noselect button\\\" title=\\\"Reset Viewer\\\"></div>\\r\\n        </div>\\r\\n        <div id='side_panel' class=\\\"column fixed noselect\\\">\\r\\n            <div id=\\\"vis_selector_container\\\">\\r\\n                <select id=\\\"vis_selector\\\">\\r\\n                </select>\\r\\n            </div>\\r\\n            <div id=\\\"columns_container\\\" style=\\\"visibility: hidden\\\">\\r\\n                <ul id='active_columns'></ul>\\r\\n                <div id=\\\"sub_columns\\\">\\r\\n                    <ul id='inactive_columns'></ul>\\r\\n                    <div id=\\\"side_panel__actions\\\" style=\\\"visibility: hidden\\\">\\r\\n                        <div id=\\\"add-computed-expression\\\" class=\\\"side_panel-action\\\"><span class=\\\"psp-icon psp-icon__add\\\"></span><span class=\\\"psp-title__columnName\\\">New Column</span></div>\\r\\n                    </div>\\r\\n                </div>\\r\\n                <perspective-computed-expression-editor></perspective-computed-expression-editor>\\r\\n            </div>\\r\\n            <div id=\\\"resize_bar\\\"></div>\\r\\n        </div>\\r\\n        <div class=\\\"column noselect\\\">\\r\\n            <div id='top_panel'>\\r\\n                <div class=\\\"rrow\\\">\\r\\n                    <div id=\\\"row_pivots\\\">\\r\\n                        <div class=\\\"psp-text-field\\\">\\r\\n                            <ul class=\\\"psp-text-field__input\\\" for=\\\"row-pivots\\\"></ul>\\r\\n                            <label for=\\\"row_pivots\\\"></label>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </div>\\r\\n                <span id=\\\"transpose_button\\\" class=\\\"rrow centered\\\" title=\\\"Transpose Pivots\\\">&#x21C4;</span>\\r\\n                <div class=\\\"rrow\\\">\\r\\n                    <div id=\\\"column_pivots\\\">\\r\\n                        <div class=\\\"psp-text-field\\\">\\r\\n                            <ul class=\\\"psp-text-field__input\\\" for=\\\"column-pivots\\\"></ul>\\r\\n                            <label for=\\\"column_pivots\\\"></label>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </div>\\r\\n                <div class=\\\"rrow\\\">\\r\\n                    <div id=\\\"sort\\\">\\r\\n                        <div class=\\\"psp-text-field\\\">\\r\\n                            <ul class=\\\"psp-text-field__input\\\" for=\\\"sort\\\"></ul>\\r\\n                            <label for=\\\"sort\\\"></label>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </div>\\r\\n                <div class=\\\"rrow\\\" style='flex-grow:3;height:auto;flex:1 1 400px;max-width:none'>\\r\\n                    <div id=\\\"filters\\\">\\r\\n                        <div class=\\\"psp-text-field\\\">\\r\\n                            <ul class=\\\"psp-text-field__input\\\" for='filters'></ul>\\r\\n                            <label for=\\\"filters\\\"></label>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </div>\\r\\n            </div>\\r\\n            <div id=\\\"pivot_chart_container\\\">\\r\\n                <div class=\\\"plugin_information plugin_information--warning hidden\\\" id=\\\"plugin_information--size\\\">\\r\\n                    <span class=\\\"plugin_information__text\\\" id=\\\"plugin_information_count\\\">Estimated rendering</span>\\r\\n                    <span class=\\\"plugin_information__actions\\\">\\r\\n                        <span class=\\\"plugin_information__action\\\">Render all points</span>\\r\\n                        <span class=\\\"plugin_information__action--close\\\" id=\\\"close_button\\\"></span>\\r\\n                    </span>\\r\\n                </div>\\r\\n                <div id=\\\"pivot_chart\\\"></div>\\r\\n            </div>\\r\\n        </div>\\r\\n\\r\\n        <div id=\\\"config_button\\\" class=\\\"noselect button\\\" title=\\\"Right click for additional options\\\"></div>\\r\\n\\r\\n        <div id='drop_target'>\\r\\n            <div id='drop_target_inner'>\\r\\n\\r\\n            </div>\\r\\n        </div>\\r\\n\\r\\n        <slot></slot>\\r\\n    </div>\\r\\n\\r\\n</template>\";","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \":host #app #top_panel #row_pivots label:before{content:var(--row_pivots--before, \\\"Row Pivots\\\")}:host #app #top_panel #column_pivots label:before{content:var(--column_pivots--before, \\\"Column Pivots\\\")}:host #app #top_panel #sort label:before{content:\\\"Sort\\\"}:host #app #top_panel #filters label:before{content:\\\"Filter\\\"}:host #app #side_panel #active_columns perspective-row:before{font-size:10px;margin-left:var(--column_selector--width,20px);left:1px;padding:var(--column_type--padding,0 0 0 5px);color:var(--inactive--color,#666);position:absolute;margin-top:-15px}:host:hover #config_button{opacity:1}#config_button{background:0 0;opacity:1!important}.button{padding:var(--button--padding,12px 14px 24px 8px)}[settings=true] #config_button{opacity:1!important}@keyframes expand{from{opacity:0}}:host{position:relative;display:inline-block;overflow:hidden;word-wrap:normal;--highcharts-full--gradient:linear-gradient(#4d342f 0%, #e4521b 22.5%, #feeb65 42.5%, #f0f0f0 50%, #dcedc8 57.5%, #42b3d5 67.5%, #1a237e 100%);--highcharts-positive--gradient:linear-gradient(#dcedc8 0%, #42b3d5 35%, #1a237e 100%);--highcharts-negative--gradient:linear-gradient(#feeb65 100%, #e4521b 70%, #4d342f 0%);--hypergrid-tree-header--background:#fff;--hypergrid-tree-header--color:#666;--hypergrid-header--background:#fff;--hypergrid-separator--color:#666;--hypergrid-header--color:#666;--hypergrid-positive--color:#1078d1;--hypergrid-negative--color:#ff8888;--hypergrid--font-size:12px;--hypergrid-header--font-size:12px;--hypergrid--font-family:Helvetica,Arial,sans-serif;--hypergrid-header--font-family:Helvetica,Arial,sans-serif;--hypergrid-row-hover--background:#f6f6f6;--hypergrid-row-hover--color:#666;--hypergrid-cell-hover--background:#eeeeee;--hypergrid-cell-hover--color:#666;--integer--hypergrid--text-align:right;--float--hypergrid--text-align:right;--d3fc-series:rgba(31, 119, 180, 0.5);--d3fc-series-1:#0366d6;--d3fc-series-2:#ff7f0e;--d3fc-series-3:#2ca02c;--d3fc-series-4:#d62728;--d3fc-series-5:#9467bd;--d3fc-series-6:#8c564b;--d3fc-series-7:#e377c2;--d3fc-series-8:#7f7f7f;--d3fc-series-9:#bcbd22;--d3fc-series-10:#17becf;--d3fc-full--gradient:linear-gradient(#4d342f 0%, #e4521b 22.5%, #feeb65 42.5%, #f0f0f0 50%, #dcedc8 57.5%, #42b3d5 67.5%, #1a237e 100%);--d3fc-positive--gradient:linear-gradient(#dcedc8 0%, #42b3d5 35%, #1a237e 100%);--d3fc-negative--gradient:linear-gradient(#feeb65 100%, #e4521b 70%, #4d342f 0%)}:host #pivot_chart{position:absolute;width:100%;height:100%;display:grid;justify-content:stretch}:host .hidden{display:none}:host .psp-icon{color:#999}:host .psp-icon:hover{cursor:pointer}:host .psp-icon__add{display:flex;width:20px;min-width:20px;margin-top:-2px;height:0;font-family:var(--column-add--font-family,inherit)}:host .psp-icon__add:before{font-feature-settings:\\\"liga\\\";content:var(--column-add--before, \\\"+\\\")}:host .psp-title__columnName{display:flex;margin-left:34px;margin-top:3px;font-size:12px;color:#666}:host .side_panel-action:hover{cursor:pointer}:host *{box-sizing:border-box;line-height:1.42857143}:host #app{display:flex;position:relative;width:100%;height:100%}:host #app.hide_message #drop_target{display:none}:host .chart{padding:15px}:host #pivot_chart_container{flex-grow:1;position:relative;border:var(--plugin--border,none);overflow:hidden}:host .config{display:flex}:host #column_pivots #psp_row,:host #filters #psp_row,:host #row_pivots #psp_row,:host #sort #psp_row{display:inline}:host ul{min-height:20px;padding:0;margin:0;font-size:12px}:host #active_columns perspective-row{animation:.3s ease-out expand;--column-selector--color:var(--active--color, #999);--is_visible--before:var(--active-column-selector--content, \\\"\\\\25CF\\\")}:host #inactive_columns perspective-row{animation:.3s ease-out expand;--column-selector--color:var(--inactive-column-selector--color, #999);--is_visible--before:var(--inactive-column-selector--content, \\\"\\\\25CB\\\");--row_draggable--animation:none;opacity:var(--inactive-column--opacity,1);transition:opacity .3s}:host #inactive_columns perspective-row:hover{transition:none;opacity:1}:host #top_panel perspective-row{animation:.3s ease-out expand;--column-name--flex:1;padding:0 10px 0 0;margin-bottom:-1px;display:var(--top-panel-row--display,inline-block);--psp_row-display:inline-block}:host #active_columns,:host #inactive_columns{list-style:none;padding:0;width:100%;margin:var(--column-container--margin,8px 0 0 0);overflow-y:auto;overflow-x:hidden;position:relative}:host #inactive_columns perspective-row.active{--row_draggable--margin:0px 0px 0px 10px;opacity:0;height:0!important;overflow:hidden}:host .columns_horizontal #sub_columns.collapse #side_panel__actions{margin-top:0}:host #sub_columns{min-height:33.3%;flex-shrink:100000;display:flex;flex-direction:column;overflow-x:hidden;width:100%}:host #sub_columns.collapse{flex-shrink:0;min-height:64px}:host #sub_columns.collapse #inactive_columns{display:none}:host .column{display:flex;list-style:none;flex-direction:column;flex:1}:host .rrow{display:flex;flex-grow:1;min-height:24px;align-items:center;max-width:400px;list-style:none;min-width:140px;margin:var(--column-drop-container--margin,5px 10px 0 0)}:host .rrow>div{display:flex;min-height:24px;flex-direction:column;justify-content:flex-end}:host #top_panel>.rrow>*{width:100%;padding:12px 0;margin:-12px 0}:host .rrow #psp_row{white-space:nowrap}:host #sort perspective-row{--sort_order-display:inline;--sort_order-padding:0 0 0 4px}:host #sort perspective-row[sort-order=asc]{--row-sort-order--before:var(--sort-order-asc--before, \\\"\\\\2191\\\")}:host #sort perspective-row[sort-order=desc]{--row-sort-order--before:var(--sort-order-desc--before, \\\"\\\\2193\\\")}:host #sort perspective-row[sort-order=none]{--row-sort-order--before:var(--sort-order-none--before, \\\"-\\\")}:host #sort perspective-row[sort-order=\\\"asc abs\\\"]{--row-sort-order--before:var(--sort-order-asc-abs--before, \\\"\\\\21E7\\\")}:host #sort perspective-row[sort-order=\\\"desc abs\\\"]{--row-sort-order--before:var(--sort-order-desc-abs--before, \\\"\\\\21E9\\\")}:host #sort perspective-row[sort-order=\\\"col asc\\\"]{--row-sort-order--before:var(--sort-order-col-asc--before, \\\"\\\\2192\\\")}:host #sort perspective-row[sort-order=\\\"col desc\\\"]{--row-sort-order--before:var(--sort-order-col-desc--before, \\\"\\\\2190\\\")}:host #sort perspective-row[sort-order=\\\"col asc abs\\\"]{--row-sort-order--before:var(--sort-order-col-asc-abs--before, \\\"\\\\21E8\\\")}:host #sort perspective-row[sort-order=\\\"col desc abs\\\"]{--row-sort-order--before:var(--sort-order-col-desc-abs--before, \\\"\\\\21E6\\\")}:host #top_panel perspective-row::after{content:\\\",\\\"}:host #top_panel perspective-row:last-child::after{display:none;content:\\\"\\\"!important}:host label{white-space:nowrap;display:inline-block;vertical-align:middle;margin-bottom:0}:host #drop_target{position:absolute;left:0;top:0;right:0;bottom:0;padding:30px}:host #drop_target_inner{width:100%;height:100%;display:flex;align-items:center;justify-content:center}:host #drop_target_inner h3{font-weight:300}:host #config_button{position:absolute;top:0;left:0;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}:host #config_button:hover{color:var(--active--color,inherit)}:host .button{cursor:pointer;font-size:16px;font-weight:400}:host select::-ms-expand{display:none}:host select{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;background:var(--select--background,url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNC45IDEwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0LjkgMTA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojQUFBQUFBO30KPC9zdHlsZT4KPHRpdGxlPmFycm93czwvdGl0bGU+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMS40LDQuNyAyLjUsMy4yIDMuNSw0LjcgIi8+Cjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iMy41LDUuMyAyLjUsNi44IDEuNCw1LjMgIi8+Cjwvc3ZnPg==) no-repeat 95% 50%);background-color:#fff;color:inherit;border-radius:5px;height:24px;padding:var(--select--padding,0 0 0 6px);font-size:12px;font-family:inherit}:host input{padding:0 10px}:host .centered{display:flex;align-items:center;justify-content:center}:host #top_panel{display:flex;flex-wrap:wrap;justify-content:flex-start;padding:var(--top_panel--padding,5px 0 10px 0);max-width:1000px;z-index:1}:host #side_panel{position:relative;flex:0 0 auto;padding:var(--side_panel--padding,10px 10px 0 11px)}:host #side_panel>div{display:flex}:host #vis_selector_container{min-height:29px;margin-left:var(--column_selector--width,20px);overflow:hidden}:host #vis_selector{flex-grow:1}:host #transpose_button{cursor:pointer;min-width:5px;max-width:5px;flex-grow:0;color:#999;font-family:Arial;font-size:12px}:host #transpose_button:hover{color:var(--active--color,inherit)}:host #resize_bar{position:absolute;top:0;right:0;bottom:0;width:8px;cursor:col-resize}\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".psp-text-field{position:relative;background-color:var(--column-drop-container--background,#fff);border-width:0 0 1px;border-style:solid;border-color:var(--inactive--color,#ccc);display:flex;flex-direction:column;justify-content:flex-end;min-height:24px;transition:border-color .3s ease-out}:host(.dragging) .psp-text-field.dropping{border-bottom-width:2px;border-style:solid;border-color:var(--active--color,#1a7da1)}:host(.dragging) .psp-text-field{border-bottom-width:1px;border-style:solid;border-color:var(--active--color,#1a7da1)}.psp-text-field>.psp-text-field__input{border:0;line-height:20px;vertical-align:bottom;padding-bottom:0;display:none}.psp-text-field__input+label{height:var(--column--height,auto);line-height:17px;box-sizing:border-box;color:var(--inactive--color,#ccc);font-weight:400;white-space:nowrap;padding:var(--column-drop-container--padding,0 0 2px 10px);font-size:12px;display:inline-block;transition:font-size .3s,margin .3s}.dropping .psp-text-field__input,.psp-text-field__input:not(:empty){display:block!important}.dropping .psp-text-field__input::after{content:\\\"|\\\";width:0;overflow:visible;margin-top:-1px;position:absolute}.dropping *{pointer-events:none}.dropping .psp-text-field label,.psp-text-field__input:not(:empty)+label{position:absolute;top:0;margin:var(--column-drop-label--margin,0);font-size:var(--column-drop-label--font-size,12px);display:var(--column-drop-label--display,none)}.dropping perspective-row.inserting{border-top:25px solid transparent}.dropping perspective-row.postserting{border-bottom:25px solid transparent}:host perspective-row{height:var(--column--height,21px);--row_draggable-height:var(--column--height, 21px)}:host([row-pivots]) #active_columns perspective-row{height:var(--active-column--height,41px);min-height:var(--active-column--height,41px);--row_draggable-height:var(--active-column--height, 41px);--column_aggregate-display:inline-block;--is_visible--height:var(--active-column-selector--height, auto)}:host{font-family:Arial,sans-serif;background-color:#eee;color:#333}:host #app.columns_horizontal #columns_container{flex-direction:row-reverse}:host #app.columns_horizontal #active_columns,:host #app.columns_horizontal #inactive_columns{display:flex;flex-direction:column;flex:0 1 auto;width:100%}:host #app.columns_horizontal #inactive_columns{flex:1 1 auto}:host #app.columns_horizontal #sub_columns{flex-shrink:1}:host #app.columns_horizontal #sub_columns perspective-row{--column_name-margin:0 25px 0 0}:host #app.columns_horizontal #side_panel #divider{display:none}:host #app.columns_horizontal perspective-computed-expression-editor{max-height:none;margin-right:24px;width:auto}:host #side_panel perspective-row{--name-before-display:inline-block;--is_visible-display:inline-block;--row_draggable-padding:0px 10px 0px 0px;--row_close-display:none;--column_name-max-width:180px}:host #top_panel perspective-row{--row_draggable-display:inline-flex;--row-draggable--flex-direction:row;--row-draggable--align-items:center}:host #columns_container{flex-direction:column;height:calc(100% - 29px)}:host #columns_container #active_columns{flex:0 1 auto}:host #columns_container #active_columns perspective-row{margin-bottom:2px;--row_draggable-background-color:var(--column--background, white);--row_draggable-border-color:var(--inactive--color, #ccc);--row_draggable-border-width:0 0 1px 0;--row_draggable-overflow:hidden;--row_draggable--justify-content:space-evenly}:host #columns_container #active_columns perspective-row:last-child{--row_draggable-border-width:var(--row_draggable-border-last-child-width, 0 0 1px 0)}:host #columns_container #active_columns perspective-row[drop-target]{--row_draggable_children-opacity:0}:host #columns_container #active_columns perspective-row.null-column{--row_draggable_children-opacity:0;pointer-events:none}:host #columns_container #active_columns.one_lock perspective-row:first-child,:host #columns_container #active_columns.two_lock perspective-row:first-child{--active--color:#ccc;--is_visible--cursor:normal}:host #columns_container #active_columns.two_lock perspective-row:nth-child(2){--active--color:#ccc;--is_visible--cursor:normal}:host #columns_container #active_columns perspective-row:only-child{--active--color:#ccc;--is_visible--cursor:normal}:host #columns_container #active_columns,:host #columns_container #inactive_columns{border:none!important}:host ul{transition:background-color .2s,border-color .2s;outline:0;border-style:solid;border-color:var(--inactive--color,#ccc);font-size:12px;padding:var(--column-drop-container--padding,0 10px 0 10px);border-width:0 0 1px}:host #side_panel #side_panel__actions{display:flex;flex-direction:column;flex-shrink:1000;justify-content:flex-start;position:relative;overflow-y:hidden;width:100%;padding-top:20px;margin:var(--column-container--margin,8px);min-height:36px}:host #side_panel #side_panel__actions button.side_panel-action{align-items:center;align-content:center;background:0 0;border:none;display:flex;flex-direction:row;font-size:12px;padding-right:10px;-webkit-appearance:none;-moz-appearance:none;appearance:none}:host #side_panel #side_panel__actions button.side_panel-action span{margin-left:5px;font-size:15px}:host #side_panel #side_panel__actions button.side_panel-action:hover{cursor:pointer}:host .noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}:host svg .highcharts-legend-box{fill:none}:host #pivot_chart{background-color:var(--plugin--background,#fff)}:host #drop_target{border:var(--plugin--border,none);background:var(--plugin--background,#fff)}:host #pivot_chart_container{box-shadow:var(--plugin--box-shadow,none)}:host #filters perspective-row{margin:0;--filter_operator-display:inline-block;--filter_operand-display:inline-block}:host .plugin_information{color:var(--warning--color,inherit);display:flex;position:absolute;flex-direction:row;justify-content:flex-start;padding:.5rem;width:100%;z-index:10000;transition:opacity .3s ease-out;opacity:1}:host .plugin_information.hidden{display:none;opacity:0}:host .plugin_information.plugin_information--warning{background:#ffca28}:host .plugin_information .plugin_information__text{font-size:12px;margin-right:.25rem;display:flex;flex-wrap:wrap;align-items:center}:host .plugin_information .plugin_information__text:before{content:var(--overflow_hint--before);font-family:var(--overflow_hint--font-family);color:var(--overflow_hint--color);padding:var(--overflow_hint--padding);font-size:16px}:host .plugin_information .plugin_information__action{font-size:12px;text-decoration:underline;cursor:pointer;margin-right:.25rem}:host .plugin_information .plugin_information__action--close{margin-left:12px;display:inline-flex;font-size:12px;cursor:pointer}:host .plugin_information .plugin_information__actions{margin-left:auto;display:flex;align-items:center;flex-direction:row;justify-content:flex-start}:host .plugin_information .plugin_information--overflow-hint-percent{font-weight:700}:host .plugin_information .plugin_information--overflow-hint{white-space:nowrap}:host #drop_target_inner h3{color:#aaa;font-weight:300}:host #config_button,:host #copy_button,:host #download_button,:host #reset_button{font-weight:400;font-family:var(--button--font-family,Arial);color:var(--inactive--color,#999);font-size:var(--button--font-size,16px);transition:opacity .3s;overflow:hidden}:host #config_button:hover,:host #copy_button:hover,:host #download_button:hover,:host #reset_button:hover{color:var(--active--color,inherit)}:host #config_button:before{font-feature-settings:\\\"liga\\\";content:var(--settings-button--content, \\\"\\\\1F527\\\")}:host #reset_button:before{font-feature-settings:\\\"liga\\\";content:var(--reset_button--before, \\\"Reset\\\")}:host #close_button:before{font-family:var(--button--font-family,Arial);font-feature-settings:\\\"liga\\\";content:var(--close_button--before, \\\"Close\\\")}:host #download_button:before{font-feature-settings:\\\"liga\\\";content:var(--download_button--before, \\\"Save\\\")}:host #copy_button:before{font-feature-settings:\\\"liga\\\";content:var(--copy_button--before, \\\"Copy\\\")}:host #menubar{display:none;flex-direction:column;padding-top:55px}:host #app.show_menu #menubar{display:flex}:host select{border-radius:0;background-color:var(--select--background-color,#fff);border-style:solid;border-color:var(--inactive--color,#ccc);border-width:0 0 1px}:host select:focus{outline:0}:host input{border-style:solid;border-color:var(--inactive--color,#ccc);border-width:0 0 1px}:host input::placeholder{color:var(--inactive--color,#ccc)}:host option[value=\\\"\\\"]{color:#fff!important}:host #app{background-color:inherit}:host ::-webkit-scrollbar,:host ::shadow ::-webkit-scrollbar{width:12px}:host ::-webkit-scrollbar-thumb,:host ::shadow ::-webkit-scrollbar-thumb{background:#ccc}:host ::-webkit-scrollbar-track,:host ::shadow ::-webkit-scrollbar-track{background:0 0}\", \"\"]);\n\n// exports\n","module.exports = __WEBPACK_EXTERNAL_MODULE__20__;","module.exports = __WEBPACK_EXTERNAL_MODULE__21__;","module.exports = __WEBPACK_EXTERNAL_MODULE__22__;","module.exports = __WEBPACK_EXTERNAL_MODULE__23__;","/*\n\nForked from https://github.com/timruffles/mobile-drag-drop/ v2.3.0-rc.2\n\nCopyright (c) 2013 Tim Ruffles\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the \"Software\"), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\nthe Software, and to permit persons to whom the Software is furnished to do so,\nsubject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\nFOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\nIN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\nCONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\nconst CLASS_PREFIX = \"dnd-poly-\";\nconst CLASS_DRAG_IMAGE = CLASS_PREFIX + \"drag-image\";\nconst CLASS_DRAG_IMAGE_SNAPBACK = CLASS_PREFIX + \"snapback\";\nconst CLASS_DRAG_OPERATION_ICON = CLASS_PREFIX + \"icon\";\nconst EVENT_PREFIX = \"dnd-poly-\";\nconst EVENT_DRAG_DRAGSTART_PENDING = EVENT_PREFIX + \"dragstart-pending\";\nconst EVENT_DRAG_DRAGSTART_CANCEL = EVENT_PREFIX + \"dragstart-cancel\";\nconst ALLOWED_EFFECTS = [\"none\", \"copy\", \"copyLink\", \"copyMove\", \"link\", \"linkMove\", \"move\", \"all\"];\nconst DROP_EFFECTS = [\"none\", \"copy\", \"move\", \"link\"];\n\nfunction detectFeatures() {\n    const features = {\n        dragEvents: \"ondragstart\" in document.documentElement,\n        draggable: \"draggable\" in document.documentElement,\n        userAgentSupportingNativeDnD: undefined\n    };\n    const isBlinkEngine = !!window.chrome || /chrome/i.test(navigator.userAgent);\n    features.userAgentSupportingNativeDnD = !(/iPad|iPhone|iPod|Android/.test(navigator.userAgent) || (isBlinkEngine && \"ontouchstart\" in document.documentElement));\n    return features;\n}\nfunction supportsPassiveEventListener() {\n    let supportsPassiveEventListeners = false;\n    try {\n        const opts = Object.defineProperty({}, \"passive\", {\n            get: function() {\n                supportsPassiveEventListeners = true;\n            }\n        });\n        window.addEventListener(\"test\", null, opts);\n    } catch (e) {}\n    return supportsPassiveEventListeners;\n}\n\nconst supportsPassive = supportsPassiveEventListener();\nfunction isDOMElement(object) {\n    return object && object.tagName;\n}\nfunction addDocumentListener(ev, handler, passive) {\n    if (passive === void 0) {\n        passive = true;\n    }\n    document.addEventListener(ev, handler, supportsPassive ? {passive: passive} : false);\n}\nfunction removeDocumentListener(ev, handler) {\n    document.removeEventListener(ev, handler);\n}\nfunction onEvt(el, event, handler, capture) {\n    if (capture === void 0) {\n        capture = false;\n    }\n    const options = supportsPassive ? {passive: true, capture: capture} : capture;\n    el.addEventListener(event, handler, options);\n    return {\n        off: function() {\n            el.removeEventListener(event, handler, options);\n        }\n    };\n}\nfunction prepareNodeCopyAsDragImage(srcNode, dstNode) {\n    if (srcNode.nodeType === 1) {\n        const cs = getComputedStyle(srcNode);\n        for (let i = 0; i < cs.length; i++) {\n            const csName = cs[i];\n            dstNode.style.setProperty(csName, cs.getPropertyValue(csName), cs.getPropertyPriority(csName));\n        }\n        dstNode.style.pointerEvents = \"none\";\n        dstNode.removeAttribute(\"id\");\n        dstNode.removeAttribute(\"class\");\n        dstNode.removeAttribute(\"draggable\");\n        if (dstNode.nodeName === \"CANVAS\") {\n            const canvasSrc = srcNode;\n            const canvasDst = dstNode;\n            const canvasSrcImgData = canvasSrc.getContext(\"2d\").getImageData(0, 0, canvasSrc.width, canvasSrc.height);\n            canvasDst.getContext(\"2d\").putImageData(canvasSrcImgData, 0, 0);\n        }\n    }\n    if (srcNode.hasChildNodes()) {\n        for (let i = 0; i < srcNode.childNodes.length; i++) {\n            prepareNodeCopyAsDragImage(srcNode.childNodes[i], dstNode.childNodes[i]);\n        }\n    }\n}\nfunction createDragImage(sourceNode) {\n    const dragImage = sourceNode.cloneNode(true);\n    prepareNodeCopyAsDragImage(sourceNode, dragImage);\n    return dragImage;\n}\nfunction average(array) {\n    if (array.length === 0) {\n        return 0;\n    }\n    return (\n        array.reduce(function(s, v) {\n            return v + s;\n        }, 0) / array.length\n    );\n}\nfunction isTouchIdentifierContainedInTouchEvent(touchEvent, touchIdentifier) {\n    for (let i = 0; i < touchEvent.changedTouches.length; i++) {\n        const touch = touchEvent.changedTouches[i];\n        if (touch.identifier === touchIdentifier) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction updateCentroidCoordinatesOfTouchesIn(coordinateProp, event, outPoint) {\n    const pageXs = [],\n        pageYs = [];\n    for (let i = 0; i < event.touches.length; i++) {\n        const touch = event.touches[i];\n        pageXs.push(touch[coordinateProp + \"X\"]);\n        pageYs.push(touch[coordinateProp + \"Y\"]);\n    }\n    outPoint.x = average(pageXs);\n    outPoint.y = average(pageYs);\n}\nconst TRANSFORM_CSS_VENDOR_PREFIXES = [\"\", \"-webkit-\"];\nfunction extractTransformStyles(sourceNode) {\n    return TRANSFORM_CSS_VENDOR_PREFIXES.map(function(prefix) {\n        const transform = sourceNode.style[prefix + \"transform\"];\n        if (!transform || transform === \"none\") {\n            return \"\";\n        }\n        return transform.replace(/translate\\(\\D*\\d+[^,]*,\\D*\\d+[^,]*\\)\\s*/g, \"\");\n    });\n}\nfunction translateElementToPoint(element, pnt, originalTransforms, offset, centerOnCoordinates) {\n    if (centerOnCoordinates === void 0) {\n        centerOnCoordinates = true;\n    }\n    let x = pnt.x,\n        y = pnt.y;\n    if (offset) {\n        x += offset.x;\n        y += offset.y;\n    }\n    if (centerOnCoordinates) {\n        x -= parseInt(element.offsetWidth, 10) / 2;\n        y -= parseInt(element.offsetHeight, 10) / 2;\n    }\n    const translate = \"translate3d(\" + x + \"px,\" + y + \"px, 0)\";\n    for (let i = 0; i < TRANSFORM_CSS_VENDOR_PREFIXES.length; i++) {\n        const transformProp = TRANSFORM_CSS_VENDOR_PREFIXES[i] + \"transform\";\n        element.style[transformProp] = translate + \" \" + originalTransforms[i];\n    }\n}\nfunction applyDragImageSnapback(sourceEl, dragImage, dragImageTransforms, transitionEndCb) {\n    const cs = getComputedStyle(sourceEl);\n    if (cs.visibility === \"hidden\" || cs.display === \"none\") {\n        console.log(\"dnd-poly: source node is not visible. skipping snapback transition.\");\n        transitionEndCb();\n        return;\n    }\n    dragImage.classList.add(CLASS_DRAG_IMAGE_SNAPBACK);\n    const csDragImage = getComputedStyle(dragImage);\n    const durationInS = parseFloat(csDragImage.transitionDuration);\n    if (isNaN(durationInS) || durationInS === 0) {\n        console.log(\"dnd-poly: no transition used - skipping snapback\");\n        transitionEndCb();\n        return;\n    }\n    console.log(\"dnd-poly: starting dragimage snap back\");\n    const rect = sourceEl.getBoundingClientRect();\n    const pnt = {\n        x: rect.left,\n        y: rect.top\n    };\n    pnt.x += document.body.scrollLeft || document.documentElement.scrollLeft;\n    pnt.y += document.body.scrollTop || document.documentElement.scrollTop;\n    pnt.x -= parseInt(cs.marginLeft, 10);\n    pnt.y -= parseInt(cs.marginTop, 10);\n    const delayInS = parseFloat(csDragImage.transitionDelay);\n    const durationInMs = Math.round((durationInS + delayInS) * 1000);\n    translateElementToPoint(dragImage, pnt, dragImageTransforms, undefined, false);\n    setTimeout(transitionEndCb, durationInMs);\n}\n\nconst DataTransfer = (function() {\n    function DataTransfer(_dataStore, _setDragImageHandler) {\n        this._dataStore = _dataStore;\n        this._setDragImageHandler = _setDragImageHandler;\n        this._dropEffect = DROP_EFFECTS[0];\n    }\n    Object.defineProperty(DataTransfer.prototype, \"dropEffect\", {\n        get: function() {\n            return this._dropEffect;\n        },\n        set: function(value) {\n            if (this._dataStore.mode !== 0 && ALLOWED_EFFECTS.indexOf(value) > -1) {\n                this._dropEffect = value;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataTransfer.prototype, \"types\", {\n        get: function() {\n            if (this._dataStore.mode !== 0) {\n                return Object.freeze(this._dataStore.types);\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataTransfer.prototype, \"effectAllowed\", {\n        get: function() {\n            return this._dataStore.effectAllowed;\n        },\n        set: function(value) {\n            if (this._dataStore.mode === 2 && ALLOWED_EFFECTS.indexOf(value) > -1) {\n                this._dataStore.effectAllowed = value;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DataTransfer.prototype.setData = function(type, data) {\n        if (this._dataStore.mode === 2) {\n            if (type.indexOf(\" \") > -1) {\n                throw new Error(\"illegal arg: type contains space\");\n            }\n            this._dataStore.data[type] = data;\n            if (this._dataStore.types.indexOf(type) === -1) {\n                this._dataStore.types.push(type);\n            }\n        }\n    };\n    DataTransfer.prototype.getData = function(type) {\n        if (this._dataStore.mode === 1 || this._dataStore.mode === 2) {\n            return this._dataStore.data[type] || \"\";\n        }\n    };\n    DataTransfer.prototype.clearData = function(format) {\n        if (this._dataStore.mode === 2) {\n            if (format && this._dataStore.data[format]) {\n                delete this._dataStore.data[format];\n                const index = this._dataStore.types.indexOf(format);\n                if (index > -1) {\n                    this._dataStore.types.splice(index, 1);\n                }\n                return;\n            }\n            this._dataStore.data = {};\n            this._dataStore.types = [];\n        }\n    };\n    DataTransfer.prototype.setDragImage = function(image, x, y) {\n        if (this._dataStore.mode === 2) {\n            this._setDragImageHandler(image, x, y);\n        }\n    };\n    return DataTransfer;\n})();\n\nfunction tryFindDraggableTarget(event) {\n    let el = event.target;\n    do {\n        if (el.draggable === false) {\n            continue;\n        }\n        if (el.draggable === true) {\n            return el;\n        }\n        if (el.getAttribute && el.getAttribute(\"draggable\") === \"true\") {\n            return el;\n        }\n    } while ((el = el.parentNode) && el !== document.body);\n}\nfunction determineDropEffect(effectAllowed, sourceNode) {\n    if (!effectAllowed) {\n        if (sourceNode.nodeType === 3 && sourceNode.tagName === \"A\") {\n            return DROP_EFFECTS[3];\n        }\n        return DROP_EFFECTS[1];\n    }\n    if (effectAllowed === ALLOWED_EFFECTS[0]) {\n        return DROP_EFFECTS[0];\n    }\n    if (effectAllowed.indexOf(ALLOWED_EFFECTS[1]) === 0 || effectAllowed === ALLOWED_EFFECTS[7]) {\n        return DROP_EFFECTS[1];\n    }\n    if (effectAllowed.indexOf(ALLOWED_EFFECTS[4]) === 0) {\n        return DROP_EFFECTS[3];\n    }\n    if (effectAllowed === ALLOWED_EFFECTS[6]) {\n        return DROP_EFFECTS[2];\n    }\n    return DROP_EFFECTS[1];\n}\nfunction createDragEventFromTouch(targetElement, e, type, cancelable, window, dataTransfer, relatedTarget) {\n    if (relatedTarget === void 0) {\n        relatedTarget = null;\n    }\n    const touch = e.changedTouches[0];\n    const dndEvent = new Event(type, {\n        bubbles: true,\n        cancelable: cancelable\n    });\n    dndEvent.dataTransfer = dataTransfer;\n    dndEvent.relatedTarget = relatedTarget;\n    dndEvent.screenX = touch.screenX;\n    dndEvent.screenY = touch.screenY;\n    dndEvent.clientX = touch.clientX;\n    dndEvent.clientY = touch.clientY;\n    dndEvent.pageX = touch.pageX;\n    dndEvent.pageY = touch.pageY;\n    const targetRect = targetElement.getBoundingClientRect();\n    dndEvent.offsetX = dndEvent.clientX - targetRect.left;\n    dndEvent.offsetY = dndEvent.clientY - targetRect.top;\n    return dndEvent;\n}\nfunction dispatchDragEvent(dragEvent, targetElement, touchEvent, dataStore, dataTransfer, cancelable, relatedTarget) {\n    if (cancelable === void 0) {\n        cancelable = true;\n    }\n    if (relatedTarget === void 0) {\n        relatedTarget = null;\n    }\n    console.log(\"dnd-poly: dispatching \" + dragEvent);\n    const leaveEvt = createDragEventFromTouch(targetElement, touchEvent, dragEvent, cancelable, document.defaultView, dataTransfer, relatedTarget);\n    const cancelled = !targetElement.dispatchEvent(leaveEvt);\n    dataStore.mode = 0;\n    return cancelled;\n}\nfunction determineDragOperation(effectAllowed, dropEffect) {\n    if (!effectAllowed || effectAllowed === ALLOWED_EFFECTS[7]) {\n        return dropEffect;\n    }\n    if (dropEffect === DROP_EFFECTS[1]) {\n        if (effectAllowed.indexOf(DROP_EFFECTS[1]) === 0) {\n            return DROP_EFFECTS[1];\n        }\n    } else if (dropEffect === DROP_EFFECTS[3]) {\n        if (effectAllowed.indexOf(DROP_EFFECTS[3]) === 0 || effectAllowed.indexOf(\"Link\") > -1) {\n            return DROP_EFFECTS[3];\n        }\n    } else if (dropEffect === DROP_EFFECTS[2]) {\n        if (effectAllowed.indexOf(DROP_EFFECTS[2]) === 0 || effectAllowed.indexOf(\"Move\") > -1) {\n            return DROP_EFFECTS[2];\n        }\n    }\n    return DROP_EFFECTS[0];\n}\n\nconst DragOperationController = (function() {\n    function DragOperationController(_initialEvent, _config, _sourceNode, _dragOperationEndedCb) {\n        this._initialEvent = _initialEvent;\n        this._config = _config;\n        this._sourceNode = _sourceNode;\n        this._dragOperationEndedCb = _dragOperationEndedCb;\n        this._dragOperationState = 0;\n        this._immediateUserSelection = null;\n        this._currentDropTarget = null;\n        console.log(\"dnd-poly: setting up potential drag operation..\");\n        this._lastTouchEvent = _initialEvent;\n        this._initialTouch = _initialEvent.changedTouches[0];\n        this._touchMoveHandler = this._onTouchMove.bind(this);\n        this._touchEndOrCancelHandler = this._onTouchEndOrCancel.bind(this);\n        addDocumentListener(\"touchmove\", this._touchMoveHandler, false);\n        addDocumentListener(\"touchend\", this._touchEndOrCancelHandler, false);\n        addDocumentListener(\"touchcancel\", this._touchEndOrCancelHandler, false);\n    }\n    DragOperationController.prototype._setup = function() {\n        const _this = this;\n        console.log(\"dnd-poly: starting drag and drop operation\");\n        this._dragOperationState = 1;\n        this._currentDragOperation = DROP_EFFECTS[0];\n        this._dragDataStore = {\n            data: {},\n            effectAllowed: undefined,\n            mode: 3,\n            types: []\n        };\n        this._currentHotspotCoordinates = {\n            x: null,\n            y: null\n        };\n        this._dragImagePageCoordinates = {\n            x: null,\n            y: null\n        };\n        let dragImageSrc = this._sourceNode;\n        this._dataTransfer = new DataTransfer(this._dragDataStore, function(element, x, y) {\n            dragImageSrc = element;\n            if (typeof x === \"number\" || typeof y === \"number\") {\n                _this._dragImageOffset = {\n                    x: x || 0,\n                    y: y || 0\n                };\n            }\n        });\n        this._dragDataStore.mode = 2;\n        this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n        if (dispatchDragEvent(\"dragstart\", this._sourceNode, this._lastTouchEvent, this._dragDataStore, this._dataTransfer)) {\n            console.log(\"dnd-poly: dragstart cancelled\");\n            this._dragOperationState = 3;\n            this._cleanup();\n            return false;\n        }\n        updateCentroidCoordinatesOfTouchesIn(\"page\", this._lastTouchEvent, this._dragImagePageCoordinates);\n        const dragImage = this._config.dragImageSetup(dragImageSrc);\n        this._dragImageTransforms = extractTransformStyles(dragImage);\n        dragImage.style.position = \"absolute\";\n        dragImage.style.left = \"0px\";\n        dragImage.style.top = \"0px\";\n        dragImage.style.zIndex = \"999999\";\n        dragImage.classList.add(CLASS_DRAG_IMAGE);\n        dragImage.classList.add(CLASS_DRAG_OPERATION_ICON);\n        this._dragImage = dragImage;\n        if (!this._dragImageOffset) {\n            if (this._config.dragImageOffset) {\n                this._dragImageOffset = {\n                    x: this._config.dragImageOffset.x,\n                    y: this._config.dragImageOffset.y\n                };\n            } else if (this._config.dragImageCenterOnTouch) {\n                const cs = getComputedStyle(dragImageSrc);\n                this._dragImageOffset = {\n                    x: 0 - parseInt(cs.marginLeft, 10),\n                    y: 0 - parseInt(cs.marginTop, 10)\n                };\n            } else {\n                const targetRect = dragImageSrc.getBoundingClientRect();\n                const cs = getComputedStyle(dragImageSrc);\n                this._dragImageOffset = {\n                    x: targetRect.left - this._initialTouch.clientX - parseInt(cs.marginLeft, 10) + targetRect.width / 2,\n                    y: targetRect.top - this._initialTouch.clientY - parseInt(cs.marginTop, 10) + targetRect.height / 2\n                };\n            }\n        }\n        translateElementToPoint(this._dragImage, this._dragImagePageCoordinates, this._dragImageTransforms, this._dragImageOffset, this._config.dragImageCenterOnTouch);\n        document.body.appendChild(this._dragImage);\n        this._iterationIntervalId = window.setInterval(function() {\n            if (_this._iterationLock) {\n                console.log(\"dnd-poly: iteration skipped because previous iteration hast not yet finished.\");\n                return;\n            }\n            _this._iterationLock = true;\n            _this._dragAndDropProcessModelIteration();\n            _this._iterationLock = false;\n        }, this._config.iterationInterval);\n        return true;\n    };\n    DragOperationController.prototype._cleanup = function() {\n        console.log(\"dnd-poly: cleanup\");\n        if (this._iterationIntervalId) {\n            clearInterval(this._iterationIntervalId);\n            this._iterationIntervalId = null;\n        }\n        removeDocumentListener(\"touchmove\", this._touchMoveHandler);\n        removeDocumentListener(\"touchend\", this._touchEndOrCancelHandler);\n        removeDocumentListener(\"touchcancel\", this._touchEndOrCancelHandler);\n        if (this._dragImage) {\n            this._dragImage.parentNode.removeChild(this._dragImage);\n            this._dragImage = null;\n        }\n        this._dragOperationEndedCb(this._config, this._lastTouchEvent, this._dragOperationState);\n    };\n    DragOperationController.prototype._onTouchMove = function(event) {\n        const _this = this;\n        if (isTouchIdentifierContainedInTouchEvent(event, this._initialTouch.identifier) === false) {\n            return;\n        }\n        this._lastTouchEvent = event;\n        if (this._dragOperationState === 0) {\n            let startDrag = void 0;\n            if (this._config.dragStartConditionOverride) {\n                try {\n                    startDrag = this._config.dragStartConditionOverride(event);\n                } catch (e) {\n                    console.error(\"dnd-poly: error in dragStartConditionOverride hook: \" + e);\n                    startDrag = false;\n                }\n            } else {\n                startDrag = event.touches.length === 1;\n            }\n            if (!startDrag) {\n                this._cleanup();\n                return;\n            }\n            if (this._setup() === true) {\n                this._initialEvent.preventDefault();\n                event.preventDefault();\n            }\n            return;\n        }\n        console.log(\"dnd-poly: moving draggable..\");\n        event.preventDefault();\n        updateCentroidCoordinatesOfTouchesIn(\"client\", event, this._currentHotspotCoordinates);\n        updateCentroidCoordinatesOfTouchesIn(\"page\", event, this._dragImagePageCoordinates);\n        if (this._config.dragImageTranslateOverride) {\n            try {\n                let handledDragImageTranslate_1 = false;\n                this._config.dragImageTranslateOverride(\n                    event,\n                    {\n                        x: this._currentHotspotCoordinates.x,\n                        y: this._currentHotspotCoordinates.y\n                    },\n                    this._immediateUserSelection,\n                    function(offsetX, offsetY) {\n                        if (!_this._dragImage) {\n                            return;\n                        }\n                        handledDragImageTranslate_1 = true;\n                        _this._currentHotspotCoordinates.x += offsetX;\n                        _this._currentHotspotCoordinates.y += offsetY;\n                        _this._dragImagePageCoordinates.x += offsetX;\n                        _this._dragImagePageCoordinates.y += offsetY;\n                        translateElementToPoint(_this._dragImage, _this._dragImagePageCoordinates, _this._dragImageTransforms, _this._dragImageOffset, _this._config.dragImageCenterOnTouch);\n                    }\n                );\n                if (handledDragImageTranslate_1) {\n                    return;\n                }\n            } catch (e) {\n                console.log(\"dnd-poly: error in dragImageTranslateOverride hook: \" + e);\n            }\n        }\n        translateElementToPoint(this._dragImage, this._dragImagePageCoordinates, this._dragImageTransforms, this._dragImageOffset, this._config.dragImageCenterOnTouch);\n    };\n    DragOperationController.prototype._onTouchEndOrCancel = function(event) {\n        if (isTouchIdentifierContainedInTouchEvent(event, this._initialTouch.identifier) === false) {\n            return;\n        }\n        if (this._config.dragImageTranslateOverride) {\n            try {\n                this._config.dragImageTranslateOverride(undefined, undefined, undefined, function() {});\n            } catch (e) {\n                console.log(\"dnd-poly: error in dragImageTranslateOverride hook: \" + e);\n            }\n        }\n        if (this._dragOperationState === 0) {\n            this._cleanup();\n            return;\n        }\n        event.preventDefault();\n        this._dragOperationState = event.type === \"touchcancel\" ? 3 : 2;\n    };\n    DragOperationController.prototype._dragAndDropProcessModelIteration = function() {\n        const _this = this;\n        const previousDragOperation = this._currentDragOperation;\n        this._dragDataStore.mode = 3;\n        this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n        const dragCancelled = dispatchDragEvent(\"drag\", this._sourceNode, this._lastTouchEvent, this._dragDataStore, this._dataTransfer);\n        if (dragCancelled) {\n            console.log(\"dnd-poly: drag event cancelled.\");\n            this._currentDragOperation = DROP_EFFECTS[0];\n        }\n        if (dragCancelled || this._dragOperationState === 2 || this._dragOperationState === 3) {\n            const dragFailed = this._dragOperationEnded(this._dragOperationState);\n            if (dragFailed) {\n                applyDragImageSnapback(this._sourceNode, this._dragImage, this._dragImageTransforms, function() {\n                    _this._finishDragOperation();\n                });\n                return;\n            }\n            this._finishDragOperation();\n            return;\n        }\n        const newUserSelection = this._config.elementFromPoint(this._currentHotspotCoordinates.x, this._currentHotspotCoordinates.y);\n        console.log(\"dnd-poly: new immediate user selection is: \" + newUserSelection);\n        const previousTargetElement = this._currentDropTarget;\n        if (newUserSelection !== this._immediateUserSelection && newUserSelection !== this._currentDropTarget) {\n            this._immediateUserSelection = newUserSelection;\n            if (this._currentDropTarget !== null) {\n                this._dragDataStore.mode = 3;\n                this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n                dispatchDragEvent(\"dragexit\", this._currentDropTarget, this._lastTouchEvent, this._dragDataStore, this._dataTransfer, false);\n            }\n            if (this._immediateUserSelection === null) {\n                this._currentDropTarget = this._immediateUserSelection;\n                console.log(\"dnd-poly: current drop target changed to null\");\n            } else {\n                this._dragDataStore.mode = 3;\n                this._dataTransfer.dropEffect = determineDropEffect(this._dragDataStore.effectAllowed, this._sourceNode);\n                if (dispatchDragEvent(\"dragenter\", this._immediateUserSelection, this._lastTouchEvent, this._dragDataStore, this._dataTransfer)) {\n                    console.log(\"dnd-poly: dragenter default prevented\");\n                    this._currentDropTarget = this._immediateUserSelection;\n                    this._currentDragOperation = determineDragOperation(this._dataTransfer.effectAllowed, this._dataTransfer.dropEffect);\n                } else {\n                    if (this._immediateUserSelection !== document.body) {\n                        this._currentDropTarget = document.body;\n                    }\n                }\n            }\n        }\n        if (previousTargetElement !== this._currentDropTarget && isDOMElement(previousTargetElement)) {\n            console.log(\"dnd-poly: current drop target changed.\");\n            this._dragDataStore.mode = 3;\n            this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n            dispatchDragEvent(\"dragleave\", previousTargetElement, this._lastTouchEvent, this._dragDataStore, this._dataTransfer, false, this._currentDropTarget);\n        }\n        if (isDOMElement(this._currentDropTarget)) {\n            this._dragDataStore.mode = 3;\n            this._dataTransfer.dropEffect = determineDropEffect(this._dragDataStore.effectAllowed, this._sourceNode);\n            if (dispatchDragEvent(\"dragover\", this._currentDropTarget, this._lastTouchEvent, this._dragDataStore, this._dataTransfer) === false) {\n                console.log(\"dnd-poly: dragover not prevented on possible drop-target.\");\n                this._currentDragOperation = DROP_EFFECTS[0];\n            } else {\n                console.log(\"dnd-poly: dragover prevented.\");\n                this._currentDragOperation = determineDragOperation(this._dataTransfer.effectAllowed, this._dataTransfer.dropEffect);\n            }\n        }\n        console.log(\"dnd-poly: d'n'd iteration ended. current drag operation: \" + this._currentDragOperation);\n        if (previousDragOperation !== this._currentDragOperation) {\n            this._dragImage.classList.remove(CLASS_PREFIX + previousDragOperation);\n        }\n        const currentDragOperationClass = CLASS_PREFIX + this._currentDragOperation;\n        this._dragImage.classList.add(currentDragOperationClass);\n    };\n    DragOperationController.prototype._dragOperationEnded = function(state) {\n        console.log(\"dnd-poly: drag operation end detected with \" + this._currentDragOperation);\n        const dragFailed = this._currentDragOperation === DROP_EFFECTS[0] || this._currentDropTarget === null || state === 3;\n        if (dragFailed) {\n            if (isDOMElement(this._currentDropTarget)) {\n                this._dragDataStore.mode = 3;\n                this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n                dispatchDragEvent(\"dragleave\", this._currentDropTarget, this._lastTouchEvent, this._dragDataStore, this._dataTransfer, false);\n            }\n        } else {\n            if (isDOMElement(this._currentDropTarget)) {\n                this._dragDataStore.mode = 1;\n                this._dataTransfer.dropEffect = this._currentDragOperation;\n                if (dispatchDragEvent(\"drop\", this._currentDropTarget, this._lastTouchEvent, this._dragDataStore, this._dataTransfer) === true) {\n                    this._currentDragOperation = this._dataTransfer.dropEffect;\n                } else {\n                    this._currentDragOperation = DROP_EFFECTS[0];\n                }\n            }\n        }\n        return dragFailed;\n    };\n    DragOperationController.prototype._finishDragOperation = function() {\n        console.log(\"dnd-poly: dragimage snap back transition ended\");\n        this._dragDataStore.mode = 3;\n        this._dataTransfer.dropEffect = this._currentDragOperation;\n        dispatchDragEvent(\"dragend\", this._sourceNode, this._lastTouchEvent, this._dragDataStore, this._dataTransfer, false);\n        this._dragOperationState = 2;\n        this._cleanup();\n    };\n    return DragOperationController;\n})();\n\nconst config = {\n    iterationInterval: 150,\n    tryFindDraggableTarget: tryFindDraggableTarget,\n    dragImageSetup: createDragImage,\n    elementFromPoint: function(x, y) {\n        return document.elementFromPoint(x, y);\n    }\n};\nlet activeDragOperation;\nfunction onTouchstart(e, composePath) {\n    console.log(\"dnd-poly: global touchstart\");\n    if (activeDragOperation) {\n        console.log(\"dnd-poly: drag operation already active\");\n        return;\n    }\n    const dragTarget = config.tryFindDraggableTarget(e, composePath);\n    if (!dragTarget) {\n        console.log(\"dnd-poly: no draggable at touchstart coordinates\");\n        return;\n    }\n    try {\n        activeDragOperation = new DragOperationController(e, config, dragTarget, dragOperationEnded);\n    } catch (err) {\n        dragOperationEnded(config, e, 3);\n        throw err;\n    }\n}\nfunction onDelayTouchstart(evt) {\n    console.log(\"dnd-poly: setup delayed dragstart..\");\n    const el = evt.target;\n    const composePath = evt.composedPath();\n    const heldItem = function() {\n        console.log(\"dnd-poly: starting delayed drag..\");\n        end.off();\n        cancel.off();\n        move.off();\n        scroll.off();\n        onTouchstart(evt, composePath);\n    };\n    const onReleasedItem = function(event) {\n        console.log(\"dnd-poly: aborting delayed drag because of \" + event.type);\n        end.off();\n        cancel.off();\n        move.off();\n        scroll.off();\n        if (el) {\n            el.dispatchEvent(new CustomEvent(EVENT_DRAG_DRAGSTART_CANCEL, {bubbles: true, cancelable: true}));\n        }\n        clearTimeout(timer);\n    };\n    if (el) {\n        el.dispatchEvent(new CustomEvent(EVENT_DRAG_DRAGSTART_PENDING, {bubbles: true, cancelable: true}));\n    }\n    const timer = window.setTimeout(heldItem, config.holdToDrag);\n    const end = onEvt(el, \"touchend\", onReleasedItem);\n    const cancel = onEvt(el, \"touchcancel\", onReleasedItem);\n    const move = onEvt(el, \"touchmove\", onReleasedItem);\n    const scroll = onEvt(window, \"scroll\", onReleasedItem, true);\n}\n\nfunction dragOperationEnded(_config, event, state) {\n    if (state === 0) {\n        console.log(\"dnd-poly: Drag never started. Last event was \" + event.type);\n        if (_config.defaultActionOverride) {\n            try {\n                _config.defaultActionOverride(event);\n                if (event.defaultPrevented) {\n                    console.log(\"dnd-poly: defaultActionOverride has taken care of triggering the default action. preventing default on original event\");\n                }\n            } catch (e) {\n                console.log(\"dnd-poly: error in defaultActionOverride: \" + e);\n            }\n        }\n    }\n    activeDragOperation = null;\n}\n\nfunction polyfill(override) {\n    if (override) {\n        Object.keys(override).forEach(function(key) {\n            config[key] = override[key];\n        });\n    }\n    if (!config.forceApply) {\n        const detectedFeatures = detectFeatures();\n        if (detectedFeatures.userAgentSupportingNativeDnD && detectedFeatures.draggable && detectedFeatures.dragEvents) {\n            return false;\n        }\n    }\n    console.log(\"dnd-poly: Applying mobile drag and drop polyfill.\");\n    if (config.holdToDrag) {\n        console.log(\"dnd-poly: holdToDrag set to \" + config.holdToDrag);\n        addDocumentListener(\"touchstart\", onDelayTouchstart, false);\n    } else {\n        addDocumentListener(\"touchstart\", onTouchstart, false);\n    }\n    return true;\n}\n\nfunction tryFindDraggableTarget_override(event, composePath) {\n    const cp = composePath || event.composedPath();\n    for (let o of cp) {\n        let el = o;\n        do {\n            if (el.draggable === false) {\n                continue;\n            }\n            if (el.getAttribute && el.getAttribute(\"draggable\") === \"true\") {\n                return el;\n            }\n        } while ((el = el.parentNode) && el !== document.body);\n    }\n}\n\nfunction elementFromPoint(x, y) {\n    for (let o of this._path) {\n        if (o.elementFromPoint) {\n            let el = o.elementFromPoint(x, y);\n            if (el) {\n                while (el.shadowRoot) {\n                    el = el.shadowRoot.elementFromPoint(x, y);\n                }\n                return el;\n            }\n        }\n    }\n}\n\nfunction dragStartConditionOverride(event) {\n    this._path = event.composedPath();\n    return true;\n}\n\npolyfill({\n    tryFindDraggableTarget: tryFindDraggableTarget_override,\n    elementFromPoint: elementFromPoint,\n    dragStartConditionOverride: dragStartConditionOverride,\n    holdToDrag: 500\n});\n","module.exports = __WEBPACK_EXTERNAL_MODULE__25__;","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nimport debounce from \"lodash/debounce\";\r\n\r\nimport Awesomplete from \"awesomplete\";\r\nimport awesomplete_style from \"!!css-loader!awesomplete/awesomplete.css\";\r\n\r\nimport {bindTemplate} from \"./utils.js\";\r\n\r\nimport perspective from \"@finos/perspective\";\r\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\r\nimport template from \"../html/row.html\";\r\n\r\nimport style from \"../less/row.less\";\r\nimport {html, render, nothing} from \"lit-html\";\r\n\r\nconst SPAN = document.createElement(\"span\");\r\nSPAN.style.visibility = \"hidden\";\r\nSPAN.style.fontFamily = \"monospace\";\r\nSPAN.style.fontSize = \"12px\";\r\nSPAN.style.position = \"absolute\";\r\n\r\nfunction get_text_width(text, max = 0) {\r\n    // FIXME get these values form the stylesheet\r\n    SPAN.innerHTML = text;\r\n    document.body.appendChild(SPAN);\r\n    const width = `${Math.max(max, SPAN.offsetWidth) + 20}px`;\r\n    document.body.removeChild(SPAN);\r\n    return width;\r\n}\r\n\r\n// Eslint complains here because we don't do anything, but actually we globally\r\n// register this class as a CustomElement\r\n@bindTemplate(template, {toString: () => style + \"\\n\" + awesomplete_style}) // eslint-disable-next-line no-unused-vars\r\nclass Row extends HTMLElement {\r\n    set name(n) {\r\n        const elem = this.shadowRoot.querySelector(\"#name\");\r\n        elem.innerHTML = this.getAttribute(\"name\");\r\n    }\r\n\r\n    _option_template(agg, name) {\r\n        return html`\r\n            <option value=\"${agg}\" data-desc=\"${name}\">${name || agg}</option>\r\n        `;\r\n    }\r\n\r\n    _select_template(category, type) {\r\n        const items = perspective[category][type] || [];\r\n        const weighted_options = html`\r\n            <optgroup label=\"weighted mean\">\r\n                ${this._weights.map(x => this._option_template(JSON.stringify([\"weighted mean\", x]), x))}\r\n            </optgroup>\r\n        `;\r\n        const has_weighted_mean = category === \"TYPE_AGGREGATES\" && (type === \"integer\" || type === \"float\");\r\n        return html`\r\n            ${items.map(x => this._option_template(x))} ${has_weighted_mean ? weighted_options : nothing}\r\n        `;\r\n    }\r\n\r\n    set_weights(xs) {\r\n        this._weights = xs;\r\n    }\r\n\r\n    set type(t) {\r\n        const elem = this.shadowRoot.querySelector(\"#name\");\r\n        const type = this.getAttribute(\"type\");\r\n        if (!type) return;\r\n        const type_config = get_type_config(type);\r\n        if (type_config.type) {\r\n            elem.classList.add(type_config.type);\r\n        }\r\n        elem.classList.add(type);\r\n        const agg_dropdown = this.shadowRoot.querySelector(\"#column_aggregate\");\r\n        const filter_dropdown = this.shadowRoot.querySelector(\"#filter_operator\");\r\n\r\n        render(this._select_template(\"TYPE_AGGREGATES\", type_config.type || type), agg_dropdown);\r\n        render(this._select_template(\"TYPE_FILTERS\", type_config.type || type), filter_dropdown);\r\n\r\n        if (!this.hasAttribute(\"aggregate\")) {\r\n            this.aggregate = type_config.aggregate;\r\n        } else {\r\n            this.aggregate = this.getAttribute(\"aggregate\");\r\n        }\r\n        if (this.hasAttribute(\"filter\")) {\r\n            this.filter = this.getAttribute(\"filter\");\r\n        }\r\n\r\n        const filter_operand = this.shadowRoot.querySelector(\"#filter_operand\");\r\n        this._callback = event => this._update_filter(event);\r\n        filter_operand.addEventListener(\"keyup\", this._callback.bind(this));\r\n    }\r\n\r\n    choices(choices) {\r\n        const filter_operand = this.shadowRoot.querySelector(\"#filter_operand\");\r\n        const filter_operator = this.shadowRoot.querySelector(\"#filter_operator\");\r\n        const selector = new Awesomplete(filter_operand, {\r\n            label: this.getAttribute(\"name\"),\r\n            list: choices,\r\n            minChars: 0,\r\n            autoFirst: true,\r\n            filter: function(text, input) {\r\n                return Awesomplete.FILTER_CONTAINS(text, input.match(/[^,]*$/)[0]);\r\n            },\r\n            item: function(text, input) {\r\n                return Awesomplete.ITEM(text, input.match(/[^,]*$/)[0]);\r\n            },\r\n            replace: function(text) {\r\n                const before = this.input.value.match(/^.+,\\s*|/)[0];\r\n                if (filter_operator.value === \"in\" || filter_operator.value === \"not in\") {\r\n                    this.input.value = before + text + \", \";\r\n                } else {\r\n                    this.input.value = before + text;\r\n                }\r\n            }\r\n        });\r\n        if (filter_operand.value === \"\") {\r\n            selector.evaluate();\r\n        }\r\n        filter_operand.focus();\r\n        this._filter_operand.addEventListener(\"focus\", () => {\r\n            if (filter_operand.value.trim().length === 0) {\r\n                selector.evaluate();\r\n            }\r\n        });\r\n        filter_operand.addEventListener(\"awesomplete-selectcomplete\", this._callback);\r\n    }\r\n\r\n    set filter(f) {\r\n        const filter_dropdown = this.shadowRoot.querySelector(\"#filter_operator\");\r\n        const filter = JSON.parse(this.getAttribute(\"filter\"));\r\n        if (filter_dropdown.value !== filter.operator) {\r\n            filter_dropdown.value = filter.operator || get_type_config(this.getAttribute(\"type\")).filter_operator;\r\n        }\r\n        filter_dropdown.style.width = get_text_width(filter_dropdown.value);\r\n        const filter_input = this.shadowRoot.querySelector(\"#filter_operand\");\r\n        const operand = filter.operand ? filter.operand.toString() : \"\";\r\n        if (!this._initialized) {\r\n            filter_input.value = operand;\r\n        }\r\n        if (filter_dropdown.value === perspective.FILTER_OPERATORS.isNull || filter_dropdown.value === perspective.FILTER_OPERATORS.isNotNull) {\r\n            filter_input.style.display = \"none\";\r\n        } else {\r\n            filter_input.style.display = \"inline-block\";\r\n            filter_input.style.width = get_text_width(operand, 30);\r\n        }\r\n    }\r\n\r\n    set aggregate(a) {\r\n        const agg_dropdown = this.shadowRoot.querySelector(\"#column_aggregate\");\r\n        const aggregate = this.getAttribute(\"aggregate\");\r\n        if (agg_dropdown.value !== aggregate && this.hasAttribute(\"type\")) {\r\n            const type = this.getAttribute(\"type\");\r\n            agg_dropdown.value = aggregate || get_type_config(type).aggregate;\r\n        }\r\n        this._blur_agg_dropdown();\r\n    }\r\n\r\n    set computed_column(c) {\r\n        // const data = this._get_computed_data();\r\n        // const computed_input_column =\r\n        //    this.shadowRoot.querySelector('#computed_input_column');\r\n        // const computation_name =\r\n        //    this.shadowRoot.querySelector('#computation_name');\r\n        // computation_name.textContent = data.computation.name;\r\n        // computed_input_column.textContent = data.input_column;\r\n    }\r\n\r\n    _get_computed_data() {\r\n        const data = JSON.parse(this.getAttribute(\"computed_column\"));\r\n        return {\r\n            column_name: data.column_name,\r\n            input_columns: data.input_columns,\r\n            input_type: data.input_type,\r\n            computation: data.computation,\r\n            type: data.type\r\n        };\r\n    }\r\n\r\n    _update_filter(event) {\r\n        const filter_operand = this.shadowRoot.querySelector(\"#filter_operand\");\r\n        const filter_operator = this.shadowRoot.querySelector(\"#filter_operator\");\r\n        let val = filter_operand.value;\r\n        const type = this.getAttribute(\"type\");\r\n        switch (type) {\r\n            case \"float\":\r\n                val = parseFloat(val);\r\n                break;\r\n            case \"integer\":\r\n                val = parseInt(val);\r\n                break;\r\n            case \"boolean\":\r\n                val = val.toLowerCase().indexOf(\"true\") > -1;\r\n                break;\r\n            case \"string\":\r\n            default:\r\n        }\r\n        if (filter_operator.value === perspective.FILTER_OPERATORS.isIn || filter_operator.value === perspective.FILTER_OPERATORS.isNotIn) {\r\n            val = val.split(\",\").map(x => x.trim());\r\n        }\r\n        this.setAttribute(\"filter\", JSON.stringify({operator: filter_operator.value, operand: val}));\r\n        this.dispatchEvent(new CustomEvent(\"filter-selected\", {detail: event}));\r\n    }\r\n\r\n    _set_data_transfer(event) {\r\n        if (this.hasAttribute(\"filter\")) {\r\n            const {operator, operand} = JSON.parse(this.getAttribute(\"filter\"));\r\n            event.dataTransfer.setData(\"text\", JSON.stringify([this.getAttribute(\"name\"), operator, operand, this.getAttribute(\"type\"), this.getAttribute(\"aggregate\")]));\r\n        } else {\r\n            event.dataTransfer.setData(\r\n                \"text\",\r\n                JSON.stringify([this.getAttribute(\"name\"), get_type_config(this.getAttribute(\"type\")).filter_operator, undefined, this.getAttribute(\"type\"), this.getAttribute(\"aggregate\")])\r\n            );\r\n        }\r\n        this.dispatchEvent(new CustomEvent(\"row-drag\"));\r\n    }\r\n\r\n    _register_ids() {\r\n        this._li = this.shadowRoot.querySelector(\".row_draggable\");\r\n        this._visible = this.shadowRoot.querySelector(\".is_visible\");\r\n        this._row_close = this.shadowRoot.querySelector(\"#row_close\");\r\n        this._agg_dropdown = this.shadowRoot.querySelector(\"#column_aggregate\");\r\n        this._sort_order = this.shadowRoot.querySelector(\"#sort_order\");\r\n        this._filter_operand = this.shadowRoot.querySelector(\"#filter_operand\");\r\n        this._filter_operator = this.shadowRoot.querySelector(\"#filter_operator\");\r\n        this._edit_computed_column_button = this.shadowRoot.querySelector(\"#row_edit\");\r\n        this._column_aggregate_category = this.shadowRoot.querySelector(\"#column_aggregate_category\");\r\n    }\r\n\r\n    _blur_agg_dropdown() {\r\n        this._agg_dropdown.blur();\r\n        if (this._agg_dropdown.value[0] === \"[\") {\r\n            for (const option of this._agg_dropdown.querySelectorAll(\"optgroup option\")) {\r\n                const name = option.getAttribute(\"data-desc\");\r\n                option.innerHTML = `mean by ${name}`;\r\n            }\r\n        }\r\n    }\r\n\r\n    _focus_agg_dropdown() {\r\n        for (const option of this._agg_dropdown.querySelectorAll(\"optgroup option\")) {\r\n            const name = option.getAttribute(\"data-desc\");\r\n            option.innerHTML = `by ${name}`;\r\n        }\r\n    }\r\n\r\n    _register_callbacks() {\r\n        this._li.addEventListener(\"dragstart\", this._set_data_transfer.bind(this));\r\n        this._li.addEventListener(\"dragend\", () => {\r\n            this.dispatchEvent(new CustomEvent(\"row-dragend\"));\r\n        });\r\n        this._visible.addEventListener(\"mousedown\", event => this.dispatchEvent(new CustomEvent(\"visibility-clicked\", {detail: event})));\r\n        this._row_close.addEventListener(\"mousedown\", event => this.dispatchEvent(new CustomEvent(\"close-clicked\", {detail: event})));\r\n        this._agg_dropdown.addEventListener(\"focus\", this._focus_agg_dropdown.bind(this));\r\n\r\n        this._agg_dropdown.addEventListener(\"change\", event => {\r\n            this._blur_agg_dropdown();\r\n            const value = this._agg_dropdown.value;\r\n            this.setAttribute(\"aggregate\", value);\r\n            this.dispatchEvent(new CustomEvent(\"aggregate-selected\", {detail: event}));\r\n        });\r\n        this._sort_order.addEventListener(\"click\", event => {\r\n            this.dispatchEvent(new CustomEvent(\"sort-order\", {detail: event}));\r\n        });\r\n\r\n        const debounced_filter = debounce(event => this._update_filter(event), 50);\r\n        this._filter_operator.addEventListener(\"change\", () => {\r\n            this._filter_operand.focus();\r\n            this._filter_operator.style.width = get_text_width(this._filter_operator.value);\r\n            const filter_input = this.shadowRoot.querySelector(\"#filter_operand\");\r\n            filter_input.style.width = get_text_width(\"\" + this._filter_operand.value, 30);\r\n            debounced_filter();\r\n        });\r\n        this._edit_computed_column_button.addEventListener(\"click\", () => {\r\n            this.dispatchEvent(\r\n                new CustomEvent(\"perspective-computed-column-edit\", {\r\n                    bubbles: true,\r\n                    detail: this._get_computed_data()\r\n                })\r\n            );\r\n        });\r\n    }\r\n\r\n    connectedCallback() {\r\n        this._register_ids();\r\n        this._register_callbacks();\r\n    }\r\n}\r\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nconst token_name_to_display_name = {\n    columnName: \"column name\",\n    leftParen: \"(\",\n    rightParen: \")\",\n    add: \"+\",\n    subtract: \"-\",\n    multiply: \"*\",\n    divide: \"/\",\n    percent_of: \"%\"\n};\n\nconst actual_token_to_string = token => {\n    let actual;\n    if (Array.isArray(token)) {\n        actual = token\n            .filter(x => x.tokenType.name !== \"EOF\")\n            .map(x => {\n                if (x.payload) {\n                    return x.payload;\n                } else {\n                    return x.image;\n                }\n            });\n    } else {\n        actual = token.payload ? token.payload : token.image;\n    }\n\n    if (!actual || actual.length === 0) {\n        actual = \"EOF\";\n    }\n\n    return actual;\n};\n\n/**\n * A custom error message provider for the Lexer.\n */\nexport const PerspectiveLexerErrorMessage = {\n    /**\n     * Builds an error message to be displayed when the Lexer finds an\n     * unexpected character that cannot be matched.\n     *\n     * @param {*} fullText\n     * @param {*} startOffset\n     * @param {*} length\n     * @param {*} line\n     * @param {*} column\n     */\n    buildUnexpectedCharactersMessage: (fullText, startOffset, length, line, column) => {\n        return `Ln ${line}, Col ${column}: Unexpected input \\`${fullText}\\` at character ${startOffset}`;\n    }\n};\n\nexport const PerspectiveParserErrorMessage = {\n    /**\n     * Build an error message for when the parser is missing a mandatory token\n     * in a repetition, i.e. `pow2` is a function name, but it requires a `(`\n     * or column name to be syntactically correct.\n     */\n    buildEarlyExitMessage: options => {\n        let actual = actual_token_to_string(options.actual);\n\n        // A 2-dimensional array of expected paths\n        const expected_path_names = options.expectedIterationPaths.map(expected => {\n            let path = [];\n            expected.map(x => {\n                const name = \" - \" + token_name_to_display_name[x.name] ? token_name_to_display_name[x.name] : x.name;\n                path.push(name);\n            });\n            return path.join(\", \");\n        });\n        return `Unexpected token: \\`${actual}\\`\\n\\nExpected one of the following tokens: \\n ${expected_path_names.join(\"\\n\")}`;\n    },\n\n    /**\n     * Build an error message for when a token is mismatched, i.e. an opening\n     * parenthesis without a matching closing parenthesis.\n     */\n    buildMismatchTokenMessage: options => {\n        let actual = actual_token_to_string(options.actual);\n\n        let expected = options.expected.name;\n\n        if (token_name_to_display_name[expected]) {\n            expected = token_name_to_display_name[expected];\n        }\n\n        let message = `Expecting token \\`${expected}\\`, but found \\`${actual}\\`.`;\n\n        if (expected === \")\" || expected === \"rightParen\") {\n            message += \"\\n\\nMake sure all left parentheses are matched\\nwith right parentheses.\";\n        }\n\n        return message;\n    },\n\n    /**\n     * Build an error message for when a token does not fit into the grammar,\n     * i.e. if the expression does not begin with a column name, `(`, or\n     * any of the functional operators.\n     */\n    buildNoViableAltMessage: options => {\n        let actual = actual_token_to_string(options.actual);\n        let message = `Unexpected token: \\`${actual}\\`.`;\n\n        if (options.ruleName === \"Expression\") {\n            message += `\\n\\nExpected a column name, \\`(\\`,\\nor functional operator such as:\\n- \\`sqrt\\`\\n- \\`uppercase\\`\\n- \\`day_of_week\\``;\n        } else if (options.ruleName === \"ColumnName\") {\n            message += `\\n\\nExpected a column name or \\`(\\``;\n        } else if (options.ruleName === \"TerminalColumnName\") {\n            message += `\\n\\nExpected a column name after 'AS'`;\n        }\n\n        return message;\n    }\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {Lexer, createToken} from \"chevrotain\";\nimport {PerspectiveLexerErrorMessage} from \"./error\";\n\nexport const vocabulary = {};\n\n/**\n * Create token types to categorize computations:\n * - OperatorTokenType: operators that require left and right-hand side operands\n * - FunctionTokenType: operators that have 1...n comma separated parameters.\n */\nconst OperatorTokenType = createToken({\n    name: \"OperatorTokenType\",\n    pattern: Lexer.NA\n});\n\nconst FunctionTokenType = createToken({\n    name: \"FunctionTokenType\",\n    pattern: Lexer.NA\n});\n\nconst UpperLowerCaseTokenType = createToken({\n    name: \"UpperLowerTokenType\",\n    pattern: /(uppercase|lowercase)/\n});\n\n// Create tokens for column names and computed function names\nconst column_name_regex_pattern = /([\"'])(?<column_name>.*?[^\\\\])\\1/y;\n\n/**\n * Given a string from which to extract a column name, extract the column name\n * in-between the quotation marks and set it as the `payload` property. In the\n * CST visitor, use `.payload` to access the true column name value.\n *\n * @param {String} string\n * @param {Number} start_offset\n */\nconst match_column_name = function(string, start_offset) {\n    column_name_regex_pattern.lastIndex = start_offset;\n    const result = column_name_regex_pattern.exec(string);\n\n    if (result !== null) {\n        const full_match = result[0];\n        const quotes_removed = full_match.substr(1, full_match.length - 2);\n        result.payload = quotes_removed;\n    }\n\n    return result;\n};\n\n// Column names are always encased inside quotes.\nexport const ColumnName = createToken({\n    name: \"columnName\",\n    pattern: {exec: match_column_name},\n    line_breaks: false\n});\n\n// Allow users to specify custom names using `AS`\nexport const As = createToken({\n    name: \"as\",\n    pattern: /(AS|As|as)/,\n    longer_alt: UpperLowerCaseTokenType\n});\n\n// Mathematical operators, in the format \"x\" + \"y\"\n\nexport const Add = createToken({\n    name: \"add\",\n    pattern: /\\+/,\n    categories: [OperatorTokenType]\n});\n\nexport const Subtract = createToken({\n    name: \"subtract\",\n    pattern: /-/,\n    categories: [OperatorTokenType]\n});\n\nexport const Multiply = createToken({\n    name: \"multiply\",\n    pattern: /\\*/,\n    categories: [OperatorTokenType]\n});\n\nexport const Divide = createToken({\n    name: \"divide\",\n    pattern: /\\//,\n    categories: [OperatorTokenType]\n});\n\nexport const Pow = createToken({\n    name: \"pow\",\n    pattern: /\\^/,\n    categories: [OperatorTokenType]\n});\n\nexport const PercentOf = createToken({\n    name: \"percent_of\",\n    pattern: /\\%/,\n    categories: [OperatorTokenType]\n});\n\nexport const Equals = createToken({\n    name: \"equals\",\n    pattern: /\\==/,\n    categories: [OperatorTokenType]\n});\n\nexport const NotEquals = createToken({\n    name: \"not_equals\",\n    pattern: /\\!=/,\n    categories: [OperatorTokenType]\n});\n\nexport const GreaterThan = createToken({\n    name: \"greater_than\",\n    pattern: /\\>/,\n    categories: [OperatorTokenType]\n});\n\nexport const LessThan = createToken({\n    name: \"less_than\",\n    pattern: /\\</,\n    categories: [OperatorTokenType]\n});\n\nexport const Is = createToken({\n    name: \"is\",\n    pattern: /\\is/,\n    categories: [OperatorTokenType]\n});\n\n// Function operators, in the format func(\"x\")\nexport const Sqrt = createToken({\n    name: \"sqrt\",\n    pattern: /sqrt/,\n    categories: [FunctionTokenType]\n});\n\nexport const Pow2 = createToken({\n    name: \"pow2\",\n    pattern: /pow2/,\n    categories: [FunctionTokenType]\n});\n\nexport const Abs = createToken({\n    name: \"abs\",\n    pattern: /abs/,\n    categories: [FunctionTokenType]\n});\n\nexport const Invert = createToken({\n    name: \"invert\",\n    pattern: /invert/,\n    categories: [FunctionTokenType]\n});\n\nexport const Log = createToken({\n    name: \"log\",\n    pattern: /log/,\n    categories: [FunctionTokenType]\n});\n\nexport const Exp = createToken({\n    name: \"exp\",\n    pattern: /exp/,\n    categories: [FunctionTokenType]\n});\n\n// Bucketing functions\n\nexport const Bin10 = createToken({\n    name: \"bin10\",\n    pattern: /bin10/,\n    categories: [FunctionTokenType]\n});\n\nexport const Bin100 = createToken({\n    name: \"bin100\",\n    pattern: /bin100/,\n    categories: [FunctionTokenType]\n});\n\nexport const Bin1000 = createToken({\n    name: \"bin1000\",\n    pattern: /bin1000/,\n    categories: [FunctionTokenType]\n});\n\nexport const Bin10th = createToken({\n    name: \"bin10th\",\n    pattern: /bin10th/,\n    categories: [FunctionTokenType]\n});\n\nexport const Bin100th = createToken({\n    name: \"bin100th\",\n    pattern: /bin100th/,\n    categories: [FunctionTokenType]\n});\n\nexport const Bin1000th = createToken({\n    name: \"bin1000th\",\n    pattern: /bin1000th/,\n    categories: [FunctionTokenType]\n});\n\n// String functions\n\nexport const Length = createToken({\n    name: \"length\",\n    pattern: /length/,\n    categories: [FunctionTokenType]\n});\n\nexport const Lowercase = createToken({\n    name: \"lowercase\",\n    pattern: /lowercase/,\n    categories: [FunctionTokenType]\n});\n\nexport const Uppercase = createToken({\n    name: \"uppercase\",\n    pattern: /uppercase/,\n    categories: [FunctionTokenType]\n});\n\nexport const ConcatComma = createToken({\n    name: \"concat_comma\",\n    pattern: /concat_comma/,\n    categories: [FunctionTokenType]\n});\n\nexport const ConcatSpace = createToken({\n    name: \"concat_space\",\n    pattern: /concat_space/,\n    categories: [FunctionTokenType]\n});\n\n// Date functions\n\nexport const HourOfDay = createToken({\n    name: \"hour_of_day\",\n    pattern: /hour_of_day/,\n    categories: [FunctionTokenType]\n});\n\nexport const DayOfWeek = createToken({\n    name: \"day_of_week\",\n    pattern: /day_of_week/,\n    categories: [FunctionTokenType]\n});\n\nexport const MonthOfYear = createToken({\n    name: \"month_of_year\",\n    pattern: /month_of_year/,\n    categories: [FunctionTokenType]\n});\n\nexport const SecondBucket = createToken({\n    name: \"second_bucket\",\n    pattern: /second_bucket/,\n    categories: [FunctionTokenType]\n});\n\nexport const MinuteBucket = createToken({\n    name: \"minute_bucket\",\n    pattern: /minute_bucket/,\n    categories: [FunctionTokenType]\n});\n\nexport const HourBucket = createToken({\n    name: \"hour_bucket\",\n    pattern: /hour_bucket/\n});\n\nexport const DayBucket = createToken({\n    name: \"day_bucket\",\n    pattern: /day_bucket/,\n    categories: [FunctionTokenType]\n});\n\nexport const WeekBucket = createToken({\n    name: \"week_bucket\",\n    pattern: /week_bucket/,\n    categories: [FunctionTokenType]\n});\n\nexport const MonthBucket = createToken({\n    name: \"month_bucket\",\n    pattern: /month_bucket/,\n    categories: [FunctionTokenType]\n});\n\nexport const YearBucket = createToken({\n    name: \"year_bucket\",\n    pattern: /year_bucket/,\n    categories: [FunctionTokenType]\n});\n\n// Parenthesis\nexport const LeftParen = createToken({\n    name: \"leftParen\",\n    pattern: /\\(/\n});\n\nexport const RightParen = createToken({\n    name: \"rightParen\",\n    pattern: /\\)/\n});\n\n// Comma\nexport const Comma = createToken({\n    name: \"comma\",\n    pattern: /,/\n});\n\n// Whitespace\nexport const Whitespace = createToken({\n    name: \"whitespace\",\n    pattern: /\\s+/,\n    group: Lexer.SKIPPED\n});\n\n// Order of tokens is important\nconst tokens = [\n    Whitespace,\n    Comma,\n    As,\n    ColumnName,\n    LeftParen,\n    RightParen,\n    Add,\n    Subtract,\n    Multiply,\n    Divide,\n    Pow,\n    PercentOf,\n    Equals,\n    NotEquals,\n    GreaterThan,\n    LessThan,\n    Sqrt,\n    Pow2,\n    Abs,\n    Invert,\n    Log,\n    Exp,\n    Bin1000th,\n    Bin1000,\n    Bin100th,\n    Bin100,\n    Bin10th,\n    Bin10,\n    Length,\n    Is,\n    ConcatComma,\n    ConcatSpace,\n    Uppercase,\n    Lowercase,\n    HourOfDay,\n    DayOfWeek,\n    MonthOfYear,\n    SecondBucket,\n    MinuteBucket,\n    HourBucket,\n    DayBucket,\n    WeekBucket,\n    MonthBucket,\n    YearBucket,\n    UpperLowerCaseTokenType\n];\n\n// Add each token to the vocabulary exported for the Parser\ntokens.forEach(t => {\n    vocabulary[t.name] = t;\n});\n\nconst lexer = new Lexer(tokens, {\n    errorMessageProvider: PerspectiveLexerErrorMessage\n});\n\nexport const lex = function(input) {\n    const result = lexer.tokenize(input);\n\n    if (result.errors.length > 0) {\n        let message = result.errors.map(e => e.message);\n        throw new Error(`${message.join(\"\\n\")}`);\n    }\n\n    return result;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {CstParser} from \"chevrotain\";\nimport {\n    vocabulary,\n    Comma,\n    ColumnName,\n    As,\n    LeftParen,\n    RightParen,\n    Sqrt,\n    Pow2,\n    Abs,\n    Invert,\n    Log,\n    Exp,\n    Add,\n    Subtract,\n    Multiply,\n    Divide,\n    Pow,\n    PercentOf,\n    Equals,\n    NotEquals,\n    GreaterThan,\n    LessThan,\n    Length,\n    Is,\n    Lowercase,\n    Uppercase,\n    ConcatComma,\n    ConcatSpace,\n    Bin1000th,\n    Bin1000,\n    Bin100th,\n    Bin100,\n    Bin10th,\n    Bin10,\n    HourOfDay,\n    DayOfWeek,\n    MonthOfYear,\n    SecondBucket,\n    MinuteBucket,\n    HourBucket,\n    DayBucket,\n    WeekBucket,\n    MonthBucket,\n    YearBucket\n} from \"./lexer\";\nimport {PerspectiveParserErrorMessage} from \"./error\";\n\nexport class ComputedExpressionColumnParser extends CstParser {\n    constructor() {\n        super(vocabulary, {\n            errorMessageProvider: PerspectiveParserErrorMessage\n        });\n\n        this.RULE(\"SuperExpression\", () => {\n            this.SUBRULE(this.Expression);\n        });\n\n        this.RULE(\"Expression\", () => {\n            this.OR(\n                [\n                    {\n                        ALT: () => {\n                            this.SUBRULE(this.OperatorComputedColumn);\n                        }\n                    },\n                    {\n                        ALT: () => {\n                            this.SUBRULE(this.FunctionComputedColumn);\n                        }\n                    }\n                ],\n                {\n                    ERR_MSG: \"Expected an expression of the form `x + y` or `func(x)`.\"\n                }\n            );\n        });\n\n        this.RULE(\"OperatorComputedColumn\", () => {\n            this.SUBRULE(this.ColumnName, {LABEL: \"left\"});\n            this.AT_LEAST_ONE(() => {\n                this.SUBRULE(this.Operator);\n                this.SUBRULE2(this.ColumnName, {LABEL: \"right\"});\n            });\n            this.OPTION(() => {\n                this.SUBRULE(this.As, {LABEL: \"as\"});\n            });\n        });\n\n        this.RULE(\"FunctionComputedColumn\", () => {\n            this.SUBRULE(this.Function);\n            this.CONSUME(LeftParen);\n            this.AT_LEAST_ONE_SEP({\n                SEP: Comma,\n                DEF: () => {\n                    this.SUBRULE(this.ColumnName);\n                }\n            });\n            this.CONSUME(RightParen);\n            this.OPTION(() => {\n                this.SUBRULE(this.As, {LABEL: \"as\"});\n            });\n        });\n\n        this.RULE(\"ColumnName\", () => {\n            this.OR([{ALT: () => this.SUBRULE(this.ParentheticalExpression)}, {ALT: () => this.CONSUME(ColumnName)}], {\n                ERR_MSG: \"Expected a column name (wrapped in double quotes) or a parenthesis-wrapped expression.\"\n            });\n        });\n\n        this.RULE(\"TerminalColumnName\", () => {\n            this.CONSUME(ColumnName);\n        });\n\n        this.RULE(\"As\", () => {\n            this.CONSUME(As);\n            this.SUBRULE(this.TerminalColumnName);\n        });\n\n        this.RULE(\"Function\", () => {\n            this.OR([\n                {ALT: () => this.CONSUME(Sqrt)},\n                {ALT: () => this.CONSUME(Pow2)},\n                {ALT: () => this.CONSUME(Abs)},\n                {ALT: () => this.CONSUME(Invert)},\n                {ALT: () => this.CONSUME(Log)},\n                {ALT: () => this.CONSUME(Exp)},\n                {ALT: () => this.CONSUME(Bin1000th)},\n                {ALT: () => this.CONSUME(Bin1000)},\n                {ALT: () => this.CONSUME(Bin100th)},\n                {ALT: () => this.CONSUME(Bin100)},\n                {ALT: () => this.CONSUME(Bin10th)},\n                {ALT: () => this.CONSUME(Bin10)},\n                {ALT: () => this.CONSUME(Length)},\n                {ALT: () => this.CONSUME(Uppercase)},\n                {ALT: () => this.CONSUME(Lowercase)},\n                {ALT: () => this.CONSUME(ConcatComma)},\n                {ALT: () => this.CONSUME(ConcatSpace)},\n                {ALT: () => this.CONSUME(HourOfDay)},\n                {ALT: () => this.CONSUME(DayOfWeek)},\n                {ALT: () => this.CONSUME(MonthOfYear)},\n                {ALT: () => this.CONSUME(SecondBucket)},\n                {ALT: () => this.CONSUME(MinuteBucket)},\n                {ALT: () => this.CONSUME(HourBucket)},\n                {ALT: () => this.CONSUME(DayBucket)},\n                {ALT: () => this.CONSUME(WeekBucket)},\n                {ALT: () => this.CONSUME(MonthBucket)},\n                {ALT: () => this.CONSUME(YearBucket)}\n            ]);\n        });\n\n        this.RULE(\"Operator\", () => {\n            this.OR([\n                {ALT: () => this.CONSUME(Add)},\n                {ALT: () => this.CONSUME(Subtract)},\n                {ALT: () => this.CONSUME(Multiply)},\n                {ALT: () => this.CONSUME(Divide)},\n                {ALT: () => this.CONSUME(Pow)},\n                {ALT: () => this.CONSUME(PercentOf)},\n                {ALT: () => this.CONSUME(Equals)},\n                {ALT: () => this.CONSUME(NotEquals)},\n                {ALT: () => this.CONSUME(GreaterThan)},\n                {ALT: () => this.CONSUME(LessThan)},\n                {ALT: () => this.CONSUME(Is)}\n            ]);\n        });\n\n        /**\n         * The rule for parenthetical expressions, which consume parentheses\n         * and resolve to this.Expression.\n         */\n        this.RULE(\"ParentheticalExpression\", () => {\n            this.CONSUME(LeftParen);\n            this.SUBRULE(this.Expression);\n            this.CONSUME(RightParen);\n        });\n\n        this.performSelfAnalysis();\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\n// TODO: these have been renamed compared to old computed columns, make sure\n// names are consistent throughout.\nexport const COMPUTED_FUNCTION_FORMATTERS = {\n    \"+\": (x, y) => `(${x} + ${y})`,\n    \"-\": (x, y) => `(${x} - ${y})`,\n    \"*\": (x, y) => `(${x} * ${y})`,\n    \"/\": (x, y) => `(${x} / ${y})`,\n    \"%\": (x, y) => `(${x} %% ${y})`,\n    \"==\": (x, y) => `(${x} == ${y})`,\n    \"!=\": (x, y) => `(${x} != ${y})`,\n    \">\": (x, y) => `(${x} > ${y})`,\n    \"<\": (x, y) => `(${x} < ${y})`,\n    \"^\": (x, y) => `(${x} ^ ${y})`,\n    invert: x => `(1 / ${x})`,\n    log: x => `log(${x})`,\n    exp: x => `exp(${x})`,\n    pow2: x => `(${x} ^ 2)`,\n    sqrt: x => `sqrt(${x})`,\n    abs: x => `abs(${x})`,\n    bin10: x => `bin10(${x})`,\n    bin100: x => `bin100(${x})`,\n    bin1000: x => `bin1000(${x})`,\n    bin10th: x => `bin10th(${x})`,\n    bin100th: x => `bin100th(${x})`,\n    bin1000th: x => `bin1000th(${x})`,\n    uppercase: x => `uppercase(${x})`,\n    lowercase: x => `lowercase(${x})`,\n    length: x => `length(${x})`,\n    is: (x, y) => `(${x} is ${y})`,\n    concat_space: (x, y) => `concat_space(${x}, ${y})`,\n    concat_comma: (x, y) => `concat_comma(${x}, ${y})`,\n    hour_of_day: x => `hour_of_day(${x})`,\n    day_of_week: x => `day_of_week(${x})`,\n    month_of_year: x => `month_of_year(${x})`,\n    second_bucket: x => `second_bucket(${x})`,\n    minute_bucket: x => `minute_bucket(${x})`,\n    hour_bucket: x => `hour_bucket(${x})`,\n    day_bucket: x => `day_bucket(${x})`,\n    week_bucket: x => `week_bucket(${x})`,\n    month_bucket: x => `month_bucket(${x})`,\n    year_bucket: x => `year_bucket(${x})`\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {lex} from \"./lexer\";\nimport {ComputedExpressionColumnParser} from \"./parser\";\nimport {COMPUTED_FUNCTION_FORMATTERS} from \"./formatter\";\n\nconst parser = new ComputedExpressionColumnParser([]);\nconst base_visitor = parser.getBaseCstVisitorConstructor();\n\nexport class ComputedExpressionColumnVisitor extends base_visitor {\n    constructor() {\n        super();\n        this.validateVisitor();\n    }\n\n    SuperExpression(ctx) {\n        let computed_columns = [];\n        this.visit(ctx.Expression, computed_columns);\n        return computed_columns;\n    }\n\n    Expression(ctx, computed_columns) {\n        if (ctx.OperatorComputedColumn) {\n            this.visit(ctx.OperatorComputedColumn, computed_columns);\n        } else if (ctx.FunctionComputedColumn) {\n            this.visit(ctx.FunctionComputedColumn, computed_columns);\n        } else {\n            return;\n        }\n    }\n\n    /**\n     * Visit a single computed column in operator notation and generate its\n     * specification.\n     *\n     * @param {*} ctx\n     */\n    OperatorComputedColumn(ctx, computed_columns) {\n        let left = this.visit(ctx.left, computed_columns);\n\n        if (typeof left === \"undefined\") {\n            left = computed_columns[computed_columns.length - 1].column;\n        }\n\n        let operator = this.visit(ctx.Operator);\n\n        if (!operator) {\n            return;\n        }\n\n        let right = this.visit(ctx.right, computed_columns);\n\n        if (typeof right === \"undefined\") {\n            right = computed_columns[computed_columns.length - 1].column;\n        }\n\n        let as = this.visit(ctx.as);\n\n        let column_name = COMPUTED_FUNCTION_FORMATTERS[operator](left, right);\n\n        // Use custom name if provided through `AS/as/As`\n        if (as) {\n            column_name = as;\n        }\n\n        computed_columns.push({\n            column: column_name,\n            computed_function_name: operator,\n            inputs: [left, right]\n        });\n    }\n\n    /**\n     * Visit a single computed column in functional notation and generate its\n     * specification.\n     *\n     * @param {*} ctx\n     * @param {*} computed_columns\n     */\n    FunctionComputedColumn(ctx, computed_columns) {\n        const fn = this.visit(ctx.Function);\n\n        // Functions have 1...n parameters\n        let input_columns = [];\n\n        for (const column_name of ctx.ColumnName) {\n            let column = this.visit(column_name, computed_columns);\n            if (typeof column === \"undefined\") {\n                // Use the column immediately to the left, as that is the\n                // name of the parsed column from the expression\n                input_columns.push(computed_columns[computed_columns.length - 1].column);\n            } else {\n                input_columns.push(column);\n            }\n        }\n\n        const as = this.visit(ctx.as);\n\n        let column_name = COMPUTED_FUNCTION_FORMATTERS[fn](...input_columns);\n\n        // Use custom name if provided through `AS/as/As`\n        if (as) {\n            column_name = as;\n        }\n\n        const computed = {\n            column: column_name,\n            computed_function_name: fn,\n            inputs: input_columns\n        };\n\n        computed_columns.push(computed);\n    }\n\n    /**\n     * Parse and return a column name to be included in the computed config.\n     * @param {*} ctx\n     */\n    ColumnName(ctx, computed_columns) {\n        // `image` contains the raw string, `payload` contains the string\n        // without quotes.\n        if (ctx.ParentheticalExpression) {\n            return this.visit(ctx.ParentheticalExpression, computed_columns);\n        } else {\n            return ctx.columnName[0].payload;\n        }\n    }\n\n    /**\n     * Parse and return a column name to be included in the computed config, and\n     * explicitly not parsed as a parenthetical expression.\n     *\n     * @param {*} ctx\n     */\n    TerminalColumnName(ctx) {\n        return ctx.columnName[0].payload;\n    }\n\n    /**\n     * Parse a single mathematical operator (+, -, *, /, %).\n     * @param {*} ctx\n     */\n    Operator(ctx) {\n        if (ctx.add) {\n            return ctx.add[0].image;\n        } else if (ctx.subtract) {\n            return ctx.subtract[0].image;\n        } else if (ctx.multiply) {\n            return ctx.multiply[0].image;\n        } else if (ctx.divide) {\n            return ctx.divide[0].image;\n        } else if (ctx.pow) {\n            return ctx.pow[0].image;\n        } else if (ctx.percent_of) {\n            return ctx.percent_of[0].image;\n        } else if (ctx.equals) {\n            return ctx.equals[0].image;\n        } else if (ctx.not_equals) {\n            return ctx.not_equals[0].image;\n        } else if (ctx.greater_than) {\n            return ctx.greater_than[0].image;\n        } else if (ctx.less_than) {\n            return ctx.less_than[0].image;\n        } else if (ctx.is) {\n            return ctx.is[0].image;\n        } else {\n            return;\n        }\n    }\n\n    /**\n     * Identify and return a function name used for computation.\n     *\n     * @param {*} ctx\n     */\n    Function(ctx) {\n        if (ctx.sqrt) {\n            return ctx.sqrt[0].image;\n        } else if (ctx.pow2) {\n            return ctx.pow2[0].image;\n        } else if (ctx.abs) {\n            return ctx.abs[0].image;\n        } else if (ctx.invert) {\n            return ctx.invert[0].image;\n        } else if (ctx.log) {\n            return ctx.log[0].image;\n        } else if (ctx.exp) {\n            return ctx.exp[0].image;\n        } else if (ctx.length) {\n            return ctx.length[0].image;\n        } else if (ctx.uppercase) {\n            return ctx.uppercase[0].image;\n        } else if (ctx.lowercase) {\n            return ctx.lowercase[0].image;\n        } else if (ctx.concat_comma) {\n            return ctx.concat_comma[0].image;\n        } else if (ctx.concat_space) {\n            return ctx.concat_space[0].image;\n        } else if (ctx.bin10) {\n            return ctx.bin10[0].image;\n        } else if (ctx.bin100) {\n            return ctx.bin100[0].image;\n        } else if (ctx.bin1000) {\n            return ctx.bin1000[0].image;\n        } else if (ctx.bin10th) {\n            return ctx.bin10th[0].image;\n        } else if (ctx.bin100th) {\n            return ctx.bin100th[0].image;\n        } else if (ctx.bin1000th) {\n            return ctx.bin1000th[0].image;\n        } else if (ctx.hour_of_day) {\n            return ctx.hour_of_day[0].image;\n        } else if (ctx.day_of_week) {\n            return ctx.day_of_week[0].image;\n        } else if (ctx.month_of_year) {\n            return ctx.month_of_year[0].image;\n        } else if (ctx.second_bucket) {\n            return ctx.second_bucket[0].image;\n        } else if (ctx.minute_bucket) {\n            return ctx.minute_bucket[0].image;\n        } else if (ctx.hour_bucket) {\n            return ctx.hour_bucket[0].image;\n        } else if (ctx.day_bucket) {\n            return ctx.day_bucket[0].image;\n        } else if (ctx.week_bucket) {\n            return ctx.week_bucket[0].image;\n        } else if (ctx.month_bucket) {\n            return ctx.month_bucket[0].image;\n        } else if (ctx.year_bucket) {\n            return ctx.year_bucket[0].image;\n        } else {\n            return;\n        }\n    }\n\n    /**\n     * Give a custom name to the created computed column using \"AS\" or \"as\".\n     *\n     * @param {*} ctx\n     */\n    As(ctx) {\n        return ctx.TerminalColumnName[0].children.columnName[0].payload;\n    }\n\n    /**\n     * Parse an expression inside parentheses through recursing back up to\n     * `Expression`.\n     *\n     * @param {*} ctx\n     * @param {*} computed_columns\n     */\n    ParentheticalExpression(ctx, computed_columns) {\n        return this.visit(ctx.Expression, computed_columns);\n    }\n}\n\n// We only need one visitor instance - state is reset using `parser.input`.\nconst visitor = new ComputedExpressionColumnVisitor();\n\n/**\n * Given a string expression of the form '\"column\" +, -, *, / \"column\",\n * parse it and return a computed column configuration object.\n *\n * @param {String} expression\n */\nexport const expression_to_computed_column_config = function(expression) {\n    const lex_result = lex(expression);\n\n    // calling `parser.input` resets state.\n    parser.input = lex_result.tokens;\n\n    const cst = parser.SuperExpression();\n\n    if (parser.errors.length > 0) {\n        let message = parser.errors.map(e => e.message);\n        throw new Error(`${message.join(\"\\n\")}`);\n    }\n\n    return visitor.visit(cst);\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {bindTemplate, throttlePromise} from \"./utils.js\";\n\nimport template from \"../html/computed_expression_editor.html\";\n\nimport style from \"../less/computed_expression_editor.less\";\n\nimport {expression_to_computed_column_config} from \"./computed_expressions/visitor\";\n\n// Eslint complains here because we don't do anything, but actually we globally\n// register this class as a CustomElement\n@bindTemplate(template, style) // eslint-disable-next-line no-unused-vars\nclass ComputedExpressionEditor extends HTMLElement {\n    constructor() {\n        super();\n\n        this._parsed_expression = undefined;\n        this.expressions = [];\n    }\n\n    connectedCallback() {\n        this._register_ids();\n        this._register_callbacks();\n        this._textarea_observer = new MutationObserver(this._resize_textarea.bind(this));\n    }\n\n    /**\n     * Observe the textarea when the editor is opened.\n     */\n    _observe_textarea() {\n        this._textarea_observer.observe(this._expression_input, {\n            attributes: true,\n            attributeFilter: [\"style\"]\n        });\n    }\n\n    /**\n     * Dispatch an event on textarea resize to notify the side panel, and\n     * disconnect the observer.\n     */\n    _resize_textarea() {\n        const event = new CustomEvent(\"perspective-computed-expression-resize\");\n        this.dispatchEvent(event);\n        this._textarea_observer.disconnect();\n    }\n\n    /**\n     * When a column/text is dragged and dropped into the textbox, read it\n     * properly.\n     *\n     * @param {*} event\n     */\n    _capture_drop_data(event) {\n        const data = event.dataTransfer.getData(\"text\");\n        if (data !== \"\") {\n            try {\n                const parsed = JSON.parse(data);\n                if (Array.isArray(parsed) && parsed.length > 4) {\n                    event.preventDefault();\n                    this._expression_input.value += `\"${parsed[0]}\"`;\n                }\n            } catch (e) {\n                // regular text, don't do anything as browser will handle\n            } finally {\n                this._validate_expression();\n            }\n        }\n    }\n\n    // Expression actions\n    @throttlePromise\n    async _validate_expression() {\n        const expression = this._expression_input.value;\n\n        if (expression.length === 0) {\n            this._clear_error_messages();\n            this._enable_save_button();\n            return;\n        }\n\n        // FIXME: make the error UI an overlay like the render warning.\n\n        try {\n            // Use this just for validation. On anything short of a massive\n            // expression, this should have no performance impact as we\n            // share an instance of the parser throughout the viewer.\n            this._parsed_expression = expression_to_computed_column_config(expression);\n        } catch (e) {\n            const message = e.message ? e.message : JSON.stringify(e);\n            this._disable_save_button();\n            this._set_error_message(message, this._error);\n            return;\n        }\n\n        // Take the parsed expression and type check it on the viewer,\n        // which will call `_type_check_expression()` with a computed_schema.\n        const event = new CustomEvent(\"perspective-computed-expression-type-check\", {\n            detail: {\n                parsed_expression: this._parsed_expression\n            }\n        });\n\n        this.dispatchEvent(event);\n        return;\n    }\n\n    @throttlePromise\n    async _type_check_expression(computed_schema, expected_types) {\n        const parsed = this._parsed_expression || [];\n        const invalid = [];\n\n        for (const column of parsed) {\n            if (!computed_schema[column.column]) {\n                invalid.push(column.column);\n            }\n        }\n\n        if (invalid.length > 0) {\n            let message = \"TypeError:\\n\";\n            for (const col of invalid) {\n                message += `- \\`${col}\\` expected input column types ${expected_types[col].join(\"/\")}\\n`;\n            }\n            this._disable_save_button();\n            this._set_error_message(message, this._error);\n        } else {\n            this._clear_error_messages();\n            this._enable_save_button();\n        }\n    }\n\n    /**\n     * DEPRECATED: Clears all expressions from the viewer.\n     */\n    _remove_all_expressions() {\n        const event = new CustomEvent(\"perspective-computed-expression-remove\");\n        this.dispatchEvent(event);\n        this.expressions = [];\n    }\n\n    _save_expression() {\n        const expression = this._expression_input.value;\n        const parsed_expression = this._parsed_expression || [];\n\n        const event = new CustomEvent(\"perspective-computed-expression-save\", {\n            detail: {\n                expression: expression,\n                parsed_expression: parsed_expression\n            }\n        });\n\n        this.dispatchEvent(event);\n\n        this.expressions.push(expression);\n    }\n\n    // UI actions\n    _clear_expression_input() {\n        const input = this._expression_input;\n        input.value = \"\";\n    }\n\n    _close_expression_editor() {\n        this.style.display = \"none\";\n        this._side_panel_actions.style.display = \"flex\";\n        this._clear_error_messages();\n        this._clear_expression_input();\n        // Disconnect the observer.\n        this._textarea_observer.disconnect();\n    }\n\n    // error message handlers\n    _set_error_message(message, target) {\n        if (target) {\n            target.innerText = message;\n            target.style.display = \"block\";\n        }\n    }\n\n    _clear_error_messages() {\n        this._error.innerText = \"\";\n        this._error.style.display = \"none\";\n    }\n\n    // Save button handlers\n    _disable_save_button() {\n        this._save_button.toggleAttribute(\"disabled\", true);\n    }\n\n    _enable_save_button() {\n        this._save_button.removeAttribute(\"disabled\");\n    }\n\n    // Remove button handlers\n    _disable_remove_button() {\n        this._remove_button.toggleAttribute(\"disabled\", true);\n    }\n\n    _enable_remove_button() {\n        this._remove_button.removeAttribute(\"disabled\");\n    }\n\n    /**\n     * Map DOM IDs to class properties.\n     */\n    _register_ids() {\n        this._side_panel_actions = this.parentElement.querySelector(\"#side_panel__actions\");\n        this._close_button = this.shadowRoot.querySelector(\"#psp-expression-close\");\n        this._expression_input = this.shadowRoot.querySelector(\"#psp-expression-input\");\n        this._error = this.shadowRoot.querySelector(\"#psp-expression-error\");\n        this._save_button = this.shadowRoot.querySelector(\"#psp-expression-button-save\");\n        this._remove_button = this.shadowRoot.querySelector(\"#psp-expression-button-remove\");\n    }\n\n    /**\n     * Map callback functions to class properties.\n     */\n    _register_callbacks() {\n        this._close_button.addEventListener(\"click\", this._close_expression_editor.bind(this));\n        this._expression_input.addEventListener(\"keyup\", this._validate_expression.bind(this));\n        this._expression_input.addEventListener(\"drop\", this._capture_drop_data.bind(this));\n        this._save_button.addEventListener(\"click\", this._save_expression.bind(this));\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {swap} from \"../utils.js\";\n\nfunction calc_index(event) {\n    if (this._active_columns.children.length == 0) {\n        return 0;\n    } else {\n        let is_last_null = false;\n        for (let cidx in this._active_columns.children) {\n            let child = this._active_columns.children[cidx];\n            is_last_null = is_last_null || child?.classList?.contains(\"null-column\");\n            if (child.offsetTop + child.offsetHeight > event.offsetY + this._active_columns.scrollTop) {\n                return parseInt(cidx);\n            }\n        }\n        let last_index = this._active_columns.children.length;\n        if (is_last_null) {\n            last_index--;\n        }\n        return last_index;\n    }\n}\n\nexport function dragend(event) {\n    let div = event.target.getRootNode().host;\n    let parent = div;\n    if (parent.tagName === \"PERSPECTIVE-VIEWER\") {\n        parent = event.target.parentElement;\n    } else {\n        parent = div.parentElement;\n    }\n    let idx = Array.prototype.slice.call(parent.children).indexOf(div.tagName === \"PERSPECTIVE-ROW\" ? div : event.target);\n    let attr_name = parent.getAttribute(\"for\");\n    if (this.hasAttribute(attr_name)) {\n        let attr_value = JSON.parse(this.getAttribute(attr_name));\n        attr_value.splice(idx, 1);\n        if (attr_value.length === 0) {\n            this.removeAttribute(attr_name);\n        } else {\n            this.setAttribute(attr_name, JSON.stringify(attr_value));\n        }\n    }\n}\n\nexport function drop(ev) {\n    ev.preventDefault();\n    ev.currentTarget.classList.remove(\"dropping\");\n    if (this._drop_target_hover) {\n        this._drop_target_hover.removeAttribute(\"drop-target\");\n    }\n    let data = ev.dataTransfer.getData(\"text\");\n    if (!data) return;\n    data = JSON.parse(data);\n\n    // Update the columns attribute\n    let name = ev.currentTarget.querySelector(\"ul\").getAttribute(\"for\") || ev.currentTarget.getAttribute(\"id\").replace(\"_\", \"-\");\n    let columns = JSON.parse(this.getAttribute(name) || \"[]\");\n    let data_index = columns.indexOf(data[0]);\n    if (data_index !== -1) {\n        columns.splice(data_index, 1);\n    }\n\n    const filtering = name.indexOf(\"filter\") > -1;\n    if (filtering) {\n        this.setAttribute(name, JSON.stringify(columns.concat([data])));\n    } else if (name.indexOf(\"sort\") > -1) {\n        this.setAttribute(name, JSON.stringify(columns.concat([[data[0]]])));\n    } else {\n        this.setAttribute(name, JSON.stringify(columns.concat([data[0]])));\n    }\n\n    // Deselect the dropped column\n    if (this._plugin.deselectMode === \"pivots\" && this._get_visible_column_count() > 1 && name !== \"sort\" && !filtering) {\n        for (let x of this.shadowRoot.querySelectorAll(\"#active_columns perspective-row\")) {\n            if (x.getAttribute(\"name\") === data[0]) {\n                this._active_columns.removeChild(x);\n                break;\n            }\n        }\n        this._update_column_view();\n    }\n\n    this._debounce_update();\n}\n\nexport function column_dragend(event) {\n    let data = event.target.parentElement.parentElement;\n    if (Array.prototype.slice(this._active_columns.children).indexOf(data) > -1 && this._get_visible_column_count() > 1 && event.dataTransfer.dropEffect !== \"move\") {\n        this._active_columns.removeChild(data);\n        this._update_column_view();\n    }\n    this._active_columns.classList.remove(\"dropping\");\n}\n\nexport function column_dragleave(event) {\n    let src = event.relatedTarget;\n    while (src && src !== this._active_columns) {\n        src = src.parentElement;\n    }\n    if (src === null) {\n        this._active_columns.classList.remove(\"dropping\");\n        if (this._drop_target_null) {\n            this._active_columns.replaceChild(this._drop_target_null, this._drop_target_hover);\n            delete this._drop_target_null;\n        }\n        if (this._drop_target_hover.parentElement === this._active_columns) {\n            this._active_columns.removeChild(this._drop_target_hover);\n        }\n        if (this._original_index !== -1) {\n            this._active_columns.insertBefore(this._drop_target_hover, this._active_columns.children[this._original_index]);\n        }\n        this._drop_target_hover.removeAttribute(\"drop-target\");\n    }\n}\n\nfunction _unset_drop_target_null() {\n    if (this._drop_target_null) {\n        if (this._drop_target_null.parentElement === this._active_columns) {\n            swap(this._active_columns, this._drop_target_hover, this._drop_target_null);\n        } else {\n            this._active_columns.replaceChild(this._drop_target_null, this._drop_target_hover);\n        }\n        delete this._drop_target_null;\n    }\n}\n\nfunction column_swap(new_index) {\n    _unset_drop_target_null.call(this);\n    if (this._active_columns.children[new_index]) {\n        if (this._drop_target_hover !== this._active_columns.children[new_index]) {\n            this._drop_target_null = this._active_columns.children[new_index];\n            swap(this._active_columns, this._active_columns.children[new_index], this._drop_target_hover);\n        }\n    }\n}\n\nfunction column_replace(new_index) {\n    _unset_drop_target_null.call(this);\n    if (this._active_columns.children[new_index]) {\n        this._drop_target_null = this._active_columns.children[new_index];\n        this._active_columns.replaceChild(this._drop_target_hover, this._active_columns.children[new_index]);\n    }\n}\n\nexport function column_dragover(event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = \"move\";\n    if (event.currentTarget.className !== \"dropping\") {\n        event.currentTarget.classList.add(\"dropping\");\n    }\n    if (!this._drop_target_hover.hasAttribute(\"drop-target\")) {\n        this._drop_target_hover.toggleAttribute(\"drop-target\", true);\n    }\n    let new_index = calc_index.call(this, event);\n    const current_index = Array.prototype.slice.call(this._active_columns.children).indexOf(this._drop_target_hover);\n    const over_elem = this._active_columns.children[new_index];\n    const to_replace = new_index < this._plugin.initial?.names?.length - 1;\n    const is_diff = this._drop_target_hover !== this._active_columns.children[new_index];\n    const from_active = this._original_index !== -1;\n    const from_replace = from_active && this._original_index < this._plugin.initial?.names?.length - 1;\n    const from_append = from_active && this._original_index >= this._plugin.initial?.names?.length - 1;\n    const from_required = from_active && this._original_index < this._plugin.initial?.count;\n    const to_required = new_index < this._plugin.initial?.count;\n    const to_null = !to_required && over_elem?.classList.contains(\"null-column\");\n    if (from_required && to_null) {\n        _unset_drop_target_null.call(this);\n    } else if (to_replace && from_append && is_diff) {\n        _unset_drop_target_null.call(this);\n        const from_last =\n            this._original_index === this._plugin.initial?.names?.length - 1 &&\n            this._drop_target_hover === this._active_columns.children[this._original_index] &&\n            this._active_columns.children.length === this._plugin.initial?.names?.length;\n        if (from_last) {\n            this._drop_target_null = this._active_columns.children[new_index];\n            swap(this._active_columns, this._active_columns.children[new_index], this._drop_target_hover);\n        } else if (!this._active_columns.children[new_index]?.classList.contains(\"null-column\")) {\n            this._drop_target_null = this._active_columns.children[new_index];\n            this._active_columns.replaceChild(this._drop_target_hover, this._active_columns.children[new_index]);\n            this._active_columns.insertBefore(this._drop_target_null, this._active_columns.children[this._original_index]);\n        } else {\n            if (this._drop_target_hover !== this._active_columns.children[new_index]) {\n                this._drop_target_null = this._active_columns.children[new_index];\n                this._active_columns.replaceChild(this._drop_target_hover, this._active_columns.children[new_index]);\n            }\n        }\n    } else if (to_replace && from_active && is_diff) {\n        column_swap.call(this, new_index);\n    } else if (to_replace && !from_active && is_diff) {\n        column_replace.call(this, new_index);\n    } else if (!to_replace && from_replace && is_diff) {\n        column_swap.call(this, new_index);\n    } else if (to_null && from_active) {\n        column_swap.call(this, new_index);\n    } else if (to_null && !from_active) {\n        column_replace.call(this, new_index);\n    } else if (current_index < new_index) {\n        if (new_index + 1 < this._active_columns.children.length) {\n            if (!this._active_columns.children[new_index + 1].hasAttribute(\"drop-target\")) {\n                _unset_drop_target_null.call(this);\n                this._active_columns.insertBefore(this._drop_target_hover, this._active_columns.children[new_index + 1]);\n            }\n        } else {\n            if (!this._active_columns.children[this._active_columns.children.length - 1].hasAttribute(\"drop-target\")) {\n                _unset_drop_target_null.call(this);\n                this._active_columns.appendChild(this._drop_target_hover);\n            }\n        }\n    } else if (new_index < this._active_columns.children.length) {\n        if (!this._active_columns.children[new_index].hasAttribute(\"drop-target\")) {\n            _unset_drop_target_null.call(this);\n            this._active_columns.insertBefore(this._drop_target_hover, this._active_columns.children[new_index]);\n        }\n    } else {\n        if (!this._active_columns.children[this._active_columns.children.length - 1].hasAttribute(\"drop-target\")) {\n            _unset_drop_target_null.call(this);\n            this._active_columns.appendChild(this._drop_target_hover);\n        }\n    }\n}\n\nexport function column_drop(ev) {\n    ev.preventDefault();\n    delete this._drop_target_null;\n    ev.currentTarget.classList.remove(\"dropping\");\n    if (this._drop_target_hover.parentElement === this._active_columns) {\n        this._drop_target_hover.removeAttribute(\"drop-target\");\n    }\n    let data = ev.dataTransfer.getData(\"text\");\n    if (!data) return;\n\n    this._update_column_view();\n}\n\nexport function dragenter(ev) {\n    ev.stopPropagation();\n    ev.preventDefault();\n    ev.currentTarget.classList.add(\"dropping\");\n}\n\nexport function dragover(ev) {\n    ev.stopPropagation();\n    ev.preventDefault();\n    ev.currentTarget.classList.add(\"dropping\");\n    ev.dataTransfer.dropEffect = \"move\";\n}\n\nexport function dragleave(ev) {\n    if (ev.currentTarget == ev.target) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        ev.currentTarget.classList.remove(\"dropping\");\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport class CancelTask {\n    constructor(on_cancel, initial = false) {\n        this._on_cancel = on_cancel;\n        this._cancelled = false;\n        this.initial = initial;\n    }\n\n    cancel() {\n        if (!this._cancelled && this._on_cancel) {\n            this._on_cancel();\n            this._on_cancel = undefined;\n        }\n        this._cancelled = true;\n    }\n\n    get cancelled() {\n        return this._cancelled;\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {renderers} from \"./renderers.js\";\n\nexport class StateElement extends HTMLElement {\n    get _plugin() {\n        let current_renderers = renderers.getInstance();\n        let view = this.getAttribute(\"plugin\");\n        if (!view) {\n            view = Object.keys(current_renderers)[0];\n            this.setAttribute(\"plugin\", view);\n        }\n        return current_renderers[view] || current_renderers[Object.keys(current_renderers)[0]];\n    }\n\n    // deprecate\n    _get_view_dom_columns(selector, callback) {\n        selector = selector || \"#active_columns perspective-row\";\n        let columns = Array.prototype.slice.call(this.shadowRoot.querySelectorAll(selector));\n        if (!callback) {\n            return columns;\n        }\n        return columns.map(callback).filter(x => x);\n    }\n\n    _get_view_all_columns() {\n        return Array.prototype.slice.call(this.shadowRoot.querySelectorAll(\"#inactive_columns perspective-row\"));\n    }\n\n    _get_view_active_columns() {\n        return Array.prototype.slice.call(this.shadowRoot.querySelectorAll(\"#active_columns perspective-row\"));\n    }\n\n    _get_view_active_valid_columns() {\n        return Array.prototype.slice.call(this.shadowRoot.querySelectorAll(\"#active_columns perspective-row\")).filter(x => !x.classList.contains(\"null-column\"));\n    }\n\n    _get_view_inactive_columns() {\n        return Array.prototype.slice.call(this.shadowRoot.querySelectorAll(\"#inactive_columns perspective-row\"));\n    }\n\n    _get_view_all_column_names() {\n        return this._get_view_all_columns().map(x => x.getAttribute(\"name\"));\n    }\n\n    _get_view_active_column_names() {\n        return this._get_view_active_columns().map(x => x.getAttribute(\"name\"));\n    }\n\n    _get_view_all_valid_column_names() {\n        return this._get_view_all_column_names().filter(x => x);\n    }\n\n    _get_view_active_valid_column_names() {\n        return this._get_view_active_column_names().filter(x => x);\n    }\n\n    _get_view_active_valid_column_count() {\n        return this._get_view_active_valid_column_names().length;\n    }\n\n    // deprecate\n    _get_view_columns({active = true} = {}) {\n        let selector;\n        if (active) {\n            selector = \"#active_columns perspective-row\";\n        } else {\n            selector = \"#inactive_columns perspective-row\";\n        }\n        return this._get_view_dom_columns(selector, col => {\n            return col.getAttribute(\"name\");\n        });\n    }\n\n    _get_view_aggregates(selector) {\n        selector = selector || \"#active_columns perspective-row\";\n        return this._get_view_dom_columns(selector, s => {\n            let op = s.getAttribute(\"aggregate\");\n            if (op[0] === \"[\") {\n                try {\n                    op = JSON.parse(op);\n                } catch (e) {\n                    console.error(e);\n                }\n            }\n            const column = s.getAttribute(\"name\");\n            return column && {op, column};\n        });\n    }\n\n    _get_view_row_pivots() {\n        return this._get_view_dom_columns(\"#row_pivots perspective-row\", col => {\n            return col.getAttribute(\"name\");\n        });\n    }\n\n    _get_view_column_pivots() {\n        return this._get_view_dom_columns(\"#column_pivots perspective-row\", col => {\n            return col.getAttribute(\"name\");\n        });\n    }\n\n    _get_view_filter_nodes() {\n        return this._get_view_dom_columns(\"#filters perspective-row\");\n    }\n\n    _get_view_filters() {\n        return this._get_view_dom_columns(\"#filters perspective-row\", col => {\n            let {operator, operand} = JSON.parse(col.getAttribute(\"filter\"));\n            return [col.getAttribute(\"name\"), operator, operand];\n        });\n    }\n\n    _get_view_sorts() {\n        return this._get_view_dom_columns(\"#sort perspective-row\", col => {\n            let order = col.getAttribute(\"sort-order\") || \"asc\";\n            return [col.getAttribute(\"name\"), order];\n        });\n    }\n\n    _get_view_computed_columns() {\n        return JSON.parse(this.getAttribute(\"computed-columns\")) || [];\n    }\n\n    _get_view_parsed_computed_columns() {\n        return JSON.parse(this.getAttribute(\"parsed-computed-columns\")) || [];\n    }\n\n    _get_visible_column_count() {\n        return this._get_view_active_columns().length;\n    }\n\n    get_aggregate_attribute() {\n        const aggs = JSON.parse(this.getAttribute(\"aggregates\")) || {};\n        const found = new Set();\n        const new_aggs = Object.keys(aggs).map(col => {\n            found.add(col);\n            return {column: col, op: aggs[col]};\n        });\n        if (this._aggregate_defaults) {\n            for (const column of Object.keys(this._aggregate_defaults)) {\n                if (!found.has(column)) {\n                    new_aggs.push({\n                        column,\n                        op: this._aggregate_defaults[column]\n                    });\n                }\n            }\n        }\n        return new_aggs;\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport debounce from \"lodash/debounce\";\nimport isEqual from \"lodash/isEqual\";\nimport {html, render} from \"lit-html\";\n\nimport perspective from \"@finos/perspective\";\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\nimport {CancelTask} from \"./cancel_task.js\";\n\nimport {StateElement} from \"./state_element.js\";\nimport {expression_to_computed_column_config} from \"../computed_expressions/visitor\";\n\n/******************************************************************************\n *\n *  Helpers\n *\n */\n\nfunction numberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nlet TYPE_ORDER = {integer: 2, string: 0, float: 3, boolean: 4, datetime: 1, date: 1};\n\nconst column_sorter = schema => (a, b) => {\n    const s1 = TYPE_ORDER[schema[a]];\n    const s2 = TYPE_ORDER[schema[b]];\n    let r = 0;\n    if (s1 == s2) {\n        r = a.toLowerCase() < b.toLowerCase() ? -1 : 1;\n    } else {\n        r = s1 < s2 ? -1 : 1;\n    }\n    return r;\n};\n\nfunction get_aggregate_defaults(columns, schema, computed_schema) {\n    const aggregates = {};\n    for (const col of columns) {\n        let type = schema[col];\n        if (!type) {\n            type = computed_schema[col];\n        }\n        aggregates[col] = get_type_config(type).aggregate;\n    }\n    return aggregates;\n}\n\nfunction get_aggregates_with_defaults(aggregate_attribute, columns, schema, computed_schema) {\n    const found = new Set();\n    const aggregates = [];\n    for (const col of aggregate_attribute) {\n        let type = schema[col.column];\n        if (!type) {\n            type = computed_schema[col.column];\n        }\n        const type_config = get_type_config(type);\n        found.add(col.column);\n        if (type_config.type || type) {\n            if (col.op === \"\" || perspective.TYPE_AGGREGATES[type_config.type || type].indexOf(col.op) === -1) {\n                col.op = type_config.aggregate;\n            }\n            aggregates.push(col);\n        } else {\n            console.warn(`No column \"${col.column}\" found (specified in aggregates attribute).`);\n        }\n    }\n\n    // Add columns detected from dataset.\n    for (const col of columns) {\n        if (!found.has(col)) {\n            let type = schema[col];\n            if (!type) {\n                type = computed_schema[col.column];\n            }\n            aggregates.push({\n                column: col,\n                op: get_type_config(type).aggregate\n            });\n        }\n    }\n\n    return aggregates;\n}\n\nconst _total_template = args => {\n    if (args) {\n        const x = numberWithCommas(args[0]);\n        const y = numberWithCommas(args[1]);\n        const total = Math.floor((args[0] / args[1]) * 100);\n        return html`\n            <span title=\"${x} / ${y}\" class=\"plugin_information--overflow-hint\">&nbsp;<span class=\"plugin_information--overflow-hint-percent\">${total}%</span>&nbsp;</span>\n        `;\n    }\n};\n\nconst _nowrap_template = text => {\n    if (text !== \"\") {\n        return html`\n            <span style=\"white-space:nowrap\">${text}</span>\n        `;\n    }\n};\n\n/**\n * Render warning template tagged literal.\n * @param {*} strings\n * @param  {...[n, m]} args tuples of rationals to be formatted.\n */\nconst _warning = (strings, ...args) => strings.flatMap((str, idx) => [_nowrap_template(str), _total_template(args[idx])]).filter(x => x);\n\n/******************************************************************************\n *\n * PerspectiveElement\n *\n */\n\nexport class PerspectiveElement extends StateElement {\n    /**\n     * Given an array of computed column definitions, check the table's\n     * computed schema and make sure all types and column names are valid.\n     * If any column names are invalid, they are removed from the output\n     * array of computed column definitions.\n     *\n     * @param {Array{Object}} computed_columns an Array of computed column\n     * definitions\n     * @param {Object{String}} computed_schema a computed column schema\n     * generated from the table\n     *\n     * @returns {Array{Object}} a validated Array of computed column definitions\n     */\n    _validate_parsed_computed_columns(computed_columns, computed_schema) {\n        if (!computed_columns || computed_columns.length === 0) return [];\n        const validated = [];\n\n        for (const computed of computed_columns) {\n            if (computed_schema[computed.column]) {\n                validated.push(computed);\n            }\n        }\n\n        return validated;\n    }\n\n    /**\n     * Given a {@link module:perspective~table}, load it into the\n     * {@link module:perspective_viewer~PerspectiveViewer} and set the viewer's\n     * state. If the `computed-columns` attribute is set on the viewer, this\n     * method attempts to validate the computed columns with the `Table` and\n     * reconcile state.\n     *\n     * @param {*} table\n     * @param {*} computed\n     */\n    async _load_table(table) {\n        this.shadowRoot.querySelector(\"#app\").classList.add(\"hide_message\");\n        const resolve = this._set_updating();\n\n        this._clear_state();\n        this._table = table;\n\n        let [cols, schema] = await Promise.all([table.columns(), table.schema(true)]);\n\n        // Initial col order never contains computed columns\n        this._initial_col_order = cols.slice();\n\n        // Already validated through the attribute API\n        let parsed_computed_columns = this._get_view_parsed_computed_columns();\n\n        if (parsed_computed_columns.length === 0) {\n            // Fallback for race condition on workspace - need to parse\n            // computed expressions, and assume that `parsed-computed-columns`\n            // will be set when the setAttribute callback fires\n            // *after* the table has been loaded.\n            const computed_expressions = this._get_view_computed_columns();\n            for (const expression of computed_expressions) {\n                if (typeof expression === \"string\") {\n                    parsed_computed_columns = parsed_computed_columns.concat(expression_to_computed_column_config(expression));\n                } else {\n                    parsed_computed_columns.push(expression);\n                }\n            }\n        }\n\n        const computed_column_names = parsed_computed_columns.map(x => x.column);\n        const computed_schema = await table.computed_schema(parsed_computed_columns);\n\n        cols = cols.concat(computed_column_names);\n\n        if (!this.hasAttribute(\"columns\")) {\n            this.setAttribute(\"columns\", JSON.stringify(this._initial_col_order));\n        }\n\n        cols.sort(column_sorter(schema));\n\n        // Update aggregates\n        const aggregate_attribute = this.get_aggregate_attribute();\n        const aggregates = get_aggregates_with_defaults(aggregate_attribute, cols, schema, computed_schema);\n\n        let shown = JSON.parse(this.getAttribute(\"columns\")); //.filter(x => all_cols.indexOf(x) > -1);\n\n        // At this point, cols contains both the table columns and the\n        // validated computed columns, so this should only filter on columns\n        // that don't exist in either.\n        const shown_is_invalid = shown.filter(x => cols.indexOf(x) > -1).length === 0;\n\n        if (shown_is_invalid) {\n            shown = this._initial_col_order;\n        }\n\n        this._aggregate_defaults = get_aggregate_defaults(cols, schema, computed_schema);\n\n        // Clear the columns in the DOM before adding new ones\n        this._clear_columns();\n\n        for (const name of cols) {\n            let aggregate = aggregates.find(a => a.column === name).op;\n            const computed = computed_column_names.includes(name) ? name : undefined;\n            let type = schema[name];\n            if (!type) {\n                type = computed_schema[name];\n            }\n            const row = this._new_row(name, type, aggregate, null, null, computed);\n            this._inactive_columns.appendChild(row);\n            if (shown.includes(name)) {\n                row.classList.add(\"active\");\n            }\n        }\n\n        while (shown.length < this._plugin.initial?.names?.length) {\n            shown.push(null);\n        }\n\n        for (const x of shown) {\n            const computed = computed_column_names.includes(x) ? x : undefined;\n            let type = schema[name];\n            if (!type) {\n                type = computed_schema[name];\n            }\n            const active_row = this._new_row(x, type, undefined, undefined, undefined, computed);\n            this._active_columns.appendChild(active_row);\n        }\n\n        if (cols.length === shown.filter(x => cols.indexOf(x) > -1).length) {\n            this._inactive_columns.parentElement.classList.add(\"collapse\");\n        } else {\n            this._inactive_columns.parentElement.classList.remove(\"collapse\");\n        }\n\n        this._show_column_container();\n\n        if ((await this._table.compute()) === true) {\n            this._show_side_panel_actions();\n        }\n\n        // Filters need type information to populate e.g. the operator dropdown,\n        // so reset them.\n        if (this.hasAttribute(\"filters\")) {\n            this.filters = this.getAttribute(\"filters\");\n        }\n\n        try {\n            await this._debounce_update({force_update: true});\n        } catch (e) {\n            console.warn(\"Initial view failed, resetting UI state\");\n            await this.reset();\n            throw e;\n        }\n\n        resolve();\n    }\n\n    async get_maxes() {\n        let max_cols, max_rows;\n        const [schema, num_columns] = await Promise.all([this._view.schema(), this._view.num_columns()]);\n        const schema_columns = Object.keys(schema || {}).length || 1;\n\n        if (typeof this._plugin.max_columns !== \"undefined\") {\n            const column_group_diff = this._plugin.max_columns % schema_columns;\n            const column_limit = this._plugin.max_columns + column_group_diff;\n            max_cols = column_limit < num_columns ? column_limit : undefined;\n        }\n\n        if (typeof this._plugin.max_cells !== \"undefined\") {\n            max_rows = Math.ceil(max_cols ? this._plugin.max_cells / max_cols : this._plugin.max_cells / (num_columns || 1));\n        }\n\n        return {max_cols, max_rows};\n    }\n\n    async _warn_render_size_exceeded(max_cols, max_rows) {\n        if (this._show_warnings && (max_cols || max_rows)) {\n            const num_columns = await this._view.num_columns();\n            const num_rows = await this._view.num_rows();\n            const count = num_columns * num_rows;\n            const columns_are_truncated = max_cols && max_cols < num_columns;\n            const rows_are_truncated = max_rows && max_rows < num_rows;\n            if (columns_are_truncated && rows_are_truncated) {\n                this._plugin_information.classList.remove(\"hidden\");\n                const warning = _warning`Rendering ${[max_cols, num_columns]} of columns and ${[num_columns * max_rows, count]} of points.`;\n                render(warning, this._plugin_information_message);\n                return true;\n            } else if (columns_are_truncated) {\n                this._plugin_information.classList.remove(\"hidden\");\n                const warning = _warning`Rendering ${[max_cols, num_columns]} of columns.`;\n                render(warning, this._plugin_information_message);\n                return true;\n            } else if (rows_are_truncated) {\n                this._plugin_information.classList.remove(\"hidden\");\n                const warning = _warning`Rendering ${[num_columns * max_rows, count]} of points.`;\n                render(warning, this._plugin_information_message);\n                return true;\n            } else {\n                this._plugin_information.classList.add(\"hidden\");\n            }\n        }\n        return false;\n    }\n\n    /**\n     * Calculates the optimal timeout in milliseconds for render events,\n     * calculated by 5 frame moving average of this component's render\n     * framerate, or explicit override attribute `\"throttle\"`.\n     *\n     * @private\n     * @returns\n     * @memberof PerspectiveElement\n     */\n    _calculate_throttle_timeout() {\n        let timeout;\n        const throttle = this.getAttribute(\"throttle\");\n        if (throttle === undefined || throttle === \"null\" || !this.hasAttribute(\"throttle\")) {\n            if (!this.__render_times || this.__render_times.length < 5) {\n                return 0;\n            }\n            timeout = this.__render_times.reduce((x, y) => x + y, 0) / this.__render_times.length;\n            timeout = Math.min(5000, timeout);\n        } else {\n            timeout = parseInt(throttle);\n            if (isNaN(timeout) || timeout < 0) {\n                console.warn(`Bad throttle attribute value \"${throttle}\".  Can be (non-negative integer) milliseconds.`);\n                this.removeAttribute(\"throttle\");\n                return 0;\n            }\n        }\n        return Math.max(0, timeout);\n    }\n\n    _view_on_update(limit_points) {\n        if (!this._debounced) {\n            this._debounced = setTimeout(async () => {\n                this._debounced = undefined;\n                const timer = this._render_time();\n                if (this._task && !this._task.initial) {\n                    this._task.cancel();\n                }\n                const task = (this._task = new CancelTask());\n                const updater = this._plugin.update || this._plugin.create;\n                try {\n                    if (limit_points) {\n                        const {max_cols, max_rows} = await this.get_maxes();\n                        if (!task.cancelled) {\n                            await this._warn_render_size_exceeded(max_cols, max_rows);\n                            await updater.call(this, this._datavis, this._view, task, max_cols, max_rows);\n                        }\n                    } else {\n                        await updater.call(this, this._datavis, this._view, task);\n                    }\n                    timer();\n                    task.cancel();\n                } catch (err) {\n                    console.error(\"Error rendering plugin.\", err);\n                } finally {\n                    this.dispatchEvent(new Event(\"perspective-view-update\"));\n                }\n            }, this._calculate_throttle_timeout());\n        }\n    }\n\n    async _validate_filters() {\n        const filters = [];\n        for (const node of this._get_view_filter_nodes()) {\n            const operandNode = node.shadowRoot.getElementById(\"filter_operand\");\n            const exclamation = node.shadowRoot.getElementById(\"row_exclamation\");\n            const {operator, operand} = JSON.parse(node.getAttribute(\"filter\"));\n            const filter = [node.getAttribute(\"name\"), operator, operand];\n            if (await this._table.is_valid_filter(filter)) {\n                filters.push(filter);\n                node.title = \"\";\n                operandNode.style.borderColor = \"\";\n                exclamation.hidden = true;\n            } else {\n                node.title = \"Invalid Filter\";\n                operandNode.style.borderColor = \"red\";\n                exclamation.hidden = false;\n            }\n        }\n\n        return filters;\n    }\n\n    _is_config_changed(config) {\n        const plugin_name = this.getAttribute(\"plugin\");\n        if (isEqual(config, this._previous_config) && plugin_name === this._previous_plugin_name) {\n            return false;\n        } else {\n            this._previous_config = config;\n            this._previous_plugin_name = plugin_name;\n            return true;\n        }\n    }\n\n    async _new_view({force_update = false, ignore_size_check = false, limit_points = true} = {}) {\n        if (!this._table) return;\n        this._check_responsive_layout();\n        const row_pivots = this._get_view_row_pivots();\n        const column_pivots = this._get_view_column_pivots();\n        const filters = await this._validate_filters();\n        const view_aggregates = this._get_view_aggregates();\n        if (view_aggregates.length === 0) return;\n        const sort = this._get_view_sorts();\n\n        let columns = view_aggregates.map(x => x.column);\n        let aggregates = {};\n        for (const a of view_aggregates) {\n            aggregates[a.column] = a.op;\n        }\n\n        for (const s of sort) {\n            const name = s[0];\n            if (columns.indexOf(name) === -1 && !(column_pivots.indexOf(s) > -1 || row_pivots.indexOf(s) > -1)) {\n                const all = this.get_aggregate_attribute();\n                const {column, op} = all.reduce((obj, y) => (y.column === name ? y : obj));\n                aggregates[column] = op;\n            }\n        }\n\n        // Computed Columns will have been parsed by this point in the\n        // setAttribute callback.\n        const computed_columns = this._get_view_parsed_computed_columns();\n\n        const config = {\n            filter: filters,\n            row_pivots: row_pivots,\n            column_pivots: column_pivots,\n            aggregates: aggregates,\n            columns: columns,\n            sort: sort,\n            computed_columns: computed_columns\n        };\n\n        if (this._view) {\n            this._view.remove_update(this._view_updater);\n            this._view.delete();\n            this._view = undefined;\n        }\n\n        try {\n            this._view = this._table.view(config);\n            this._view_updater = () => this._view_on_update(limit_points);\n            this._view.on_update(this._view_updater);\n        } catch (e) {\n            this._view.delete();\n            throw e;\n        }\n\n        const timer = this._render_time();\n        this._render_count = (this._render_count || 0) + 1;\n        if (this._task) {\n            this._task.cancel();\n        }\n\n        const task = (this._task = new CancelTask(() => this._render_count--, true));\n\n        try {\n            const {max_cols, max_rows} = await this.get_maxes();\n            if (!ignore_size_check) {\n                await this._warn_render_size_exceeded(max_cols, max_rows);\n            }\n            if (limit_points) {\n                await this._plugin.create.call(this, this._datavis, this._view, task, max_cols, max_rows, force_update);\n            } else {\n                await this._plugin.create.call(this, this._datavis, this._view, task, undefined, undefined, force_update);\n            }\n        } catch (err) {\n            console.warn(err);\n        } finally {\n            if (!this.__render_times) {\n                this.__render_times = [];\n                this.dispatchEvent(new Event(\"perspective-view-update\"));\n            }\n            timer();\n            task.cancel();\n            if (this._render_count === 0) {\n                this.removeAttribute(\"updating\");\n                this.dispatchEvent(new Event(\"perspective-update-complete\"));\n            }\n        }\n    }\n\n    _check_loaded_table() {\n        if (this._table) {\n            const table = this._table;\n            delete this._table;\n            this._load_table(table);\n        }\n    }\n\n    _render_time() {\n        const t = performance.now();\n        return () => {\n            this.__render_times.unshift(performance.now() - t);\n            this.__render_times = this.__render_times.slice(0, 5);\n        };\n    }\n\n    _restyle_plugin() {\n        if (this._plugin.styleElement) {\n            const task = (this._task = new CancelTask());\n            this._plugin.styleElement.call(this, this._datavis, this._view, task);\n        }\n    }\n\n    _clear_state(clear_table = true) {\n        if (this._task) {\n            this._task.cancel();\n        }\n        const all = [];\n        if (this._view) {\n            const view = this._view;\n            this._view = undefined;\n            all.push(view.delete());\n            view.remove_update(this._view_updater);\n            view.remove_delete();\n        }\n        if (this._table && clear_table) {\n            const table = this._table;\n            this._table = undefined;\n            if (table._owner_viewer && table._owner_viewer === this) {\n                all.push(table.delete());\n            }\n        }\n        return Promise.all(all);\n    }\n\n    _set_updating() {\n        this.toggleAttribute(\"updating\", true);\n        let resolve;\n        this._updating_promise = new Promise(_resolve => {\n            resolve = _resolve;\n        });\n        return resolve;\n    }\n\n    _register_debounce_instance() {\n        const _update = debounce((resolve, ignore_size_check, force_update, limit_points) => {\n            this._new_view({ignore_size_check, force_update, limit_points}).then(resolve);\n        }, 0);\n\n        this._debounce_update = async ({force_update = false, ignore_size_check = false, limit_points = true} = {}) => {\n            if (this._table) {\n                let resolve = this._set_updating();\n                await new Promise(resolve => _update(resolve, ignore_size_check, force_update, limit_points));\n                resolve();\n            }\n        };\n    }\n\n    _get_worker() {\n        if (this._table) {\n            return this._table._worker;\n        }\n        return perspective.shared_worker();\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\nimport {dragend} from \"./dragdrop.js\";\nimport {renderers} from \"./renderers.js\";\n\nimport {PerspectiveElement} from \"./perspective_element.js\";\nimport {html, render} from \"lit-html\";\n\n/**\n * Render `<option>` blocks\n * @param {*} names name objects\n */\nconst options = vals => {\n    const opts = [];\n    for (name in vals) {\n        opts.push(html`\n            <option value=\"${name}\">${vals[name].name || name}</option>\n        `);\n    }\n    return opts;\n};\n\nexport class DomElement extends PerspectiveElement {\n    _clear_columns() {\n        this._inactive_columns.innerHTML = \"\";\n        this._active_columns.innerHTML = \"\";\n    }\n\n    set_aggregate_attribute(aggs) {\n        let is_set = false;\n        let aggregates = aggs.reduce((obj, agg) => {\n            if (this._aggregate_defaults[agg.column] !== agg.op) {\n                obj[agg.column] = agg.op;\n                is_set = true;\n            }\n            return obj;\n        }, {});\n        if (is_set) {\n            this.setAttribute(\"aggregates\", JSON.stringify(aggregates));\n        } else {\n            this.removeAttribute(\"aggregates\");\n        }\n    }\n\n    _get_type(name) {\n        let all = this._get_view_inactive_columns();\n        if (all.length > 0) {\n            const type = all.find(x => x.getAttribute(\"name\") === name);\n            if (type) {\n                return type.getAttribute(\"type\");\n            } else {\n                return \"integer\";\n            }\n        } else {\n            return \"\";\n        }\n    }\n\n    _set_row_type(row) {\n        const weights = this._get_view_inactive_columns()\n            .filter(x => x.getAttribute(\"type\") === \"integer\" || x.getAttribute(\"type\") === \"float\")\n            .map(x => x.getAttribute(\"name\"));\n        row.set_weights(weights);\n        row.setAttribute(\"type\", this._get_type(row.getAttribute(\"name\")));\n    }\n\n    // Generates a new row in state + DOM\n    _new_row(name, type, aggregate, filter, sort, computed) {\n        let row = document.createElement(\"perspective-row\");\n        type = type || this._get_type(name);\n\n        if (!aggregate) {\n            let aggregates = this.get_aggregate_attribute();\n            if (aggregates) {\n                aggregate = aggregates.find(x => x.column === name);\n                if (aggregate) {\n                    aggregate = aggregate.op;\n                } else {\n                    aggregate = get_type_config(type).aggregate;\n                }\n            } else {\n                aggregate = get_type_config(type).aggregate;\n            }\n        }\n\n        if (filter) {\n            row.setAttribute(\"filter\", filter);\n\n            if (type === \"string\") {\n                const view = this._table.view({row_pivots: [name], aggregates: {}});\n                view.to_json().then(json => {\n                    row.choices(this._autocomplete_choices(json));\n                });\n                view.delete();\n            }\n        }\n\n        if (sort) {\n            row.setAttribute(\"sort-order\", sort);\n        } else {\n            if (this._get_view_column_pivots().indexOf(name) > -1) {\n                row.setAttribute(\"sort-order\", \"col asc\");\n            } else {\n                row.setAttribute(\"sort-order\", \"asc\");\n            }\n        }\n\n        const weights = this._get_view_inactive_columns()\n            .filter(x => x.getAttribute(\"type\") === \"integer\" || x.getAttribute(\"type\") === \"float\")\n            .map(x => x.getAttribute(\"name\"));\n        row.set_weights(weights);\n\n        if (name === null) {\n            row.classList.add(\"null-column\");\n        } else {\n            row.setAttribute(\"type\", type);\n            row.setAttribute(\"name\", name);\n        }\n\n        row.setAttribute(\"aggregate\", Array.isArray(aggregate) ? JSON.stringify(aggregate) : aggregate);\n\n        row.addEventListener(\"visibility-clicked\", this._column_visibility_clicked.bind(this));\n        row.addEventListener(\"aggregate-selected\", this._column_aggregate_clicked.bind(this));\n        row.addEventListener(\"filter-selected\", this._column_filter_clicked.bind(this));\n        row.addEventListener(\"close-clicked\", event => dragend.call(this, event.detail));\n        row.addEventListener(\"sort-order\", this._sort_order_clicked.bind(this));\n\n        row.addEventListener(\"row-drag\", () => {\n            this.classList.add(\"dragging\");\n            this._active_columns.style.overflow = \"hidden\";\n            this._original_index = Array.prototype.slice.call(this._active_columns.children).findIndex(x => x.getAttribute(\"name\") === name);\n            if (this._original_index !== -1) {\n                this._drop_target_hover = this._active_columns.children[this._original_index];\n                setTimeout(() => row.setAttribute(\"drop-target\", true));\n            } else {\n                this._drop_target_hover = this._new_row(name, type, aggregate);\n            }\n        });\n        row.addEventListener(\"row-dragend\", () => {\n            this._active_columns.style.overflow = \"auto\";\n            this.classList.remove(\"dragging\");\n        });\n\n        if (computed) {\n            row.setAttribute(\"computed_column\", JSON.stringify(computed));\n            row.classList.add(\"computed\");\n        }\n\n        return row;\n    }\n\n    /**\n     * Using a computed schema generated in the attribute callback, add\n     * computed columns to the inactive columns area if they're not specified\n     * to be inserted anywhere else in the UI.\n     */\n    _update_computed_column_view(computed_schema) {\n        const computed_columns = this._get_view_parsed_computed_columns();\n        const columns = this._get_view_all_column_names();\n        const active = this._get_view_active_column_names();\n\n        if (Object.keys(computed_schema).length === 0 || computed_columns.length === 0) {\n            return;\n        }\n\n        let added_count = 0;\n\n        const attr = JSON.parse(this.getAttribute(\"columns\")) || [];\n        let reset_columns_attr = false;\n\n        for (const cc of computed_columns) {\n            const name = cc.column;\n\n            // Check for whether the computed column is in the attribute but\n            // NOT in the DOM - occurs when restore is called and a race\n            // condition between `computed-columns` and `columns` occurs.\n            const should_reset = !columns.includes(name) && attr.includes(name);\n\n            if (should_reset) {\n                reset_columns_attr = true;\n            }\n\n            // If the column already exists or is already in the active DOM,\n            // don't add it to the inactive DOM\n            const should_add = !columns.includes(name) && !active.includes(name);\n\n            if (!should_add) {\n                continue;\n            }\n\n            const row = this._new_row(name, computed_schema[name], null, null, null, name);\n            this._inactive_columns.appendChild(row);\n            added_count++;\n        }\n\n        if (reset_columns_attr) {\n            this._update_column_view(attr, true);\n        } else {\n            // Remove collapse so that new inactive columns show up\n            if (added_count > 0 && this._inactive_columns.parentElement.classList.contains(\"collapse\")) {\n                this._inactive_columns.parentElement.classList.remove(\"collapse\");\n            }\n        }\n    }\n\n    /**\n     * Given two sets of computed columns, remove columns that are present in\n     * `old_computed_columns` but not `new_computed_columns`, and return a\n     * list of computed column definitions to remove.\n     *\n     * @param {*} old_computed_columns\n     * @param {*} new_computed_columns\n     */\n    _diff_computed_column_view(old_computed_columns, new_computed_columns) {\n        const to_remove = [];\n        const new_names = new_computed_columns.map(x => x.column);\n        for (const column of old_computed_columns) {\n            if (!new_names.includes(column.column)) {\n                to_remove.push(column);\n            }\n        }\n        return to_remove;\n    }\n\n    /**\n     * When the `computed-columns` attribute is set to [], null, or undefined,\n     * clear all previously created columns from the UI.\n     */\n    _reset_computed_column_view(computed_columns) {\n        if (!computed_columns || computed_columns.length === 0) {\n            return;\n        }\n\n        const computed_names = computed_columns.map(x => x.column);\n\n        // Remove computed columns from all\n        const filtered_active = this._get_view_active_column_names().filter(x => !computed_names.includes(x));\n\n        const aggregates = this._get_view_aggregates().filter(x => !computed_names.includes(x.column));\n        const rp = this._get_view_row_pivots().filter(x => !computed_names.includes(x));\n        const cp = this._get_view_column_pivots().filter(x => !computed_names.includes(x));\n        const sort = this._get_view_sorts().filter(x => !computed_names.includes(x[0]));\n        const filters = this._get_view_filters().filter(x => !computed_names.includes(x[0]));\n\n        // Aggregates as an array is from the attribute API\n        this.set_aggregate_attribute(aggregates);\n\n        this.setAttribute(\"columns\", JSON.stringify(filtered_active));\n        this.setAttribute(\"row-pivots\", JSON.stringify(rp));\n        this.setAttribute(\"column-pivots\", JSON.stringify(cp));\n        this.setAttribute(\"sort\", JSON.stringify(sort));\n        this.setAttribute(\"filters\", JSON.stringify(filters));\n\n        // Remove inactive computed columns\n        const inactive_computed = this._get_view_all_columns().filter(x => x.classList.contains(\"computed\"));\n\n        for (const col of inactive_computed) {\n            this._inactive_columns.removeChild(col);\n        }\n\n        // Re-check on whether to collapse inactive columns\n        const pop_cols = this._get_view_active_columns().filter(x => typeof x !== \"undefined\" && x !== null);\n        const lis = this._get_view_inactive_columns();\n\n        if (pop_cols.length === lis.length) {\n            this._inactive_columns.parentElement.classList.add(\"collapse\");\n        } else {\n            this._inactive_columns.parentElement.classList.remove(\"collapse\");\n        }\n    }\n\n    _update_column_view(columns, reset = false) {\n        if (!columns) {\n            columns = this._get_view_active_column_names();\n        }\n\n        if (this._plugin.initial && this._plugin.initial.names) {\n            while (columns.length < this._plugin.initial.names.length) {\n                columns.push(null);\n            }\n        }\n\n        // If columns were not passed in, this is needed to keep the attribute\n        // API in sync with DOM state.\n        this.setAttribute(\"columns\", JSON.stringify(columns));\n\n        const pop_cols = columns.filter(x => typeof x !== \"undefined\" && x !== null);\n        const lis = this._get_view_inactive_columns();\n        if (pop_cols.length === lis.length) {\n            this._inactive_columns.parentElement.classList.add(\"collapse\");\n        } else {\n            this._inactive_columns.parentElement.classList.remove(\"collapse\");\n        }\n        lis.forEach(x => {\n            const index = pop_cols.indexOf(x.getAttribute(\"name\"));\n            if (index === -1) {\n                x.classList.remove(\"active\");\n            } else {\n                x.classList.add(\"active\");\n            }\n        });\n        if (reset) {\n            this._update_column_list(columns, this._active_columns, (name, computed_names) => {\n                if (name === null) {\n                    return this._new_row(null);\n                } else {\n                    const ref = lis.find(x => x.getAttribute(\"name\") === name);\n                    if (ref) {\n                        const name = ref.getAttribute(\"name\");\n                        let computed;\n                        if (computed_names.includes(name)) {\n                            computed = name;\n                        }\n                        return this._new_row(name, ref.getAttribute(\"type\"), undefined, undefined, undefined, computed);\n                    }\n                }\n            });\n        }\n    }\n\n    _update_column_list(columns, container, callback, accessor) {\n        accessor = accessor || ((x, y) => y.getAttribute(\"name\") === x);\n        const active_columns = Array.prototype.slice.call(container.children);\n\n        // Make sure that the `computed` attribute is set on computed columns\n        const computed_columns = this._get_view_parsed_computed_columns();\n        const computed_names = computed_columns.map(x => x.column);\n\n        for (let i = 0, j = 0; i < active_columns.length || j < columns.length; i++, j++) {\n            const name = columns[j];\n            const col = active_columns[i];\n            const next_col = active_columns[i + 1];\n            if (!col) {\n                const node = callback(name, computed_names);\n                if (node) {\n                    container.appendChild(node);\n                }\n            } else if (typeof name === \"undefined\") {\n                container.removeChild(col);\n            } else if (accessor(name, col)) {\n                this._set_row_type(col);\n            } else {\n                if (col.classList.contains(\"null-column\")) {\n                    const node = callback(name, computed_names);\n                    if (node) {\n                        container.replaceChild(node, col);\n                    }\n                } else if (next_col && accessor(name, next_col)) {\n                    container.removeChild(col);\n                    i++;\n                    //  j--;\n                } else {\n                    const node = callback(name, computed_names);\n                    if (node) {\n                        container.insertBefore(node, col);\n                        i--;\n                    }\n                }\n            }\n        }\n    }\n\n    _set_row_styles() {\n        let style = \"\";\n        if (this._plugin.initial && this._plugin.initial.names) {\n            for (const nidx in this._plugin.initial.names) {\n                const name = this._plugin.initial.names[nidx];\n                style += `#active_columns perspective-row:nth-child(${parseInt(nidx) + 1}){margin-top:23px;}`;\n                style += `#active_columns perspective-row:nth-child(${parseInt(nidx) + 1}):before{content:\"${name}\";}`;\n            }\n        }\n        this.shadowRoot.querySelector(\"#psp_styles\").innerHTML = style;\n    }\n\n    _show_column_container() {\n        this.shadowRoot.querySelector(\"#columns_container\").style.visibility = \"visible\";\n    }\n\n    _show_side_panel_actions() {\n        this.shadowRoot.querySelector(\"#side_panel__actions\").style.visibility = \"visible\";\n    }\n\n    _remove_null_columns(since_index = 0) {\n        const elems = this._get_view_active_columns();\n        while (++since_index < elems.length) {\n            const elem = elems[since_index];\n            if (elem.classList.contains(\"null-column\")) {\n                this.shadowRoot.querySelector(\"#active_columns\").removeChild(elem);\n            }\n        }\n    }\n\n    _set_column_defaults() {\n        const cols = this._get_view_all_columns();\n        const active_cols = this._get_view_active_valid_columns();\n        const valid_active_cols = this._get_view_active_valid_column_names();\n        if (cols.length > 0) {\n            if (this._plugin.initial) {\n                let pref = [];\n                let count = this._plugin.initial.count || 2;\n                this._fill_numeric(active_cols, pref);\n                this._fill_numeric(cols, pref);\n                this._fill_numeric(cols, pref, true);\n                pref = pref.slice(0, count);\n                const labels = this._plugin.initial.names;\n                while (labels && pref.length < labels.length) {\n                    pref.push(null);\n                }\n                this.setAttribute(\"columns\", JSON.stringify(pref));\n            } else if (this._plugin.selectMode === \"select\") {\n                this.setAttribute(\"columns\", JSON.stringify([cols[0].getAttribute(\"name\")]));\n            } else {\n                this.setAttribute(\"columns\", JSON.stringify(valid_active_cols));\n                this._remove_null_columns();\n            }\n        }\n    }\n\n    _fill_numeric(cols, pref, bypass = false) {\n        for (let col of cols) {\n            let type = col.getAttribute(\"type\");\n            let name = col.getAttribute(\"name\");\n            if (bypass || ([\"float\", \"integer\"].indexOf(type) > -1 && pref.indexOf(name) === -1)) {\n                pref.push(name);\n            }\n        }\n    }\n\n    async _check_responsive_layout() {\n        if (this.shadowRoot) {\n            const app = this.shadowRoot.querySelector(\"#app\");\n            if (this.clientHeight < 500 && this.clientWidth > 600 && this._get_view_columns({active: false}).length > this._get_view_columns().length) {\n                if (!app.classList.contains(\"columns_horizontal\")) {\n                    const old = this._persisted_side_panel_width;\n                    this._persisted_side_panel_width = this._side_panel.style.width;\n                    this._side_panel.style.width = old || \"\";\n                    app.classList.add(\"columns_horizontal\");\n                    return false;\n                }\n                return false;\n            } else if (app.classList.contains(\"columns_horizontal\")) {\n                const panel = this.shadowRoot.querySelector(\"#pivot_chart_container\");\n                panel.clientWidth + this._side_panel.clientWidth;\n                const width = this._persisted_side_panel_width || panel.clientWidth + this._side_panel.clientWidth / 2;\n                const height = panel.clientHeight + 50;\n                await this._pre_resize(width, height, () => {\n                    const old = this._persisted_side_panel_width;\n                    this._persisted_side_panel_width = this._side_panel.style.width;\n                    this._side_panel.style.width = old || \"\";\n                    app.classList.remove(\"columns_horizontal\");\n                });\n                return true;\n            }\n        }\n        return false;\n    }\n\n    // setup functions\n    _register_ids() {\n        this._aggregate_selector = this.shadowRoot.querySelector(\"#aggregate_selector\");\n        this._vis_selector = this.shadowRoot.querySelector(\"#vis_selector\");\n        this._filters = this.shadowRoot.querySelector(\"#filters\");\n        this._row_pivots = this.shadowRoot.querySelector(\"#row_pivots\");\n        this._column_pivots = this.shadowRoot.querySelector(\"#column_pivots\");\n        this._datavis = this.shadowRoot.querySelector(\"#pivot_chart\");\n        this._active_columns = this.shadowRoot.querySelector(\"#active_columns\");\n        this._inactive_columns = this.shadowRoot.querySelector(\"#inactive_columns\");\n        this._side_panel_actions = this.shadowRoot.querySelector(\"#side_panel__actions\");\n        this._add_computed_expression_button = this.shadowRoot.querySelector(\"#add-computed-expression\");\n        this._computed_expression_editor = this.shadowRoot.querySelector(\"perspective-computed-expression-editor\");\n        this._inner_drop_target = this.shadowRoot.querySelector(\"#drop_target_inner\");\n        this._drop_target = this.shadowRoot.querySelector(\"#drop_target\");\n        this._config_button = this.shadowRoot.querySelector(\"#config_button\");\n        this._reset_button = this.shadowRoot.querySelector(\"#reset_button\");\n        this._download_button = this.shadowRoot.querySelector(\"#download_button\");\n        this._copy_button = this.shadowRoot.querySelector(\"#copy_button\");\n        this._side_panel = this.shadowRoot.querySelector(\"#side_panel\");\n        this._top_panel = this.shadowRoot.querySelector(\"#top_panel\");\n        this._sort = this.shadowRoot.querySelector(\"#sort\");\n        this._transpose_button = this.shadowRoot.querySelector(\"#transpose_button\");\n        this._plugin_information = this.shadowRoot.querySelector(\".plugin_information\");\n        this._plugin_information_action = this.shadowRoot.querySelector(\".plugin_information__action\");\n        this._plugin_information_action_close = this.shadowRoot.querySelector(\".plugin_information__action--close\");\n        this._plugin_information_message = this.shadowRoot.querySelector(\"#plugin_information_count\");\n        this._resize_bar = this.shadowRoot.querySelector(\"#resize_bar\");\n    }\n\n    // sets state, manipulates DOM\n    _register_view_options() {\n        let current_renderers = renderers.getInstance();\n        render(options(current_renderers), this._vis_selector);\n    }\n\n    // sets state\n    _register_data_attribute() {\n        // TODO this feature needs to become a real attribute.\n        if (this.getAttribute(\"data\")) {\n            let data = this.getAttribute(\"data\");\n            try {\n                data = JSON.parse(data);\n            } catch (e) {}\n            this.load(data);\n        }\n    }\n\n    _autocomplete_choices(json) {\n        return json\n            .slice(1, json.length)\n            .map(x => x.__ROW_PATH__)\n            .filter(x => (Array.isArray(x) ? x.filter(v => !!v).length > 0 : !!x));\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {dragend, column_dragend, column_dragleave, column_dragover, column_drop, drop, dragenter, dragover, dragleave} from \"./dragdrop.js\";\n\nimport {DomElement} from \"./dom_element.js\";\n\nexport class ActionElement extends DomElement {\n    _show_context_menu(event) {\n        this.shadowRoot.querySelector(\"#app\").classList.toggle(\"show_menu\");\n        event.stopPropagation();\n        event.preventDefault();\n        return false;\n    }\n\n    _hide_context_menu() {\n        this.shadowRoot.querySelector(\"#app\").classList.remove(\"show_menu\");\n    }\n\n    async _toggle_config(event) {\n        if (!event || event.button !== 2) {\n            this._show_config = !this._show_config;\n            this._hide_context_menu();\n            const panel = this.shadowRoot.querySelector(\"#pivot_chart_container\");\n            if (!this._show_config) {\n                await this._pre_resize(\n                    panel.clientWidth + this._side_panel.clientWidth,\n                    panel.clientHeight + this._top_panel.clientHeight,\n                    () => {\n                        this._side_panel.style.display = \"none\";\n                        this._top_panel.style.display = \"none\";\n                        this.removeAttribute(\"settings\");\n                    },\n                    () => this.dispatchEvent(new CustomEvent(\"perspective-toggle-settings\", {detail: this._show_config}))\n                );\n            } else {\n                await this._post_resize(\n                    () => {\n                        this.toggleAttribute(\"settings\", true);\n                    },\n                    () => {\n                        this._side_panel.style.display = \"flex\";\n                        this._top_panel.style.display = \"flex\";\n                        this.dispatchEvent(new CustomEvent(\"perspective-toggle-settings\", {detail: this._show_config}));\n                    }\n                );\n            }\n        }\n    }\n\n    /**\n     * Given a targe `width` and `height`, pre-size the plugin before modifying\n     * the HTML to reduce visual tearing.\n     *\n     * @private\n     * @param {*} width\n     * @param {*} height\n     * @param {*} post Function to run once action is complete\n     * @param {*} [pre=undefined] Function to run once visual effects have been\n     * applied.  This may be before `post`, as pre-sizing will be delayed when\n     * the target size is a sub-window of the current view.\n     * @memberof ActionElement\n     */\n    async _pre_resize(width, height, post, pre = undefined) {\n        this._datavis.style.width = `${width}px`;\n        this._datavis.style.height = `${height}px`;\n        try {\n            if (!document.hidden && this.offsetParent) {\n                await this._plugin.resize.call(this);\n            }\n        } finally {\n            pre?.();\n            this._datavis.style.width = \"100%\";\n            this._datavis.style.height = \"100%\";\n            post();\n        }\n    }\n\n    async _post_resize(post, pre) {\n        pre?.();\n        try {\n            if (!document.hidden && this.offsetParent) {\n                await this._plugin.resize.call(this);\n            }\n        } finally {\n            post();\n        }\n    }\n\n    /**\n     * Display the computed expressions panel.\n     *\n     * @param {*} event\n     */\n    _open_computed_expression_editor(event) {\n        event.stopImmediatePropagation();\n        if (this._computed_expression_editor.expressions.length == 0) {\n            this._computed_expression_editor._disable_remove_button();\n        } else {\n            this._computed_expression_editor._enable_remove_button();\n        }\n        this._computed_expression_editor.style.display = \"flex\";\n        this._side_panel_actions.style.display = \"none\";\n        this._computed_expression_editor._observe_textarea();\n    }\n\n    /**\n     * Given an expression (in the `detail` property of the\n     * `perspective-computed-expression-save` event), retrieve the viewer's\n     * `computed-columns` array and append the new expression to be parsed.\n     *\n     * @param {*} event\n     */\n    _save_computed_expression(event) {\n        const expression = event.detail.expression;\n\n        // `computed-columns` stores the raw expression typed by the user.\n        let computed_columns = this._get_view_computed_columns();\n\n        if (computed_columns.includes(expression)) {\n            console.warn(`\"${expression}\" was not applied because it already exists.`);\n            return;\n        }\n\n        computed_columns.push(expression);\n\n        this.setAttribute(\"computed-columns\", JSON.stringify(computed_columns));\n    }\n\n    async _type_check_computed_expression(event) {\n        const parsed = event.detail.parsed_expression || [];\n        if (parsed.length === 0) {\n            this._computed_expression_editor._type_check_expression({});\n            return;\n        }\n        const functions = {};\n        for (const col of parsed) {\n            functions[col.column] = col.computed_function_name;\n        }\n        const schema = await this._table.computed_schema(parsed);\n        // Look at the failing values, and get their expected types\n        const expected_types = {};\n        for (const key in functions) {\n            if (!schema[key]) {\n                expected_types[key] = await this._table.get_computation_input_types(functions[key]);\n            }\n        }\n\n        this._computed_expression_editor._type_check_expression(schema, expected_types);\n    }\n\n    /**\n     * Remove all computed expressions from the DOM.\n     */\n    _clear_all_computed_expressions() {\n        this.setAttribute(\"computed-columns\", JSON.stringify([]));\n    }\n\n    _set_computed_expression(event) {\n        return event;\n    }\n\n    _column_visibility_clicked(ev) {\n        const parent = ev.currentTarget;\n        const is_active = parent.parentElement.getAttribute(\"id\") === \"active_columns\";\n        if (is_active) {\n            const min_columns = this._plugin.initial?.count || 1;\n            if (this._get_view_active_valid_column_count() === min_columns) {\n                return;\n            }\n            if (ev.detail.shiftKey) {\n                for (let child of Array.prototype.slice.call(this._active_columns.children)) {\n                    if (child !== parent) {\n                        this._active_columns.removeChild(child);\n                    }\n                }\n            } else {\n                const index = Array.prototype.slice.call(this._active_columns.children).indexOf(parent);\n                if (index < this._plugin.initial?.count) {\n                    return;\n                } else if (index < this._plugin.initial?.names?.length - 1) {\n                    this._active_columns.insertBefore(this._new_row(null), parent);\n                }\n                this._active_columns.removeChild(parent);\n            }\n        } else {\n            if ((ev.detail.shiftKey && this._plugin.selectMode === \"toggle\") || (!ev.detail.shiftKey && this._plugin.selectMode === \"select\")) {\n                for (let child of Array.prototype.slice.call(this._active_columns.children)) {\n                    this._active_columns.removeChild(child);\n                }\n            }\n            let row = this._new_row(parent.getAttribute(\"name\"), parent.getAttribute(\"type\"));\n            const cols = this._get_view_active_columns();\n            let i = cols.length - 1;\n            if (!cols[i] || !cols[i]?.classList.contains(\"null-column\")) {\n                this._active_columns.appendChild(row);\n            } else\n                while (i-- > 0) {\n                    if (!cols[i].classList.contains(\"null-column\")) {\n                        this._active_columns.replaceChild(row, cols[i + 1]);\n                        break;\n                    }\n                }\n        }\n        this._check_responsive_layout();\n        this._update_column_view();\n    }\n\n    _column_aggregate_clicked() {\n        let aggregates = this.get_aggregate_attribute();\n        let new_aggregates = this._get_view_aggregates();\n        for (let aggregate of aggregates) {\n            let updated_agg = new_aggregates.find(x => x.column === aggregate.column);\n            if (updated_agg) {\n                aggregate.op = updated_agg.op;\n            }\n        }\n        this.set_aggregate_attribute(aggregates);\n        this._update_column_view();\n        this._debounce_update();\n    }\n\n    _column_filter_clicked() {\n        let new_filters = this._get_view_filters();\n        this._updating_filter = true;\n        this.setAttribute(\"filters\", JSON.stringify(new_filters));\n        this._updating_filter = false;\n        this._debounce_update();\n    }\n\n    _increment_sort(sort, column_sorting, abs_sorting) {\n        let sort_orders = [\"asc\", \"desc\"];\n        if (column_sorting) {\n            sort_orders.push(\"col asc\", \"col desc\");\n        }\n        if (abs_sorting) {\n            sort_orders = sort_orders.map(x => `${x} abs`);\n        }\n        sort_orders.push(\"none\");\n        return sort_orders[(sort_orders.indexOf(sort) + 1) % sort_orders.length];\n    }\n\n    _sort_order_clicked(event) {\n        const row = event.target;\n        const abs_sorting = event.detail.shiftKey && row.getAttribute(\"type\") !== \"string\";\n        const new_sort_order = this._increment_sort(row.getAttribute(\"sort-order\"), this._get_view_column_pivots().length > 0, abs_sorting);\n        row.setAttribute(\"sort-order\", new_sort_order);\n\n        const sort = this._get_view_sorts();\n        this.setAttribute(\"sort\", JSON.stringify(sort));\n    }\n\n    // edits state\n    _transpose() {\n        const has_row = this.hasAttribute(\"row-pivots\");\n        const has_col = this.hasAttribute(\"column-pivots\");\n        if (has_row && has_col) {\n            let row_pivots = this.getAttribute(\"row-pivots\");\n            this.setAttribute(\"row-pivots\", this.getAttribute(\"column-pivots\"));\n            this.setAttribute(\"column-pivots\", row_pivots);\n        } else if (has_row) {\n            let row_pivots = this.getAttribute(\"row-pivots\");\n            this.removeAttribute(\"row-pivots\");\n            this.setAttribute(\"column-pivots\", row_pivots);\n        } else if (has_col) {\n            let column_pivots = this.getAttribute(\"column-pivots\");\n            this.removeAttribute(\"column-pivots\");\n            this.setAttribute(\"row-pivots\", column_pivots);\n        } else {\n            this.removeAttribute(\"column-pivots\");\n            this.removeAttribute(\"row-pivots\");\n        }\n    }\n\n    _reset_sidepanel() {\n        this._side_panel.style.width = \"\";\n    }\n\n    _resize_sidepanel(event) {\n        const initial = document.body.style.cursor;\n        document.body.style.cursor = \"col-resize\";\n        const start = event.clientX;\n        const width = this._side_panel.offsetWidth;\n        const resize = event => {\n            const new_width = Math.max(0, Math.min(width + (event.clientX - start), this.offsetWidth - 10));\n            this._side_panel.style.width = `${new_width}px`;\n            if (this._plugin) {\n                this.notifyResize();\n            }\n        };\n        const stop = () => {\n            document.body.style.cursor = initial;\n            document.removeEventListener(\"mousemove\", resize);\n            document.removeEventListener(\"mouseup\", stop);\n        };\n        document.addEventListener(\"mousemove\", resize);\n        document.addEventListener(\"mouseup\", stop);\n    }\n\n    _vis_selector_changed() {\n        this._plugin_information.classList.add(\"hidden\");\n        this.setAttribute(\"plugin\", this._vis_selector.value);\n        this._active_columns.classList.remove(\"one_lock\", \"two_lock\");\n        const classname = [\"one_lock\", \"two_lock\"][this._plugin.initial?.count - 1];\n        if (classname) {\n            this._active_columns.classList.add(classname);\n        }\n        this._debounce_update();\n    }\n\n    // most of these are drag and drop handlers - how to clean up?\n    _register_callbacks() {\n        this._sort.addEventListener(\"drop\", drop.bind(this));\n        this._sort.addEventListener(\"dragend\", dragend.bind(this));\n        this._sort.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._sort.addEventListener(\"dragover\", dragover.bind(this));\n        this._sort.addEventListener(\"dragleave\", dragleave.bind(this));\n        this._row_pivots.addEventListener(\"drop\", drop.bind(this));\n        this._row_pivots.addEventListener(\"dragend\", dragend.bind(this));\n        this._row_pivots.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._row_pivots.addEventListener(\"dragover\", dragover.bind(this));\n        this._row_pivots.addEventListener(\"dragleave\", dragleave.bind(this));\n        this._column_pivots.addEventListener(\"drop\", drop.bind(this));\n        this._column_pivots.addEventListener(\"dragend\", dragend.bind(this));\n        this._column_pivots.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._column_pivots.addEventListener(\"dragover\", dragover.bind(this));\n        this._column_pivots.addEventListener(\"dragleave\", dragleave.bind(this));\n        this._filters.addEventListener(\"drop\", drop.bind(this));\n        this._filters.addEventListener(\"dragend\", dragend.bind(this));\n        this._filters.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._filters.addEventListener(\"dragover\", dragover.bind(this));\n        this._filters.addEventListener(\"dragleave\", dragleave.bind(this));\n        this._active_columns.addEventListener(\"drop\", column_drop.bind(this));\n        this._active_columns.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._active_columns.addEventListener(\"dragend\", column_dragend.bind(this));\n        this._active_columns.addEventListener(\"dragover\", column_dragover.bind(this));\n        this._active_columns.addEventListener(\"dragleave\", column_dragleave.bind(this));\n        this._add_computed_expression_button.addEventListener(\"click\", this._open_computed_expression_editor.bind(this));\n        this._computed_expression_editor.addEventListener(\"perspective-computed-expression-save\", this._save_computed_expression.bind(this));\n        this._computed_expression_editor.addEventListener(\"perspective-computed-expression-resize\", this._reset_sidepanel.bind(this));\n        this._computed_expression_editor.addEventListener(\"perspective-computed-expression-type-check\", this._type_check_computed_expression.bind(this));\n        this._computed_expression_editor.addEventListener(\"perspective-computed-expression-remove\", this._clear_all_computed_expressions.bind(this));\n        this._computed_expression_editor.addEventListener(\"perspective-computed-expression-update\", this._set_computed_expression.bind(this));\n        this._config_button.addEventListener(\"mousedown\", this._toggle_config.bind(this));\n        this._config_button.addEventListener(\"contextmenu\", this._show_context_menu.bind(this));\n        this._reset_button.addEventListener(\"click\", this.reset.bind(this));\n        this._copy_button.addEventListener(\"click\", event => this.copy(event.shiftKey));\n        this._download_button.addEventListener(\"click\", event => this.download(event.shiftKey));\n        this._transpose_button.addEventListener(\"click\", this._transpose.bind(this));\n        this._drop_target.addEventListener(\"dragover\", dragover.bind(this));\n        this._resize_bar.addEventListener(\"mousedown\", this._resize_sidepanel.bind(this));\n        this._resize_bar.addEventListener(\"dblclick\", this._reset_sidepanel.bind(this));\n\n        this._vis_selector.addEventListener(\"change\", this._vis_selector_changed.bind(this));\n\n        this._plugin_information_action.addEventListener(\"click\", () => {\n            this._debounce_update({ignore_size_check: true, limit_points: false});\n            this._plugin_information.classList.add(\"hidden\");\n        });\n\n        this._plugin_information_action_close.addEventListener(\"click\", () => {\n            this._plugin_information.classList.add(\"hidden\");\n        });\n    }\n}\n","/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nimport \"@webcomponents/webcomponentsjs\";\r\nimport \"./polyfill.js\";\r\n\r\nimport {bindTemplate, json_attribute, array_attribute, copy_to_clipboard, throttlePromise} from \"./utils.js\";\r\nimport {renderers, register_debug_plugin} from \"./viewer/renderers.js\";\r\nimport \"./row.js\";\r\nimport \"./computed_expression_editor.js\";\r\n\r\nimport template from \"../html/viewer.html\";\r\n\r\nimport view_style from \"../less/viewer.less\";\r\nimport default_style from \"../less/default.less\";\r\n\r\nimport {ActionElement} from \"./viewer/action_element.js\";\r\nimport {expression_to_computed_column_config} from \"./computed_expressions/visitor.js\";\r\n\r\n/**\r\n * Module for the `<perspective-viewer>` custom element.\r\n *\r\n * This module has no exports, but importing it has a side\r\n * effect: the {@link module:perspective_viewer~PerspectiveViewer} class is\r\n * registered as a custom element, after which it can be used as a standard DOM\r\n * element.\r\n *\r\n * The documentation in this module defines the instance structure of a\r\n * `<perspective-viewer>` DOM object instantiated typically, through HTML or any\r\n * relevent DOM method e.g. `document.createElement(\"perspective-viewer\")` or\r\n * `document.getElementsByTagName(\"perspective-viewer\")`.\r\n *\r\n * @module perspective-viewer\r\n */\r\n\r\nconst PERSISTENT_ATTRIBUTES = [\"selectable\", \"editable\", \"plugin\", \"computed-columns\", \"row-pivots\", \"column-pivots\", \"aggregates\", \"filters\", \"sort\", \"columns\"];\r\n\r\n/**\r\n * The HTMLElement class for `<perspective-viewer>` custom element.\r\n *\r\n * This class is not exported, so this constructor cannot be invoked in the\r\n * typical manner; instead, instances of the class are created through the\r\n * Custom Elements DOM API.\r\n *\r\n * Properties of an instance of this class, such as\r\n * {@link module:perspective_viewer~PerspectiveViewer#columns}, are reflected on\r\n * the DOM element as Attributes, and should be accessed as such - e.g.\r\n * `instance.setAttribute(\"columns\", JSON.stringify([\"a\", \"b\"]))`.\r\n *\r\n * @class PerspectiveViewer\r\n * @extends {HTMLElement}\r\n * @example\r\n * // Create a new `<perspective-viewer>`\r\n * const elem = document.createElement(\"perspective-viewer\");\r\n * elem.setAttribute(\"columns\", JSON.stringify([\"a\", \"b\"]));\r\n * document.body.appendChild(elem);\r\n *\r\n */\r\n@bindTemplate(template, view_style, default_style) // eslint-disable-next-line no-unused-vars\r\nclass PerspectiveViewer extends ActionElement {\r\n    constructor() {\r\n        super();\r\n        this._register_debounce_instance();\r\n        this._show_config = true;\r\n        this._show_warnings = true;\r\n        this.__render_times = [];\r\n        this._resize_handler = this.notifyResize.bind(this);\r\n        window.addEventListener(\"resize\", this._resize_handler);\r\n    }\r\n\r\n    connectedCallback() {\r\n        if (Object.keys(renderers.getInstance()).length === 0) {\r\n            register_debug_plugin();\r\n        }\r\n\r\n        this.toggleAttribute(\"settings\", true);\r\n\r\n        this._register_ids();\r\n        this._register_callbacks();\r\n        this._register_view_options();\r\n        this._register_data_attribute();\r\n        this.toggleConfig();\r\n        this._check_loaded_table();\r\n    }\r\n\r\n    /**\r\n     * Sets this `perspective.table.view`'s `sort` property, an array of column\r\n     * names.\r\n     *\r\n     * @kind member\r\n     * @type {array<string>} Array of arrays tuples of column name and\r\n     * direction, where the possible values are \"asc\", \"desc\", \"asc abs\", \"desc\r\n     * abs\" and \"none\".\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     * @example <caption>via Javascript DOM</caption>\r\n     * let elem = document.getElementById('my_viewer');\r\n     * elem.setAttribute('sort', JSON.stringify([[\"x\",\"desc\"]));\r\n     * @example <caption>via HTML</caption>\r\n     * <perspective-viewer sort='[[\"x\",\"desc\"]]'></perspective-viewer>\r\n     */\r\n    @array_attribute\r\n    sort(sort) {\r\n        if (sort === null || sort === undefined || sort.length === 0) {\r\n            if (this.hasAttribute(\"sort\")) {\r\n                this.removeAttribute(\"sort\");\r\n            }\r\n            sort = [];\r\n        }\r\n        var inner = this._sort.querySelector(\"ul\");\r\n        this._update_column_list(\r\n            sort,\r\n            inner,\r\n            (s, computed_names) => {\r\n                let dir = \"asc\";\r\n                if (Array.isArray(s)) {\r\n                    dir = s[1];\r\n                    s = s[0];\r\n                }\r\n                let computed = undefined;\r\n                if (computed_names.includes(s)) {\r\n                    computed = s;\r\n                }\r\n                return this._new_row(s, false, false, false, dir, computed);\r\n            },\r\n            (sort, node) => {\r\n                if (Array.isArray(sort)) {\r\n                    return node.getAttribute(\"name\") === sort[0] && node.getAttribute(\"sort-order\") === sort[1];\r\n                }\r\n                return node.getAttribute(\"name\") === sort;\r\n            }\r\n        );\r\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n        this._debounce_update();\r\n    }\r\n\r\n    /**\r\n     * The set of visible columns.\r\n     *\r\n     * @kind member\r\n     * @param {array} columns An array of strings, the names of visible columns.\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     * @example <caption>via Javascript DOM</caption>\r\n     * let elem = document.getElementById('my_viewer');\r\n     * elem.setAttribute('columns', JSON.stringify([\"x\", \"y'\"]));\r\n     * @example <caption>via HTML</caption>\r\n     * <perspective-viewer columns='[\"x\", \"y\"]'></perspective-viewer>\r\n     */\r\n    @array_attribute\r\n    columns(show) {\r\n        if (show === null || show === undefined || show.length === 0) {\r\n            if (this.hasAttribute(\"columns\")) {\r\n                if (this._initial_col_order) {\r\n                    this.setAttribute(\"columns\", JSON.stringify(this._initial_col_order));\r\n                } else {\r\n                    this.removeAttribute(\"columns\");\r\n                }\r\n            }\r\n            show = (this._initial_col_order || []).slice();\r\n        }\r\n        this._update_column_view(show, true);\r\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n        this._debounce_update();\r\n    }\r\n\r\n    /* eslint-disable max-len */\r\n\r\n    /**\r\n     * The set of visible columns.\r\n     *\r\n     * @kind member\r\n     * @param {array} computed-columns An array of computed column objects\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     * @example <caption>via Javascript DOM</caption>\r\n     * let elem = document.getElementById('my_viewer');\r\n     * elem.setAttribute('computed-columns', JSON.stringify([{name: \"x+y\", computed_function_name: \"+\", inputs: [\"x\", \"y\"]}]));\r\n     * @example <caption>via HTML</caption>\r\n     * <perspective-viewer computed-columns=\"[{name:'x+y',computed_function_name:'+',inputs:['x','y']}]\"\"></perspective-viewer>\r\n     */\r\n    @array_attribute\r\n    \"computed-columns\"(computed_columns) {\r\n        const resolve = this._set_updating();\r\n\r\n        (async () => {\r\n            if (this._computed_expression_editor.style.display !== \"none\") {\r\n                this._computed_expression_editor._close_expression_editor();\r\n            }\r\n            if (computed_columns === null || computed_columns === undefined || computed_columns.length === 0) {\r\n                // Remove computed columns from the DOM, and reset the config\r\n                // to exclude all computed columns.\r\n                if (this.hasAttribute(\"computed-columns\")) {\r\n                    this.removeAttribute(\"computed-columns\");\r\n                    const parsed = this._get_view_parsed_computed_columns();\r\n                    this._reset_computed_column_view(parsed);\r\n                    this.removeAttribute(\"parsed-computed-columns\");\r\n                    resolve();\r\n                    return;\r\n                }\r\n                computed_columns = [];\r\n            }\r\n\r\n            let parsed_computed_columns = [];\r\n\r\n            for (const column of computed_columns) {\r\n                if (typeof column === \"string\") {\r\n                    // Either validated through the UI, or will be validated\r\n                    // here. TODO: rearchitect so we don't triple parse each\r\n                    // expression.\r\n                    parsed_computed_columns = parsed_computed_columns.concat(expression_to_computed_column_config(column));\r\n                } else {\r\n                    parsed_computed_columns.push(column);\r\n                }\r\n            }\r\n\r\n            // Attempt to validate the parsed computed columns against the Table\r\n            let computed_schema = {};\r\n\r\n            if (this._table) {\r\n                computed_schema = await this._table.computed_schema(parsed_computed_columns);\r\n                const validated = await this._validate_parsed_computed_columns(parsed_computed_columns, computed_schema);\r\n                if (validated.length !== parsed_computed_columns.length) {\r\n                    // Generate a diff error message with the invalid columns\r\n                    const diff = [];\r\n                    for (let i = 0; i < parsed_computed_columns.length; i++) {\r\n                        if (i > validated.length - 1) {\r\n                            diff.push(parsed_computed_columns[i]);\r\n                        } else {\r\n                            if (parsed_computed_columns[i].column !== validated[i].column) {\r\n                                diff.push(parsed_computed_columns[i]);\r\n                            }\r\n                        }\r\n                    }\r\n                    console.warn(\"Could not apply these computed columns:\", JSON.stringify(diff));\r\n                }\r\n                parsed_computed_columns = validated;\r\n            }\r\n\r\n            // Need to refresh the UI so that previous computed columns used in\r\n            // pivots, columns, etc. get cleared\r\n            const old_columns = this._get_view_parsed_computed_columns();\r\n            const to_remove = this._diff_computed_column_view(old_columns, parsed_computed_columns);\r\n            this._reset_computed_column_view(to_remove);\r\n\r\n            // Always store a copy of the parsed computed columns for\r\n            // validation of column names, etc.\r\n            this.setAttribute(\"parsed-computed-columns\", JSON.stringify(parsed_computed_columns));\r\n\r\n            this._update_computed_column_view(computed_schema);\r\n            this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n            await this._debounce_update();\r\n            resolve();\r\n        })();\r\n    }\r\n\r\n    /* eslint-enable max-len */\r\n\r\n    /**\r\n     * The set of column aggregate configurations.\r\n     *\r\n     * @kind member\r\n     * @param {object} aggregates A dictionary whose keys are column names, and\r\n     * values are valid aggregations. The `aggregates` attribute works as an\r\n     * override; in lieu of a key for a column supplied by the developers, a\r\n     * default will be selected and reflected to the attribute based on the\r\n     * column's type.  See {@link perspective/src/js/defaults.js}\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     * @example <caption>via Javascript DOM</caption>\r\n     * let elem = document.getElementById('my_viewer');\r\n     * elem.setAttribute('aggregates', JSON.stringify({x: \"distinct count\"}));\r\n     * @example <caption>via HTML</caption>\r\n     * <perspective-viewer aggregates='{\"x\": \"distinct count\"}'>\r\n     * </perspective-viewer>\r\n     */\r\n    @json_attribute\r\n    aggregates(show) {\r\n        if (show === null || show === undefined || Object.keys(show).length === 0) {\r\n            if (this.hasAttribute(\"aggregates\")) {\r\n                this.removeAttribute(\"aggregates\");\r\n            }\r\n            show = {};\r\n        }\r\n\r\n        let lis = this._get_view_dom_columns();\r\n        lis.map(x => {\r\n            let agg = show[x.getAttribute(\"name\")];\r\n            if (agg) {\r\n                x.setAttribute(\"aggregate\", Array.isArray(agg) ? JSON.stringify(agg) : agg);\r\n            }\r\n        });\r\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n        this._debounce_update();\r\n    }\r\n\r\n    /**\r\n     * The set of column filter configurations.\r\n     *\r\n     * @kind member\r\n     * @type {array} filters An array of filter config objects. A filter config\r\n     * object is an array of three elements: * The column name. * The filter\r\n     * operation as a string. See\r\n     * {@link perspective/src/js/config/constants.js} * The filter argument, as\r\n     * a string, float or Array<string> as the filter operation demands.\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     * @example <caption>via Javascript DOM</caption>\r\n     * let filters = [\r\n     *     [\"x\", \"<\", 3],\r\n     *     [\"y\", \"contains\", \"abc\"]\r\n     * ];\r\n     * let elem = document.getElementById('my_viewer');\r\n     * elem.setAttribute('filters', JSON.stringify(filters));\r\n     * @example <caption>via HTML</caption>\r\n     * <perspective-viewer filters='[[\"x\", \"<\", 3], [\"y\", \"contains\", \"abc\"]]'>\r\n     * </perspective-viewer>\r\n     */\r\n    @array_attribute\r\n    filters(filters) {\r\n        if (filters === null || filters === undefined || filters.length === 0) {\r\n            if (this.hasAttribute(\"filters\")) {\r\n                this.removeAttribute(\"filters\");\r\n            }\r\n            filters = [];\r\n        }\r\n        if (!this._updating_filter) {\r\n            var inner = this._filters.querySelector(\"ul\");\r\n            this._update_column_list(\r\n                filters,\r\n                inner,\r\n                (filter, computed_names) => {\r\n                    const fterms = JSON.stringify({\r\n                        operator: filter[1],\r\n                        operand: filter[2]\r\n                    });\r\n                    const name = filter[0];\r\n                    let computed = undefined;\r\n                    if (computed_names.includes(name)) {\r\n                        computed = name;\r\n                    }\r\n                    return this._new_row(name, undefined, undefined, fterms, undefined, computed);\r\n                },\r\n                (filter, node) =>\r\n                    node.getAttribute(\"name\") === filter[0] &&\r\n                    node.getAttribute(\"filter\") ===\r\n                        JSON.stringify({\r\n                            operator: filter[1],\r\n                            operand: filter[2]\r\n                        })\r\n            );\r\n        }\r\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n        this._debounce_update();\r\n    }\r\n\r\n    /**\r\n     * Sets the currently selected plugin, via its `name` field, and removes\r\n     * any children the previous plugin may have left behind in the light DOM.\r\n     *\r\n     * @type {string}\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     */\r\n    set plugin(v) {\r\n        if (v === \"null\" || v === null || v === undefined) {\r\n            this.setAttribute(\"plugin\", this._vis_selector.options[0].value);\r\n            return;\r\n        }\r\n        this.innerHTML = \"\";\r\n        const plugin_names = Object.keys(renderers.getInstance());\r\n        if (this.hasAttribute(\"plugin\")) {\r\n            let plugin = this.getAttribute(\"plugin\");\r\n            if (plugin_names.indexOf(plugin) === -1) {\r\n                const guess_plugin = plugin_names.find(x => x.indexOf(plugin) > -1);\r\n                if (guess_plugin) {\r\n                    console.warn(`Unknown plugin \"${plugin}\", using \"${guess_plugin}\"`);\r\n                    this.setAttribute(\"plugin\", guess_plugin);\r\n                } else {\r\n                    console.error(`Unknown plugin \"${plugin}\"`);\r\n                    this.setAttribute(\"plugin\", this._vis_selector.options[0].value);\r\n                }\r\n            } else {\r\n                if (this._vis_selector.value !== plugin) {\r\n                    this._vis_selector.value = plugin;\r\n                    this._vis_selector_changed();\r\n                }\r\n                this._set_row_styles();\r\n                this._set_column_defaults();\r\n                this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n            }\r\n        } else {\r\n            this.setAttribute(\"plugin\", this._vis_selector.options[0].value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets this `perspective.table.view`'s `column_pivots` property.\r\n     *\r\n     * @kind member\r\n     * @type {Array<String>} Array of column names\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     */\r\n    @array_attribute\r\n    \"column-pivots\"(pivots) {\r\n        if (pivots === null || pivots === undefined || pivots.length === 0) {\r\n            if (this.hasAttribute(\"column-pivots\")) {\r\n                this.removeAttribute(\"column-pivots\");\r\n            }\r\n            pivots = [];\r\n        }\r\n\r\n        const inner = this._column_pivots.querySelector(\"ul\");\r\n        this._update_column_list(pivots, inner, (pivot, computed_names) => {\r\n            let computed = undefined;\r\n            if (computed_names.includes(pivot)) {\r\n                computed = pivot;\r\n            }\r\n            return this._new_row(pivot, undefined, undefined, undefined, undefined, computed);\r\n        });\r\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n        this._debounce_update();\r\n    }\r\n\r\n    /**\r\n     * Sets this `perspective.table.view`'s `row_pivots` property.\r\n     *\r\n     * @kind member\r\n     * @type {array<string>} Array of column names\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     */\r\n    @array_attribute\r\n    \"row-pivots\"(pivots) {\r\n        if (pivots === null || pivots === undefined || pivots.length === 0) {\r\n            if (this.hasAttribute(\"row-pivots\")) {\r\n                this.removeAttribute(\"row-pivots\");\r\n            }\r\n            pivots = [];\r\n        }\r\n\r\n        const inner = this._row_pivots.querySelector(\"ul\");\r\n        this._update_column_list(pivots, inner, (pivot, computed_names) => {\r\n            let computed = undefined;\r\n            if (computed_names.includes(pivot)) {\r\n                computed = pivot;\r\n            }\r\n            return this._new_row(pivot, undefined, undefined, undefined, undefined, computed);\r\n        });\r\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n        this._debounce_update();\r\n    }\r\n\r\n    /**\r\n     * Determines whether this viewer is editable or not (though it is\r\n     * ultimately up to the plugin as to whether editing is implemented).\r\n     *\r\n     * @kind member\r\n     * @type {boolean} Is this viewer editable?\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     */\r\n    set editable(x) {\r\n        if (x === \"null\") {\r\n            if (this.hasAttribute(\"editable\")) {\r\n                this.removeAttribute(\"editable\");\r\n            }\r\n        } else {\r\n            this.toggleAttribute(\"editable\", true);\r\n        }\r\n        this._debounce_update({force_update: true});\r\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n    }\r\n\r\n    /**\r\n     * Determines the render throttling behavior. Can be an integer, for\r\n     * millisecond window to throttle render event; or, if `undefined`,\r\n     * will try to determine the optimal throttle time from this component's\r\n     * render framerate.\r\n     *\r\n     * @kind member\r\n     * @type {integer|string} The throttle rate - milliseconds (integer), or the\r\n     * enum \"adaptive\" for a dynamic throttle based on render time.\r\n     * @example\r\n     * <!-- Only draws at most 1 frame/sec. -->\r\n     * <perspective-viewer throttle=\"1000\"></perspective-viewer>\r\n     */\r\n    set throttle(x) {\r\n        if (x === \"null\") {\r\n            if (this.hasAttribute(\"throttle\")) {\r\n                this.removeAttribute(\"throttle\");\r\n            }\r\n        }\r\n        // Returns the throttle time, but also perform validaiton - we only want\r\n        // the latter here.\r\n        this._calculate_throttle_timeout();\r\n    }\r\n\r\n    /*\r\n     * Determines whether row selections is enabled on this viewer (though it is\r\n     * ultimately up to the plugin as to whether selectable is implemented).\r\n     *\r\n     * @kind member\r\n     * @type {boolean} Is this viewer editable?\r\n     * @fires PerspectiveViewer#perspective-config-update\r\n     */\r\n    set selectable(x) {\r\n        if (x === \"null\") {\r\n            if (this.hasAttribute(\"selectable\")) {\r\n                this.removeAttribute(\"selectable\");\r\n            }\r\n        } else {\r\n            this.toggleAttribute(\"selectable\", true);\r\n        }\r\n        this._debounce_update({force_update: true});\r\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n    }\r\n\r\n    /**\r\n     * This element's `perspective` worker instance. This property is not\r\n     * reflected as an HTML attribute, and is readonly; it can be effectively\r\n     * set however by calling the `load() method with a `perspective.table`\r\n     * instance from the preferred worker.\r\n     *\r\n     * @readonly\r\n     * @example\r\n     * let elem = document.getElementById('my_viewer');\r\n     * let table = elem.worker.table([{x:1, y:2}]);\r\n     * elem.load(table);\r\n     */\r\n    get worker() {\r\n        return this._get_worker();\r\n    }\r\n\r\n    /**\r\n     * This element's `perspective.table` instance.\r\n     *\r\n     * @readonly\r\n     */\r\n    get table() {\r\n        return this._table;\r\n    }\r\n\r\n    /**\r\n     * This element's `perspective.table.view` instance. The instance itself\r\n     * will change after every `PerspectiveViewer#perspective-config-update`\r\n     * event.\r\n     *\r\n     * @readonly\r\n     */\r\n    get view() {\r\n        return this._view;\r\n    }\r\n\r\n    /**\r\n     * Load data. If `load` or `update` have already been called on this\r\n     * element, its internal `perspective.table` will also be deleted.\r\n     *\r\n     * @async\r\n     * @param {any} data The data to load.  Works with the same input types\r\n     * supported by `perspective.table`.\r\n     * @returns {Promise<void>} A promise which resolves once the data is loaded\r\n     * and a `perspective.view` has been created.\r\n     * @fires module:perspective_viewer~PerspectiveViewer#perspective-click\r\n     * PerspectiveViewer#perspective-view-update\r\n     * ]);\r\n     * @example <caption>Load CSV</caption>\r\n     * const my_viewer = document.getElementById('#my_viewer');\r\n     * my_viewer.load(\"x,y\\n1,a\\n2,b\");\r\n     * @example <caption>Load perspective.table</caption>\r\n     * const my_viewer = document.getElementById('#my_viewer');\r\n     * const tbl = perspective.table(\"x,y\\n1,a\\n2,b\");\r\n     * my_viewer.load(tbl);\r\n     * @example <caption>Load Promise<perspective.table></caption>\r\n     * const my_viewer = document.getElementById('#my_viewer');\r\n     * const tbl = async () => perspective.table(\"x,y\\n1,a\\n2,b\");\r\n     * my_viewer.load(tbl);\r\n     */\r\n    async load(data, options) {\r\n        let table;\r\n        if (data instanceof Promise) {\r\n            table = await data;\r\n        } else {\r\n            try {\r\n                data = data.trim();\r\n            } catch (e) {}\r\n            if (data.type === \"table\") {\r\n                table = data;\r\n            } else {\r\n                table = this.worker.table(data, options);\r\n                table._owner_viewer = this;\r\n            }\r\n        }\r\n        if (this.isConnected) {\r\n            await this._load_table(table);\r\n        } else {\r\n            this._table = table;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates this element's `perspective.table` with new data.\r\n     *\r\n     * @param {any} data The data to load.  Works with the same input types\r\n     * supported by `perspective.table.update`.\r\n     * @fires PerspectiveViewer#perspective-view-update\r\n     * @example\r\n     * const my_viewer = document.getElementById('#my_viewer');\r\n     * my_viewer.update([\r\n     *     {x: 1, y: 'a'},\r\n     *     {x: 2, y: 'b'}\r\n     * ]);\r\n     */\r\n    update(data) {\r\n        if (this._table === undefined) {\r\n            this.load(data);\r\n        } else {\r\n            this._table.update(data);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Determine whether to reflow the viewer and redraw.\r\n     *\r\n     */\r\n    @throttlePromise\r\n    async notifyResize(immediate) {\r\n        const resized = await this._check_responsive_layout();\r\n        if (!resized && !document.hidden && this.offsetParent) {\r\n            await this._plugin.resize.call(this, immediate);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Duplicate an existing `<perspective-element>`, including data and view\r\n     * settings.  The underlying `perspective.table` will be shared between both\r\n     * elements\r\n     *\r\n     * @param {any} widget A `<perspective-viewer>` instance to clone.\r\n     */\r\n    clone(widget) {\r\n        if (this._inner_drop_target) {\r\n            this._inner_drop_target.innerHTML = widget._inner_drop_target.innerHTML;\r\n        }\r\n\r\n        this._load_table(widget.table);\r\n        this.restore(widget.save());\r\n    }\r\n\r\n    /**\r\n     * Deletes this element's data and clears it's internal state (but not its\r\n     * user state).  This (or the underlying `perspective.table`'s equivalent\r\n     * method) must be called in order for its memory to be reclaimed.\r\n     *\r\n     * @param {boolean} delete_table Should a delete call also be made to the\r\n     * underlying `table()`.\r\n     * @returns {Promise<boolean>} Whether or not this call resulted in the\r\n     * underlying `perspective.table` actually being deleted.\r\n     */\r\n    delete(delete_table = true) {\r\n        let x = this._clear_state(delete_table);\r\n        if (this._plugin.delete) {\r\n            this._plugin.delete.call(this);\r\n        }\r\n        window.removeEventListener(\"load\", this._resize_handler);\r\n        window.removeEventListener(\"resize\", this._resize_handler);\r\n        return x;\r\n    }\r\n\r\n    /**\r\n     * Restyles the elements and to pick up any style changes\r\n     */\r\n    restyleElement() {\r\n        this._restyle_plugin();\r\n    }\r\n\r\n    /**\r\n     * Serialize this element's attribute/interaction state.\r\n     *\r\n     * @returns {object} a serialized element.\r\n     */\r\n    save() {\r\n        let obj = {};\r\n        const cols = new Set(PERSISTENT_ATTRIBUTES);\r\n        for (let key = 0; key < this.attributes.length; key++) {\r\n            let attr = this.attributes[key];\r\n            if (cols.has(attr.name)) {\r\n                if (attr.value === \"\") {\r\n                    obj[attr.name] = true;\r\n                } else if (attr.name !== \"plugin\" && attr.value !== undefined && attr.value !== null) {\r\n                    obj[attr.name] = JSON.parse(attr.value);\r\n                } else {\r\n                    obj[attr.name] = attr.value;\r\n                }\r\n                cols.delete(attr.name);\r\n            }\r\n        }\r\n        for (const col of cols) {\r\n            obj[col] = null;\r\n        }\r\n        if (this._plugin.save) {\r\n            obj.plugin_config = this._plugin.save.call(this);\r\n        }\r\n        return obj;\r\n    }\r\n\r\n    /**\r\n     * Restore this element to a state as generated by a reciprocal call to\r\n     * `save` or `serialize`.\r\n     *\r\n     * @param {object|string} config returned by `save` or `serialize`.\r\n     * @returns {Promise<void>} A promise which resolves when the changes have\r\n     * been applied.\r\n     */\r\n    async restore(config) {\r\n        if (typeof config === \"string\") {\r\n            config = JSON.parse(config);\r\n        }\r\n        for (const key of PERSISTENT_ATTRIBUTES) {\r\n            if (config.hasOwnProperty(key)) {\r\n                let val = config[key];\r\n                if (val === true) {\r\n                    this.toggleAttribute(key, true);\r\n                } else if (val !== undefined && val !== null && val !== false) {\r\n                    if (typeof val !== \"string\") {\r\n                        val = JSON.stringify(val);\r\n                    }\r\n                    this.setAttribute(key, val);\r\n                } else {\r\n                    this.removeAttribute(key);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this._plugin.restore && config.plugin_config) {\r\n            this._plugin.restore.call(this, config.plugin_config);\r\n        }\r\n        await this._debounce_update();\r\n    }\r\n\r\n    /**\r\n     * Flush any pending attribute modifications to this element.\r\n     *\r\n     * @returns {Promise<void>} A promise which resolves when the current\r\n     * attribute state has been applied.\r\n     */\r\n    async flush() {\r\n        await new Promise(setTimeout);\r\n        while (this.hasAttribute(\"updating\")) {\r\n            await this._updating_promise;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clears the rows in the current {@link table}.\r\n     */\r\n    clear() {\r\n        this._table?.clear();\r\n    }\r\n\r\n    /**\r\n     * Replaces all rows in the current {@link table}.\r\n     */\r\n    replace(data) {\r\n        this._table ? this._table.replace(data) : this._load(data);\r\n    }\r\n\r\n    /**\r\n     * Reset's this element's view state and attributes to default.  Does not\r\n     * delete this element's `perspective.table` or otherwise modify the data\r\n     * state.\r\n     */\r\n    reset() {\r\n        this.removeAttribute(\"row-pivots\");\r\n        this.removeAttribute(\"column-pivots\");\r\n        this.removeAttribute(\"filters\");\r\n        this.removeAttribute(\"sort\");\r\n        if (this._initial_col_order) {\r\n            this.setAttribute(\"columns\", JSON.stringify(this._initial_col_order));\r\n        } else {\r\n            this.removeAttribute(\"columns\");\r\n        }\r\n        this.setAttribute(\"plugin\", Object.keys(renderers.getInstance())[0]);\r\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\r\n        this._hide_context_menu();\r\n    }\r\n\r\n    /**\r\n     * Download this element's data as a CSV file.\r\n     *\r\n     * @param {boolean} [flat=false] Whether to use the element's current view\r\n     * config, or to use a default \"flat\" view.\r\n     * @memberof PerspectiveViewer\r\n     */\r\n    async download(flat = false) {\r\n        const view = flat ? this._table.view() : this._view;\r\n        const csv = await view.to_csv();\r\n        const element = document.createElement(\"a\");\r\n        const binStr = csv;\r\n        const len = binStr.length;\r\n        const arr = new Uint8Array(len);\r\n        for (let i = 0; i < len; i++) {\r\n            arr[i] = binStr.charCodeAt(i);\r\n        }\r\n        const blob = new Blob([arr]);\r\n        element.setAttribute(\"href\", URL.createObjectURL(blob));\r\n        element.setAttribute(\"download\", \"perspective.csv\");\r\n        element.style.display = \"none\";\r\n        document.body.appendChild(element);\r\n        element.click();\r\n        document.body.removeChild(element);\r\n        this._hide_context_menu();\r\n    }\r\n\r\n    /**\r\n     * Copies this element's view data (as a CSV) to the clipboard.  This method\r\n     * must be called from an event handler, subject to the browser's\r\n     * restrictions on clipboard access.  See\r\n     * {@link https://www.w3.org/TR/clipboard-apis/#allow-read-clipboard}.\r\n     */\r\n    copy(flat = false) {\r\n        let data;\r\n        const view = flat ? this._table.view() : this._view;\r\n        view.to_csv()\r\n            .then(csv => {\r\n                data = csv;\r\n            })\r\n            .catch(err => {\r\n                console.error(err);\r\n                data = \"\";\r\n            });\r\n        let count = 0;\r\n        let f = () => {\r\n            if (typeof data !== \"undefined\") {\r\n                copy_to_clipboard(data);\r\n            } else if (count < 200) {\r\n                count++;\r\n                setTimeout(f, 50);\r\n            } else {\r\n                console.warn(\"Timeout expired - copy to clipboard cancelled.\");\r\n            }\r\n        };\r\n        f();\r\n        this._hide_context_menu();\r\n    }\r\n\r\n    /**\r\n     * Opens/closes the element's config menu.\r\n     *\r\n     * @async\r\n     */\r\n    async toggleConfig() {\r\n        await this._toggle_config();\r\n    }\r\n}\r\n\r\n/**\r\n * `perspective-click` is fired whenever underlying `view`'s grid or chart are\r\n * clicked providing a detail that includes a `config`, `column_names` and\r\n * `row`.\r\n *\r\n * @event module:perspective_viewer~PerspectiveViewer#perspective-click\r\n * @type {object}\r\n * @property {array} column_names - Includes a list of column names.\r\n * @property {object} config - Contains a property `filters` that can be applied\r\n * to a `<perspective-viewer>` through the use of `restore()` updating it to\r\n * show the filtered subset of data..\r\n * @property {array} row - Includes the data row.\r\n */\r\n\r\n/**\r\n * `perspective-config-update` is fired whenever an configuration attribute has\r\n * been modified, by the user or otherwise.\r\n *\r\n * @event module:perspective_viewer~PerspectiveViewer#perspective-config-update\r\n * @type {string}\r\n */\r\n\r\n/**\r\n * `perspective-view-update` is fired whenever underlying `view`'s data has\r\n * updated, including every invocation of `load` and `update`.\r\n *\r\n * @event module:perspective_viewer~PerspectiveViewer#perspective-view-update\r\n * @type {string}\r\n */\r\n"],"sourceRoot":""}