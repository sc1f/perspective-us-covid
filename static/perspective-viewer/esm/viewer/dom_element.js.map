{"version":3,"sources":["../../../src/js/viewer/dom_element.js"],"names":["get_type_config","dragend","renderers","PerspectiveElement","html","render","options","vals","opts","name","push","DomElement","_clear_columns","_inactive_columns","innerHTML","_active_columns","set_aggregate_attribute","aggs","is_set","aggregates","reduce","obj","agg","_aggregate_defaults","column","op","setAttribute","JSON","stringify","removeAttribute","_get_type","all","_get_view_inactive_columns","length","type","find","x","getAttribute","_set_row_type","row","weights","filter","map","set_weights","_new_row","aggregate","sort","computed","document","createElement","get_aggregate_attribute","view","_table","row_pivots","to_json","then","json","choices","_autocomplete_choices","delete","_get_view_column_pivots","indexOf","classList","add","Array","isArray","addEventListener","_column_visibility_clicked","bind","_column_aggregate_clicked","_column_filter_clicked","event","call","detail","_sort_order_clicked","style","overflow","_original_index","prototype","slice","children","findIndex","_drop_target_hover","setTimeout","remove","_update_computed_column_view","computed_schema","computed_columns","_get_view_parsed_computed_columns","columns","_get_view_all_column_names","active","_get_view_active_column_names","Object","keys","added_count","attr","parse","reset_columns_attr","cc","should_reset","includes","should_add","appendChild","_update_column_view","parentElement","contains","_diff_computed_column_view","old_computed_columns","new_computed_columns","to_remove","new_names","_reset_computed_column_view","computed_names","filtered_active","_get_view_aggregates","rp","_get_view_row_pivots","cp","_get_view_sorts","filters","_get_view_filters","inactive_computed","_get_view_all_columns","col","removeChild","pop_cols","_get_view_active_columns","lis","reset","_plugin","initial","names","forEach","index","_update_column_list","ref","undefined","container","callback","accessor","y","active_columns","i","j","next_col","node","replaceChild","insertBefore","_set_row_styles","nidx","parseInt","shadowRoot","querySelector","_show_column_container","visibility","_show_side_panel_actions","_remove_null_columns","since_index","elems","elem","_set_column_defaults","cols","active_cols","_get_view_active_valid_columns","valid_active_cols","_get_view_active_valid_column_names","pref","count","_fill_numeric","labels","selectMode","bypass","_check_responsive_layout","app","clientHeight","clientWidth","_get_view_columns","old","_persisted_side_panel_width","_side_panel","width","panel","height","_pre_resize","_register_ids","_aggregate_selector","_vis_selector","_filters","_row_pivots","_column_pivots","_datavis","_side_panel_actions","_add_computed_expression_button","_computed_expression_editor","_inner_drop_target","_drop_target","_config_button","_reset_button","_download_button","_copy_button","_top_panel","_sort","_transpose_button","_plugin_information","_plugin_information_action","_plugin_information_action_close","_plugin_information_message","_resize_bar","_register_view_options","current_renderers","getInstance","_register_data_attribute","data","e","load","__ROW_PATH__","v"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\nimport {dragend} from \"./dragdrop.js\";\nimport {renderers} from \"./renderers.js\";\n\nimport {PerspectiveElement} from \"./perspective_element.js\";\nimport {html, render} from \"lit-html\";\n\n/**\n * Render `<option>` blocks\n * @param {*} names name objects\n */\nconst options = vals => {\n    const opts = [];\n    for (name in vals) {\n        opts.push(html`\n            <option value=\"${name}\">${vals[name].name || name}</option>\n        `);\n    }\n    return opts;\n};\n\nexport class DomElement extends PerspectiveElement {\n    _clear_columns() {\n        this._inactive_columns.innerHTML = \"\";\n        this._active_columns.innerHTML = \"\";\n    }\n\n    set_aggregate_attribute(aggs) {\n        let is_set = false;\n        let aggregates = aggs.reduce((obj, agg) => {\n            if (this._aggregate_defaults[agg.column] !== agg.op) {\n                obj[agg.column] = agg.op;\n                is_set = true;\n            }\n            return obj;\n        }, {});\n        if (is_set) {\n            this.setAttribute(\"aggregates\", JSON.stringify(aggregates));\n        } else {\n            this.removeAttribute(\"aggregates\");\n        }\n    }\n\n    _get_type(name) {\n        let all = this._get_view_inactive_columns();\n        if (all.length > 0) {\n            const type = all.find(x => x.getAttribute(\"name\") === name);\n            if (type) {\n                return type.getAttribute(\"type\");\n            } else {\n                return \"integer\";\n            }\n        } else {\n            return \"\";\n        }\n    }\n\n    _set_row_type(row) {\n        const weights = this._get_view_inactive_columns()\n            .filter(x => x.getAttribute(\"type\") === \"integer\" || x.getAttribute(\"type\") === \"float\")\n            .map(x => x.getAttribute(\"name\"));\n        row.set_weights(weights);\n        row.setAttribute(\"type\", this._get_type(row.getAttribute(\"name\")));\n    }\n\n    // Generates a new row in state + DOM\n    _new_row(name, type, aggregate, filter, sort, computed) {\n        let row = document.createElement(\"perspective-row\");\n        type = type || this._get_type(name);\n\n        if (!aggregate) {\n            let aggregates = this.get_aggregate_attribute();\n            if (aggregates) {\n                aggregate = aggregates.find(x => x.column === name);\n                if (aggregate) {\n                    aggregate = aggregate.op;\n                } else {\n                    aggregate = get_type_config(type).aggregate;\n                }\n            } else {\n                aggregate = get_type_config(type).aggregate;\n            }\n        }\n\n        if (filter) {\n            row.setAttribute(\"filter\", filter);\n\n            if (type === \"string\") {\n                const view = this._table.view({row_pivots: [name], aggregates: {}});\n                view.to_json().then(json => {\n                    row.choices(this._autocomplete_choices(json));\n                });\n                view.delete();\n            }\n        }\n\n        if (sort) {\n            row.setAttribute(\"sort-order\", sort);\n        } else {\n            if (this._get_view_column_pivots().indexOf(name) > -1) {\n                row.setAttribute(\"sort-order\", \"col asc\");\n            } else {\n                row.setAttribute(\"sort-order\", \"asc\");\n            }\n        }\n\n        const weights = this._get_view_inactive_columns()\n            .filter(x => x.getAttribute(\"type\") === \"integer\" || x.getAttribute(\"type\") === \"float\")\n            .map(x => x.getAttribute(\"name\"));\n        row.set_weights(weights);\n\n        if (name === null) {\n            row.classList.add(\"null-column\");\n        } else {\n            row.setAttribute(\"type\", type);\n            row.setAttribute(\"name\", name);\n        }\n\n        row.setAttribute(\"aggregate\", Array.isArray(aggregate) ? JSON.stringify(aggregate) : aggregate);\n\n        row.addEventListener(\"visibility-clicked\", this._column_visibility_clicked.bind(this));\n        row.addEventListener(\"aggregate-selected\", this._column_aggregate_clicked.bind(this));\n        row.addEventListener(\"filter-selected\", this._column_filter_clicked.bind(this));\n        row.addEventListener(\"close-clicked\", event => dragend.call(this, event.detail));\n        row.addEventListener(\"sort-order\", this._sort_order_clicked.bind(this));\n\n        row.addEventListener(\"row-drag\", () => {\n            this.classList.add(\"dragging\");\n            this._active_columns.style.overflow = \"hidden\";\n            this._original_index = Array.prototype.slice.call(this._active_columns.children).findIndex(x => x.getAttribute(\"name\") === name);\n            if (this._original_index !== -1) {\n                this._drop_target_hover = this._active_columns.children[this._original_index];\n                setTimeout(() => row.setAttribute(\"drop-target\", true));\n            } else {\n                this._drop_target_hover = this._new_row(name, type, aggregate);\n            }\n        });\n        row.addEventListener(\"row-dragend\", () => {\n            this._active_columns.style.overflow = \"auto\";\n            this.classList.remove(\"dragging\");\n        });\n\n        if (computed) {\n            row.setAttribute(\"computed_column\", JSON.stringify(computed));\n            row.classList.add(\"computed\");\n        }\n\n        return row;\n    }\n\n    /**\n     * Using a computed schema generated in the attribute callback, add\n     * computed columns to the inactive columns area if they're not specified\n     * to be inserted anywhere else in the UI.\n     */\n    _update_computed_column_view(computed_schema) {\n        const computed_columns = this._get_view_parsed_computed_columns();\n        const columns = this._get_view_all_column_names();\n        const active = this._get_view_active_column_names();\n\n        if (Object.keys(computed_schema).length === 0 || computed_columns.length === 0) {\n            return;\n        }\n\n        let added_count = 0;\n\n        const attr = JSON.parse(this.getAttribute(\"columns\")) || [];\n        let reset_columns_attr = false;\n\n        for (const cc of computed_columns) {\n            const name = cc.column;\n\n            // Check for whether the computed column is in the attribute but\n            // NOT in the DOM - occurs when restore is called and a race\n            // condition between `computed-columns` and `columns` occurs.\n            const should_reset = !columns.includes(name) && attr.includes(name);\n\n            if (should_reset) {\n                reset_columns_attr = true;\n            }\n\n            // If the column already exists or is already in the active DOM,\n            // don't add it to the inactive DOM\n            const should_add = !columns.includes(name) && !active.includes(name);\n\n            if (!should_add) {\n                continue;\n            }\n\n            const row = this._new_row(name, computed_schema[name], null, null, null, name);\n            this._inactive_columns.appendChild(row);\n            added_count++;\n        }\n\n        if (reset_columns_attr) {\n            this._update_column_view(attr, true);\n        } else {\n            // Remove collapse so that new inactive columns show up\n            if (added_count > 0 && this._inactive_columns.parentElement.classList.contains(\"collapse\")) {\n                this._inactive_columns.parentElement.classList.remove(\"collapse\");\n            }\n        }\n    }\n\n    /**\n     * Given two sets of computed columns, remove columns that are present in\n     * `old_computed_columns` but not `new_computed_columns`, and return a\n     * list of computed column definitions to remove.\n     *\n     * @param {*} old_computed_columns\n     * @param {*} new_computed_columns\n     */\n    _diff_computed_column_view(old_computed_columns, new_computed_columns) {\n        const to_remove = [];\n        const new_names = new_computed_columns.map(x => x.column);\n        for (const column of old_computed_columns) {\n            if (!new_names.includes(column.column)) {\n                to_remove.push(column);\n            }\n        }\n        return to_remove;\n    }\n\n    /**\n     * When the `computed-columns` attribute is set to [], null, or undefined,\n     * clear all previously created columns from the UI.\n     */\n    _reset_computed_column_view(computed_columns) {\n        if (!computed_columns || computed_columns.length === 0) {\n            return;\n        }\n\n        const computed_names = computed_columns.map(x => x.column);\n\n        // Remove computed columns from all\n        const filtered_active = this._get_view_active_column_names().filter(x => !computed_names.includes(x));\n\n        const aggregates = this._get_view_aggregates().filter(x => !computed_names.includes(x.column));\n        const rp = this._get_view_row_pivots().filter(x => !computed_names.includes(x));\n        const cp = this._get_view_column_pivots().filter(x => !computed_names.includes(x));\n        const sort = this._get_view_sorts().filter(x => !computed_names.includes(x[0]));\n        const filters = this._get_view_filters().filter(x => !computed_names.includes(x[0]));\n\n        // Aggregates as an array is from the attribute API\n        this.set_aggregate_attribute(aggregates);\n\n        this.setAttribute(\"columns\", JSON.stringify(filtered_active));\n        this.setAttribute(\"row-pivots\", JSON.stringify(rp));\n        this.setAttribute(\"column-pivots\", JSON.stringify(cp));\n        this.setAttribute(\"sort\", JSON.stringify(sort));\n        this.setAttribute(\"filters\", JSON.stringify(filters));\n\n        // Remove inactive computed columns\n        const inactive_computed = this._get_view_all_columns().filter(x => x.classList.contains(\"computed\"));\n\n        for (const col of inactive_computed) {\n            this._inactive_columns.removeChild(col);\n        }\n\n        // Re-check on whether to collapse inactive columns\n        const pop_cols = this._get_view_active_columns().filter(x => typeof x !== \"undefined\" && x !== null);\n        const lis = this._get_view_inactive_columns();\n\n        if (pop_cols.length === lis.length) {\n            this._inactive_columns.parentElement.classList.add(\"collapse\");\n        } else {\n            this._inactive_columns.parentElement.classList.remove(\"collapse\");\n        }\n    }\n\n    _update_column_view(columns, reset = false) {\n        if (!columns) {\n            columns = this._get_view_active_column_names();\n        }\n\n        if (this._plugin.initial && this._plugin.initial.names) {\n            while (columns.length < this._plugin.initial.names.length) {\n                columns.push(null);\n            }\n        }\n\n        // If columns were not passed in, this is needed to keep the attribute\n        // API in sync with DOM state.\n        this.setAttribute(\"columns\", JSON.stringify(columns));\n\n        const pop_cols = columns.filter(x => typeof x !== \"undefined\" && x !== null);\n        const lis = this._get_view_inactive_columns();\n        if (pop_cols.length === lis.length) {\n            this._inactive_columns.parentElement.classList.add(\"collapse\");\n        } else {\n            this._inactive_columns.parentElement.classList.remove(\"collapse\");\n        }\n        lis.forEach(x => {\n            const index = pop_cols.indexOf(x.getAttribute(\"name\"));\n            if (index === -1) {\n                x.classList.remove(\"active\");\n            } else {\n                x.classList.add(\"active\");\n            }\n        });\n        if (reset) {\n            this._update_column_list(columns, this._active_columns, (name, computed_names) => {\n                if (name === null) {\n                    return this._new_row(null);\n                } else {\n                    const ref = lis.find(x => x.getAttribute(\"name\") === name);\n                    if (ref) {\n                        const name = ref.getAttribute(\"name\");\n                        let computed;\n                        if (computed_names.includes(name)) {\n                            computed = name;\n                        }\n                        return this._new_row(name, ref.getAttribute(\"type\"), undefined, undefined, undefined, computed);\n                    }\n                }\n            });\n        }\n    }\n\n    _update_column_list(columns, container, callback, accessor) {\n        accessor = accessor || ((x, y) => y.getAttribute(\"name\") === x);\n        const active_columns = Array.prototype.slice.call(container.children);\n\n        // Make sure that the `computed` attribute is set on computed columns\n        const computed_columns = this._get_view_parsed_computed_columns();\n        const computed_names = computed_columns.map(x => x.column);\n\n        for (let i = 0, j = 0; i < active_columns.length || j < columns.length; i++, j++) {\n            const name = columns[j];\n            const col = active_columns[i];\n            const next_col = active_columns[i + 1];\n            if (!col) {\n                const node = callback(name, computed_names);\n                if (node) {\n                    container.appendChild(node);\n                }\n            } else if (typeof name === \"undefined\") {\n                container.removeChild(col);\n            } else if (accessor(name, col)) {\n                this._set_row_type(col);\n            } else {\n                if (col.classList.contains(\"null-column\")) {\n                    const node = callback(name, computed_names);\n                    if (node) {\n                        container.replaceChild(node, col);\n                    }\n                } else if (next_col && accessor(name, next_col)) {\n                    container.removeChild(col);\n                    i++;\n                    //  j--;\n                } else {\n                    const node = callback(name, computed_names);\n                    if (node) {\n                        container.insertBefore(node, col);\n                        i--;\n                    }\n                }\n            }\n        }\n    }\n\n    _set_row_styles() {\n        let style = \"\";\n        if (this._plugin.initial && this._plugin.initial.names) {\n            for (const nidx in this._plugin.initial.names) {\n                const name = this._plugin.initial.names[nidx];\n                style += `#active_columns perspective-row:nth-child(${parseInt(nidx) + 1}){margin-top:23px;}`;\n                style += `#active_columns perspective-row:nth-child(${parseInt(nidx) + 1}):before{content:\"${name}\";}`;\n            }\n        }\n        this.shadowRoot.querySelector(\"#psp_styles\").innerHTML = style;\n    }\n\n    _show_column_container() {\n        this.shadowRoot.querySelector(\"#columns_container\").style.visibility = \"visible\";\n    }\n\n    _show_side_panel_actions() {\n        this.shadowRoot.querySelector(\"#side_panel__actions\").style.visibility = \"visible\";\n    }\n\n    _remove_null_columns(since_index = 0) {\n        const elems = this._get_view_active_columns();\n        while (++since_index < elems.length) {\n            const elem = elems[since_index];\n            if (elem.classList.contains(\"null-column\")) {\n                this.shadowRoot.querySelector(\"#active_columns\").removeChild(elem);\n            }\n        }\n    }\n\n    _set_column_defaults() {\n        const cols = this._get_view_all_columns();\n        const active_cols = this._get_view_active_valid_columns();\n        const valid_active_cols = this._get_view_active_valid_column_names();\n        if (cols.length > 0) {\n            if (this._plugin.initial) {\n                let pref = [];\n                let count = this._plugin.initial.count || 2;\n                this._fill_numeric(active_cols, pref);\n                this._fill_numeric(cols, pref);\n                this._fill_numeric(cols, pref, true);\n                pref = pref.slice(0, count);\n                const labels = this._plugin.initial.names;\n                while (labels && pref.length < labels.length) {\n                    pref.push(null);\n                }\n                this.setAttribute(\"columns\", JSON.stringify(pref));\n            } else if (this._plugin.selectMode === \"select\") {\n                this.setAttribute(\"columns\", JSON.stringify([cols[0].getAttribute(\"name\")]));\n            } else {\n                this.setAttribute(\"columns\", JSON.stringify(valid_active_cols));\n                this._remove_null_columns();\n            }\n        }\n    }\n\n    _fill_numeric(cols, pref, bypass = false) {\n        for (let col of cols) {\n            let type = col.getAttribute(\"type\");\n            let name = col.getAttribute(\"name\");\n            if (bypass || ([\"float\", \"integer\"].indexOf(type) > -1 && pref.indexOf(name) === -1)) {\n                pref.push(name);\n            }\n        }\n    }\n\n    async _check_responsive_layout() {\n        if (this.shadowRoot) {\n            const app = this.shadowRoot.querySelector(\"#app\");\n            if (this.clientHeight < 500 && this.clientWidth > 600 && this._get_view_columns({active: false}).length > this._get_view_columns().length) {\n                if (!app.classList.contains(\"columns_horizontal\")) {\n                    const old = this._persisted_side_panel_width;\n                    this._persisted_side_panel_width = this._side_panel.style.width;\n                    this._side_panel.style.width = old || \"\";\n                    app.classList.add(\"columns_horizontal\");\n                    return false;\n                }\n                return false;\n            } else if (app.classList.contains(\"columns_horizontal\")) {\n                const panel = this.shadowRoot.querySelector(\"#pivot_chart_container\");\n                panel.clientWidth + this._side_panel.clientWidth;\n                const width = this._persisted_side_panel_width || panel.clientWidth + this._side_panel.clientWidth / 2;\n                const height = panel.clientHeight + 50;\n                await this._pre_resize(width, height, () => {\n                    const old = this._persisted_side_panel_width;\n                    this._persisted_side_panel_width = this._side_panel.style.width;\n                    this._side_panel.style.width = old || \"\";\n                    app.classList.remove(\"columns_horizontal\");\n                });\n                return true;\n            }\n        }\n        return false;\n    }\n\n    // setup functions\n    _register_ids() {\n        this._aggregate_selector = this.shadowRoot.querySelector(\"#aggregate_selector\");\n        this._vis_selector = this.shadowRoot.querySelector(\"#vis_selector\");\n        this._filters = this.shadowRoot.querySelector(\"#filters\");\n        this._row_pivots = this.shadowRoot.querySelector(\"#row_pivots\");\n        this._column_pivots = this.shadowRoot.querySelector(\"#column_pivots\");\n        this._datavis = this.shadowRoot.querySelector(\"#pivot_chart\");\n        this._active_columns = this.shadowRoot.querySelector(\"#active_columns\");\n        this._inactive_columns = this.shadowRoot.querySelector(\"#inactive_columns\");\n        this._side_panel_actions = this.shadowRoot.querySelector(\"#side_panel__actions\");\n        this._add_computed_expression_button = this.shadowRoot.querySelector(\"#add-computed-expression\");\n        this._computed_expression_editor = this.shadowRoot.querySelector(\"perspective-computed-expression-editor\");\n        this._inner_drop_target = this.shadowRoot.querySelector(\"#drop_target_inner\");\n        this._drop_target = this.shadowRoot.querySelector(\"#drop_target\");\n        this._config_button = this.shadowRoot.querySelector(\"#config_button\");\n        this._reset_button = this.shadowRoot.querySelector(\"#reset_button\");\n        this._download_button = this.shadowRoot.querySelector(\"#download_button\");\n        this._copy_button = this.shadowRoot.querySelector(\"#copy_button\");\n        this._side_panel = this.shadowRoot.querySelector(\"#side_panel\");\n        this._top_panel = this.shadowRoot.querySelector(\"#top_panel\");\n        this._sort = this.shadowRoot.querySelector(\"#sort\");\n        this._transpose_button = this.shadowRoot.querySelector(\"#transpose_button\");\n        this._plugin_information = this.shadowRoot.querySelector(\".plugin_information\");\n        this._plugin_information_action = this.shadowRoot.querySelector(\".plugin_information__action\");\n        this._plugin_information_action_close = this.shadowRoot.querySelector(\".plugin_information__action--close\");\n        this._plugin_information_message = this.shadowRoot.querySelector(\"#plugin_information_count\");\n        this._resize_bar = this.shadowRoot.querySelector(\"#resize_bar\");\n    }\n\n    // sets state, manipulates DOM\n    _register_view_options() {\n        let current_renderers = renderers.getInstance();\n        render(options(current_renderers), this._vis_selector);\n    }\n\n    // sets state\n    _register_data_attribute() {\n        // TODO this feature needs to become a real attribute.\n        if (this.getAttribute(\"data\")) {\n            let data = this.getAttribute(\"data\");\n            try {\n                data = JSON.parse(data);\n            } catch (e) {}\n            this.load(data);\n        }\n    }\n\n    _autocomplete_choices(json) {\n        return json\n            .slice(1, json.length)\n            .map(x => x.__ROW_PATH__)\n            .filter(x => (Array.isArray(x) ? x.filter(v => !!v).length > 0 : !!x));\n    }\n}\n"],"file":"dom_element.js"}