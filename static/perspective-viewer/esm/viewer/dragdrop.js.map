{"version":3,"sources":["../../../src/js/viewer/dragdrop.js"],"names":["swap","calc_index","event","_active_columns","children","length","is_last_null","cidx","child","classList","contains","offsetTop","offsetHeight","offsetY","scrollTop","parseInt","last_index","dragend","div","target","getRootNode","host","parent","tagName","parentElement","idx","Array","prototype","slice","call","indexOf","attr_name","getAttribute","hasAttribute","attr_value","JSON","parse","splice","removeAttribute","setAttribute","stringify","drop","ev","preventDefault","currentTarget","remove","_drop_target_hover","data","dataTransfer","getData","name","querySelector","replace","columns","data_index","filtering","concat","_plugin","deselectMode","_get_visible_column_count","x","shadowRoot","querySelectorAll","removeChild","_update_column_view","_debounce_update","column_dragend","dropEffect","column_dragleave","src","relatedTarget","_drop_target_null","replaceChild","_original_index","insertBefore","_unset_drop_target_null","column_swap","new_index","column_replace","column_dragover","className","add","toggleAttribute","current_index","over_elem","to_replace","initial","names","is_diff","from_active","from_replace","from_append","from_required","count","to_required","to_null","from_last","appendChild","column_drop","dragenter","stopPropagation","dragover","dragleave"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {swap} from \"../utils.js\";\n\nfunction calc_index(event) {\n    if (this._active_columns.children.length == 0) {\n        return 0;\n    } else {\n        let is_last_null = false;\n        for (let cidx in this._active_columns.children) {\n            let child = this._active_columns.children[cidx];\n            is_last_null = is_last_null || child?.classList?.contains(\"null-column\");\n            if (child.offsetTop + child.offsetHeight > event.offsetY + this._active_columns.scrollTop) {\n                return parseInt(cidx);\n            }\n        }\n        let last_index = this._active_columns.children.length;\n        if (is_last_null) {\n            last_index--;\n        }\n        return last_index;\n    }\n}\n\nexport function dragend(event) {\n    let div = event.target.getRootNode().host;\n    let parent = div;\n    if (parent.tagName === \"PERSPECTIVE-VIEWER\") {\n        parent = event.target.parentElement;\n    } else {\n        parent = div.parentElement;\n    }\n    let idx = Array.prototype.slice.call(parent.children).indexOf(div.tagName === \"PERSPECTIVE-ROW\" ? div : event.target);\n    let attr_name = parent.getAttribute(\"for\");\n    if (this.hasAttribute(attr_name)) {\n        let attr_value = JSON.parse(this.getAttribute(attr_name));\n        attr_value.splice(idx, 1);\n        if (attr_value.length === 0) {\n            this.removeAttribute(attr_name);\n        } else {\n            this.setAttribute(attr_name, JSON.stringify(attr_value));\n        }\n    }\n}\n\nexport function drop(ev) {\n    ev.preventDefault();\n    ev.currentTarget.classList.remove(\"dropping\");\n    if (this._drop_target_hover) {\n        this._drop_target_hover.removeAttribute(\"drop-target\");\n    }\n    let data = ev.dataTransfer.getData(\"text\");\n    if (!data) return;\n    data = JSON.parse(data);\n\n    // Update the columns attribute\n    let name = ev.currentTarget.querySelector(\"ul\").getAttribute(\"for\") || ev.currentTarget.getAttribute(\"id\").replace(\"_\", \"-\");\n    let columns = JSON.parse(this.getAttribute(name) || \"[]\");\n    let data_index = columns.indexOf(data[0]);\n    if (data_index !== -1) {\n        columns.splice(data_index, 1);\n    }\n\n    const filtering = name.indexOf(\"filter\") > -1;\n    if (filtering) {\n        this.setAttribute(name, JSON.stringify(columns.concat([data])));\n    } else if (name.indexOf(\"sort\") > -1) {\n        this.setAttribute(name, JSON.stringify(columns.concat([[data[0]]])));\n    } else {\n        this.setAttribute(name, JSON.stringify(columns.concat([data[0]])));\n    }\n\n    // Deselect the dropped column\n    if (this._plugin.deselectMode === \"pivots\" && this._get_visible_column_count() > 1 && name !== \"sort\" && !filtering) {\n        for (let x of this.shadowRoot.querySelectorAll(\"#active_columns perspective-row\")) {\n            if (x.getAttribute(\"name\") === data[0]) {\n                this._active_columns.removeChild(x);\n                break;\n            }\n        }\n        this._update_column_view();\n    }\n\n    this._debounce_update();\n}\n\nexport function column_dragend(event) {\n    let data = event.target.parentElement.parentElement;\n    if (Array.prototype.slice(this._active_columns.children).indexOf(data) > -1 && this._get_visible_column_count() > 1 && event.dataTransfer.dropEffect !== \"move\") {\n        this._active_columns.removeChild(data);\n        this._update_column_view();\n    }\n    this._active_columns.classList.remove(\"dropping\");\n}\n\nexport function column_dragleave(event) {\n    let src = event.relatedTarget;\n    while (src && src !== this._active_columns) {\n        src = src.parentElement;\n    }\n    if (src === null) {\n        this._active_columns.classList.remove(\"dropping\");\n        if (this._drop_target_null) {\n            this._active_columns.replaceChild(this._drop_target_null, this._drop_target_hover);\n            delete this._drop_target_null;\n        }\n        if (this._drop_target_hover.parentElement === this._active_columns) {\n            this._active_columns.removeChild(this._drop_target_hover);\n        }\n        if (this._original_index !== -1) {\n            this._active_columns.insertBefore(this._drop_target_hover, this._active_columns.children[this._original_index]);\n        }\n        this._drop_target_hover.removeAttribute(\"drop-target\");\n    }\n}\n\nfunction _unset_drop_target_null() {\n    if (this._drop_target_null) {\n        if (this._drop_target_null.parentElement === this._active_columns) {\n            swap(this._active_columns, this._drop_target_hover, this._drop_target_null);\n        } else {\n            this._active_columns.replaceChild(this._drop_target_null, this._drop_target_hover);\n        }\n        delete this._drop_target_null;\n    }\n}\n\nfunction column_swap(new_index) {\n    _unset_drop_target_null.call(this);\n    if (this._active_columns.children[new_index]) {\n        if (this._drop_target_hover !== this._active_columns.children[new_index]) {\n            this._drop_target_null = this._active_columns.children[new_index];\n            swap(this._active_columns, this._active_columns.children[new_index], this._drop_target_hover);\n        }\n    }\n}\n\nfunction column_replace(new_index) {\n    _unset_drop_target_null.call(this);\n    if (this._active_columns.children[new_index]) {\n        this._drop_target_null = this._active_columns.children[new_index];\n        this._active_columns.replaceChild(this._drop_target_hover, this._active_columns.children[new_index]);\n    }\n}\n\nexport function column_dragover(event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = \"move\";\n    if (event.currentTarget.className !== \"dropping\") {\n        event.currentTarget.classList.add(\"dropping\");\n    }\n    if (!this._drop_target_hover.hasAttribute(\"drop-target\")) {\n        this._drop_target_hover.toggleAttribute(\"drop-target\", true);\n    }\n    let new_index = calc_index.call(this, event);\n    const current_index = Array.prototype.slice.call(this._active_columns.children).indexOf(this._drop_target_hover);\n    const over_elem = this._active_columns.children[new_index];\n    const to_replace = new_index < this._plugin.initial?.names?.length - 1;\n    const is_diff = this._drop_target_hover !== this._active_columns.children[new_index];\n    const from_active = this._original_index !== -1;\n    const from_replace = from_active && this._original_index < this._plugin.initial?.names?.length - 1;\n    const from_append = from_active && this._original_index >= this._plugin.initial?.names?.length - 1;\n    const from_required = from_active && this._original_index < this._plugin.initial?.count;\n    const to_required = new_index < this._plugin.initial?.count;\n    const to_null = !to_required && over_elem?.classList.contains(\"null-column\");\n    if (from_required && to_null) {\n        _unset_drop_target_null.call(this);\n    } else if (to_replace && from_append && is_diff) {\n        _unset_drop_target_null.call(this);\n        const from_last =\n            this._original_index === this._plugin.initial?.names?.length - 1 &&\n            this._drop_target_hover === this._active_columns.children[this._original_index] &&\n            this._active_columns.children.length === this._plugin.initial?.names?.length;\n        if (from_last) {\n            this._drop_target_null = this._active_columns.children[new_index];\n            swap(this._active_columns, this._active_columns.children[new_index], this._drop_target_hover);\n        } else if (!this._active_columns.children[new_index]?.classList.contains(\"null-column\")) {\n            this._drop_target_null = this._active_columns.children[new_index];\n            this._active_columns.replaceChild(this._drop_target_hover, this._active_columns.children[new_index]);\n            this._active_columns.insertBefore(this._drop_target_null, this._active_columns.children[this._original_index]);\n        } else {\n            if (this._drop_target_hover !== this._active_columns.children[new_index]) {\n                this._drop_target_null = this._active_columns.children[new_index];\n                this._active_columns.replaceChild(this._drop_target_hover, this._active_columns.children[new_index]);\n            }\n        }\n    } else if (to_replace && from_active && is_diff) {\n        column_swap.call(this, new_index);\n    } else if (to_replace && !from_active && is_diff) {\n        column_replace.call(this, new_index);\n    } else if (!to_replace && from_replace && is_diff) {\n        column_swap.call(this, new_index);\n    } else if (to_null && from_active) {\n        column_swap.call(this, new_index);\n    } else if (to_null && !from_active) {\n        column_replace.call(this, new_index);\n    } else if (current_index < new_index) {\n        if (new_index + 1 < this._active_columns.children.length) {\n            if (!this._active_columns.children[new_index + 1].hasAttribute(\"drop-target\")) {\n                _unset_drop_target_null.call(this);\n                this._active_columns.insertBefore(this._drop_target_hover, this._active_columns.children[new_index + 1]);\n            }\n        } else {\n            if (!this._active_columns.children[this._active_columns.children.length - 1].hasAttribute(\"drop-target\")) {\n                _unset_drop_target_null.call(this);\n                this._active_columns.appendChild(this._drop_target_hover);\n            }\n        }\n    } else if (new_index < this._active_columns.children.length) {\n        if (!this._active_columns.children[new_index].hasAttribute(\"drop-target\")) {\n            _unset_drop_target_null.call(this);\n            this._active_columns.insertBefore(this._drop_target_hover, this._active_columns.children[new_index]);\n        }\n    } else {\n        if (!this._active_columns.children[this._active_columns.children.length - 1].hasAttribute(\"drop-target\")) {\n            _unset_drop_target_null.call(this);\n            this._active_columns.appendChild(this._drop_target_hover);\n        }\n    }\n}\n\nexport function column_drop(ev) {\n    ev.preventDefault();\n    delete this._drop_target_null;\n    ev.currentTarget.classList.remove(\"dropping\");\n    if (this._drop_target_hover.parentElement === this._active_columns) {\n        this._drop_target_hover.removeAttribute(\"drop-target\");\n    }\n    let data = ev.dataTransfer.getData(\"text\");\n    if (!data) return;\n\n    this._update_column_view();\n}\n\nexport function dragenter(ev) {\n    ev.stopPropagation();\n    ev.preventDefault();\n    ev.currentTarget.classList.add(\"dropping\");\n}\n\nexport function dragover(ev) {\n    ev.stopPropagation();\n    ev.preventDefault();\n    ev.currentTarget.classList.add(\"dropping\");\n    ev.dataTransfer.dropEffect = \"move\";\n}\n\nexport function dragleave(ev) {\n    if (ev.currentTarget == ev.target) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        ev.currentTarget.classList.remove(\"dropping\");\n    }\n}\n"],"file":"dragdrop.js"}