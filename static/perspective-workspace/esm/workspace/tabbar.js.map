{"version":3,"sources":["../../../src/js/workspace/tabbar.js"],"names":["ArrayExt","ElementExt","TabBar","TabBarItems","DEFAULT_TITLE","PerspectiveTabBar","constructor","options","_addEventListeners","__content_node__","onUpdateRequest","msg","contentNode","_check_shade","Array","from","children","filter","x","classList","contains","length","add","remove","handleEvent","event","retargetEvent","type","widget","currentTitle","owner","parent","showContextMenu","preventDefault","target","id","Label","onTitleChangeRequest","Config","tabs","index","findFirstIndex","tab","hitTest","clientX","clientY","title","titles","toggleConfig","oldValue","value","stopEvents","stopPropagation","onCancel","label","setAttribute","removeEventListeners","onEnter","keyCode","name","blur","listeners","mousemove","mousedown","mouseup","keydown","eventName","removeEventListener","addEventListener","removeAttribute","focus","onResize","checkCondensed","approxWidth","width","node","offsetWidth","Object","defineProperty","composedPath","enumerable"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {ArrayExt} from \"@lumino/algorithm\";\nimport {ElementExt} from \"@lumino/domutils\";\nimport {TabBar} from \"@lumino/widgets\";\nimport {TabBarItems, DEFAULT_TITLE} from \"./tabbarrenderer\";\n\nexport class PerspectiveTabBar extends TabBar {\n    constructor(options = {}) {\n        super(options);\n        this._addEventListeners();\n        this.__content_node__;\n    }\n\n    onUpdateRequest(msg) {\n        // NOT INERT!  This is a lumino bug fix.\n        // lumino/virtualdom keeps a weakmap on contentNode which is later\n        // reset - this causes the diff to double some elements.  Memoizing\n        // prevent collection from the weakmap.\n        this.__content_node__ = this.contentNode;\n        super.onUpdateRequest(msg);\n        this._check_shade();\n    }\n\n    _check_shade() {\n        if (Array.from(this.contentNode.children).filter(x => x.classList.contains(\"settings_open\") && x.classList.contains(\"p-mod-current\")).length > 0) {\n            this.contentNode.classList.add(\"inactive-blur\");\n        } else {\n            this.contentNode.classList.remove(\"inactive-blur\");\n        }\n    }\n\n    handleEvent(event) {\n        this.retargetEvent(event);\n        switch (event.type) {\n            case \"contextmenu\":\n                const widget = this.currentTitle.owner;\n                this.parent.parent.parent.showContextMenu(widget, event);\n                event.preventDefault();\n                break;\n\n            case \"dblclick\":\n                if (event.target.id === TabBarItems.Label) {\n                    this.onTitleChangeRequest(event);\n                }\n                break;\n\n            case \"mousedown\":\n                if (event.target.id === TabBarItems.Config) {\n                    const tabs = this.contentNode.children;\n\n                    // Find the index of the released tab.\n                    const index = ArrayExt.findFirstIndex(tabs, tab => {\n                        return ElementExt.hitTest(tab, event.clientX, event.clientY);\n                    });\n\n                    if (index < 0) {\n                        break;\n                    }\n\n                    const title = this.titles[index];\n                    title.owner.toggleConfig();\n                    return;\n                }\n                break;\n        }\n        super.handleEvent(event);\n    }\n\n    onTitleChangeRequest(event) {\n        const oldValue = event.target.value;\n\n        const stopEvents = event => event.stopPropagation();\n\n        const onCancel = () => {\n            this.title.label = oldValue;\n            event.target.value = oldValue;\n            event.target.setAttribute(\"readonly\", \"\");\n            removeEventListeners();\n        };\n\n        const onEnter = event => {\n            if (event.keyCode === 13) {\n                removeEventListeners();\n                this.currentTitle.owner.name = event.target.value;\n                event.target.value = event.target.value || DEFAULT_TITLE;\n                event.target.setAttribute(\"readonly\", \"\");\n                event.target.blur();\n            }\n        };\n\n        const listeners = {\n            mousemove: stopEvents,\n            mousedown: stopEvents,\n            mouseup: stopEvents,\n            keydown: onEnter,\n            blur: onCancel\n        };\n\n        const removeEventListeners = () => {\n            for (let eventName in listeners) {\n                event.target.removeEventListener(eventName, listeners[eventName]);\n            }\n        };\n\n        for (let eventName in listeners) {\n            event.target.addEventListener(eventName, listeners[eventName]);\n        }\n\n        event.target.removeAttribute(\"readonly\");\n\n        if (oldValue === DEFAULT_TITLE) {\n            event.target.value = \"\";\n        }\n\n        event.target.focus();\n    }\n\n    onResize(msg) {\n        super.onResize(msg);\n        this.checkCondensed(msg);\n    }\n\n    checkCondensed(msg) {\n        const approxWidth = (msg ? msg.width : this.node.offsetWidth) / this.contentNode.children.length;\n        if (approxWidth < 400) {\n            this.node.classList.add(\"condensed\");\n        } else {\n            this.node.classList.remove(\"condensed\");\n        }\n    }\n\n    /**\n     * Shadow dom targets events at the host, not the clicked element, which\n     * Lumino dislikes.  This makes the event look like it is not crossing\n     * the ShadowDom boundary.\n     *\n     */\n    retargetEvent(event) {\n        Object.defineProperty(event, \"target\", {value: event.composedPath()[0], enumerable: true});\n        return event;\n    }\n\n    _addEventListeners() {\n        this.node.addEventListener(\"dblclick\", this);\n        this.node.addEventListener(\"contextmenu\", this);\n    }\n}\n"],"file":"tabbar.js"}