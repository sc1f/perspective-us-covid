{"version":3,"sources":["../../../src/js/workspace/discrete.js"],"names":["DockPanel","SplitPanel","toArray","Signal","DISCRETE_STEP_SIZE","cloneMouseEvent","x","y","event","evt","document","createEvent","initMouseEvent","type","cancelable","view","detail","screenX","screenY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","DiscreteContext","_clamp","orient","client","margin","width","height","min","max","_rect","undefined","_block_move","key","val","_offset_drag_start","old","_offset_drag_current","method","diff","Math","_check_prev","clientX","clientY","old_clientX","old_clientY","calculate_move","left","top","blockX","blockY","constructor","rect","extend","base","handle","handleEvent","elem","target","classList","contains","parentElement","some","getAttribute","addClass","_offset_target","add","context","node","getBoundingClientRect","preventDefault","stopPropagation","update","new_event","removeClass","remove","DiscreteDockPanel","DiscreteSplitPanel","args","layoutModified","onUpdateRequest","emit","onResize","msg","widget","widgets","style","minWidth","minHeight"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {DockPanel, SplitPanel} from \"@lumino/widgets\";\nimport {toArray} from \"@lumino/algorithm\";\nimport {Signal} from \"@lumino/signaling\";\n\nconst DISCRETE_STEP_SIZE = 1;\n\nfunction cloneMouseEvent(x, y, event) {\n    const evt = document.createEvent(\"MouseEvent\");\n    evt.initMouseEvent(\n        event.type,\n        true,\n        event.cancelable,\n        event.view,\n        event.detail,\n        event.screenX,\n        event.screenY,\n        x,\n        y,\n        event.ctrlKey,\n        event.altKey,\n        event.shiftKey,\n        event.metaKey,\n        event.button,\n        event.relatedTarget\n    );\n    return evt;\n}\n\nclass DiscreteContext {\n    _clamp(orient, client) {\n        const margin = {width: 300, height: 200}[orient];\n        const [min, max] = [margin, this._rect[orient] - margin];\n        return client < min ? min : client > max ? max : undefined;\n    }\n\n    _block_move(key, client) {\n        const val = this._offset_drag_start[key];\n        const old = this._offset_drag_current[key];\n        const method = client < old ? \"ceil\" : \"floor\";\n        const diff = client - val;\n        return Math[method](diff / DISCRETE_STEP_SIZE) * DISCRETE_STEP_SIZE + val;\n    }\n\n    _check_prev(clientX, clientY) {\n        const {x: old_clientX, y: old_clientY} = this._offset_drag_current;\n        if (clientX !== old_clientX || clientY !== old_clientY) {\n            this._offset_drag_current = {x: clientX, y: clientY};\n            return true;\n        }\n        return false;\n    }\n\n    calculate_move({clientX, clientY}) {\n        clientX -= this._rect.left;\n        clientY -= this._rect.top;\n        const blockX = this._block_move(\"x\", clientX);\n        const blockY = this._block_move(\"y\", clientY);\n        clientX = this._clamp(\"width\", clientX) || this._clamp(\"width\", blockX) || blockX;\n        clientY = this._clamp(\"height\", clientY) || this._clamp(\"height\", blockY) || blockY;\n        if (this._check_prev(clientX, clientY)) {\n            return {x: clientX + this._rect.left, y: clientY + this._rect.top};\n        }\n    }\n\n    constructor(x, y, rect) {\n        this._rect = rect;\n        this._offset_drag_start = this._offset_drag_current = {\n            x: x - rect.left,\n            y: y - rect.top\n        };\n    }\n}\n\nfunction extend(base, handle) {\n    return class extends base {\n        handleEvent(event) {\n            switch (event.type) {\n                case \"mousedown\":\n                    {\n                        const elem = event.target;\n                        if (!elem.classList.contains(handle)) {\n                            break;\n                        }\n                        if ([elem, elem.parentElement].some(x => x.getAttribute(\"data-orientation\") === \"horizontal\")) {\n                            this.addClass(\"ew\");\n                        } else {\n                            this.addClass(\"ns\");\n                        }\n                        this.addClass(\"resizing\");\n                        const {clientX, clientY} = event;\n                        this._offset_target = elem;\n                        this._offset_target.classList.add(\"resizing\");\n                        this.context = new DiscreteContext(clientX, clientY, this.node.getBoundingClientRect());\n                    }\n                    break;\n                case \"mousemove\":\n                    if (!DISCRETE_STEP_SIZE) {\n                        super.handleEvent(event);\n                    } else if (this.context && !event.shiftKey) {\n                        event.preventDefault();\n                        event.stopPropagation();\n                        const update = this.context.calculate_move(event);\n                        if (update) {\n                            const new_event = cloneMouseEvent(update.x, update.y, event);\n                            super.handleEvent(new_event);\n                        }\n                        return;\n                    }\n                    break;\n                case \"mouseup\":\n                    {\n                        this.removeClass(\"resizing\");\n                        this.removeClass(\"ew\");\n                        this.removeClass(\"ns\");\n                        this._offset_target.classList.remove(\"resizing\");\n                        delete this.context;\n                    }\n                    break;\n                default:\n                    break;\n            }\n            super.handleEvent(event);\n        }\n    };\n}\n\nexport class DiscreteDockPanel extends extend(DockPanel, \"p-DockPanel-handle\") {}\nexport class DiscreteSplitPanel extends extend(SplitPanel, \"p-SplitPanel-handle\") {\n    constructor(...args) {\n        super(...args);\n        this.layoutModified = new Signal(this);\n    }\n\n    onUpdateRequest(...args) {\n        super.onUpdateRequest(...args);\n        this.layoutModified.emit();\n    }\n\n    onResize(msg) {\n        for (const widget of toArray(this.widgets)) {\n            widget.node.style.minWidth = `300px`;\n            widget.node.style.minHeight = `200px`;\n        }\n        super.onResize(msg);\n    }\n}\n"],"file":"discrete.js"}