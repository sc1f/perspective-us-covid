{"version":3,"sources":["../../../src/js/highcharts/draw.js"],"names":["Highcharts","style","template","COLORS_10","COLORS_20","color_axis","make_tree_data","make_y_data","make_xy_data","make_xyz_data","make_xy_column_data","set_boost","set_category_axis","set_both_axis","default_config","set_tick_size","bindTemplate","detectIE","PRIVATE","Symbol","get_or_create_element","div","perspective_highcharts_element","chart","document","createElement","body","contains","innerHTML","appendChild","draw","mode","set_config","restyle","el","view","task","end_col","end_row","_config","get_config","cancelled","config","row_pivots","col_pivots","column_pivots","columns","real_columns","JSON","parse","getAttribute","schema","tschema","Promise","all","_table","element","configs","xaxis_name","length","undefined","xaxis_type","yaxis_name","yaxis_type","xtree_name","xtree_type","ytree_name","ytree_type","num_aggregates","cols","to_columns","leaves_only","call","series","xtop","colorRange","ytop","legend","floating","enabled","colors","Infinity","type","js","to_json","top","name","data","nullColor","charts","title","text","plotOptions","borderWidth","push","s","scatter","marker","radius","dataLabels","allowOverlap","padding","indexOf","Object","assign","yAxis","startOnTick","endOnTick","join","color","fontSize","labels","overflow","hasAttribute","delete","render","HighchartsElement","constructor","_charts","connectedCallback","_container","shadowRoot","querySelector","callee","idx","cidx","boost","target","renderTo","destroy","e","console","warn","conf","update","opts","xAxis","className","i","every","x","remove","map","resize","setTimeout","reflow","Array","prototype","slice","children","tagName","removeChild"],"mappings":"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","sourcesContent":["/******************************************************************************\r\n *\r\n * Copyright (c) 2017, the Perspective Authors.\r\n *\r\n * This file is part of the Perspective library, distributed under the terms of\r\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\r\n *\r\n */\r\n\r\nimport Highcharts from \"highcharts\";\r\n\r\nimport style from \"../../less/highcharts.less\";\r\nimport template from \"../../html/highcharts.html\";\r\n\r\nimport {COLORS_10, COLORS_20} from \"./externals.js\";\r\nimport {color_axis} from \"./color_axis.js\";\r\nimport {make_tree_data, make_y_data, make_xy_data, make_xyz_data, make_xy_column_data} from \"./series.js\";\r\nimport {set_boost, set_category_axis, set_both_axis, default_config, set_tick_size} from \"./config.js\";\r\nimport {bindTemplate} from \"@finos/perspective-viewer/dist/esm/utils\";\r\nimport detectIE from \"detectie\";\r\n\r\nexport const PRIVATE = Symbol(\"Highcharts private\");\r\n\r\nfunction get_or_create_element(div) {\r\n    let perspective_highcharts_element;\r\n    this[PRIVATE] = this[PRIVATE] || {};\r\n    if (!this[PRIVATE].chart) {\r\n        perspective_highcharts_element = this[PRIVATE].chart = document.createElement(\"perspective-highcharts\");\r\n    } else {\r\n        perspective_highcharts_element = this[PRIVATE].chart;\r\n    }\r\n\r\n    if (!document.body.contains(perspective_highcharts_element)) {\r\n        div.innerHTML = \"\";\r\n        div.appendChild(perspective_highcharts_element);\r\n    }\r\n    return perspective_highcharts_element;\r\n}\r\n\r\nexport const draw = (mode, set_config, restyle) =>\r\n    async function(el, view, task, end_col, end_row) {\r\n        if (set_config) {\r\n            this._config = await view.get_config();\r\n            if (task.cancelled) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        const config = await view.get_config();\r\n\r\n        const row_pivots = config.row_pivots;\r\n        const col_pivots = config.column_pivots;\r\n        const columns = config.columns;\r\n        const real_columns = JSON.parse(this.getAttribute(\"columns\"));\r\n\r\n        const [schema, tschema] = await Promise.all([view.schema(false), this._table.schema(false)]);\r\n        let element;\r\n\r\n        if (task.cancelled) {\r\n            return;\r\n        }\r\n\r\n        let configs = [],\r\n            xaxis_name = columns.length > 0 ? columns[0] : undefined,\r\n            xaxis_type = schema[xaxis_name],\r\n            yaxis_name = columns.length > 1 ? columns[1] : undefined,\r\n            yaxis_type = schema[yaxis_name],\r\n            xtree_name = row_pivots.length > 0 ? row_pivots[row_pivots.length - 1] : undefined,\r\n            xtree_type = tschema[xtree_name],\r\n            ytree_name = col_pivots.length > 0 ? col_pivots[col_pivots.length - 1] : undefined,\r\n            ytree_type = tschema[ytree_name],\r\n            num_aggregates = columns.length;\r\n\r\n        try {\r\n            if (mode === \"scatter\") {\r\n                let cols;\r\n                if (end_col || end_row) {\r\n                    cols = await view.to_columns({end_col, end_row, leaves_only: true});\r\n                } else {\r\n                    cols = await view.to_columns();\r\n                }\r\n                const config = (configs[0] = default_config.call(this, real_columns, mode));\r\n                const [series, xtop, colorRange, ytop] = make_xy_column_data(cols, schema, real_columns, row_pivots, col_pivots);\r\n\r\n                config.legend.floating = series.length <= 20;\r\n                config.legend.enabled = col_pivots.length > 0;\r\n                config.series = series;\r\n                config.colors = series.length <= 10 ? COLORS_10 : COLORS_20;\r\n                if (colorRange[0] !== Infinity) {\r\n                    if (real_columns.length <= 3 || real_columns[3] === null) {\r\n                        config.chart.type = \"coloredScatter\";\r\n                    } else {\r\n                        config.chart.type = \"coloredBubble\";\r\n                    }\r\n                    color_axis.call(this, config, colorRange, restyle);\r\n                } else if (real_columns.length > 3 && real_columns[3] !== null) {\r\n                    config.chart.type = \"bubble\";\r\n                }\r\n\r\n                if (num_aggregates < 3) {\r\n                    set_boost(config, xaxis_type, yaxis_type);\r\n                }\r\n                set_both_axis(config, \"xAxis\", xaxis_name, xaxis_type, xaxis_type, xtop);\r\n                set_both_axis(config, \"yAxis\", yaxis_name, yaxis_type, yaxis_type, ytop);\r\n                set_tick_size.call(this, config);\r\n            } else if (mode === \"heatmap\") {\r\n                let js;\r\n                if (end_col || end_row) {\r\n                    js = await view.to_json({end_col, end_row, leaves_only: false});\r\n                } else {\r\n                    js = await view.to_json();\r\n                }\r\n                let config = (configs[0] = default_config.call(this, columns, mode));\r\n                let [series, top, ytop, colorRange] = make_xyz_data(js, row_pivots, ytree_type);\r\n                config.series = [\r\n                    {\r\n                        name: null,\r\n                        data: series,\r\n                        nullColor: \"none\"\r\n                    }\r\n                ];\r\n                config.legend.enabled = true;\r\n                config.legend.floating = false;\r\n\r\n                color_axis.call(this, config, colorRange, restyle);\r\n                set_boost(config, xaxis_type, yaxis_type);\r\n                set_category_axis(config, \"xAxis\", xtree_type, top);\r\n                set_category_axis(config, \"yAxis\", ytree_type, ytop);\r\n            } else if (mode === \"treemap\" || mode === \"sunburst\") {\r\n                let js;\r\n                if (end_col || end_row) {\r\n                    js = await view.to_json({end_col, end_row, leaves_only: false});\r\n                } else {\r\n                    js = await view.to_json();\r\n                }\r\n                let [charts, , colorRange] = make_tree_data(js, row_pivots, columns, mode === \"treemap\");\r\n                for (let series of charts) {\r\n                    let config = default_config.call(this, columns, mode);\r\n                    config.series = [series];\r\n                    if (charts.length > 1) {\r\n                        config.title.text = series.title;\r\n                    }\r\n                    config.plotOptions.series.borderWidth = 1;\r\n                    config.legend.floating = false;\r\n                    if (colorRange) {\r\n                        color_axis.call(this, config, colorRange, restyle);\r\n                    }\r\n                    configs.push(config);\r\n                }\r\n            } else if (mode === \"line\") {\r\n                let s;\r\n                let config = (configs[0] = default_config.call(this, columns, mode));\r\n\r\n                if (col_pivots.length === 0) {\r\n                    let cols;\r\n                    if (end_col || end_row) {\r\n                        cols = await view.to_columns({end_col, end_row, leaves_only: true});\r\n                    } else {\r\n                        cols = await view.to_columns();\r\n                    }\r\n                    s = await make_xy_column_data(cols, schema, columns, row_pivots, col_pivots);\r\n                } else {\r\n                    let js;\r\n                    if (end_col || end_row) {\r\n                        js = await view.to_json({end_col, end_row, leaves_only: false});\r\n                    } else {\r\n                        js = await view.to_json();\r\n                    }\r\n                    s = await make_xy_data(js, schema, columns, row_pivots, col_pivots);\r\n                }\r\n\r\n                const series = s[0];\r\n                const xtop = s[1];\r\n                const ytop = s[3];\r\n\r\n                const colors = series.length <= 10 ? COLORS_10 : COLORS_20;\r\n                config.legend.floating = series.length <= 20;\r\n                config.legend.enabled = col_pivots.length > 0;\r\n                config.series = series;\r\n                config.plotOptions.scatter.marker = {enabled: false, radius: 0};\r\n                config.colors = colors;\r\n                if (set_boost(config, xaxis_type, yaxis_type)) {\r\n                    delete config.chart[\"type\"];\r\n                }\r\n                set_both_axis(config, \"xAxis\", xaxis_name, xaxis_type, xaxis_type, xtop);\r\n                set_both_axis(config, \"yAxis\", yaxis_name, yaxis_type, yaxis_type, ytop);\r\n            } else {\r\n                let config = (configs[0] = default_config.call(this, columns, mode));\r\n                let cols;\r\n                if (end_col || end_row) {\r\n                    cols = await view.to_columns({end_col, end_row, leaves_only: false});\r\n                } else {\r\n                    cols = await view.to_columns();\r\n                }\r\n\r\n                let [series, top] = make_y_data(cols, row_pivots);\r\n                config.series = series;\r\n                config.colors = series.length <= 10 ? COLORS_10 : COLORS_20;\r\n                config.legend.enabled = col_pivots.length > 0 || series.length > 1;\r\n                config.legend.floating = series.length <= 20;\r\n                config.plotOptions.series.dataLabels = {\r\n                    allowOverlap: false,\r\n                    padding: 10\r\n                };\r\n                if (mode.indexOf(\"scatter\") > -1 || mode.indexOf(\"line\") > -1) {\r\n                    set_boost(config, xaxis_type, yaxis_type);\r\n                }\r\n                set_category_axis(config, \"xAxis\", xtree_type, top);\r\n                Object.assign(config, {\r\n                    yAxis: {\r\n                        startOnTick: false,\r\n                        endOnTick: false,\r\n                        title: {\r\n                            text: columns.join(\",  \"),\r\n                            style: {color: \"#666666\", fontSize: \"14px\"}\r\n                        },\r\n                        labels: {overflow: \"justify\"}\r\n                    }\r\n                });\r\n            }\r\n        } finally {\r\n            element = get_or_create_element.call(this, el);\r\n            if (restyle || this.hasAttribute(\"updating\")) {\r\n                element.delete();\r\n            }\r\n        }\r\n\r\n        element.render(mode, configs, this);\r\n    };\r\n\r\n@bindTemplate(template, style) // eslint-disable-next-line no-unused-vars\r\nclass HighchartsElement extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        this._charts = [];\r\n    }\r\n\r\n    connectedCallback() {\r\n        this._container = this.shadowRoot.querySelector(\"#container\");\r\n    }\r\n\r\n    render(mode, configs, callee) {\r\n        if (this._charts.length > 0 && this._charts.length === configs.length) {\r\n            let idx = 0;\r\n            for (let cidx = 0; cidx < this._charts.length; cidx++) {\r\n                const chart = this._charts[cidx];\r\n                let config = configs[idx++];\r\n                if (config.boost) {\r\n                    let target = chart.renderTo;\r\n                    try {\r\n                        chart.destroy();\r\n                    } catch (e) {\r\n                        console.warn(\"Scatter plot destroy() call failed - this is probably leaking memory\");\r\n                    }\r\n                    this._charts[cidx] = Highcharts.chart(target, config);\r\n                } else if (mode === \"scatter\") {\r\n                    let conf = {\r\n                        series: config.series,\r\n                        plotOptions: {}\r\n                    };\r\n                    set_tick_size.call(callee, conf);\r\n                    chart.update(conf);\r\n                } else {\r\n                    let opts = {series: config.series, xAxis: config.xAxis, yAxis: config.yAxis};\r\n                    chart.update(opts);\r\n                }\r\n            }\r\n        } else {\r\n            this.delete();\r\n            for (let config of configs) {\r\n                let chart = document.createElement(\"div\");\r\n                chart.className = \"chart\";\r\n                this._container.appendChild(chart);\r\n                this._charts.push(() => Highcharts.chart(chart, config));\r\n            }\r\n\r\n            for (let i = 0; i < this._charts.length; i++) {\r\n                this._charts[i] = this._charts[i]();\r\n            }\r\n        }\r\n\r\n        if (!this._charts.every(x => this._container.contains(x.renderTo))) {\r\n            this.remove();\r\n            this._charts.map(x => this._container.appendChild(x.renderTo));\r\n        }\r\n\r\n        // TODO resize bug in Highcharts?\r\n        if (configs.length > 1) {\r\n            this.resize();\r\n        }\r\n\r\n        if (detectIE()) {\r\n            setTimeout(() => this.resize());\r\n        }\r\n    }\r\n\r\n    resize() {\r\n        if (this._charts && this._charts.length > 0) {\r\n            this._charts.map(x => x.reflow());\r\n        }\r\n    }\r\n\r\n    remove() {\r\n        this._charts = [];\r\n        for (let e of Array.prototype.slice.call(this._container.children)) {\r\n            if (e.tagName === \"DIV\") {\r\n                this._container.removeChild(e);\r\n            }\r\n        }\r\n    }\r\n\r\n    delete() {\r\n        for (let chart of this._charts) {\r\n            try {\r\n                chart.destroy();\r\n            } catch (e) {\r\n                console.warn(\"Scatter plot destroy() call failed - this is probably leaking memory\");\r\n            }\r\n        }\r\n        this.remove();\r\n    }\r\n}\r\n"],"file":"draw.js"}