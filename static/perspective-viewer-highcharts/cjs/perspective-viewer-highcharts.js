!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("highcharts"),require("@finos/perspective/dist/esm/config"),require("core-js/modules/es.array.iterator"),require("core-js/modules/web.dom-collections.iterator"),require("core-js/modules/es.object.assign"),require("core-js/modules/es.string.split"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.promise"),require("highcharts-more"),require("highcharts/modules/heatmap"),require("highcharts/modules/boost"),require("highcharts/modules/treemap"),require("highcharts/modules/sunburst"),require("highcharts-grouped-categories"),require("gradient-parser"),require("@finos/perspective-viewer/dist/esm/utils"),require("detectie"),require("@finos/perspective-viewer/dist/esm/utils.js"),require("core-js/modules/es.array.reverse"),require("core-js/modules/es.string.replace")):"function"==typeof define&&define.amd?define(["highcharts","@finos/perspective/dist/esm/config","core-js/modules/es.array.iterator","core-js/modules/web.dom-collections.iterator","core-js/modules/es.object.assign","core-js/modules/es.string.split","core-js/modules/es.symbol.description","core-js/modules/es.promise","highcharts-more","highcharts/modules/heatmap","highcharts/modules/boost","highcharts/modules/treemap","highcharts/modules/sunburst","highcharts-grouped-categories","gradient-parser","@finos/perspective-viewer/dist/esm/utils","detectie","@finos/perspective-viewer/dist/esm/utils.js","core-js/modules/es.array.reverse","core-js/modules/es.string.replace"],t):"object"==typeof exports?exports["perspective-viewer-highcharts"]=t(require("highcharts"),require("@finos/perspective/dist/esm/config"),require("core-js/modules/es.array.iterator"),require("core-js/modules/web.dom-collections.iterator"),require("core-js/modules/es.object.assign"),require("core-js/modules/es.string.split"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.promise"),require("highcharts-more"),require("highcharts/modules/heatmap"),require("highcharts/modules/boost"),require("highcharts/modules/treemap"),require("highcharts/modules/sunburst"),require("highcharts-grouped-categories"),require("gradient-parser"),require("@finos/perspective-viewer/dist/esm/utils"),require("detectie"),require("@finos/perspective-viewer/dist/esm/utils.js"),require("core-js/modules/es.array.reverse"),require("core-js/modules/es.string.replace")):e["perspective-viewer-highcharts"]=t(e.highcharts,e["@finos/perspective/dist/esm/config"],e["core-js/modules/es.array.iterator"],e["core-js/modules/web.dom-collections.iterator"],e["core-js/modules/es.object.assign"],e["core-js/modules/es.string.split"],e["core-js/modules/es.symbol.description"],e["core-js/modules/es.promise"],e["highcharts-more"],e["highcharts/modules/heatmap"],e["highcharts/modules/boost"],e["highcharts/modules/treemap"],e["highcharts/modules/sunburst"],e["highcharts-grouped-categories"],e["gradient-parser"],e["@finos/perspective-viewer/dist/esm/utils"],e.detectie,e["@finos/perspective-viewer/dist/esm/utils.js"],e["core-js/modules/es.array.reverse"],e["core-js/modules/es.string.replace"])}(window,(function(e,t,s,i,o,r,n,l,a,c,h,u,p,d,f,m,g,b,_,y){return function(e){var t={};function s(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=23)}([function(t,s){t.exports=e},function(e,s){e.exports=t},function(e,t){e.exports=s},function(e,t){e.exports=i},function(e,t){e.exports=o},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=l},function(e,t,s){(e.exports=s(20)(!1)).push([e.i,":host{background-color:var(--plugin--background,#fff)}:host #container{position:absolute;width:calc(100% - 30px);height:calc(100% - 30px);display:grid;margin:15px;justify-content:stretch;grid-template-rows:repeat(auto-fit,minmax(400px,1fr));grid-template-columns:repeat(auto-fit,minmax(400px,1fr));overflow-y:auto}:host .chart{position:relative;width:100%;height:100%;min-width:0;min-height:0}:host .chart:last-child:first-child{position:absolute;top:0;left:0;right:0;bottom:0}:host text,:host tspan{font-family:var(--interface--font-family,Arial,sans-serif);fill:var(--highcharts-label--fill,#666)!important}:host .highcharts-null-point{fill:none}:host .highcharts-background{display:none}:host .highcharts-label-box.highcharts-tooltip-box:not([isShadow]){fill:var(--highcharts-tooltip--background,#fff)}:host .highcharts-yaxis-grid path.highcharts-grid-line{stroke:var(--highcharts-grid-line--stroke,#e6e6e6)}:host .highcharts-sunburst-series path,:host .highcharts-treemap-series rect{stroke:var(--plugin--background,#fff)}:host rect,:host svg image{opacity:var(--highcharts-rect--opacity,.5)}:host circle,:host path{opacity:var(--highcharts-circle--opacity,.8)}",""])},function(e,t){e.exports='<template id="perspective-highcharts">\n    <div id="container">\n\n    </div>\n</template>'},function(e,t){e.exports=a},function(e,t){e.exports=c},function(e,t){e.exports=h},function(e,t){e.exports=u},function(e,t){e.exports=p},function(e,t){e.exports=d},function(e,t){e.exports=f},function(e,t){e.exports=m},function(e,t){e.exports=g},function(e,t){e.exports=b},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s=function(e,t){var s=e[1]||"",i=e[3];if(!i)return s;if(t&&"function"==typeof btoa){var o=(n=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"),r=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[s].concat(r).concat([o]).join("\n")}var n;return[s].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+s+"}":s})).join("")},t.i=function(e,s){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<e.length;o++){var n=e[o];"number"==typeof n[0]&&i[n[0]]||(s&&!n[2]?n[2]=s:s&&(n[2]="("+n[2]+") and ("+s+")"),t.push(n))}},t}},function(e,t){e.exports=_},function(e,t){e.exports=y},function(e,t,s){"use strict";s.r(t);s(2),s(3),s(6),s(4),s(7);var i=s(0),o=s.n(i),r=s(8),n=s.n(r),l=s(9),a=s.n(l),c=s(10),h=s.n(c),u=s(11),p=s.n(u),d=s(12),f=s.n(d),m=s(13),g=s.n(m),b=s(14),_=s.n(b),y=s(15),x=s.n(y);const v=o.a;let j=v.Axis.prototype,w=j.render;h()(o.a),p()(o.a),g()(o.a),_()(o.a),x()(o.a),f()(o.a);const O=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],k=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];v.setOptions({colors:k}),function(e){e.wrap(e.seriesTypes.scatter.prototype,"translate",(function(e){e.apply(this,Array.prototype.slice.call(arguments,1)),"colored"===this.chart.userOptions.chart.type.slice(0,7)&&this.translateColors.call(this)}));var t=e.seriesTypes,s=e.merge,i=e.extendClass,o=e.getOptions().plotOptions,r={optionalAxis:"colorAxis",colorKey:"colorValue",translateColors:t.heatmap&&t.heatmap.prototype.translateColors};o.coloredColumn=s(o.column,{}),t.coloredColumn=i(t.column,s(r,{type:"coloredColumn",axisTypes:["xAxis","yAxis","colorAxis"]})),o.coloredScatter=s(o.scatter,{}),t.coloredScatter=i(t.scatter,s(r,{type:"coloredScatter",axisTypes:["xAxis","yAxis","colorAxis"]})),o.coloredBubble=s(o.bubble,{}),t.coloredBubble=i(t.bubble,s(r,{type:"coloredBubble",axisTypes:["xAxis","yAxis","colorAxis"]})),e.wrap(e.seriesTypes.sunburst.prototype,"translate",(function(e,t){e.call(this,t),this.translateColors()})),e.seriesTypes.sunburst.prototype.translateColors=function(){var t=this,s=this.options.nullColor,i=this.colorAxis,o=this.colorKey;e.each(this.data,(function(e){var r,n=e[o];(r=e.options.color||(e.value?i&&void 0!==n?i.toColor(n,e):e.color||t.color:s))&&(e.color=r)}))},e.seriesTypes.sunburst.prototype.colorKey="colorValue",j.render=function(){if(this.isGrouped&&(this.labelsGridPath=[]),void 0===this.originalTickLength&&(this.originalTickLength=this.options.tickLength),this.options.tickLength=this.isGrouped?.001:this.originalTickLength,w.call(this),!this.isGrouped)return this.labelsGrid&&this.labelsGrid.attr({visibility:"hidden"}),!1;var e=this,t=e.options,s=e.hasVisibleSeries||e.hasData,i=e.labelsGrid,o=e.labelsGridPath,r=e.tickWidth;return i||(i=e.labelsGrid=e.chart.renderer.path().attr({strokeWidth:r,"stroke-width":r,stroke:t.tickColor||""}).add(e.axisGroup),t.tickColor||i.addClass("highcharts-tick")),i.attr({d:o,visibility:s?"visible":"hidden"}),e.labelGroup.attr({visibility:s?"visible":"hidden"}),function e(t,s,i){for(var o,r=t.length;r--;)(o=t[r][s])&&e(o,s,i),i(t[r])}(e.categoriesTree,"categories",(function(t){var i=t.tick;return!!i&&(i.startAt+i.leaves-1<e.min||i.startAt>e.max?(i.label.hide(),i.destroyed=0):i.label.attr({visibility:s?"visible":"hidden"}),!0)})),!0}}(v);var A=s(16);function T(e){let t;t=window.ShadyCSS?window.ShadyCSS.getComputedStyleValue(this,"--highcharts-".concat(e,"--gradient")):getComputedStyle(this).getPropertyValue("--highcharts-".concat(e,"--gradient"));const s=A.parse(t)[0].colorStops;return s.map((e,t)=>{let i;return i="rgb"===e.type?"rgb(".concat(e.value.join(","),")"):"#".concat(e.value),[Number.parseFloat(e.length?e.length.value/100:"".concat(t/(s.length-1))),i]})}const S=(()=>{let e;return function(t){if(t||void 0===e){e={};for(let t of["positive","negative","full"])e[t]=T.bind(this)(t)}return e}})();function C(e,t,s){let i,{positive:o,negative:r,full:n}=S.bind(this)(s);i=t[0]>=0?o:t[1]<=0?r:n,Object.assign(e,{colorAxis:{min:t[0],max:t[1],stops:i,reversed:!1,startOnTick:!1,endOnTick:!1}}),e.legend.reversed=!0,e.legend.floating=!1,e.legend.enabled=!0}s(21),s(5);const q="|";function M(e,t,s){let i,o=0;for(;o<e.length;o++){let r=void 0===s||e[o].stack===s;if(e[o].name==t&&r){i=e[o];break}}return o==e.length&&(i={name:t,connectNulls:!0,data:[]},s&&(i.stack=s),e.push(i)),i}function P(e,t,s){let i={name:t,connectNulls:!0,data:e};return s&&(i.stack=s),i}function z(e){return null===e?"-":e}class W{constructor(e,t){this.depth=e,this.json=t,this.top={name:"",depth:0,categories:[]}}add_label(e){let t={name:e[e.length-1],depth:e.length,categories:[]};for(var s=this.top,i=0;i<e.length-1;i++)for(var o=0;o<s.categories.length;o++)if(s.categories[o].name===e[i]){s=s.categories[o];break}return s.categories.push(t),t}*[Symbol.iterator](){let e=this.top;for(let t of this.json){let s=t.__ROW_PATH__||[""];s.length>0&&s.length<this.depth?e=this.add_label(s):s.length>=this.depth&&(e.categories.push(z(s[s.length-1])),yield t)}}}class L{constructor(e,t){this.columns=e,this.depth=t,this.axis={name:"",depth:0,categories:[]},this.fill_axis()}add_label(e){let t={name:e[e.length-1],depth:e.length,categories:[]};for(var s=this.axis,i=0;i<e.length-1;i++)for(var o=0;o<s.categories.length;o++)if(s.categories[o].name===e[i]){s=s.categories[o];break}return s.categories.push(t),t}fill_axis(){let e=this.axis;if(void 0!==this.columns.__ROW_PATH__)for(let t of this.columns.__ROW_PATH__)if(t.length>0&&t.length<this.depth)e=this.add_label(t);else if(t.length>=this.depth){e.categories.push(z(t[t.length-1]));continue}}}class N{constructor(e){this.rows=e}*[Symbol.iterator](){for(let e of this.rows)void 0===this.columns&&(this.columns=Object.keys(e).filter(e=>"__ROW_PATH__"!==e),this.is_stacked=this.columns.map(e=>e.substr(e.lastIndexOf(q)+1,e.length)).filter((e,t,s)=>s.indexOf(e)===t).length>1),yield e}}class R{constructor(e,t){this.columns=e,this.column_names=Object.keys(this.columns).filter(e=>"__ROW_PATH__"!==e),this.is_stacked=this.column_names.map(e=>e.substr(e.lastIndexOf(q)+1,e.length)).filter((e,t,s)=>s.indexOf(e)===t).length>1,this.pivot_length=t}*[Symbol.iterator](){for(let e of this.column_names){let t=this.columns[e];if(this.columns.__ROW_PATH__){let e=[];for(let s=0;s<t.length;s++)this.columns.__ROW_PATH__[s].length===this.pivot_length&&e.push(t[s]);t=e}yield{name:e,data:t}}}}class H{constructor(e){this.dict={},this.names=[],this.type=e}clean(e){return"string"===this.type?(e in this.dict||(this.dict[e]=Object.keys(this.dict).length,this.names.push(z(e))),this.dict[e]):void 0===e||""===e||isNaN(e)?null:e}}class V{constructor(e,t){this.schema=e,this.xaxis_clean=new H(e[t[0]]),this.yaxis_clean=new H(e[t[1]]),this.color_clean=new H(e[t[2]])}make(e,t,s){let i={};if(i.x=e[t[0]],null!==i.x||null!==e[t[1]]){if(i.x=this.xaxis_clean.clean(i.x),i.y=0,t.length>1&&(i.y=e[t[1]],i.y=this.yaxis_clean.clean(i.y)),t.length>2){let o=e[t[2]];if("string"===this.schema[t[2]]){let e=this.color_clean.clean(o);i.marker={lineColor:e,fillColor:e}}else isNaN(o)||(s[0]=Math.min(s[0],o),s[1]=Math.max(s[1],o)),i.colorValue=o}return t.length>3&&(i.z=isNaN(e[t[3]])?1:e[t[3]]),"__ROW_PATH__"in e&&(i.name=e.__ROW_PATH__.join(", ")),i}}make_col(e,t,s,i,o,r,n=!1){let l=[],a=e;if(0===e.length)return l;if(void 0===e.length){a=[];for(let s of t)a.push(e[s])}for(let e=0;e<a[0].length;e++){if(null===a[0][e]||void 0===a[0][e]||""===a[0][e])continue;let c={};if(o){if(o[e].length!==i)continue;c.name=o[e].join(", ")}if(c.x=this.xaxis_clean.clean(a[0][e]),s>1&&(c.y=this.yaxis_clean.clean(a[1][e])),t.length>2&&null!==t[2]){let s=a[2][e];if("string"===this.schema[t[2]])if(n)c.colorValue=s;else{let e=this.color_clean.clean(s);c.marker={lineColor:e,fillColor:e},c.colorValue=e}else isNaN(s)||(r[0]=Math.min(r[0],s),r[1]=Math.max(r[1],s)),c.colorValue=s}if(t.length>3&&null!==t[3]){let t=a[3][e];c.z=n?t:isNaN(t)?1:t}let h=3;for(;"string"==typeof t[++h];)c.tooltip=[]||!1,c.tooltip.push(a[h][e]);l.push(c)}return l}}function G(e,t,s,i,o){const r=new R(e,i.length);let n=[];const l=s.filter(e=>null!==e);let a=[1/0,-1/0],c=new V(t,r.column_names),h=r.columns.__ROW_PATH__;if(0===o.length){let e=P(c.make_col(r.columns,s,l.length,r.pivot_length,h,a,!0)," ");n.push(e)}else{let e={};if(h){let e=[];for(let t=0;t<h.length;t++)h[t].length===r.pivot_length&&e.push(h[t]);h=e}let t=0;for(let i of r){let o=i.name.split(q),u=o.slice(0,o.length-1).join(", ")||" ";for(void 0===e[u]&&(e[u]=[]),e[u].push(i.data);null===s[++t];)e[u].push(null);if(e[u].length===s.length){let i=c.make_col(e[u],s,l.length,r.pivot_length,h,a);t=0;let o=P(i,u);n.push(o)}}}return[n,{categories:c.xaxis_clean.names},a,{categories:c.yaxis_clean.names}]}function Y(e,t,s){let[i,o]=function(e,t){let s=new W(t.length,e),i=new N(s);var o=[];for(let e of i)for(let t of i.columns){let s=t.split(q),r=s[s.length-1];s=i.is_stacked?s.join(", ")||r:s.slice(0,s.length-1).join(", ")||" ";let n=M(o,s,r),l=e[t];l=void 0===l||""===l?null:l,n.data.push(l)}return[o,s.top]}(e,t);"string"!==s&&void 0!==s&&(i=i.reverse());let r=[1/0,-1/0],n=function(e){let t=e.map(e=>e.name.split(",")),s={name:null,depth:0,categories:[]},i=t[0].length;for(let e=0;e<t.length;++e){let o=t[e],r=s;for(let e=0;e<o.length;++e){let t=o[e];if(e===i-1)r.categories.push(t);else{let s=r.categories.length;if(s>0&&r.categories[s-1].name==t)r=r.categories[s-1];else{let s={name:t,depth:e+1,categories:[]};r.categories.push(s),r=s}}}}return s}(i),l=[];for(let e=0;e<i[0].data.length;++e)for(let t=0;t<i.length;++t){let s=i[t].data[e];l.push([e,t,s]),r[0]=Math.min(r[0],s),r[1]=Math.max(r[1],s)}if(r[0]*r[1]<0){let e=Math.max(Math.abs(r[0]),Math.abs(r[1]));r=[-e,e]}return i=l,[i,o,n,r]}class E extends W{*[Symbol.iterator](){let e=this.top;for(let t of this.json){let s=t.__ROW_PATH__||[""];s.length>0&&s.length<this.depth?e=this.add_label(s):s.length>=this.depth&&e.categories.push(z(s[s.length-1])),yield t}}}function D(e,t,s,i){let o=new E(t.length,e),r=new N(o),n=[];for(let e of r){let i=e.__ROW_PATH__.map(e=>null===e?"-":e),o=i.join(", "),l=i.slice(-1)[0],a=i.slice(0,-1).join(", ");for(let i=0;i<r.columns.length;i++){let c=r.columns[i],h=c.split(q),u=h[h.length-1];if(h=h.slice(0,h.length-1).join(", ")||" ",i%s.length==0){M(n,h,u).data.push({id:o,name:l,value:e[c],colorValue:s.length>1?e[r.columns[i+1]]:void 0,parent:a,leaf:e.__ROW_PATH__.length===t.length})}}}let l=function(e,t){let s=[];for(let i of e){let e=i.name.split(q);s.push({layoutAlgorithm:"squarified",allowDrillToNode:!0,alternateStartingDirection:!0,data:i.data.slice(1),levels:t,title:e,stack:i.stack})}return s}(n,function(e){let t=[];for(let s=0;s<e.length;s++)t.push({level:s+1,borderWidth:2*(e.length-s),dataLabels:{enabled:!0,allowOverlap:!0,style:{opacity:[1,.3][s]||0,fontSize:"".concat([14,10][s]||0,"px"),textOutline:null}}});return t}(t)),a=function(e,t,s){let i;if(e.length>=2){i=[1/0,-1/0];for(let e of t){let t=e.data;for(let e=1;e<t.length;++e)(s&&t[e].leaf||!s)&&(i[0]=Math.min(i[0],t[e].colorValue),i[1]=Math.max(i[1],t[e].colorValue));if(i[0]*i[1]<0){let e=Math.max(Math.abs(i[0]),Math.abs(i[1]));i=[-e,e]}}}return i}(s,n,i);return[l,o.top,a]}s(22);var F=s(1);function X(e,t,s){const i=J(t,U(e,s));return"NaN"===i||null==i?"":"<span>".concat(e,": <b>").concat(i,"</b></span><br/>")}function B(e,t){if(t.length<=0)return"";let s=[];for(let i=0;i<e.length;i++)s.push("<span>".concat(e[i],": <b>").concat(t[i],"</b></span><br/>"));return s.join("")}function I(e){let t=[],s=e.parent;for(t.unshift(e.name);void 0!==s;)void 0!==s.name&&t.unshift(s.name),s=s.parent;return t}function U(e,t){return t[e]}function K(e){return null!=e&&" "!==e}function J(e,t){return"datetime"===t?new Date(e).toLocaleString("en-us",Object(F.get_type_config)("datetime").format):"date"===t?new Date(e).toLocaleString("en-us",Object(F.get_type_config)("date").format):"float"===t||"integer"===t?(s=e,"float"===t?Number.parseFloat(s).toLocaleString(Object(F.get_type_config)("float").format):Number.parseInt(s).toLocaleString(Object(F.get_type_config)("float").format)):e;var s}function Z(e,t,...s){if((e.series[0].data?e.series[0].data.length*e.series.length:e.series.length)>5e3)return Object.assign(e,{boost:{useGPUTranslations:-1===s.indexOf("datetime")&&-1===s.indexOf("date"),usePreAllocated:-1===s.indexOf("datetime")&&-1===s.indexOf("date")}}),e.plotOptions.series.boostThreshold=1,e.plotOptions.series.turboThreshold=0,!0}function Q(e){let t=Math.min(6,Math.max(3,Math.floor((this.clientWidth+this.clientHeight)/Math.max(300,e.series[0].data.length/3))));e.plotOptions.coloredScatter={marker:{radius:t}},e.plotOptions.scatter={marker:{radius:t}}}function $(e,t,s,i,o,r){"string"===i?ee(e,t,o,r):function(e,t,s,i){let o={type:["datetime","date"].indexOf(i)>-1?"datetime":void 0,startOnTick:!1,endOnTick:!1,title:{style:{color:"#666666",fontSize:"14px"},text:s}};"yAxis"===t&&Object.assign(o,{labels:{overflow:"justify"}});Object.assign(e,{[t]:o})}(e,t,s,i)}function ee(e,t,s,i){if("datetime"===s)Object.assign(e,{[t]:{categories:i.categories.map(e=>new Date(e).toLocaleString("en-us",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"})),labels:{enabled:i.categories.length>0,autoRotation:[-5]}}});else if("date"===s)Object.assign(e,{[t]:{categories:i.categories.map(e=>new Date(e).toLocaleString("en-us",{year:"numeric",month:"numeric",day:"numeric"})),labels:{enabled:i.categories.length>0,autoRotation:[-5]}}});else{let s={categories:i.categories,labels:{enabled:i.categories.length>0,padding:0,autoRotation:[-10,-20,-30,-40,-50,-60,-70,-80,-90]}};"yAxis"!==t||e.hasOwnProperty("boost")&&"heatmap"!==e.chart.type||Object.assign(s,{title:null,tickWidth:1,reversed:!0}),Object.assign(e,{[t]:s})}}function te(e,t){let s="scatter",i="xy";"y_line"===t?(i="y",s="line"):"y_area"===t?(i="y",s="area"):"y_scatter"===t?(i="y",s="scatter"):t.indexOf("bar")>-1?(i="y",s="column"):"treemap"==t?(i="hierarchy",s="treemap"):"sunburst"==t?(i="hierarchy",s="sunburst"):"scatter"===t?(i="xy",s=e.length<=3||null===e[3]?"scatter":"bubble"):"heatmap"===t&&(i="xyz",s="heatmap");const o=this,r=this._config,n=(l=r.row_pivots,a=r.column_pivots,{row:l,column:a});var l,a;return{chart:{type:s,inverted:"x_"===t.slice(0,2),animation:!1,zoomType:"scatter"===t?"xy":"x",resetZoomButton:{position:{align:"left"}}},navigation:{buttonOptions:{enabled:!1}},credits:{enabled:!1},title:{text:null},legend:{align:"right",verticalAlign:"top",y:10,layout:"vertical",enabled:!1,itemStyle:{fontWeight:"normal"}},boost:{enabled:!1},plotOptions:{area:{stacking:"normal",marker:{enabled:!1,radius:0}},line:{marker:{enabled:!1,radius:0}},coloredScatter:{},scatter:{},column:{stacking:"normal",states:{hover:{brightness:-.1,borderColor:"#000000"}}},heatmap:{nullColor:"rgba(0,0,0,0)"},series:{animation:!1,nullColor:"rgba(0,0,0,0)",boostThreshold:0,turboThreshold:6e4,borderWidth:0,connectNulls:!0,lineWidth:-1===t.indexOf("line")?0:1.5,states:{hover:{lineWidthPlus:0}},point:{events:{click:async function(){let i=[],n=[];if("bubble"===s&&"scatter"===t||"scatter"===s&&"scatter"===t||"scatter"===s&&"line"===t)n=this.series.userOptions.name.split(", "),i=this.name?this.name.split(", "):[];else{if("column"!==s&&"line"!==s&&"scatter"!==s&&"area"!==s)return void console.log("Click dispatch for ".concat(t," ").concat(s," not supported."));n=this.series.userOptions.name.split(", "),i=I(this.category)}const l=r.row_pivots.map((e,t)=>[e,"==",i[t]]),a=r.column_pivots.map((e,t)=>[e,"==",n[t]]),c=r.filter.concat(l).concat(a).filter(e=>!!e[e.length-1]),h=this.index+1,u=h+1;let p=[];if("bubble"===s&&"scatter"===t||"scatter"===s&&"scatter"===t||"scatter"===s&&"line"===t)p=e;else{const e=this.series.userOptions?this.series.userOptions.stack:"",t=n[n.length-1];(e=>""==e.replace(/\s/g,""))(t)?p.push(e):p.push(t)}const d=await o._view.to_json({start_row:h,end_row:u});o.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{column_names:p,config:{filters:c},row:d[0]}}))}}}}},tooltip:{animation:!1,backgroundColor:"#FFFFFF",borderColor:"#777777",followPointer:!1,valueDecimals:2,formatter:function(t){return o._view.schema(!1).then(s=>{let o=function(e,t,s,i,o){const r=o.row,n=o.column,l=r.length>0,a=n.length>0;if("y"===t){let t="",i="";if(l){t=B(r,I(e.key))}if(a){i=B(n,e.series.userOptions.name.split(", "))}const o=e.series.userOptions.stack,c=U(o,s);return"".concat(t,"\n                ").concat(i,"\n                <span>").concat(o,": </span><b>").concat(J(e.y,c),"</b>")}if("xy"===t){const t=K(i[0]),o=K(i[1]),c=K(i[2]),h=K(i[3]);let u="",p="",d="",f="",m="",g="",b="";if(l){u=B(r,e.key.split(","))}if(a){p=B(n,e.point.series.name.split(","))}if(t){f=X(i[0],e.x,s)}if(o){m=X(i[1],e.y,s)}if(c){g=X(i[2],e.point.colorValue,s)}if(h){b=X(i[3],e.point.z,s)}if(e.point.tooltip&&e.point.tooltip.length>0)for(let t=0;t<e.point.tooltip.length;t++)d+=X(i[4+t],e.point.tooltip[t],s);return[u,p,f,m,g,b,d].join("")}if("xyz"===t)return"<span>".concat(J(e.point.value),"</span>");if("hierarchy"===t)return"<span>".concat(e.point.id,": </span><b>").concat(J(e.x),"</b>");let c;return c=e.x?e.x:e.y,c}(this,i,s,e,n);t.label.attr({text:o})}).catch(e=>console.error(e)),"Loading..."},positioner:function(e,t,s){let i,o,r=this.chart;return i=s.plotX+e>r.plotWidth?s.plotX+r.plotLeft-e-5:s.plotX+r.plotLeft,o=s.plotY+t>r.plotHeight?s.plotY+r.plotTop-t:s.plotY+r.plotTop,{x:i,y:o}}}}}var se,ie=s(17),oe=s(18),re=s.n(oe);function ne(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(ne.prototype,HTMLElement.prototype),Object.setPrototypeOf(ne,HTMLElement);const le=Symbol("Highcharts private");function ae(e){let t;return this[le]=this[le]||{},t=this[le].chart?this[le].chart:this[le].chart=document.createElement("perspective-highcharts"),document.body.contains(t)||(e.innerHTML="",e.appendChild(t)),t}const ce=(e,t,s)=>(async function(i,o,r,n,l){if(t&&(this._config=await o.get_config(),r.cancelled))return;const a=await o.get_config(),c=a.row_pivots,h=a.column_pivots,u=a.columns,p=JSON.parse(this.getAttribute("columns")),[d,f]=await Promise.all([o.schema(!1),this._table.schema(!1)]);let m;if(r.cancelled)return;let g=[],b=u.length>0?u[0]:void 0,_=d[b],y=u.length>1?u[1]:void 0,x=d[y],v=f[c.length>0?c[c.length-1]:void 0],j=f[h.length>0?h[h.length-1]:void 0],w=u.length;try{if("scatter"===e){let t;t=n||l?await o.to_columns({end_col:n,end_row:l,leaves_only:!0}):await o.to_columns();const i=g[0]=te.call(this,p,e),[r,a,u,f]=G(t,d,p,c,h);i.legend.floating=r.length<=20,i.legend.enabled=h.length>0,i.series=r,i.colors=r.length<=10?O:k,u[0]!==1/0?(p.length<=3||null===p[3]?i.chart.type="coloredScatter":i.chart.type="coloredBubble",C.call(this,i,u,s)):p.length>3&&null!==p[3]&&(i.chart.type="bubble"),w<3&&Z(i,0,x),$(i,"xAxis",b,_,_,a),$(i,"yAxis",y,x,x,f),Q.call(this,i)}else if("heatmap"===e){let t;t=n||l?await o.to_json({end_col:n,end_row:l,leaves_only:!1}):await o.to_json();let i=g[0]=te.call(this,u,e),[r,a,h,p]=Y(t,c,j);i.series=[{name:null,data:r,nullColor:"none"}],i.legend.enabled=!0,i.legend.floating=!1,C.call(this,i,p,s),Z(i,0,x),ee(i,"xAxis",v,a),ee(i,"yAxis",j,h)}else if("treemap"===e||"sunburst"===e){let t;t=n||l?await o.to_json({end_col:n,end_row:l,leaves_only:!1}):await o.to_json();let[i,,r]=D(t,c,u,"treemap"===e);for(let t of i){let o=te.call(this,u,e);o.series=[t],i.length>1&&(o.title.text=t.title),o.plotOptions.series.borderWidth=1,o.legend.floating=!1,r&&C.call(this,o,r,s),g.push(o)}}else if("line"===e){let t,s=g[0]=te.call(this,u,e);if(0===h.length){let e;e=n||l?await o.to_columns({end_col:n,end_row:l,leaves_only:!0}):await o.to_columns(),t=await G(e,d,u,c,h)}else{let e;e=n||l?await o.to_json({end_col:n,end_row:l,leaves_only:!1}):await o.to_json(),t=await function(e,t,s,i,o){let r=new W(i.length,e),n=new N(r),l=[],a=[1/0,-1/0],c=new V(t,s);if(0===o.length){let e=M(l," ");for(let t of n){let i=c.make(t,s,a);i&&e.data.push(i)}}else{let t,s,i=[],o=Object.keys(e[0]).filter(e=>"__ROW_PATH__"!==e);for(let e of o){let o=e.split(q),r=o.slice(0,o.length-1).join(", ")||" ";if(void 0===t&&(t=r),s=M(l,t),t===r)i.push(e);else{for(let e of n){let t=c.make(e,i,a);t&&s.data.push(t)}t=r,i=[e]}}for(let e of n){let t=c.make(e,i,a);t&&s.data.push(t)}}return[l,{categories:c.xaxis_clean.names},a,{categories:c.yaxis_clean.names}]}(e,d,u,c,h)}const i=t[0],r=t[1],a=t[3],p=i.length<=10?O:k;s.legend.floating=i.length<=20,s.legend.enabled=h.length>0,s.series=i,s.plotOptions.scatter.marker={enabled:!1,radius:0},s.colors=p,Z(s,0,x)&&delete s.chart.type,$(s,"xAxis",b,_,_,r),$(s,"yAxis",y,x,x,a)}else{let t,s=g[0]=te.call(this,u,e);t=n||l?await o.to_columns({end_col:n,end_row:l,leaves_only:!1}):await o.to_columns();let[i,r]=function(e,t){let s=[],i=new L(e,t.length),o=new R(e,t.length);for(let e of o){let t=e.name.split(q),i=t[t.length-1];t=o.is_stacked?t.join(", ")||i:t.slice(0,t.length-1).join(", ")||" ";let r=P(e.data.map(e=>void 0===e||""===e?null:e),t,i);s.push(r)}return[s,i.axis]}(t,c);s.series=i,s.colors=i.length<=10?O:k,s.legend.enabled=h.length>0||i.length>1,s.legend.floating=i.length<=20,s.plotOptions.series.dataLabels={allowOverlap:!1,padding:10},(e.indexOf("scatter")>-1||e.indexOf("line")>-1)&&Z(s,0,x),ee(s,"xAxis",v,r),Object.assign(s,{yAxis:{startOnTick:!1,endOnTick:!1,title:{text:u.join(",  "),style:{color:"#666666",fontSize:"14px"}},labels:{overflow:"justify"}}})}}finally{m=ae.call(this,i),(s||this.hasAttribute("updating"))&&m.delete()}m.render(e,g,this)});Object(ie.bindTemplate)(a.a,n.a)(se=class extends ne{constructor(){super(),this._charts=[]}connectedCallback(){this._container=this.shadowRoot.querySelector("#container")}render(e,t,s){if(this._charts.length>0&&this._charts.length===t.length){let i=0;for(let r=0;r<this._charts.length;r++){const n=this._charts[r];let l=t[i++];if(l.boost){let e=n.renderTo;try{n.destroy()}catch(e){console.warn("Scatter plot destroy() call failed - this is probably leaking memory")}this._charts[r]=o.a.chart(e,l)}else if("scatter"===e){let e={series:l.series,plotOptions:{}};Q.call(s,e),n.update(e)}else{let e={series:l.series,xAxis:l.xAxis,yAxis:l.yAxis};n.update(e)}}}else{this.delete();for(let e of t){let t=document.createElement("div");t.className="chart",this._container.appendChild(t),this._charts.push(()=>o.a.chart(t,e))}for(let e=0;e<this._charts.length;e++)this._charts[e]=this._charts[e]()}this._charts.every(e=>this._container.contains(e.renderTo))||(this.remove(),this._charts.map(e=>this._container.appendChild(e.renderTo))),t.length>1&&this.resize(),re()()&&setTimeout(()=>this.resize())}resize(){this._charts&&this._charts.length>0&&this._charts.map(e=>e.reflow())}remove(){this._charts=[];for(let e of Array.prototype.slice.call(this._container.children))"DIV"===e.tagName&&this._container.removeChild(e)}delete(){for(let e of this._charts)try{e.destroy()}catch(e){console.warn("Scatter plot destroy() call failed - this is probably leaking memory")}this.remove()}});var he=s(19);function ue(){this[le]&&this[le].chart.resize()}function pe(){this[le]&&this[le].chart.delete()}const de=25e3,fe=25e3,me=1e5,ge=25e3,be=2500,_e=1e3,ye=2e4,xe=100,ve=100,je=100,we=100,Oe=24,ke=24,Ae=24,Te={x_bar:{name:"X Bar Chart",create:ce("x_bar",!0),update:ce("x_bar",!1),resize:ue,initial:{type:"number",count:1},selectMode:"select",delete:pe,max_cells:ge,max_columns:we},y_bar:{name:"Y Bar Chart",create:ce("y_bar",!0),update:ce("y_bar",!1),resize:ue,initial:{type:"number",count:1},selectMode:"select",delete:pe,max_cells:ge,max_columns:we},y_line:{name:"Y Line Chart",create:ce("y_line",!0),update:ce("y_line",!1),resize:ue,initial:{type:"number",count:1},selectMode:"select",delete:pe,max_cells:de,max_columns:xe},y_scatter:{name:"Y Scatter Chart",create:ce("y_scatter",!0),update:ce("y_scatter",!1),resize:ue,initial:{type:"number",count:1},selectMode:"select",delete:pe,max_cells:me,max_columns:je},y_area:{name:"Y Area Chart",create:ce("y_area",!0),update:ce("y_area",!1),resize:ue,initial:{type:"number",count:1},selectMode:"select",delete:pe,max_cells:fe,max_columns:ve},xy_line:{name:"X/Y Line Chart",create:ce("line",!0),update:ce("line",!1),resize:ue,initial:{type:"number",count:2,names:["X Axis","Y Axis","Tooltip"]},selectMode:"toggle",delete:pe,max_cells:me,max_columns:je},xy_scatter:{name:"X/Y Scatter Chart",create:ce("scatter",!0),update:ce("scatter",!1),resize:ue,styleElement:ce("scatter",!1,!0),initial:{type:"number",count:2,names:["X Axis","Y Axis","Color","Size","Tooltip"]},selectMode:"toggle",delete:pe,max_cells:me,max_columns:je},treemap:{name:"Treemap",create:ce("treemap",!0),update:ce("treemap",!1),resize:ue,styleElement:ce("treemap",!1,!0),initial:{type:"number",count:1,names:["Size","Color"]},selectMode:"toggle",delete:function(){},max_cells:be,max_columns:Oe},sunburst:{name:"Sunburst",create:ce("sunburst",!0),update:ce("sunburst",!1),styleElement:ce("sunburst",!1,!0),resize:ue,initial:{type:"number",count:1,names:["Size","Color"]},selectMode:"toggle",delete:function(){},max_cells:_e,max_columns:ke},heatmap:{name:"Heatmap",create:ce("heatmap",!0),update:ce("heatmap",!1),resize:ue,initial:{type:"number",count:1},selectMode:"select",delete:pe,max_cells:ye,max_columns:Ae}};!function(...e){e=e.length>0?e:Object.keys(Te);for(const t of e)Object(he.registerPlugin)(t,Te[t])}()}])}));
//# sourceMappingURL=perspective-viewer-highcharts.js.map